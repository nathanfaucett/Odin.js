var define;"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/config",[],function(){function Config(){this.debug=!1,this.host="127.0.0.1",this.port=3e3,this.FAKE_LAG=0,this.SCENE_SYNC_RATE=.5,this.MAX_SCENE_STATES=5,this.MIN_DELTA=1e-6,this.MAX_DELTA=1}var hasOwnProperty=Object.prototype.hasOwnProperty;return Config.prototype.fromJSON=function(json){for(var key in json){void 0!=this[key]&&(this[key]=json[key])}return this},Config.prototype.toJSON=function(json){json||(json={});for(var key in this){void 0!=this[key]&&hasOwnProperty.call(this,key)&&(json[key]=this[key])}return json},new Config}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/time",["odin/core/game/config"],function(Config){function now(){return.001*performance.now()}function Time(){this.start=START,this.sinceStart=0,this.time=0,this.fps=60,this.delta=DELTA,this.frameCount=0,defineProperty(this,"scale",{get:function(){return SCALE},set:function(value){SCALE=value,FIXED_DELTA=GLOBAL_FIXED*value}}),defineProperty(this,"fixedDelta",{get:function(){return FIXED_DELTA},set:function(value){GLOBAL_FIXED=value,FIXED_DELTA=GLOBAL_FIXED*SCALE}})}var DateNow,HR_TIME,frameCount,last,time,delta,fpsFrame,fpsLast,fpsTime,isServer="undefined"==typeof window,w=isServer?{}:window,performance="undefined"!=typeof w.performance?w.performance:{},defineProperty=Object.defineProperty,START_MS=Date.now(),START=.001*START_MS,DELTA=1/60,FIXED_DELTA=DELTA,GLOBAL_FIXED=DELTA,SCALE=1;return isServer?(HR_TIME=process.hrtime(),DateNow=function(){var hrtime=process.hrtime(HR_TIME),s=1e3*hrtime[0],ns=1e-6*hrtime[1];return s+ns}):DateNow=function(){return Date.now()-START_MS},performance.now||(performance.now=performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow||DateNow),Time.prototype.now=now,Time.prototype.stamp=function(){return.001*Date.now()},Time.prototype.stampMS=function(){return Date.now()},frameCount=0,last=-1/60,time=0,delta=1/60,fpsFrame=0,fpsLast=0,fpsTime=0,Time.prototype.update=function(){var MIN_DELTA=Config.MIN_DELTA,MAX_DELTA=Config.MAX_DELTA;this.frameCount=frameCount++,last=time,time=now(),this.sinceStart=time,fpsTime=time,fpsFrame++,fpsTime>fpsLast+1&&(this.fps=fpsFrame/(fpsTime-fpsLast),fpsLast=fpsTime,fpsFrame=0),delta=(time-last)*SCALE,this.delta=MIN_DELTA>delta?MIN_DELTA:delta>MAX_DELTA?MAX_DELTA:delta,this.time=time*SCALE},new Time}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/util",[],function(){function isObject(obj){return obj===Object(obj)}function isArrayLike(obj){return"object"==typeof obj&&"number"==typeof obj.length}function isArguments(obj){return"[object Arguments]"===toString.call(obj)}function isFunction(obj){return"function"==typeof obj}function isString(obj){return"[object String]"===toString.call(obj)}function isNumber(obj){return"[object Number]"===toString.call(obj)}function isDecimal(obj){return isNumber(obj)&&obj%1!==0}function isInteger(obj){return isNumber(obj)&&obj%1===0}function isDate(obj){return"[object Date]"===toString.call(obj)}function isRegExp(obj){return"[object RegExp]"===toString.call(obj)}function isBoolean(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)}function isNull(obj){return null===obj}function isUndefined(obj){return void 0===obj}function has(obj,key){return hasOwnProperty.call(obj,key)}function format(fmt){var i=1,args=arguments,len=args.length;return String(fmt).replace(FORMAT_REGEX,function(x){if("%%"===x){return"%"}if(i>=len){return x}if("%s"===x){return String(args[i++])}if("%d"===x){return Number(args[i++])}if("%j"!==x){return x}try{return JSON.stringify(args[i++])}catch(e){return"[Circular]"}})}function camelize(word,lowFirstLetter){var part,i,il,parts=word.split(SPILTER),string="";for(i=0,il=parts.length;il>i;i++){part=parts[i],string+=part[0].toUpperCase()+part.slice(1).toLowerCase()}return lowFirstLetter?string[0].toLowerCase()+string.slice(1):string}function underscore(word){return word.replace(SPILTER,"").replace(UNDERSCORE,"$1_$2").toLowerCase()}function merge(obj,add){var key;for(key in add){void 0==obj[key]&&(obj[key]=add[key])}return obj}function override(obj,add){var key;for(key in add){void 0!=add[key]&&(obj[key]=add[key])}return obj}function copy(obj,out){var key,i,il,type=typeof obj;if("object"!==type){return obj}if(isArrayLike(obj)){for(out=[],i=0,il=obj.length;il>i;i++){out[i]=copy(obj[i])}}else{if(isObject(obj)){out={};for(key in obj){out[key]=copy(obj[key])}}}return out}function clear(obj){var key;for(key in obj){delete obj[key]}return obj}function arrayBufferToBase64(buffer){for(var binary="",bytes=new Uint8Array(buffer),len=bytes.byteLength,i=0;len>i;i++){binary+=String.fromCharCode(bytes[i])}return isServer?new Buffer(binary.toString(),"binary").toString("base64"):window.btoa(binary)}function base64ToArrayBuffer(str){for(var binary=isServer?new Buffer(str,"base64").toString("binary"):window.atob(str),len=binary.length,bytes=new Uint8Array(len).i=0;len>i;i++){bytes[i]=str.charCodeAt(i)}return bytes.buffer}function uid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(UID_REPLACER,function(c){var a=16*random()|0;return("x"==c?a:3&a|8).toString(16)})}function each(obj,iterator,ctx){var i,length,objKeys;if(null!=obj){if(ArrayForEach&&obj.forEach===ArrayForEach){obj.forEach(iterator,ctx)}else{if(obj.length===+obj.length){for(i=0,length=obj.length;length>i;i++){if(iterator.call(ctx,obj[i],i,obj)===!1){return}}}else{for(objKeys=keys(obj),i=0,length=objKeys.length;length>i;i++){if(iterator.call(ctx,obj[objKeys[i]],objKeys[i],obj)===!1){return}}}}}}var UID_REPLACER,util={},random=Math.random,isServer="undefined"==typeof window,ObjectProto=Object.prototype,toString=ObjectProto.toString,hasOwnProperty=ObjectProto.hasOwnProperty,ArrayProto=Array.prototype,ArrayForEach=ArrayProto.forEach,keys=Object.keys||(Object.keys=function(obj){var key,out=[];for(key in obj){hasOwnProperty.call(obj,key)&&out.push(key)}return out}),isArray=Array.isArray||(Array.isArray=function(obj){return"[object Array]"===toString.call(obj)}),SPILTER=/[ \_\-\.]+|(?=[A-Z][^A-Z])/g,UNDERSCORE=/([a-z])([A-Z])/g,FORMAT_REGEX=/%[sdj%]/g;return util.isObject=isObject,util.isArrayLike=isArrayLike,util.isArray=isArray,util.isArguments=isArguments,util.isFunction=isFunction,util.isString=isString,util.isNumber=isNumber,util.isDecimal=isDecimal,util.isInteger=isInteger,util.isDate=isDate,util.isRegExp=isRegExp,util.isFinite=isFinite,util.isNaN=isNaN,util.isBoolean=isBoolean,util.isNull=isNull,util.isUndefined=isUndefined,util.has=has,util.format=format,util.camelize=camelize,util.underscore=underscore,util.merge=merge,util.override=override,util.copy=copy,util.clear=clear,util.keys=keys,util.arrayBufferToBase64=arrayBufferToBase64,util.base64ToArrayBuffer=base64ToArrayBuffer,UID_REPLACER=/[xy]/g,util.uid=uid,util.each=each,isServer||(util.createWorker=function(fn){var blobURL=URL.createObjectURL(new Blob(["("+fn.toString()+")()"],{type:"application/javascript"})),worker=new Worker(blobURL);return URL.revokeObjectURL(blobURL),worker},util.ajax=function(opts){opts||(opts={});var request=new XMLHttpRequest,src=opts.src,method=opts.method||(opts.method="GET"),before=opts.before,success=opts.success,error=opts.error,async=void 0!=opts.async?!!opts.async:!0;request.addEventListener("load",function(){var status=this.status;if(status>199&&301>status||304==status){"function"==typeof success&&success.call(this)}else{if("function"!=typeof error){throw new Error(method+" "+src+" "+status)}error.call(this,new Error(method+" "+src+" "+status))}},!1),request.addEventListener("error",function(){if("function"!=typeof error){throw new Error(method+" "+src)}error(new Error(method+" "+src))},!1),request.open(method,src,async),"function"==typeof before&&before.call(request),request.send()}),util}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/enum",["odin/base/util"],function(util){function Enum(enums){enums=isArray(enums)?enums:enums.split(SPLITER);for(var i=enums.length;i--;){this[enums[i]]=++COUNTER}}var isArray=util.isArray,SPLITER=/[ ,]+/,COUNTER=0;return Enum.prototype.add=function(enums){enums=isArray(enums)?enums:enums.split(SPLITER);for(var i=enums.length;i--;){this[enums[i]]=++COUNTER}return this},Enum.prototype.in=function(num){var key;for(key in this){if(this[key]==num){return!0}}return!1},Enum}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2enums",["odin/base/enum"],function(Enum){return{BodyType:new Enum("Particle RigidBody"),ShapeType:new Enum("Convex Circle Segment"),MotionState:new Enum("Dynamic Static Kinematic"),SleepState:new Enum("Awake Sleepy Sleeping")}}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/collision/p2broadphase",["odin/phys2d/p2enums"],function(P2Enums){function P2Broadphase(){}function bodiesNeedsBroadphase(bi,bj){return bi.motionState!==MotionState.Dynamic&&bj.motionState!==MotionState.Dynamic?!1:bi.sleepState===SleepState.Sleeping&&bj.sleepState===SleepState.Sleeping?!1:bi.aabb&&bj.aabb&&!bi.aabb.intersects(bj.aabb)?!1:!0}function shapesNeedsBroadphase(bi,bj,si,sj,pairsi,pairsj){return si||sj?si?sj?0===(si.filterGroup&sj.filterMask)||0===(sj.filterGroup&si.filterMask)?!1:!0:(pairsi.push(si),pairsj.push(bj),!1):(pairsi.push(bi),pairsj.push(sj),!1):!1}var MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return P2Broadphase.prototype.collisions=function(bodies,pairsi,pairsj){var bi,bj,shapesi,shapesj,shapesNumi,shapesNumj,si,sj,i,j,k,l,num=bodies.length;for(pairsi.length=pairsj.length=0,i=0;num>i;i++){for(j=0;j!==i;j++){if(bi=bodies[i],bj=bodies[j],bodiesNeedsBroadphase(bi,bj)){for(shapesi=bi.shapes,shapesj=bj.shapes,shapesNumi=shapesi.length,shapesNumj=shapesj.length,k=shapesNumi;k--;){for(l=shapesNumj;l--;){si=shapesi[k],sj=shapesj[l],shapesNeedsBroadphase(bi,bj,si,sj,pairsi,pairsj)&&si.aabb.intersects(sj.aabb)&&(pairsi.push(si),pairsj.push(sj))}}}}}},P2Broadphase}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/object_pool",[],function(){function ObjectPool(constructor){this.pooled=[],this.objects=[],this.object=constructor}return ObjectPool.prototype.create=function(){var pooled=this.pooled,object=pooled.length?pooled.pop():new this.object;return this.objects.push(object),object},ObjectPool.prototype.removeObject=function(object){var objects=this.objects,pooled=this.pooled,index=objects.indexOf(object);return index>-1&&(pooled.push(object),objects.splice(index,1)),this},ObjectPool.prototype.remove=ObjectPool.prototype.removeObjects=function(){for(var i=arguments.length;i--;){this.removeObject(arguments[i])}return this},ObjectPool.prototype.clear=function(){for(var objects=this.objects,pooled=this.pooled,i=objects.length;i--;){pooled.push(objects[i])}return objects.length=0,this},ObjectPool.prototype.clearForEach=function(fn){for(var object,objects=this.objects,pooled=this.pooled,i=objects.length;i--;){object=objects[i],pooled.push(object),fn(object)}return objects.length=0,this},ObjectPool.prototype.empty=function(){return this.pooled.length=this.objects.length=0,this},ObjectPool}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mathf",[],function(){function Mathf(){this.PI=PI,this.TWO_PI=TWO_PI,this.HALF_PI=HALF_PI,this.EPSILON=EPSILON,this.TO_RADS=TO_RADS,this.TO_DEGS=TO_DEGS}var modulo,clamp01,standardRadian,standardAngle,radsToDegs,n225,n675,n1125,n1575,n2025,n2475,n2925,n3375,RIGHT,UP_RIGHT,UP,UP_LEFT,LEFT,DOWN_LEFT,DOWN,DOWN_RIGHT,random=Math.random,abs=Math.abs,cos=Math.cos,pow=Math.pow,floor=Math.floor,ceil=Math.ceil,atan2=Math.atan2,EPSILON=1e-6,PI=3.141592653589793,TWO_PI=2*PI,HALF_PI=.5*PI,TO_RADS=PI/180,TO_DEGS=180/PI,keys=Object.keys;return Mathf.prototype._classes={},Mathf.prototype.acos=Math.acos,Mathf.prototype.asin=Math.asin,Mathf.prototype.atan=Math.atan,Mathf.prototype.atan2=Math.atan2,Mathf.prototype.cos=Math.cos,Mathf.prototype.sin=Math.sin,Mathf.prototype.tan=Math.tan,Mathf.prototype.abs=Math.abs,Mathf.prototype.ceil=Math.ceil,Mathf.prototype.exp=Math.exp,Mathf.prototype.floor=Math.floor,Mathf.prototype.log=Math.log,Mathf.prototype.max=Math.max,Mathf.prototype.min=Math.min,Mathf.prototype.pow=Math.pow,Mathf.prototype.random=Math.random,Mathf.prototype.round=Math.round,Mathf.prototype.sqrt=Math.sqrt,Mathf.prototype.equals=function(a,b,e){return abs(a-b)<(e||EPSILON)},Mathf.prototype.modulo=modulo=function(a,b){var r=a%b;return 0>r*b?r+b:r},Mathf.prototype.standardRadian=standardRadian=function(x){return modulo(x,TWO_PI)},Mathf.prototype.standardAngle=standardAngle=function(x){return modulo(x,360)},Mathf.prototype.sign=function(x){return 0>x?-1:1},Mathf.prototype.clamp=function(x,min,max){return min>x?min:x>max?max:x},Mathf.prototype.clampBottom=function(x,min){return min>x?min:x},Mathf.prototype.clampTop=function(x,max){return x>max?max:x},Mathf.prototype.clamp01=clamp01=function(x){return 0>x?0:x>1?1:x},Mathf.prototype.truncate=function(x,n){var p=pow(10,n),num=x*p;return(0>num?ceil(num):floor(num))/p},Mathf.prototype.lerp=function(a,b,x){return a+(b-a)*x},Mathf.prototype.lerpAngle=function(a,b,x){return standardRadian(a+(b-a)*x)},Mathf.prototype.lerpCos=function(a,b,x){var ft=x*PI,f=.5*(1-cos(ft));return a*(1-f)+b*f},Mathf.prototype.lerpCubic=function(v0,v1,v2,v3,x){v0||(v0=v1),v3||(v3=v2);var P=v3-v2-(v0-v1),Q=v0-v1-P,R=v2-v0,S=v1,Px=P*x,Qx=Q*x,Rx=R*x;return Px*Px*Px+Qx*Qx+Rx+S},Mathf.prototype.smoothStep=function(x,min,max){return min>=x?0:x>=max?1:(x=(x-min)/(max-min),x*x*(3-2*x))},Mathf.prototype.smootherStep=function(x,min,max){return min>=x?0:x>=max?1:(x=(x-min)/(max-min),x*x*x*(x*(6*x-15)+10))},Mathf.prototype.pingPong=function(x,length){return length||(length=1),length-abs(x%(2*length)-length)},Mathf.prototype.degsToRads=function(x){return standardRadian(x*TO_RADS)},Mathf.prototype.radsToDegs=radsToDegs=function(x){return standardAngle(x*TO_DEGS)},Mathf.prototype.randInt=function(min,max){return floor(min+random()*(max+1-min))},Mathf.prototype.randFloat=function(min,max){return min+random()*(max-min)},Mathf.prototype.randSign=function(){return random()<.5?1:-1},Mathf.prototype.randChoice=function(array){return array[random()*array.length|0]},Mathf.prototype.shuffle=function(array){for(var j,x,i=array.length;i;j=random()*i|0,x=array[--i],array[i]=array[j],array[j]=x){}return array},Mathf.prototype.randArg=function(){return arguments[random()*arguments.length|0]},Mathf.prototype.randChoiceObject=function(obj){var array=keys(obj);return array[random()*array.length|0]},Mathf.prototype.isPowerOfTwo=function(x){return(x&-x)===x},Mathf.prototype.floorPowerOfTwo=function(x){for(var prev,i=2;x>i;){prev=i,i*=2}return prev},Mathf.prototype.ceilPowerOfTwo=function(x){for(var i=2;x>i;){i*=2}return i},Mathf.prototype.fromJSON=function(json){return(new this._classes[json._className]).fromJSON(json)},n225=.39269908169872414,n675=1.1780972450961724,n1125=1.9634954084936207,n1575=2.748893571891069,n2025=3.5342917352885173,n2475=4.319689898685966,n2925=5.105088062083414,n3375=5.8904862254808625,RIGHT="right",UP_RIGHT="up_right",UP="up",UP_LEFT="up_left",LEFT="left",DOWN_LEFT="down_left",DOWN="down",DOWN_RIGHT="down_right",Mathf.prototype.directionAngle=function(a){return a=standardRadian(a),a>=n3375&&n225>a?RIGHT:a>=n225&&n675>a?UP_RIGHT:a>=n675&&n1125>a?UP:a>=n1125&&n1575>a?UP_LEFT:a>=n1575&&n2025>a?LEFT:a>=n2025&&n2475>a?DOWN_LEFT:a>=n2475&&n2925>a?DOWN:a>=n2925&&n3375>a?DOWN_RIGHT:RIGHT},Mathf.prototype.direction=function(x,y){var a=standardRadian(atan2(y,x));return a>=n3375&&n225>a?RIGHT:a>=n225&&n675>a?UP_RIGHT:a>=n675&&n1125>a?UP:a>=n1125&&n1575>a?UP_LEFT:a>=n1575&&n2025>a?LEFT:a>=n2025&&n2475>a?DOWN_LEFT:a>=n2475&&n2925>a?DOWN:a>=n2925&&n3375>a?DOWN_RIGHT:RIGHT},new Mathf}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec2",["odin/math/mathf"],function(Mathf){function Vec2(x,y){this.x=x||0,this.y=y||0}var sqrt=Math.sqrt;return Mathf._classes.Vec2=Vec2,Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)},Vec2.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this},Vec2.prototype.set=function(x,y){return this.x=x,this.y=y,this},Vec2.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this},Vec2.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},Vec2.prototype.sadd=function(s){return this.x+=s,this.y+=s,this},Vec2.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this},Vec2.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},Vec2.prototype.ssub=function(s){return this.x-=s,this.y-=s,this},Vec2.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this},Vec2.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this},Vec2.prototype.smul=function(s){return this.x*=s,this.y*=s,this},Vec2.prototype.div=function(other){var x=other.x,y=other.y;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this},Vec2.prototype.vdiv=function(a,b){var x=b.x,y=b.y;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this},Vec2.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this},Vec2.prototype.length=function(){var x=this.x,y=this.y,lsq=x*x+y*y;return 1===lsq?1:lsq>0?sqrt(lsq):0},Vec2.prototype.lengthSq=function(){var x=this.x,y=this.y;return x*x+y*y},Vec2.prototype.setLength=function(length){var x=this.x,y=this.y,l=x*x+y*y;return 1===l?(this.x*=length,this.y*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this)},Vec2.prototype.normalize=function(){var x=this.x,y=this.y,l=x*x+y*y;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this)},Vec2.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},Vec2.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this},Vec2.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this},Vec2.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this},Vec2.vdot=Vec2.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y},Vec2.prototype.dot=function(other){return this.x*other.x+this.y*other.y},Vec2.vcross=Vec2.prototype.vcross=function(a,b){return a.x*b.y-a.y*b.x},Vec2.prototype.cross=function(other){return this.x*other.y-this.y*other.x},Vec2.prototype.perp=function(){var x=this.x,y=this.y;return this.x=-y,this.y=x,this},Vec2.prototype.min=function(other){var ax=this.x,ay=this.y,bx=other.x,by=other.y;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this},Vec2.prototype.max=function(other){var ax=this.x,ay=this.y,bx=other.x,by=other.y;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this},Vec2.prototype.clamp=function(min,max){var x=this.x,y=this.y,minx=min.x,miny=min.y,maxx=max.x,maxy=max.y;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this},Vec2.prototype.transformAngle=function(a){var x=this.x,y=this.y,c=cos(a),s=sin(a);return this.x=x*c-y*s,this.y=x*s+y*c,this},Vec2.prototype.transformMat2=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[2],this.y=x*me[1]+y*me[3],this},Vec2.prototype.untransformMat2=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[1],this.y=x*me[2]+y*me[3],this},Vec2.prototype.transformMat32=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[2]+me[4],this.y=x*me[1]+y*me[3]+me[5],this},Vec2.prototype.untransformMat32=function(m){var me=m.elements,x=this.x-me[4],y=this.y-me[5];return this.x=x*me[0]+y*me[1],this.y=x*me[2]+y*me[3],this},Vec2.prototype.transformMat3=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[3]+me[6],this.y=x*me[1]+y*me[4]+me[7],this},Vec2.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y;return this.x=x*me[0]+y*me[4]+me[12],this.y=x*me[1]+y*me[5]+me[13],this},Vec2.prototype.transformProjection=function(m){var me=m.elements,x=this.x,y=this.y,d=1/(me[3]*x+me[7]*y+me[11]*z+me[15]);return this.x=(me[0]*x+me[4]*y+me[12])*d,this.y=(me[1]*x+me[5]*y+me[13])*d,this},Vec2.prototype.fromVec3=function(v){return this.x=v.x,this.y=v.y,this},Vec2.prototype.fromVec4=function(v){return this.x=v.x,this.y=v.y,this},Vec2.prototype.positionFromMat32=function(m){var me=m.elements;return this.x=me[4],this.y=me[5],this},Vec2.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this},Vec2.prototype.scaleFromMat2=function(m){var me=m.elements,x=this.set(me[0],m[2]).length(),y=this.set(me[1],m[3]).length();return this.x=x,this.y=y,this},Vec2.prototype.scaleFromMat32=Vec2.prototype.scaleFromMat2,Vec2.prototype.equals=function(other){return!(this.x!==other.x||this.y!==other.y)},Vec2.prototype.notEquals=function(other){return this.x!==other.x||this.y!==other.y},Vec2.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this},Vec2.prototype.toJSON=function(json){return json||(json={}),json._className="Vec2",json.x=this.x,json.y=this.y,json},Vec2.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this},Vec2.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array},Vec2.prototype.toString=function(){return"Vec2( "+this.x+", "+this.y+" )"},Vec2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/event_emitter",[],function(){function EventEmitter(){this._events={}}var shift=Array.prototype.shift;return EventEmitter.prototype.on=function(type,listener,ctx){var events=this._events;return(events[type]||(events[type]=[])).push({listener:listener,ctx:ctx||this}),this},EventEmitter.prototype.once=function(type,listener,ctx){function once(){self.off(type,once,ctx),listener.apply(ctx,arguments)}var self=this;return ctx=ctx||this,this.on(type,once,ctx)},EventEmitter.prototype.listenTo=function(obj,type,listener,ctx){if(!(obj instanceof EventEmitter)){throw"Can't listen to Object, it's not a instance of EventEmitter"}return obj.on(type,listener,ctx||this),this},EventEmitter.prototype.off=function(type,listener,ctx){var events,event,i,thisEvents=this._events;if(!type){for(i in thisEvents){(events=thisEvents[i])&&(events.length=0)}return this}if(events=thisEvents[type],!events){return this}if(listener){for(ctx=ctx||this,i=events.length;i--;){if(event=events[i],event.listener===listener&&event.ctx===ctx){events.splice(i,1);break}}}else{events.length=0}return this},EventEmitter.prototype.emit=function(type){var a1,a2,a3,a4,length,event,i,events=this._events[type];if(!events||!events.length){return this}if(length=arguments.length,1===length){for(i=events.length;i--;){(event=events[i])&&event.listener.call(event.ctx)}}else{if(2===length){for(a1=arguments[1],i=events.length;i--;){(event=events[i])&&event.listener.call(event.ctx,a1)}}else{if(3===length){for(a1=arguments[1],a2=arguments[2],i=events.length;i--;){(event=events[i])&&event.listener.call(event.ctx,a1,a2)}}else{if(4===length){for(a1=arguments[1],a2=arguments[2],a3=arguments[3],i=events.length;i--;){(event=events[i])&&event.listener.call(event.ctx,a1,a2,a3)}}else{if(5===length){for(a1=arguments[1],a2=arguments[2],a3=arguments[3],a4=arguments[4],i=events.length;i--;){(event=events[i])&&event.listener.call(event.ctx,a1,a2,a3,a4)}}else{for(shift.apply(arguments),i=events.length;i--;){(event=events[i])&&event.listener.apply(event.ctx,arguments)}}}}}}return this},EventEmitter.extend=function(child,parent){return parent||(parent=this),child.prototype=Object.create(parent.prototype),child.prototype.constructor=child,(this._children||(this._children={}))[child.name]=child,child._parent=this,child.extend=parent.extend||this.extend,parent.onExtend&&(child.onExtend||(child.onExtend=parent.onExtend),parent.onExtend(child)),child},EventEmitter}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/class",["odin/base/event_emitter"],function(EventEmitter){function Class(){EventEmitter.call(this),this._id=++CLASS_ID,this._jsonId=-1,this._name=""}var CLASS_ID=0;return EventEmitter.extend(Class),Class.prototype.clone=function(){return(new this.constructor).copy(this)},Class.prototype.copy=function(){return this},Class.prototype.clear=function(){return this},Class.prototype.toJSON=function(json){return json||(json={}),json._id=this._id,json._jsonId=this._id,json._className=this._className,json},Class.prototype.fromJSON=function(json){return this._jsonId=json._jsonId,this},Class.prototype.toString=function(){return this._name},Class.extend=function(child,parent){return parent||(parent=this),child.prototype=Object.create(parent.prototype),child.prototype.constructor=child,child.extend=parent.extend,child.prototype._className=child._className=child.name,(this._children||(this._children={}))[child.name]=child,child._parent=this,Class._classes[child.name]=child,parent.onExtend&&(child.onExtend||(child.onExtend=parent.onExtend),parent.onExtend(child)),child},Class.fromJSON=function(json){return(new Class._classes[json._className]).fromJSON(json)},Class.create=function(type){return new Class._classes[type]},Class._classes={},Class}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2equation",["odin/base/event_emitter"],function(EventEmitter){function P2Equation(){EventEmitter.call(this),this.bi=void 0,this.bj=void 0,this.minForce=-1e6,this.maxForce=1e6,this.relaxation=3,this.stiffness=1e7,this.a=0,this.b=0,this.eps=0,this.lambda=0,this.B=0,this.invC=0}return EventEmitter.extend(P2Equation),P2Equation.prototype.updateConstants=function(h){var k=this.stiffness,d=this.relaxation;this.a=4/(h*(1+4*d)),this.b=4*d/(1+4*d),this.eps=4/(h*h*k*(1+4*d))},P2Equation}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2contact",["odin/base/class","odin/math/mathf","odin/math/vec2","odin/phys2d/constraints/p2equation"],function(Class,Mathf,Vec2,P2Equation){function P2Contact(){P2Equation.call(this),this.minForce=0,this.p=new Vec2,this.n=new Vec2,this.s=0,this.e=1,this.u=1,this.ri=new Vec2,this.rj=new Vec2,this.rixn=0,this.rjxn=0}return P2Equation.extend(P2Contact),P2Contact.prototype.init=function(h){var bi=this.bi,bj=this.bj,p=this.p,px=p.x,py=p.y,n=this.n,nx=n.x,ny=n.y,xi=bi.position,xj=bj.position,ri=this.ri,rix=px-xi.x,riy=py-xi.y,rj=this.rj,rjx=px-xj.x,rjy=py-xj.y,rixn=rix*ny-riy*nx,rjxn=rjx*ny-rjy*nx;ri.x=rix,ri.y=riy,rj.x=rjx,rj.y=rjy,this.rixn=rixn,this.rjxn=rjxn,this.lambda=0,this.calculateB(h),this.calculateC()},P2Contact.prototype.calculateB=function(h){var bi=this.bi,bj=this.bj,n=this.n,nx=n.x,ny=n.y,vi=bi.velocity,wi=bi.angularVelocity||0,fi=bi.force,ti=bi.torque||0,invMi=bi.invMass,invIi=bi.invInertia||0,vj=bj.velocity,wj=bj.angularVelocity||0,fj=bj.force,tj=bj.torque||0,invMj=bj.invMass,invIj=bj.invInertia||0,ri=this.ri,rix=ri.x,riy=ri.y,rj=this.rj,rjx=rj.x,rjy=rj.y,e=this.e,Gq=this.s,GWx=vj.x+-wj*rjy-vi.x- -wi*riy,GWy=vj.y+wj*rjx-vi.y-wi*rix,GW=e*GWx*nx+e*GWy*ny,GiMfx=fj.x*invMj+-tj*invIj*rjy-fi.x*invMi- -ti*invIi*riy,GiMfy=fj.y*invMj+tj*invIj*rjx-fi.y*invMi-ti*invIi*rix,GiMf=GiMfx*nx+GiMfy*ny;this.B=-this.a*Gq-this.b*GW-h*GiMf},P2Contact.prototype.calculateC=function(){var bi=this.bi,bj=this.bj,rixn=this.rixn,rjxn=this.rjxn,invIi=bi.invInertia||0,invIj=bj.invInertia||0,C=bi.invMass+bj.invMass+this.eps+invIi*rixn*rixn+invIj*rjxn*rjxn;this.invC=0===C?0:1/C},P2Contact.prototype.calculateGWlambda=function(){var bi=this.bi,bj=this.bj,n=this.n,vlambdai=bi.vlambda,wlambdai=bi.wlambda||0,vlambdaj=bj.vlambda,wlambdaj=bj.wlambda||0,ulambdax=vlambdaj.x-vlambdai.x,ulambday=vlambdaj.y-vlambdai.y,GWlambda=ulambdax*n.x+ulambday*n.y;return void 0!=wlambdai&&(GWlambda-=wlambdai*this.rixn),void 0!=wlambdaj&&(GWlambda+=wlambdaj*this.rjxn),GWlambda},P2Contact.prototype.addToLambda=function(deltaLambda){var bi=this.bi,bj=this.bj,n=this.n,nx=n.x,ny=n.y,invMi=bi.invMass,vlambdai=bi.vlambda,invMj=bj.invMass,vlambdaj=bj.vlambda;vlambdai.x-=deltaLambda*invMi*nx,vlambdai.y-=deltaLambda*invMi*ny,vlambdaj.x+=deltaLambda*invMj*nx,vlambdaj.y+=deltaLambda*invMj*ny,void 0!=bi.wlambda&&(bi.wlambda-=deltaLambda*bi.invInertia*this.rixn),void 0!=bj.wlambda&&(bj.wlambda+=deltaLambda*bj.invInertia*this.rjxn)},P2Contact}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/collision/p2nearphase",["odin/base/object_pool","odin/math/mathf","odin/math/vec2","odin/phys2d/p2enums","odin/phys2d/constraints/p2contact"],function(ObjectPool,Mathf,Vec2,P2Enums,P2Contact){function clearContact(contact){contact.bi=contact.bj=void 0}function createContact(bi,bj,e,u,nx,ny,px,py,s,contacts){var c=CONTACT_POOL.create(),n=c.n,p=c.p;c.bi=bi,c.bj=bj,c.e=e,c.u=u,n.x=nx,n.y=ny,p.x=px,p.y=py,c.s=s,contacts.push(c)}function circle2Circle(si,sj,xix,xiy,ri,xjx,xjy,rj,contacts){var invDist,nx,ny,dx=xjx-xix,dy=xjy-xiy,dist=dx*dx+dy*dy,separation=0,r=ri+rj;dist>r*r||collide(si,sj)&&(EPSILON>dist?(nx=0,ny=1,invDist=0,separation=-r):(dist=sqrt(dist),invDist=1/dist,nx=dx*invDist,ny=dy*invDist,separation=dist-r),createContact(si.body,sj.body,1+min(si.elasticity,sj.elasticity),min(si.friction,sj.friction),nx,ny,xjx-rj*nx,xjy-rj*ny,separation,contacts))}function circle2CircleParticle(si,sj,xix,xiy,ri,xjx,xjy,rj,contacts){var invDist,nx,ny,dx=xjx-xix,dy=xjy-xiy,dist=dx*dx+dy*dy,separation=0,r=ri+rj;dist>r*r||collideParticle(si,sj)&&(EPSILON>dist?(nx=0,ny=1,invDist=0,separation=-r):(dist=sqrt(dist),invDist=1/dist,nx=dx*invDist,ny=dy*invDist,separation=dist-r),createContact(si.body,sj,1+si.elasticity,si.friction,nx,ny,xjx-rj*nx,xjy-rj*ny,separation,contacts))}function P2Nearphase(){}function collide(si,sj){var bi=si.body,bj=sj.body,i=bi._index,j=bj._index,space=bi.space;return space?(space.collisionMatrixSet(i,j,1,!0),space.collisionMatrixGet(i,j,!0)!==space.collisionMatrixGet(i,j,!1)?(bi.wake(),bj.wake(),bi.emit("collide",bj,si,sj),bj.emit("collide",bi,sj,si)):(bi.emit("colliding",bj,si,sj),bj.emit("colliding",bi,sj,si)),si.isTrigger||sj.isTrigger?!1:!0):!1}function collideParticle(si,bj){var bi=si.body,i=bi._index,j=bj._index,space=bi.space;return space?(space.collisionMatrixSet(i,j,1,!0),space.collisionMatrixGet(i,j,!0)!==space.collisionMatrixGet(i,j,!1)?(bi.wake(),bj.wake(),bi.emit("collideParticle",bj,si),bj.emit("collideParticle",bi,si)):(bi.emit("collidingParticle",bj,si),bj.emit("collidingParticle",bi,si)),si.isTrigger?!1:!0):!1}function circleCircle(si,sj,contacts){var xi=si.position,xj=sj.position;circle2Circle(si,sj,xi.x,xi.y,si.radius,xj.x,xj.y,sj.radius,contacts)}function circleParticle(si,sj,contacts){var xi=si.position,xj=sj.position;circle2CircleParticle(si,sj,xi.x,xi.y,si.radius,xj.x,xj.y,0,contacts)}function segmentParticle(si,sj,contacts){var dt,dta,dtb,dx,dy,invDist,r=si.radius,a=si._a,b=si._b,n=si._normal,ax=a.x,ay=a.y,bx=b.x,by=b.y,nx=n.x,ny=n.y,xj=sj.position,xjx=xj.x,xjy=xj.y,dn=nx*xjx+ny*xjy-(ax*nx+ay*ny),dist=abs(dn);if(!(dist>r)){if(dt=xjx*ny-xjy*nx,dta=ax*ny-ay*nx,dtb=bx*ny-by*nx,dta>=dt){if(dta-r>dt){return}if(dx=xjx-ax,dy=xjy-ay,dist=dx*dx+dy*dy,dist>r*r){return}dist=0===dist?0:sqrt(dist),invDist=0===dist?0:1/dist,nx=dx*invDist,ny=dy*invDist}else{if(dt>dtb){if(dt>dtb+r){return}if(dx=xjx-bx,dy=xjy-by,dist=dx*dx+dy*dy,dist>r*r){return}dist=0===dist?0:sqrt(dist),invDist=0===dist?0:1/dist,nx=dx*invDist,ny=dy*invDist}else{0>dn&&(nx=-nx,ny=-ny)}}collideParticle(si,sj)&&createContact(si.body,sj.body,1+si.elasticity,si.friction,nx,ny,xjx-r*nx,xjy-r*ny,dist-r,contacts)}}function segmentCircle(si,sj,contacts){var dt,dta,dtb,dx,dy,invDist,ri=si.radius,a=si._a,b=si._b,n=si._normal,ax=a.x,ay=a.y,bx=b.x,by=b.y,nx=n.x,ny=n.y,xj=sj.position,xjx=xj.x,xjy=xj.y,rj=sj.radius,r=ri+rj,dn=nx*xjx+ny*xjy-(ax*nx+ay*ny),dist=abs(dn);if(!(dist>r)){if(dt=xjx*ny-xjy*nx,dta=ax*ny-ay*nx,dtb=bx*ny-by*nx,dta>=dt){if(dta-r>dt){return}if(dx=xjx-ax,dy=xjy-ay,dist=dx*dx+dy*dy,dist>r*r){return}dist=0===dist?0:sqrt(dist),invDist=0===dist?0:1/dist,nx=dx*invDist,ny=dy*invDist}else{if(dt>dtb){if(dt>dtb+r){return}if(dx=xjx-bx,dy=xjy-by,dist=dx*dx+dy*dy,dist>r*r){return
}dist=0===dist?0:sqrt(dist),invDist=0===dist?0:1/dist,nx=dx*invDist,ny=dy*invDist}else{0>dn&&(nx=-nx,ny=-ny)}}collide(si,sj)&&createContact(si.body,sj.body,1+min(si.elasticity,sj.elasticity),min(si.friction,sj.friction),nx,ny,xjx-r*nx,xjy-r*ny,dist-r,contacts)}}function segmentSegment(si,sj,contacts){var d0,d1,d2,d3,mi,mj,m,s,t,ux,uy,vx,vy,amx,amy,bmx,bmy,ai=si._a,aix=ai.x,aiy=ai.y,bi=si._b,bix=bi.x,biy=bi.y,ri=si.radius,aj=sj._a,ajx=aj.x,ajy=aj.y,bj=sj._b,bjx=bj.x,bjy=bj.y,rj=sj.radius;segmentSegmentArray[0]=d0=segmentPointDistanceSq(aix,aiy,bix,biy,ajx,ajy),segmentSegmentArray[1]=d1=segmentPointDistanceSq(aix,aiy,bix,biy,bjx,bjy),segmentSegmentArray[2]=d2=segmentPointDistanceSq(ajx,ajy,bjx,bjy,aix,aiy),segmentSegmentArray[3]=d3=segmentPointDistanceSq(ajx,ajy,bjx,bjy,bix,biy),mi=d1>d0?0:1,mj=d3>d2?2:3,m=segmentSegmentArray[mi]<segmentSegmentArray[mj]?mi:mj,ux=bix-aix,uy=biy-aiy,vx=bjx-ajx,vy=bjy-ajy,0===m?(s=((ajx-aix)*ux+(ajy-aiy)*uy)/(ux*ux+uy*uy),s=0>s?0:s>1?1:s,t=0):1===m?(s=((bjx-aix)*ux+(bjy-aiy)*uy)/(ux*ux+uy*uy),s=0>s?0:s>1?1:s,t=1):2===m?(s=0,t=((aix-ajx)*vx+(aiy-ajy)*vy)/(vx*vx+vy*vy),t=0>t?0:t>1?1:t):3===m&&(s=1,t=((bix-ajx)*vx+(biy-ajy)*vy)/(vx*vx+vy*vy),t=0>t?0:t>1?1:t),amx=aix+ux*s,amy=aiy+uy*s,bmx=ajx+vx*t,bmy=ajy+vy*t,circle2Circle(si,sj,amx,amy,ri,bmx,bmy,rj,contacts)}function convexSegment(si,sj,contacts){var v,n,dist,i,vax,vay,vbx,vby,u,e,nx,ny,vertices=si._vertices,normals=si._normals,a=sj._a,ax=a.x,ay=a.y,b=sj._b,bx=b.x,by=b.y,nj=sj._normal,radius=sj.radius,njx=nj.x,njy=nj.y,segD=njx*ax+njy*ay,minNorm=valueOnAxis(vertices,njx,njy,segD)-radius,minNeg=valueOnAxis(vertices,-njx,-njy,-segD)-radius,index=-1,polyMin=-1/0,count=0;if(!(minNeg>0||minNorm>0)){for(i=vertices.length;i--;){if(v=vertices[i],n=normals[i],nx=n.x,ny=n.y,dist=segmentValueOnAxis(ax,ay,bx,by,radius,nx,ny,nx*v.x+ny*v.y),dist>0){return}dist>polyMin&&(polyMin=dist,index=i)}-1!==index&&collide(si,sj)&&(e=1+min(si.elasticity,sj.elasticity),u=min(si.friction,sj.friction),n=normals[index],nx=n.x,ny=n.y,vax=ax+-nx*radius,vay=ay+-ny*radius,vbx=bx+-nx*radius,vby=by+-ny*radius,contains(vertices,normals,vax,vay)&&(createContact(si.body,sj.body,e,u,nx,ny,vax,vay,polyMin,contacts),count++),contains(vertices,normals,vbx,vby)&&(createContact(si.body,sj.body,e,u,nx,ny,vbx,vby,polyMin,contacts),count++),(minNorm>=polyMin||minNeg>=polyMin)&&(count+=minNorm>minNeg?pointsBehindSegment(si,sj,e,u,ax,ay,bx,by,radius,nx,ny,minNorm,1,contacts):pointsBehindSegment(si,sj,e,u,ax,ay,bx,by,radius,nx,ny,minNeg,-1,contacts)))}}function pointsBehindSegment(si,sj,e,u,ax,ay,bx,by,radius,nx,ny,dist,coef,contacts){var v,vx,vy,dt,dta=nx*ay-ny*ax,dtb=nx*by-ny*bx,vertices=si._vertices,i=vertices.length,count=0;for(nx*=coef,ny*=coef;i--;){v=vertices[i],vx=v.x,vy=v.y,(nx*ax+ny*ay)*coef+radius>vx*nx+vy*ny&&(dt=nx*vy-ny*vx,dta>=dt&&dt>=dtb&&(createContact(si.body,sj.body,e,u,nx,ny,vx,vy,dist,contacts),count++))}return count}function segmentPointDistanceSq(ax,ay,bx,by,px,py){var vsq,wx=px-ax,wy=py-ay,dx=bx-ax,dy=by-ay,proj=wx*dx+wy*dy;return 0>=proj?wx*wx+wy*wy:(vsq=dx*dx+dy*dy,proj>=vsq?wx*wx+wy*wy-2*proj+vsq:wx*wx+wy*wy-proj*proj/vsq)}function segmentValueOnAxis(ax,ay,bx,by,r,nx,ny,d){var a=nx*ax+ny*ay-r,b=nx*bx+ny*by-r;return min(a,b)-d}function convexParticle(si,sj,contacts){for(var vertex,normal,s,v1,v2,v1x,v1y,v2x,v2y,ex,ey,dx,dy,u,dist,invDist,nx,ny,vertices=si._vertices,normals=si._normals,xj=sj.position,xjx=xj.x,xjy=xj.y,separation=-1/0,index=-1,i=vertices.length;i--;){if(vertex=vertices[i],normal=normals[i],s=normal.x*(xjx-vertex.x)+normal.y*(xjy-vertex.y),s>EPSILON){return}s>separation&&(separation=s,index=i)}if(-1!==index){if(normal=normals[index],nx=normal.x,ny=normal.y,v1=vertices[index],v1x=v1.x,v1y=v1.y,v2=vertices[index+1]||vertices[0],v2x=v2.x,v2y=v2.y,ex=v2x-v1x,ey=v2y-v1y,dx=xjx-v1x,dy=xjy-v1y,u=(ex*dx+ey*dy)/(ex*ex+ey*ey),0>u){if(dx=xjx-v1x,dy=xjy-v1y,dist=dx*dx+dy*dy,dist>EPSILON){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{if(u>1){if(dx=xjx-v2x,dy=xjy-v2y,dist=dx*dx+dy*dy,dist>EPSILON){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{normal=normals[index],nx=normal.x,ny=normal.y,dist=separation}}collideParticle(si,sj)&&createContact(si.body,sj,1+si.elasticity,si.friction,nx,ny,xjx,xjy,dist,contacts)}}function convexCircle(si,sj,contacts){for(var vertex,normal,s,v1,v2,v1x,v1y,v2x,v2y,ex,ey,dx,dy,u,dist,invDist,nx,ny,vertices=si._vertices,normals=si._normals,xj=sj.position,xjx=xj.x,xjy=xj.y,radius=sj.radius,separation=-1/0,index=-1,i=vertices.length;i--;){if(vertex=vertices[i],normal=normals[i],s=normal.x*(xjx-vertex.x)+normal.y*(xjy-vertex.y),s>radius){return}s>separation&&(separation=s,index=i)}if(-1!==index){if(normal=normals[index],nx=normal.x,ny=normal.y,v1=vertices[index],v1x=v1.x,v1y=v1.y,v2=vertices[index+1]||vertices[0],v2x=v2.x,v2y=v2.y,ex=v2x-v1x,ey=v2y-v1y,dx=xjx-v1x,dy=xjy-v1y,u=(ex*dx+ey*dy)/(ex*ex+ey*ey),0>u){if(dx=xjx-v1x,dy=xjy-v1y,dist=dx*dx+dy*dy,dist>radius*radius){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{if(u>1){if(dx=xjx-v2x,dy=xjy-v2y,dist=dx*dx+dy*dy,dist>radius*radius){return}dist=sqrt(dist),invDist=dist>0?1/dist:0,nx=dx*invDist,ny=dy*invDist}else{normal=normals[index],nx=normal.x,ny=normal.y,dist=separation}}collide(si,sj)&&createContact(si.body,sj.body,1+min(si.elasticity,sj.elasticity),min(si.friction,sj.friction),nx,ny,xjx-radius*nx,xjy-radius*ny,dist-radius,contacts)}}function contains(vertices,normals,px,py){for(var n,nx,ny,v,vx,vy,i=vertices.length;i--;){if(n=normals[i],nx=n.x,ny=n.y,v=vertices[i],vx=v.x,vy=v.y,nx*px+ny*py-(nx*vx+ny*vy)>0){return!1}}return!0}function findContacts(si,sj,normal,dist,contacts){if(collide(si,sj)){var v,vx,vy,i,verticesi=si._vertices,normalsi=si._normals,verticesj=sj._vertices,normalsj=sj._normals,nx=normal.x,ny=normal.y,e=1+min(si.elasticity,sj.elasticity),u=min(si.friction,sj.friction);for(i=verticesi.length;i--;){v=verticesi[i],vx=v.x,vy=v.y,contains(verticesj,normalsj,vx,vy)&&createContact(si.body,sj.body,e,u,nx,ny,vx,vy,dist,contacts)}for(i=verticesj.length;i--;){v=verticesj[i],vx=v.x,vy=v.y,contains(verticesi,normalsi,vx,vy)&&createContact(si.body,sj.body,e,u,nx,ny,vx,vy,dist,contacts)}}}function valueOnAxis(vertices,nx,ny,d){for(var v,m=1/0,i=vertices.length;i--;){v=vertices[i],m=min(m,nx*v.x+ny*v.y)}return m-d}function findMSA(si,sj){for(var n,v,dist,verticesi=si._vertices,normalsi=si._normals,counti=normalsi.length,verticesj=sj._vertices,min=-1/0,index=-1,i=counti;i--;){if(n=normalsi[i],v=verticesi[i],dist=valueOnAxis(verticesj,n.x,n.y,n.x*v.x+n.y*v.y),dist>0){return-1}dist>min&&(min=dist,index=i)}return lastMinMSA=min,index}function convexConvex(si,sj,contacts){var indexi,mini,indexj,minj;indexi=findMSA(si,sj),0>indexi||(mini=lastMinMSA,indexj=findMSA(sj,si),0>indexj||(minj=lastMinMSA,mini>minj?findContacts(si,sj,si._normals[indexi],mini,contacts):findContacts(sj,si,sj._normals[indexj],minj,contacts)))}function collisionType(si,sj,contacts){var siType=si.type,sjType=sj.type;(siType!==BodyType.Particle||sjType!==BodyType.Particle)&&(siType===BodyType.Particle&&sjType!==BodyType.Particle?sjType===ShapeType.Circle?circleParticle(sj,si,contacts):sjType===ShapeType.Segment?segmentParticle(sj,si,contacts):sjType===ShapeType.Convex&&convexParticle(sj,si,contacts):sjType===BodyType.Particle&&siType!==BodyType.Particle?siType===ShapeType.Circle?circleParticle(si,sj,contacts):siType===ShapeType.Segment?segmentParticle(si,sj,contacts):siType===ShapeType.Convex&&convexParticle(si,sj,contacts):siType===ShapeType.Circle?sjType===ShapeType.Circle?circleCircle(si,sj,contacts):sjType===ShapeType.Segment?segmentCircle(sj,si,contacts):sjType===ShapeType.Convex&&convexCircle(sj,si,contacts):siType===ShapeType.Convex?sjType===ShapeType.Circle?convexCircle(si,sj,contacts):sjType===ShapeType.Segment?convexSegment(si,sj,contacts):sjType===ShapeType.Convex&&convexConvex(si,sj,contacts):siType===ShapeType.Segment&&(sjType===ShapeType.Circle?segmentCircle(si,sj,contacts):sjType===ShapeType.Segment?segmentSegment(si,sj,contacts):sjType===ShapeType.Convex&&convexSegment(sj,si,contacts)))}var segmentSegmentArray,lastMinMSA,min=Math.min,abs=Math.abs,sqrt=Math.sqrt,EPSILON=Mathf.EPSILON,BodyType=P2Enums.BodyType,ShapeType=P2Enums.ShapeType,CONTACT_POOL=new ObjectPool(P2Contact);return P2Nearphase.CONTACT_POOL=CONTACT_POOL,P2Nearphase.prototype.collisions=function(pairsi,pairsj,contacts){var si,sj,i=pairsi.length;for(contacts.length=0,CONTACT_POOL.clearForEach(clearContact);i--;){si=pairsi[i],sj=pairsj[i],collisionType(si,sj,contacts)}},segmentSegmentArray=[0,0,0,0],lastMinMSA=0,P2Nearphase}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat32",["odin/math/mathf"],function(Mathf){function Mat32(m11,m12,m13,m21,m22,m23){var te=new Float32Array(6);this.elements=te,te[0]=void 0!=m11?m11:1,te[2]=m12||0,te[4]=m13||0,te[1]=m21||0,te[3]=void 0!=m22?m22:1,te[5]=m23||0}var sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin,atan2=Math.atan2;return Mathf._classes.Mat32=Mat32,Mat32.prototype.clone=function(){var te=this.elements;return new Mat32(te[0],te[1],te[2],te[3],te[4],te[5])},Mat32.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],this},Mat32.prototype.set=function(m11,m12,m13,m21,m22,m23){var te=this.elements;return te[0]=m11,te[2]=m12,te[4]=m13,te[1]=m21,te[3]=m22,te[5]=m23,this},Mat32.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[2],a13=ae[4],a21=ae[1],a22=ae[3],a23=ae[5],b11=be[0],b12=be[2],b13=be[4],b21=be[1],b22=be[3],b23=be[5];return ae[0]=a11*b11+a21*b12,ae[2]=a12*b11+a22*b12,ae[1]=a11*b21+a21*b22,ae[3]=a12*b21+a22*b22,ae[4]=a11*b13+a12*b23+a13,ae[5]=a21*b13+a22*b23+a23,this},Mat32.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[2],a13=ae[4],a21=ae[1],a22=ae[3],a23=ae[5],b11=be[0],b12=be[2],b13=be[4],b21=be[1],b22=be[3],b23=be[5];return te[0]=a11*b11+a21*b12,te[2]=a12*b11+a22*b12,te[1]=a11*b21+a21*b22,te[3]=a12*b21+a22*b22,te[4]=a11*b13+a12*b23+a13,te[5]=a21*b13+a22*b23+a23,this},Mat32.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,this},Mat32.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,this},Mat32.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=1,te[4]=0,te[5]=0,this},Mat32.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,this},Mat32.prototype.determinant=function(){var te=this.elements;return te[0]*te[3]-te[2]*te[1]},Mat32.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[2],m13=te[4],m21=te[1],m22=te[3],m23=te[5],det=m11*m22-m12*m21;return det=0===det?0:1/det,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,te[4]=(m21*m23-m22*m13)*det,te[5]=-(m11*m23-m12*m13)*det,this},Mat32.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m13=me[4],m21=me[1],m22=me[3],m23=me[5],det=m11*m22-m12*m21;return det=0===det?0:1/det,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,te[4]=(m21*m23-m22*m13)*det,te[5]=-(m11*m23-m12*m13)*det,this},Mat32.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[2],te[2]=tmp,this},Mat32.prototype.setTrace=function(x,y){var te=this.elements;return te[0]=x,te[3]=y,this},Mat32.prototype.lookAt=function(eye,target){var te=this.elements,x=target.x-eye.x,y=target.y-eye.y,a=atan2(y,x)-HALF_PI,c=cos(a),s=sin(a);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat32.prototype.compose=function(position,scale,angle){var te=this.elements,sx=scale.x,sy=scale.y,c=cos(angle),s=sin(angle);return te[0]=c*sx,te[1]=s*sx,te[2]=-s*sy,te[3]=c*sy,te[4]=position.x,te[5]=position.y,this},Mat32.prototype.decompose=function(position,scale){var te=this.elements,m11=te[0],m12=te[1],sx=scale.set(m11,m12).length(),sy=scale.set(te[2],te[3]).length();return position.x=te[4],position.y=te[5],scale.x=sx,scale.y=sy,atan2(m12,m11)},Mat32.prototype.setRotation=function(angle){var te=this.elements,c=cos(angle),s=sin(angle);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat32.prototype.getRotation=function(){var te=this.elements;return atan2(te[1],te[0])},Mat32.prototype.setPosition=function(v){var te=this.elements;return te[4]=v.x,te[5]=v.y,this},Mat32.prototype.getPosition=function(v){var te=this.elements;return v.x=te[4],v.y=te[5],v},Mat32.prototype.extractPosition=function(other){var te=this.elements,me=other.elements;return te[4]=me[4],te[5]=me[5],this},Mat32.prototype.extractRotation=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m21=me[1],m22=me[3],x=m11*m11+m21*m21,y=m12*m12+m22*m22,sx=x>0?1/sqrt(x):0,sy=y>0?1/sqrt(y):0;return te[0]=m11*sx,te[1]=m21*sx,te[2]=m12*sy,te[3]=m22*sy,this},Mat32.prototype.translate=function(v){var te=this.elements,x=v.x,y=v.y;return te[4]=te[0]*x+te[2]*y+te[4],te[5]=te[1]*x+te[3]*y+te[5],this},Mat32.prototype.rotate=function(angle){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],s=sin(angle),c=sin(angle);return te[0]=m11*c+m12*s,te[1]=m11*-s+m12*c,te[2]=m21*c+m22*s,te[3]=m21*-s+m22*c,this},Mat32.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y;return te[0]*=x,te[1]*=x,te[4]*=x,te[2]*=y,te[3]*=y,te[5]*=y,this},Mat32.prototype.orthographic=function(left,right,top,bottom){var te=this.elements,w=right-left,h=top-bottom,x=(right+left)/w,y=(top+bottom)/h;return te[0]=2/w,te[1]=0,te[2]=0,te[3]=2/h,te[4]=-x,te[5]=-y,this},Mat32.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[3],te[3]=me[4],te[4]=0,te[5]=0,this},Mat32.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[4],te[3]=me[5],te[4]=me[12],te[5]=me[13],this},Mat32.prototype.equals=function(other){var ae=this.elements,be=other.elements;return!(ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5])},Mat32.prototype.notEquals=function(other){var ae=this.elements,be=other.elements;return ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5]},Mat32.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],this},Mat32.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return json._className="Mat32",je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],json},Mat32.prototype.fromArray=function(array){var te=this.elements;return te[0]=array[0],te[1]=array[1],te[2]=array[2],te[3]=array[3],te[4]=array[4],te[5]=array[5],this},Mat32.prototype.toArray=function(array){array||(array=[]);var te=this.elements;return array[0]=te[0],array[1]=te[1],array[2]=te[2],array[3]=te[3],array[4]=te[4],array[5]=te[5],array},Mat32.prototype.toString=function(){var te=this.elements;return"Mat32[ "+te[0]+", "+te[2]+", "+te[4]+"]\n     [ "+te[1]+", "+te[3]+", "+te[5]+"]"},Mat32}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/aabb2",["odin/math/mathf","odin/math/vec2"],function(Mathf,Vec2){function AABB2(min,max){this.min=min||new Vec2(1/0,1/0),this.max=max||new Vec2(-1/0,-1/0)}return AABB2.prototype.clone=function(){return new AABB2(this.min.clone(),this.max.clone())},AABB2.prototype.copy=function(other){return this.min.copy(other.min),this.max.copy(other.max),this},AABB2.prototype.set=function(min,max){return this.min.copy(min),this.max.copy(max),this},AABB2.prototype.expandPoint=function(v){return this.min.min(v),this.max.max(v),this},AABB2.prototype.expandVec=function(v){return this.min.sub(v),this.max.add(v),this},AABB2.prototype.expandScalar=function(s){return this.min.ssub(s),this.max.sadd(s),this},AABB2.prototype.union=function(other){return this.min.min(other.min),this.max.max(other.max),this},AABB2.prototype.clear=function(){return this.min.set(1/0,1/0),this.max.set(-1/0,-1/0),this},AABB2.prototype.contains=function(point){var min=this.min,max=this.max,px=point.x,py=point.y;return!(px<min.x||px>max.x||py<min.y||py>max.y)},AABB2.prototype.intersects=function(other){var aMin=this.min,aMax=this.max,bMin=other.min,bMax=other.max;return!(bMax.x<aMin.x||bMin.x>aMax.x||bMax.y<aMin.y||bMin.y>aMax.y)},AABB2.prototype.fromPoints=function(points){for(var v,x,y,i=points.length,minx=1/0,miny=1/0,maxx=-1/0,maxy=-1/0,min=this.min,max=this.max;i--;){v=points[i],x=v.x,y=v.y,minx=minx>x?x:minx,miny=miny>y?y:miny,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy}return min.x=minx,min.y=miny,max.x=maxx,max.y=maxy,this},AABB2.prototype.fromCenterSize=function(center,size){var min=this.min,max=this.max,x=center.x,y=center.y,hx=.5*size.x,hy=.5*size.y;return min.x=x-hx,min.y=y-hy,max.x=x+hx,max.y=y+hy,this},AABB2.prototype.equals=function(other){return!(!this.min.equals(other.min)||!this.max.equals(other.max))},AABB2.prototype.equals=function(other){return this.min.notEquals(other.min)||this.max.notEquals(other.max)},AABB2.prototype.fromJSON=function(json){return this.min.fromJSON(json.min),this.max.fromJSON(json.max),this},AABB2.prototype.toJSON=function(json){return json||(json={}),json.min=this.min.toJSON(json.min),json.max=this.max.toJSON(json.max),json},AABB2.prototype.toString=function(){var min=this.min,max=this.max;return"AABB2( min: "+min+", max: "+max+" )"},AABB2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2shape",["odin/base/class","odin/math/vec2","odin/math/mat32","odin/math/aabb2"],function(Class,Vec2,Mat32,AABB2){function P2Shape(opts){opts||(opts={}),Class.call(this),this.type=-1,this.body=void 0,this.density=void 0!=opts.density?opts.density:1,this.localPosition=void 0!=opts.position?opts.position:new Vec2,this.localRotation=void 0!=opts.rotation?opts.rotation:0,this.position=new Vec2,this.rotation=0,this.matrix=new Mat32,this.matrixWorld=new Mat32,this.friction=void 0!=opts.friction?opts.friction:.5,this.elasticity=void 0!=opts.elasticity?opts.elasticity:.25,this.isTrigger=void 0!=opts.isTrigger?!!opts.isTrigger:!1,this.filterMask=void 0!=opts.filterMask?opts.filterMask:1,this.filterGroup=void 0!=opts.filterGroup?opts.filterGroup:1,this.aabb=new AABB2}return Class.extend(P2Shape),P2Shape.prototype.copy=function(other){return this.density=other.density,this.localPosition.copy(other.localPosition),this.localRotation=other.localRotation,this.friction=other.friction,this.elasticity=other.elasticity,this.isTrigger=other.isTrigger,this.filterMask=other.filterMask,this.filterGroup=other.filterGroup,this},P2Shape.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.density=this.density,json.localPosition=this.localPosition.toJSON(json.localPosition),json.localRotation=this.localRotation,json.friction=this.friction,json.elasticity=this.elasticity,json.isTrigger=this.isTrigger,json.filterMask=this.filterMask,json.filterGroup=this.filterGroup,json},P2Shape.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.density=json.density,this.localPosition.fromJSON(json.localPosition),this.localRotation=json.localRotation,this.friction=json.friction,this.elasticity=json.elasticity,this.isTrigger=json.isTrigger,this.filterMask=json.filterMask,this.filterGroup=json.filterGroup,this},P2Shape}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2circle",["odin/base/class","odin/phys2d/p2enums","odin/phys2d/objects/p2shape"],function(Class,P2Enums,P2Shape){function P2Circle(opts){opts||(opts={}),P2Shape.call(this,opts),this.type=ShapeType.Circle,this.radius=void 0!=opts.radius?abs(opts.radius):.5}var ShapeType=P2Enums.ShapeType,abs=Math.abs,PI=Math.PI;return P2Shape.extend(P2Circle),P2Circle.prototype.copy=function(other){return P2Shape.prototype.copy.call(this,other),this.radius=other.radius,this},P2Circle.prototype.pointQuery=function(p){var x=this.position,dx=x.x-p.x,dy=x.y-p.y,r=this.radius;return r*r>dx*dx+dy*dy},P2Circle.prototype.centroid=function(v){var localPosition=this.localPosition;return v.x=localPosition.x,v.y=localPosition.y,v},P2Circle.prototype.area=function(){var r=this.radius;return PI*r*r},P2Circle.prototype.inertia=function(mass){var r=this.radius,localPosition=this.localPosition,lx=localPosition.x,ly=localPosition.y;return mass*(r*r*.5+(lx*lx+ly*ly))},P2Circle.prototype.update=function(matrix){var x,y,localMatrix=this.matrix,matrixWorld=this.matrixWorld,localPosition=this.localPosition,pos=this.position,r=this.radius,aabb=this.aabb,min=aabb.min,max=aabb.max;localMatrix.setRotation(this.localRotation),localMatrix.setPosition(localPosition),matrixWorld.mmul(matrix,localMatrix),pos.x=localPosition.x,pos.y=localPosition.y,pos.transformMat32(matrix),x=pos.x,y=pos.y,min.x=x-r,min.y=y-r,max.x=x+r,max.y=y+r},P2Circle.prototype.toJSON=function(json){return json=P2Shape.prototype.toJSON.call(this,json),json.radius=this.radius,json},P2Circle.prototype.fromJSON=function(json){return P2Shape.prototype.fromJSON.call(this,json),this.radius=json.radius,this},P2Circle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/log",["odin/base/util","odin/core/game/config"],function(util,Config){function Log(){}function cacheKey(args){var i,key="";for(i=args.length;i--;){key+=args[i]}return key}var CACHE,each=util.each;return Log.prototype.debug=Log.prototype.info=Log.prototype.log=function(){Config.debug&&console.log.apply(console,arguments)},Log.prototype.warn=function(){(Config.debug||Config.warn)&&console.warn.apply(console,arguments)},Log.prototype.error=function(){(Config.debug||Config.error)&&console.error.apply(console,arguments)},CACHE={},Log.prototype.once=function(){!Config.debug&&!Config.error||CACHE[cacheKey(arguments)]||(CACHE[cacheKey(arguments)]=!0,console.error.apply(console,arguments))},Log.prototype.object=function(obj,values,tabs){if(!Config.debug){return""}var str="";return tabs||(tabs=""),values||(values=[]),each(obj,function(value,i){if(!~values.indexOf(value)){var tmp,type=typeof value;"object"===type?(tmp=tabs,values.push(value),tabs+="	",str+=tabs+i+" = "+this.object(value,values,tabs)+"\n",tabs=tmp):"function"!==type?str+=tabs+i+" = "+value+"\n":(values.push(value),str+=tabs+value+"\n")}},this),str},new Log}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2convex",["odin/math/vec2","odin/core/game/log","odin/phys2d/p2enums","odin/phys2d/objects/p2shape"],function(Vec2,Log,P2Enums,P2Shape){function P2Convex(opts){opts||(opts={}),P2Shape.call(this,opts),this.type=ShapeType.Convex,this.vertices=void 0!=opts.vertices?opts.vertices:[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)],P2Convex.validateVertices(this.vertices)||(log.warn("P2Convex.constructor: passed vertices are invalid, creating convex hull from vertices with gift wrapping algorithm"),this.vertices=P2Convex.createConvexHull(this.vertices)),this.normals=[],this._vertices=[],this._normals=[];var v1,v2,i,vertices=this.vertices,wverts=this._vertices,normals=this.normals,wnorms=this._normals;for(i=vertices.length;i--;){v1=vertices[i],v2=vertices[i+1]||vertices[0],normals[i]=new Vec2(v2.y-v1.y,-(v2.x-v1.x)).normalize(),wverts[i]=new Vec2(v1),wnorms[i]=new Vec2(normals[i])}}var ShapeType=P2Enums.ShapeType;return P2Shape.extend(P2Convex),P2Convex.prototype.copy=function(other){P2Shape.prototype.copy.call(this,other);var i,vertices=other.vertices,normals=other.normals;for(this.vertices.length=this.normals.length=this._vertices.length=this._normals.length=0,i=vertices.length;i--;){this.vertices[i]=vertices[i].clone()}for(i=normals.length;i--;){this.normals[i]=normals[i].clone()}return this},P2Convex.prototype.pointQuery=function(p){if(!this.aabb.contains(p)){return!1}for(var n,nx,ny,v,vx,vy,vertices=this._vertices,normals=this._normals,px=p.x,py=p.y,i=vertices.length;i--;){if(n=normals[i],nx=n.x,ny=n.y,v=vertices[i],vx=v.x,vy=v.y,nx*px+ny*py-(nx*vx+ny*vy)>0){return!1}}return!0},P2Convex.prototype.centroid=function(){var v1=new Vec2,v2=new Vec2,vsum=new Vec2;return function(v){var v1x,v1y,v2x,v2y,cross,localPosition=this.localPosition,vertices=this.vertices,len=vertices.length,area=0,i=len;for(vsum.x=vsum.y=0;i--;){v1.vadd(localPosition,vertices[i]),v2.vadd(localPosition,vertices[(i+1)%len]),v1x=v1.x,v1y=v1.y,v2x=v2.x,v2y=v2.y,cross=v1x*v2y-v1y*v2x,area+=cross,vsum.x+=(v1x+v2x)*cross,vsum.y+=(v1y+v2y)*cross}return v.copy(vsum).smul(1/(3*area))}}(),P2Convex.prototype.area=function(){for(var v1,v2,vertices=this.vertices,len=vertices.length,area=0,i=len;i--;){v1=vertices[i],v2=vertices[(i+1)%len],area+=v1.x*v2.y-v1.y*v2.x}return.5*area},P2Convex.prototype.inertia=function(){var v1=new Vec2,v2=new Vec2;return function(mass){for(var v1x,v1y,v2x,v2y,localPosition=this.localPosition,vertices=this.vertices,len=vertices.length,a=0,b=0,sum1=0,sum2=0,i=len;i--;){v1.vadd(localPosition,vertices[i]),v2.vadd(localPosition,vertices[(i+1)%len]),v1x=v1.x,v1y=v1.y,v2x=v2.x,v2y=v2.y,a=v2x*v1y-v2y*v1x,b=v1x*v1x+v1y*v1y+(v1x*v2x+v1y*v2y)+(v2x*v2x+v2y*v2y),sum1+=a*b,sum2+=a}return mass*sum1/(6*sum2)}}(),P2Convex.prototype.update=function(matrix){var wnorm,wvert,x,y,localMatrix=this.matrix,matrixWorld=this.matrixWorld,localPos=this.localPosition,vertices=this.vertices,normals=this.normals,pos=this.position,aabb=this.aabb,min=aabb.min,max=aabb.max,minx=1/0,miny=1/0,maxx=-1/0,maxy=-1/0,wnorms=this._normals,wverts=this._vertices,i=vertices.length;for(localMatrix.setRotation(this.localRotation),localMatrix.setPosition(localPos),matrixWorld.mmul(matrix,localMatrix),pos.x=localPos.x,pos.y=localPos.y,pos.transformMat32(matrix);i--;){wvert=wverts[i]||(wverts[i]=new Vec2),wnorm=wnorms[i]||(wnorms[i]=new Vec2),wnorm.copy(normals[i]).transformMat2(matrixWorld),wvert.copy(vertices[i]).transformMat32(matrixWorld),x=wvert.x,y=wvert.y,minx=minx>x?x:minx,miny=miny>y?y:miny,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy}min.x=minx,min.y=miny,max.x=maxx,max.y=maxy},P2Convex.prototype.toJSON=function(json){json=P2Shape.prototype.toJSON.call(this,json);var i,vertices=this.vertices,normals=this.normals,jsonVertices=json.vertices||(json.vertices=[]),jsonNormals=json.normals||(json.normals=[]);for(i=vertices.length;i--;){jsonVertices[i]=vertices[i].toJSON(jsonVertices[i])}for(i=normals.length;i--;){jsonNormals[i]=normals[i].toJSON(jsonNormals[i])}return json},P2Convex.prototype.fromJSON=function(json){P2Shape.prototype.fromJSON.call(this,json);var i,vertices=this.vertices,normals=this.normals,jsonVertices=json.vertices,jsonNormals=json.normals,verticesLength=jsonVertices.length,normalsLength=jsonNormals.length;for(vertices.length=this._vertices.length=verticesLength,normals.length=this._normals.length=normalsLength,i=verticesLength;i--;){vertices[i]=(vertices[i]||new Vec2).fromJSON(jsonVertices[i])}for(i=normalsLength;i--;){normals[i]=(normals[i]||new Vec2).fromJSON(jsonNormals[i])}return this},P2Convex.validateVertices=P2Convex.prototype.validateVertices=function(vertices){var a,b,bx,by,c,abx,aby,bcx,bcy,i,len=vertices.length;for(i=0;len>i;i++){if(a=vertices[i],b=vertices[(i+1)%len],bx=b.x,by=b.y,c=vertices[(i+2)%len],abx=bx-a.x,aby=by-a.y,bcx=c.x-bx,bcy=c.y-by,bcx*aby-bcy*abx>0){return!1}}return!0},P2Convex.createConvexHull=P2Convex.prototype.createConvexHull=function(){var hull=[],r=new Vec2;return function(points){var v,vx,vy,ih,ie,c,i,rmi=0,rmx=-1/0,n=points.length,m=0,newPoints=[],failed=!1;for(i=n;i--;){v=points[i],vx=v.x,vy=v.y,(vx>rmx||vx==rmx&&vy<points[rmi].y)&&(rmi=i,rmx=vx)}for(hull.length=0,ih=rmi;;){for(hull[m]=ih,ie=0,i=1;n>i;i++){ie!==ih?(r.vsub(points[ie],points[hull[m]]),v.vsub(points[i],points[hull[m]]),c=v.cross(r),0>c&&(ie=i),0===c&&v.lenSq()>r.lenSq()&&(ie=i)):ie=i}if(m++,ih=ie,m>n){failed=!0;break}if(ie===rmi){break}}if(failed){return Log.warn("P2Convex.constructor: gift wrapping algorithm failed"),[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)]}for(i=m;i--;){newPoints.push(points[hull[i]])}return P2Convex.validateVertices(newPoints)?newPoints:(Log.warn("P2Convex.constructor: gift wrapping algorithm failed"),[new Vec2(.5,.5),new Vec2(-.5,.5),new Vec2(-.5,-.5),new Vec2(.5,-.5)])}}(),P2Convex}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2particle",["odin/base/class","odin/math/vec2","odin/phys2d/p2enums"],function(Class,Vec2,P2Enums){function P2Particle(opts){opts||(opts={}),Class.call(this),this.type=BodyType.Particle,this._index=-1,this.space=void 0,this.position=void 0!=opts.position?opts.position:new Vec2,this.velocity=void 0!=opts.velocity?opts.velocity:new Vec2,this.force=new Vec2,this.linearDamping=void 0!=opts.linearDamping?opts.linearDamping:.01,this.mass=void 0!=opts.mass?opts.mass:0,this.invMass=this.mass>0?1/this.mass:0,this.motionState=void 0!=opts.motionState?opts.motionState:MotionState.Static,this.allowSleep=void 0!=opts.allowSleep?!!opts.allowSleep:!0,this.sleepState=SleepState.Awake,this.sleepVelocityLimit=void 0!=opts.sleepVelocityLimit?!!opts.sleepVelocityLimit:.01,this.sleepTimeLimit=void 0!=opts.sleepTimeLimit?!!opts.sleepTimeLimit:1,this.userData=void 0,this._sleepTime=0,this._lastSleepyTime=0,this.vlambda=new Vec2}var pow=Math.pow,BodyType=P2Enums.BodyType,MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return Class.extend(P2Particle),P2Particle.prototype.copy=function(other){return this.motionState=other.motionState,this.position.copy(other.position),this.velocity.copy(other.velocity),this.force.copy(other.force),this.linearDamping=other.linearDamping,this.mass=other.mass,this.invMass=other.invMass,this.allowSleep=other.allowSleep,this.sleepState=other.sleepState,this},P2Particle.prototype.init=function(){this.mass>0&&this.isStatic()&&(this.motionState=MotionState.Dynamic)},P2Particle.prototype.update=function(dt){if(this.motionState!==MotionState.Static){var force=this.force,invMass=this.invMass,pos=this.position,vel=this.velocity,linearDamping=pow(1-this.linearDamping,dt);vel.x+=force.x*invMass*dt,vel.y+=force.y*invMass*dt,force.x=force.y=0,vel.x*=linearDamping,vel.y*=linearDamping,this.sleepState!==SleepState.Sleeping&&(pos.x+=vel.x*dt,pos.y+=vel.y*dt)}},P2Particle.prototype.clear=function(){return this},P2Particle.prototype.setMotionState=function(motionState){this.motionState!==motionState&&(this.motionState=motionState,this.velocity.set(0,0),this.force.set(0,0),this.wake())},P2Particle.prototype.setMass=function(mass){this.mass=mass,this.invMass=mass>0?1/mass:0},P2Particle.prototype.isAwake=function(){return this.sleepState===SleepState.Awake},P2Particle.prototype.isSleepy=function(){return this.sleepState===SleepState.Sleepy},P2Particle.prototype.isSleeping=function(){return this.sleepState===SleepState.Sleeping},P2Particle.prototype.isStatic=function(){return this.motionState===MotionState.Static},P2Particle.prototype.isDynamic=function(){return this.motionState===MotionState.Dynamic},P2Particle.prototype.isKinematic=function(){return this.motionState===MotionState.Kinematic},P2Particle.prototype.wake=function(){this.sleepState===SleepState.Sleeping&&this.emit("wake"),this.sleepState=SleepState.Awake},P2Particle.prototype.sleep=function(){this.sleepState!==SleepState.Sleeping&&this.emit("sleep"),this.sleepState=SleepState.Sleeping},P2Particle.prototype.sleepTick=function(time){if(this.allowSleep){var sleepState=this.sleepState,velSq=this.velocity.lengthSq(),sleepVelocityLimit=this.sleepVelocityLimit*this.sleepVelocityLimit;sleepState===SleepState.Awake&&sleepVelocityLimit>velSq?(this.sleepState=SleepState.Sleepy,this._sleepTime=time):sleepState===SleepState.Sleepy&&velSq>sleepVelocityLimit?this.wake():sleepState===SleepState.Sleepy&&time-this._lastSleepyTime>this.sleepTimeLimit&&this.sleep()}},P2Particle.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.motionState=this.motionState,json.position=this.position.toJSON(json.position),json.velocity=this.velocity.toJSON(json.velocity),json.force=this.force.toJSON(json.force),json.linearDamping=this.linearDamping,json.mass=this.mass,json.invMass=this.invMass,json.allowSleep=this.allowSleep,json.sleepState=this.sleepState,json
},P2Particle.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.motionState=json.motionState,this.position.fromJSON(json.position),this.velocity.fromJSON(json.velocity),this.force.fromJSON(json.force),this.linearDamping=json.linearDamping,this.mass=json.mass,this.invMass=json.invMass,this.allowSleep=json.allowSleep,this.sleepState=json.sleepState,this},P2Particle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2rect",["odin/math/vec2","odin/phys2d/objects/p2convex"],function(Vec2,P2Convex){function P2Rect(opts){opts||(opts={});var extents=opts.extents||new Vec2(.5,.5),x=extents.x,y=extents.y;opts.vertices=[new Vec2(x,y),new Vec2(-x,y),new Vec2(-x,-y),new Vec2(x,-y)],P2Convex.call(this,opts),this.extents=extents}return P2Convex.extend(P2Rect),P2Rect.prototype.toJSON=function(json){return json=P2Convex.prototype.toJSON.call(this,json),json.extents=this.extents.toJSON(json.extents),json},P2Rect.prototype.fromJSON=function(json){return P2Convex.prototype.fromJSON.call(this,json),this.extents.fromJSON(json.extents),this},P2Rect}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2rigidbody",["odin/base/class","odin/math/aabb2","odin/math/vec2","odin/math/mat32","odin/core/game/log","odin/phys2d/p2enums","odin/phys2d/objects/p2particle"],function(Class,AABB2,Vec2,Mat32,Log,P2Enums,P2Particle){function P2Rigidbody(opts){opts||(opts={}),P2Particle.call(this,opts),this.type=BodyType.RigidBody,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.angularVelocity=void 0!=opts.angularVelocity?opts.angularVelocity:0,this.torque=0,this.angularDamping=void 0!=opts.angularDamping?opts.angularDamping:.01*TWO_PI,this.matrix=new Mat32,this.inertia=0,this.invInertia=0,this.shapes=[],this._shapeHash={},this.aabb=new AABB2,this.sleepAngularVelocityLimit=void 0!=opts.sleepAngularVelocityLimit?!!opts.sleepAngularVelocityLimit:.01*TWO_PI,this.wlambda=0,opts.shape&&this.addShape(opts.shape),opts.shapes&&this.addShapes.apply(this,opts.shapes)}var VEC2_SCALE,totalCentroid,centroid,TWO_PI=2*Math.PI,pow=Math.pow,BodyType=P2Enums.BodyType,MotionState=P2Enums.MotionState,SleepState=P2Enums.SleepState;return P2Particle.extend(P2Rigidbody),P2Rigidbody.prototype.copy=function(other){P2Particle.prototype.copy.call(this,other);var shapes=other.shapes,i=shapes.length;for(this.clear(),this.rotation=other.rotation,this.angularVelocity=other.angularVelocity,this.torque=other.torque,this.angularDamping=other.angularDamping;i--;){this.addShape(shapes[i].clone())}return this},VEC2_SCALE=new Vec2(1,1),P2Rigidbody.prototype.init=function(){var shape,shapes=this.shapes,matrix=this.matrix,aabb=this.aabb,i=shapes.length;for(matrix.compose(this.position,VEC2_SCALE,this.rotation),aabb.clear();i--;){shape=shapes[i],shape.update(matrix),aabb.union(shape.aabb)}this.resetMassData()},P2Rigidbody.prototype.update=function(dt){if(this.motionState!==MotionState.Static){var shape,i,shapes=this.shapes,force=this.force,invMass=this.invMass,pos=this.position,vel=this.velocity,linearDamping=pow(1-this.linearDamping,dt),matrix=this.matrix,aabb=this.aabb;if(vel.x+=force.x*invMass*dt,vel.y+=force.y*invMass*dt,this.angularVelocity+=this.torque*this.invInertia*dt,force.x=force.y=this.torque=0,vel.x*=linearDamping,vel.y*=linearDamping,this.angularVelocity*=pow(1-this.angularDamping,dt),this.sleepState!==SleepState.Sleeping){for(pos.x+=vel.x*dt,pos.y+=vel.y*dt,this.rotation+=this.angularVelocity*dt,matrix.compose(pos,VEC2_SCALE,this.rotation),aabb.clear(),i=shapes.length;i--;){shape=shapes[i],shape.update(matrix),aabb.union(shape.aabb)}}}},P2Rigidbody.prototype.clear=function(){for(var shapes=this.shapes,i=shapes.length;i--;){this.removeShape(shapes[i])}return this},P2Rigidbody.prototype.applyForce=function(force,worldPoint){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var px,py,pos=this.position,f=this.force,fx=force.x,fy=force.y;worldPoint=worldPoint||pos,px=worldPoint.x-pos.x,py=worldPoint.y-pos.y,f.x+=fx,f.y+=fy,this.torque+=px*fy-py*fx}},P2Rigidbody.prototype.applyTorque=function(torque){this.motionState!==MotionState.Static&&(this.sleepState===SleepState.Sleeping&&this.wake(),this.torque+=torque)},P2Rigidbody.prototype.applyImpulse=function(impulse,worldPoint){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var px,py,pos=this.position,invMass=this.invMass,velocity=this.velocity,ix=impulse.x,iy=impulse.y;worldPoint=worldPoint||pos,px=worldPoint.x-pos.x,py=worldPoint.y-pos.y,velocity.x+=ix*invMass,velocity.y+=iy*invMass,this.angularVelocity+=(px*iy-py*ix)*this.invInertia}},P2Rigidbody.prototype.applyVelocity=function(velocity){if(this.motionState!==MotionState.Static){this.sleepState===SleepState.Sleeping&&this.wake();var vel=this.velocity;vel.x+=velocity.x,vel.y+=velocity.y}},P2Rigidbody.prototype.applyAngularVelocity=function(angularVelocity){this.motionState!==MotionState.Static&&(this.sleepState===SleepState.Sleeping&&this.wake(),this.angularVelocity+=angularVelocity)},totalCentroid=new Vec2,centroid=new Vec2,P2Rigidbody.prototype.resetMassData=function(){var shape,mass,inertia,i,shapes=this.shapes,totalMass=0,totalInertia=0;if(this.motionState===MotionState.Dynamic){for(totalCentroid.x=totalCentroid.y=0,i=shapes.length;i--;){shape=shapes[i],shape.centroid(centroid),mass=shape.area()*shape.density,inertia=shape.inertia(mass),totalCentroid.add(centroid.smul(mass)),totalMass+=mass,totalInertia+=inertia}centroid.copy(totalCentroid.sdiv(totalMass)),this.setMass(totalMass),this.setInertia(totalInertia-totalMass*centroid.lengthSq())}},P2Rigidbody.prototype.setMotionState=function(motionState){this.motionState!==motionState&&(this.motionState=motionState,this.velocity.set(0,0),this.force.set(0,0),this.angularVelocity=this.torque=0,this.wake())},P2Rigidbody.prototype.setInertia=function(inertia){this.inertia=inertia,this.invInertia=inertia>0?1/inertia:0},P2Rigidbody.prototype.addShape=function(shape){var shapes=this.shapes,index=shapes.indexOf(shape);return-1===index?(shape.body=this,shapes.push(shape),this._shapeHash[shape._id]=shape,this.space&&(shape.update(this.matrix),this.resetMassData())):Log.error("P2Rigidbody.addShape: Shape already attached to Body"),this},P2Rigidbody.prototype.addShapes=function(){for(var i=arguments.length;i--;){this.addShape(arguments[i])}return this},P2Rigidbody.prototype.removeShape=function(shape){var shapes=this.shapes,index=shapes.indexOf(shape);return-1!==index?(shape.body=void 0,shapes.splice(index,1),this._shapeHash[shape._id]=void 0,this.space&&this.resetMassData()):Log.error("P2Rigidbody.removeShape: Shape not attached to Body"),this},P2Rigidbody.prototype.removeShapes=function(){for(var i=arguments.length;i--;){this.removeShape(arguments[i])}return this},P2Rigidbody.prototype.forEachShape=function(fn,ctx){var shapes=this.shapes,i=shapes.length;if(ctx){for(;i--&&fn.call(ctx,shapes[i],i,shapes)!==!1;){}}else{for(;i--&&fn(shapes[i],i,shapes)!==!1;){}}return this},P2Rigidbody.prototype.sleepTick=function(time){if(this.allowSleep){var sleepState=this.sleepState,velSq=this.velocity.lengthSq(),sleepVelocityLimit=this.sleepVelocityLimit*this.sleepVelocityLimit,aVel=this.angularVelocity,sleepAngularVelocityLimit=this.sleepAngularVelocityLimit;sleepState===SleepState.Awake&&sleepVelocityLimit>velSq&&sleepAngularVelocityLimit>aVel?(this.sleepState=SleepState.Sleepy,this._sleepTime=time):sleepState===SleepState.Sleepy&&(velSq>sleepVelocityLimit||aVel>sleepAngularVelocityLimit)?this.wake():sleepState===SleepState.Sleepy&&time-this._lastSleepyTime>this.sleepTimeLimit&&this.sleep()}},P2Rigidbody.prototype.toJSON=function(json){json=P2Particle.prototype.toJSON.call(this,json);var shapes=this.shapes,jsonShapes=json.shapes||(json.shapes=[]),i=shapes.length;for(json.rotation=this.rotation,json.angularVelocity=this.angularVelocity,json.torque=this.torque,json.angularDamping=this.angularDamping;i--;){jsonShapes[i]=shapes[i].toJSON(jsonShapes[i])}return json},P2Rigidbody.prototype.fromJSON=function(json){P2Particle.prototype.fromJSON.call(this,json);var jsonShapes=json.shapes||(json.shapes=[]),i=jsonShapes.length;for(this.rotation=json.rotation,this.angularVelocity=json.angularVelocity,this.torque=json.torque,this.angularDamping=json.angularDamping;i--;){this.addShape(Class.fromJSON(jsonShapes[i]))}return this},P2Rigidbody}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/objects/p2segment",["odin/base/class","odin/math/vec2","odin/phys2d/p2enums","odin/phys2d/objects/p2shape"],function(Class,Vec2,P2Enums,P2Shape){function P2Segment(opts){opts||(opts={}),P2Shape.call(this,opts),this.type=ShapeType.Segment,this.a=void 0!=opts.a?opts.a:new Vec2(-.5,0),this.b=void 0!=opts.b?opts.b:new Vec2(.5,0),this._a=this.a.clone(),this._b=this.b.clone(),this._normal=(new Vec2).vsub(this._b,this._a).perp().normalize(),this.radius=void 0!=opts.radius?abs(opts.radius):.5}var inv12,VEC2_SCALE,ShapeType=P2Enums.ShapeType,abs=Math.abs,sqrt=Math.sqrt,PI=Math.PI;return P2Shape.extend(P2Segment),P2Segment.prototype.copy=function(other){return P2Shape.prototype.copy.call(this,other),this.a.copy(other.a),this.b.copy(other.b),this.radius=other.radius,this},P2Segment.prototype.pointQuery=function(p){if(!this.aabb.contains(p)){return!1}var dt,dta,dtb,dx,dy,r=this.radius,a=this._a,b=this._b,n=this._normal,ax=a.x,ay=a.y,bx=b.x,by=b.y,nx=n.x,ny=n.y,px=p.x,py=p.y,dn=nx*px+ny*py-(ax*nx+ay*ny),dist=abs(dn);return dist>r?!1:(dt=px*ny-py*nx,dta=ax*ny-ay*nx,dtb=bx*ny-by*nx,dta>=dt?dta-r>dt?!1:(dx=px-ax,dy=py-ay,r*r>dx*dx+dy*dy):dt>dtb?dt>dtb+r?!1:(dx=px-bx,dy=py-by,r*r>dx*dx+dy*dy):!0)},P2Segment.prototype.centroid=function(v){var localPosition=this.localPosition,a=this.a,b=this.b;return v.x=localPosition.x+.5*(a.x+b.x),v.y=localPosition.y+.5*(a.y+b.y),v},P2Segment.prototype.area=function(){var a=this.a,b=this.b,r=this.radius,abx=b.x-a.x,aby=b.y-a.y,l=abx*abx+aby*aby;return l=0===l?0:sqrt(l),r*(PI*r+2*l)},inv12=1/12,P2Segment.prototype.inertia=function(mass){var localPosition=this.localPosition,lx=localPosition.x,ly=localPosition.y,a=this.a,b=this.b,ax=lx+a.x,ay=ly+a.y,bx=lx+b.x,by=ly+b.y,abx=bx-ax,aby=by-ay,lsq=abx*abx+aby*aby,x=.5*(ax+bx),y=.5*(ay+by);return mass*(lsq*inv12+(x*x+y*y))},VEC2_SCALE=new Vec2(1,1),P2Segment.prototype.update=function(matrix){var l,r,b,t,localMatrix=this.matrix,matrixWorld=this.matrixWorld,localPos=this.localPosition,pos=this.position,_a=this._a,_b=this._b,_normal=this._normal,a=this.a,b=this.b,radius=this.radius,aabb=this.aabb,min=aabb.min,max=aabb.max;localMatrix.compose(localPos,VEC2_SCALE,this.localRotation),matrixWorld.mmul(matrix,localMatrix),pos.x=localPos.x,pos.y=localPos.y,pos.transformMat32(matrix),_a.x=a.x,_a.y=a.y,_a.transformMat32(matrix),_b.x=b.x,_b.y=b.y,_b.transformMat32(matrix),_normal.x=-(_b.y-_a.y),_normal.y=_b.x-_a.x,_normal.normalize(),_a.x<_b.x?(l=_a.x,r=_b.x):(l=_b.x,r=_a.x),_a.y<_b.y?(b=_a.y,t=_b.y):(b=_b.y,t=_a.y),min.x=l-radius,min.y=b-radius,max.x=r+radius,max.y=t+radius},P2Segment.prototype.toJSON=function(json){return json=P2Shape.prototype.toJSON.call(this,json),json.a=this.a.toJSON(json.a),json.b=this.b.toJSON(json.b),json.radius=this.radius,json},P2Segment.prototype.fromJSON=function(json){return P2Shape.prototype.fromJSON.call(this,json),this.a.fromJSON(json.a),this.b.fromJSON(json.b),this.radius=json.radius,this},P2Segment}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2solver",["odin/math/mathf"],function(Mathf){function P2Solver(opts){opts||(opts={}),this.iterations=void 0!=opts.iterations?opts.iterations:10,this.tolerance=void 0!=opts.tolerance?opts.tolerance:1e-6}var clamp=Mathf.clamp;return P2Solver.prototype.solve=function(h,equations){var eq,bi,bj,vlambdai,vlambdaj,vi,vj,GWlambda,lambda,deltaLambda,deltaLambdaTotal,i,j,num=equations.length,iterations=this.iterations,iter=0,toleranceSq=this.tolerance*this.tolerance;if(num>-1){for(i=num;i--;){eq=equations[i],eq.updateConstants(h),eq.init(h)}for(i=iterations;i--;){for(iter++,deltaLambdaTotal=0,j=num;j--;){eq=equations[j],GWlambda=eq.calculateGWlambda(),lambda=eq.lambda,deltaLambda=eq.invC*(eq.B-GWlambda-eq.eps*lambda),eq.lambda=clamp(lambda+deltaLambda,eq.minForce,eq.maxForce),deltaLambda=eq.lambda-lambda,eq.addToLambda(deltaLambda),deltaLambdaTotal+=deltaLambda}if(toleranceSq>deltaLambdaTotal*deltaLambdaTotal){break}}for(i=num;i--;){eq=equations[i],bi=eq.bi,vi=bi.velocity,vlambdai=bi.vlambda,bj=eq.bj,vj=bj.velocity,vlambdaj=bj.vlambda,vi.x+=vlambdai.x,vi.y+=vlambdai.y,vj.x+=vlambdaj.x,vj.y+=vlambdaj.y,vlambdai.x=vlambdai.y=vlambdaj.x=vlambdaj.y=0,void 0!=bi.wlambda&&(bi.angularVelocity+=bi.wlambda,bi.wlambda=0),void 0!=bj.wlambda&&(bj.angularVelocity+=bj.wlambda,bj.wlambda=0)}}return iter},P2Solver}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/constraints/p2friction",["odin/base/class","odin/math/mathf","odin/math/vec2","odin/phys2d/constraints/p2equation"],function(Class,Mathf,Vec2,P2Equation){function P2Friction(){P2Equation.call(this),this.p=new Vec2,this.t=new Vec2,this.ri=new Vec2,this.rj=new Vec2,this.rixt=0,this.rjxt=0}return P2Equation.extend(P2Friction),P2Friction.prototype.init=function(h){var bi=this.bi,bj=this.bj,p=this.p,px=p.x,py=p.y,t=this.t,tx=t.x,ty=t.y,xi=bi.position,xj=bj.position,ri=this.ri,rix=px-xi.x,riy=py-xi.y,rj=this.rj,rjx=px-xj.x,rjy=py-xj.y,rixt=rix*ty-riy*tx,rjxt=rjx*ty-rjy*tx;ri.x=rix,ri.y=riy,rj.x=rjx,rj.y=rjy,this.rixt=rixt,this.rjxt=rjxt,this.lambda=0,this.calculateB(h),this.calculateC()},P2Friction.prototype.calculateB=function(h){var bi=this.bi,bj=this.bj,t=this.t,tx=t.x,ty=t.y,vi=bi.velocity,wi=bi.angularVelocity||0,fi=bi.force,ti=bi.torque||0,invMi=bi.invMass,invIi=bi.invInertia||0,vj=bj.velocity,wj=bj.angularVelocity||0,fj=bj.force,tj=bj.torque||0,invMj=bj.invMass,invIj=bj.invInertia||0,ri=this.ri,rix=ri.x,riy=ri.y,rj=this.rj,rjx=rj.x,rjy=rj.y,Gq=0,GWx=vj.x+-wj*rjy-vi.x- -wi*riy,GWy=vj.y+wj*rjx-vi.y-wi*rix,GW=GWx*tx+GWy*ty,GiMfx=fj.x*invMj+-tj*invIj*rjy-fi.x*invMi- -ti*invIi*riy,GiMfy=fj.y*invMj+tj*invIj*rjx-fi.y*invMi-ti*invIi*rix,GiMf=GiMfx*tx+GiMfy*ty;this.B=-this.a*Gq-this.b*GW-h*GiMf},P2Friction.prototype.calculateC=function(){var bi=this.bi,bj=this.bj,rixt=this.rixt,rjxt=this.rjxt,invIi=bi.invInertia||0,invIj=bj.invInertia||0,C=bi.invMass+bj.invMass+this.eps+invIi*rixt*rixt+invIj*rjxt*rjxt;this.invC=0===C?0:1/C},P2Friction.prototype.calculateGWlambda=function(){var bi=this.bi,bj=this.bj,t=this.t,vlambdai=bi.vlambda,wlambdai=bi.wlambda||0,vlambdaj=bj.vlambda,wlambdaj=bj.wlambda||0,ulambdax=vlambdaj.x-vlambdai.x,ulambday=vlambdaj.y-vlambdai.y,GWlambda=ulambdax*t.x+ulambday*t.y;return void 0!=wlambdai&&(GWlambda-=wlambdai*this.rixt),void 0!=wlambdaj&&(GWlambda+=wlambdaj*this.rjxt),GWlambda},P2Friction.prototype.addToLambda=function(deltaLambda){var bi=this.bi,bj=this.bj,t=this.t,tx=t.x,ty=t.y,invMi=bi.invMass,vlambdai=bi.vlambda,invMj=bj.invMass,vlambdaj=bj.vlambda;vlambdai.x-=deltaLambda*invMi*tx,vlambdai.y-=deltaLambda*invMi*ty,vlambdaj.x+=deltaLambda*invMj*tx,vlambdaj.y+=deltaLambda*invMj*ty,void 0!=bi.wlambda&&(bi.wlambda-=deltaLambda*bi.invInertia*this.rixt),void 0!=bj.wlambda&&(bj.wlambda+=deltaLambda*bj.invInertia*this.rjxt)},P2Friction}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/p2space",["odin/base/class","odin/base/time","odin/base/object_pool","odin/math/vec2","odin/phys2d/p2enums","odin/phys2d/p2solver","odin/phys2d/collision/p2broadphase","odin/phys2d/collision/p2nearphase","odin/phys2d/constraints/p2friction","odin/core/game/log"],function(Class,Time,ObjectPool,Vec2,P2Enums,P2Solver,P2Broadphase,P2Nearphase,P2Friction,Log){function P2Space(opts){opts||(opts={}),Class.call(this,opts),this.useGravity=void 0!=opts.useGravity?!!opts.useGravity:!0,this.gravity=void 0!=opts.gravity?opts.gravity:new Vec2(0,-9.801),this.time=0,this.broadphase=new P2Broadphase,this.nearphase=new P2Nearphase,this.solver=new P2Solver,this.bodies=[],this._bodyHash={},this._pairsi=[],this._pairsj=[],this.contacts=[],this.frictions=[],this._collisionMatrix=[],this._collisionMatrixPrevious=[],this.stats={step:0,solve:0,integrate:0,nearphase:0,broadphase:0}}var now=Time.now,MotionState=P2Enums.MotionState,FRICTION_POOL=new ObjectPool(P2Friction);return Class.extend(P2Space),P2Space.FRICTION_POOL=FRICTION_POOL,P2Space.prototype.collisionMatrixGet=function(i,j,current){var tmp=j;return j>i&&(j=i,i=tmp),i=(i*(i+1)>>1)+j-1,void 0===current||current?this._collisionMatrix[i]:this._collisionMatrixPrevious[i]},P2Space.prototype.collisionMatrixSet=function(i,j,value,current){var tmp=j;j>i&&(j=i,i=tmp),i=(i*(i+1)>>1)+j-1,void 0==current||current?this._collisionMatrix[i]=value:this._collisionMatrixPrevious[i]=value},P2Space.prototype.collisionMatrixTick=function(){var i,collisionMatrix=this._collisionMatrixPrevious;for(this._collisionMatrixPrevious=this._collisionMatrix,this._collisionMatrix=collisionMatrix,i=collisionMatrix.length;i--;){collisionMatrix[i]=0}},P2Space.prototype.clear=function(){for(var bodies=this.bodies,i=bodies.length;i--;){this.removeBody(bodies[i])}return this},P2Space.prototype.addBody=function(body){var bodies=this.bodies,index=bodies.indexOf(body);return-1===index?(bodies.push(body),this._bodyHash[body._id]=body,body.space=this,body._index=bodies.length-1,body.init()):Log.error("P2Space.addBody: Body already member of P2Space"),this},P2Space.prototype.add=function(){for(var i=arguments.length;i--;){this.addBody(arguments[i])}return this},P2Space.prototype.removeBody=function(body){var bodies=this.bodies,index=bodies.indexOf(body);return-1!==index?(body.space=void 0,body._index=-1,bodies.splice(index,1),this._bodyHash[body._id]=void 0):Log.error("P2Space.addBody: Body not member of P2Space"),this},P2Space.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeBody(arguments[i])}return this},P2Space.prototype.findBodyByPoint=function(p){for(var body,shapes,shape,j,bodies=this.bodies,i=bodies.length;i--;){if(body=bodies[i]){for(shapes=body.shapes,j=shapes.length;j--;){if(shape=shapes[j],shape&&shape.pointQuery(p)){return body}}}}return void 0},P2Space.prototype.findBodyById=function(id){return this._bodyHash[id]},P2Space.prototype.step=function(dt){var time,start,body,force,mass,bi,bj,c,cp,cn,u,slipForce,fc,fcp,fct,i,stepStart=now(),stats=this.stats,g=this.gravity,gx=g.x,gy=g.y,bodies=this.bodies,numBodies=bodies.length,pairsi=this._pairsi,pairsj=this._pairsj,contacts=this.contacts,frictions=this.frictions;if(time=this.time+=dt,this.useGravity){for(i=numBodies;i--;){body=bodies[i],body.motionState===MotionState.Dynamic&&(force=body.force,mass=body.mass,force.x+=gx*mass,force.y+=gy*mass)}}for(this.collisionMatrixTick(),start=now(),this.broadphase.collisions(bodies,pairsi,pairsj),stats.broadphase=now()-start,start=now(),this.nearphase.collisions(pairsi,pairsj,contacts),stats.nearphase=now()-start,start=now(),this.solver.solve(dt,contacts),FRICTION_POOL.clear(),frictions.length=0,i=contacts.length;i--;){c=contacts[i],c.u>0&&(bi=c.bi,bj=c.bj,fc=FRICTION_POOL.create(),u=c.u,slipForce=u*c.lambda,fc.minForce=-slipForce,fc.maxForce=slipForce,fc.bi=bi,fc.bj=bj,cp=c.p,fcp=fc.p,fcp.x=cp.x,fcp.y=cp.y,cn=c.n,fct=fc.t,fct.x=-cn.y,fct.y=cn.x,frictions.push(fc))}for(this.solver.solve(dt,frictions),stats.solve=now()-start,start=now(),i=numBodies;i--;){body=bodies[i],body&&(body.update(dt),body.sleepTick(time))}stats.integrate=now()-start,stats.step=now()-stepStart},P2Space.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.useGravity=this.useGravity,json.gravity=this.gravity.toJSON(json.gravity),json},P2Space.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.useGravity=json.useGravity,this.gravity.fromJSON(json.gravity),this},P2Space}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/phys2d/phys2d",["require","odin/phys2d/collision/p2broadphase","odin/phys2d/collision/p2nearphase","odin/phys2d/objects/p2circle","odin/phys2d/objects/p2convex","odin/phys2d/objects/p2particle","odin/phys2d/objects/p2rect","odin/phys2d/objects/p2rigidbody","odin/phys2d/objects/p2segment","odin/phys2d/objects/p2shape","odin/phys2d/p2enums","odin/phys2d/p2solver","odin/phys2d/p2space"],function(require){function Phys2D(){this.P2Broadphase=require("odin/phys2d/collision/p2broadphase"),this.P2Nearphase=require("odin/phys2d/collision/p2nearphase"),this.P2Circle=require("odin/phys2d/objects/p2circle"),this.P2Convex=require("odin/phys2d/objects/p2convex"),this.P2Particle=require("odin/phys2d/objects/p2particle"),this.P2Rect=require("odin/phys2d/objects/p2rect"),this.P2Rigidbody=require("odin/phys2d/objects/p2rigidbody"),this.P2Segment=require("odin/phys2d/objects/p2segment"),this.P2Shape=require("odin/phys2d/objects/p2shape"),this.P2Enums=require("odin/phys2d/p2enums"),this.P2Solver=require("odin/phys2d/p2solver"),this.P2Space=require("odin/phys2d/p2space")}return new Phys2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/audio_ctx",[],function(){var w="undefined"!=typeof window?window:global,ctx=w.AudioContext||w.webkitAudioContext||w.mozAudioContext||w.oAudioContext||w.msAudioContext;return ctx&&(ctx=new ctx,ctx.createGain||(ctx.createGain=ctx.createGainNode),ctx.createPanner||(ctx.createPanner=ctx.createPannerNode),AudioBufferSourceNode.prototype.start||(AudioBufferSourceNode.prototype.start=function(delay,time){this.noteOn(delay,time)}),AudioBufferSourceNode.prototype.stop||(AudioBufferSourceNode.prototype.stop=function(time){this.noteOff(time)})),ctx?ctx:!1}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/device",[],function(){function Device(){var userAgent=navigator.userAgent.toLowerCase(),audio=new Audio,video=document.createElement("video");this.userAgent=userAgent,this.pixelRatio=window.devicePixelRatio||1,this.invPixelRatio=1/this.pixelRatio,this.browser=userAgent.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i)[1],this.touch="ontouchstart"in window,this.mobile=/android|webos|iphone|ipad|ipod|blackberry/i.test(userAgent),this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.fullScreen="fullscreenElement"in document||"mozFullscreenElement"in document||"webkitFullscreenElement"in document,this.webgl=function(){for(var has,canvas=document.createElement("canvas"),names=["3d","moz-webgl","experimental-webgl","webkit-3d","webgl"],i=names.length;i--&&!(has=!!canvas.getContext(names[i]));){}return has}(),this.canvas=function(){var canvas=document.createElement("canvas"),has=!!canvas.getContext("2d");return has}(),this.gamepads=!!navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.audioMpeg=!!audio.canPlayType("audio/mpeg"),this.audioOgg=!!audio.canPlayType("audio/ogg"),this.audioMp4=!!audio.canPlayType("audio/mp4"),this.videoWebm=!!video.canPlayType("video/webm"),this.videoOgg=!!video.canPlayType("video/ogg"),this.videoMp4=!!video.canPlayType("video/mp4")}return new Device}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/dom",[],function(){function Dom(){}var createShader,SPLITER=/[ ,]+/,WEBGL_NAMES=["webgl","webkit-3d","moz-webgl","experimental-webgl","3d"],WEBGL_ATTRIBUTES={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};return Dom.prototype.addEvent=function(obj,name,callback,ctx){for(var names=name.split(SPLITER),i=names.length,scope=ctx||obj,afn=function(e){callback.call(scope,e||window.event)};i--;){name=names[i],obj.attachEvent?obj.attachEvent("on"+name,afn):obj.addEventListener(name,afn,!1)}},Dom.prototype.removeEvent=function(obj,name,callback,ctx){for(var names=name.split(SPLITER),i=names.length,scope=ctx||obj,afn=function(e){callback&&callback.call(scope,e||window.event)};i--;){name=names[i],obj.detachEvent?obj.detachEvent("on"+name,afn):obj.removeEventListener(name,afn,!1)}},Dom.prototype.addMeta=function(id,name,content){var meta=document.createElement("meta"),head=document.head;id&&(meta.id=id),name&&(meta.name=name),content&&(meta.content=content),head.insertBefore(meta,head.firstChild)},Dom.prototype.getWebGLContext=function(canvas,attributes){var key,gl,i=WEBGL_NAMES.length;attributes||(attributes={});for(key in WEBGL_ATTRIBUTES){void 0==attributes[key]&&(attributes[key]=WEBGL_ATTRIBUTES[key])}for(;i--;){try{gl=canvas.getContext(WEBGL_NAMES[i],attributes)}catch(err){console.error("Dom.getWebGLContext: could not get a WebGL Context "+(err.message||""))}if(gl){break}}if(!gl){throw"Dom.getWebGLContext: could not get a WebGL Context"}return gl},createShader=Dom.prototype.createShader=function(gl,source,type){var shader=gl.createShader(type);return gl.shaderSource(shader,source),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(console.error("Dom.createShader: problem compiling shader "+gl.getShaderInfoLog(shader)),gl.deleteShader(shader),void 0)},Dom.prototype.createProgram=function(gl,vertex,fragment){var shader,program=gl.createProgram();return shader=createShader(gl,vertex,gl.VERTEX_SHADER),gl.attachShader(program,shader),gl.deleteShader(shader),shader=createShader(gl,fragment,gl.FRAGMENT_SHADER),gl.attachShader(program,shader),gl.deleteShader(shader),gl.linkProgram(program),gl.validateProgram(program),gl.useProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)?program:(console.error("Dom.createProgram: problem compiling Program "+gl.getProgramInfoLog(program)),gl.deleteProgram(program),void 0)},new Dom}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/base/request_animation_frame",[],function(){var RATE=1e3/60,w="undefined"!=typeof window?window:global;return w.requestAnimationFrame||w.webkitRequestAnimationFrame||w.mozRequestAnimationFrame||w.oRequestAnimationFrame||w.msRequestAnimationFrame||function(callback){return w.setTimeout(callback,RATE)}}),function(){var io=function(exports,global){var io=exports;return io.version="0.9.16",io.protocol=1,io.transports=[],io.j=[],io.sockets={},io.connect=function(host,details){var uuri,socket,options,uri=io.util.parseUri(host);return global&&global.location&&(uri.protocol=uri.protocol||global.location.protocol.slice(0,-1),uri.host=uri.host||(global.document?global.document.domain:global.location.hostname),uri.port=uri.port||global.location.port),uuri=io.util.uniqueUri(uri),options={host:uri.host,secure:"https"==uri.protocol,port:uri.port||("https"==uri.protocol?443:80),query:uri.query||""},io.util.merge(options,details),(options["force new connection"]||!io.sockets[uuri])&&(socket=new io.Socket(options)),!options["force new connection"]&&socket&&(io.sockets[uuri]=socket),socket=socket||io.sockets[uuri],socket.of(uri.path.length>1?uri.path:"")},io}({},this);!function(exports,global){var pageLoaded,util=exports.util={},re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];util.parseUri=function(str){for(var m=re.exec(str||""),uri={},i=14;i--;){uri[parts[i]]=m[i]||""}return uri},util.uniqueUri=function(uri){var protocol=uri.protocol,host=uri.host,port=uri.port;return"document"in global?(host=host||document.domain,port=port||("https"==protocol&&"https:"!==document.location.protocol?443:document.location.port)):(host=host||"localhost",port||"https"!=protocol||(port=443)),(protocol||"http")+"://"+host+":"+(port||80)},util.query=function(base,addition){var part,query=util.chunkQuery(base||""),components=[];util.merge(query,util.chunkQuery(addition||""));for(part in query){query.hasOwnProperty(part)&&components.push(part+"="+query[part])}return components.length?"?"+components.join("&"):""},util.chunkQuery=function(qs){for(var kv,query={},params=qs.split("&"),i=0,l=params.length;l>i;++i){kv=params[i].split("="),kv[0]&&(query[kv[0]]=kv[1])}return query},pageLoaded=!1,util.load=function(fn){return"document"in global&&"complete"===document.readyState||pageLoaded?fn():(util.on(global,"load",fn,!1),void 0)},util.on=function(element,event,fn,capture){element.attachEvent?element.attachEvent("on"+event,fn):element.addEventListener&&element.addEventListener(event,fn,capture)},util.request=function(xdomain){if(xdomain&&"undefined"!=typeof XDomainRequest&&!util.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!xdomain||util.ua.hasCORS)){return new XMLHttpRequest}if(!xdomain){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}return null},"undefined"!=typeof window&&util.load(function(){pageLoaded=!0}),util.defer=function(fn){return util.ua.webkit&&"undefined"==typeof importScripts?(util.load(function(){setTimeout(fn,100)}),void 0):fn()},util.merge=function(target,additional,deep,lastseen){var prop,seen=lastseen||[],depth="undefined"==typeof deep?2:deep;for(prop in additional){additional.hasOwnProperty(prop)&&util.indexOf(seen,prop)<0&&("object"==typeof target[prop]&&depth?util.merge(target[prop],additional[prop],depth-1,seen):(target[prop]=additional[prop],seen.push(additional[prop])))}return target},util.mixin=function(ctor,ctor2){util.merge(ctor.prototype,ctor2.prototype)},util.inherit=function(ctor,ctor2){function f(){}f.prototype=ctor2.prototype,ctor.prototype=new f},util.isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},util.intersect=function(arr,arr2){var i,l,ret=[],longest=arr.length>arr2.length?arr:arr2,shortest=arr.length>arr2.length?arr2:arr;for(i=0,l=shortest.length;l>i;i++){~util.indexOf(longest,shortest[i])&&ret.push(shortest[i])}return ret},util.indexOf=function(arr,o,i){for(var j=arr.length,i=0>i?0>i+j?0:i+j:i||0;j>i&&arr[i]!==o;i++){}return i>=j?-1:i},util.toArray=function(enu){var i,l,arr=[];for(i=0,l=enu.length;l>i;i++){arr.push(enu[i])}return arr},util.ua={},util.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(e){return!1}return void 0!=a.withCredentials}(),util.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),util.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(exports,io){function EventEmitter(){}exports.EventEmitter=EventEmitter,EventEmitter.prototype.on=function(name,fn){return this.$events||(this.$events={}),this.$events[name]?io.util.isArray(this.$events[name])?this.$events[name].push(fn):this.$events[name]=[this.$events[name],fn]:this.$events[name]=fn,this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.once=function(name,fn){function on(){self.removeListener(name,on),fn.apply(this,arguments)}var self=this;return on.listener=fn,this.on(name,on),this},EventEmitter.prototype.removeListener=function(name,fn){var list,pos,i,l;if(this.$events&&this.$events[name]){if(list=this.$events[name],io.util.isArray(list)){for(pos=-1,i=0,l=list.length;l>i;i++){if(list[i]===fn||list[i].listener&&list[i].listener===fn){pos=i;break}}if(0>pos){return this}list.splice(pos,1),list.length||delete this.$events[name]}else{(list===fn||list.listener&&list.listener===fn)&&delete this.$events[name]}}return this},EventEmitter.prototype.removeAllListeners=function(name){return void 0===name?(this.$events={},this):(this.$events&&this.$events[name]&&(this.$events[name]=null),this)},EventEmitter.prototype.listeners=function(name){return this.$events||(this.$events={}),this.$events[name]||(this.$events[name]=[]),io.util.isArray(this.$events[name])||(this.$events[name]=[this.$events[name]]),this.$events[name]
},EventEmitter.prototype.emit=function(name){var handler,args,listeners,i,l;if(!this.$events){return!1}if(handler=this.$events[name],!handler){return!1}if(args=Array.prototype.slice.call(arguments,1),"function"==typeof handler){handler.apply(this,args)}else{if(!io.util.isArray(handler)){return!1}for(listeners=handler.slice(),i=0,l=listeners.length;l>i;i++){listeners[i].apply(this,args)}}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(n){return 10>n?"0"+n:n}function date(d){return isFinite(d.valueOf())?d.getUTCFullYear()+"-"+f(d.getUTCMonth()+1)+"-"+f(d.getUTCDate())+"T"+f(d.getUTCHours())+":"+f(d.getUTCMinutes())+":"+f(d.getUTCSeconds())+"Z":null}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value instanceof Date&&(value=date(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1){partial[i]=str(i,value)||"null"}return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep){for(length=rep.length,i=0;length>i;i+=1){"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}}else{for(k in value){Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}}return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}var JSON,cx,escapable,gap,indent,meta,rep;return nativeJSON&&nativeJSON.parse?exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}:(JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space){for(i=0;space>i;i+=1){indent+=" "}}else{"string"==typeof space&&(indent=space)}if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length)){throw new Error("JSON.stringify")}return str("",{"":value})},JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value){for(k in value){Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k])}}return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("JSON.parse")},void 0)}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(exports,io){var regexp,parser=exports.parser={},packets=parser.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],reasons=parser.reasons=["transport not supported","client not handshaken","unauthorized"],advice=parser.advice=["reconnect"],JSON=io.JSON,indexOf=io.util.indexOf;parser.encodePacket=function(packet){var reason,adv,ev,encoded,type=indexOf(packets,packet.type),id=packet.id||"",endpoint=packet.endpoint||"",ack=packet.ack,data=null;switch(packet.type){case"error":reason=packet.reason?indexOf(reasons,packet.reason):"",adv=packet.advice?indexOf(advice,packet.advice):"",(""!==reason||""!==adv)&&(data=reason+(""!==adv?"+"+adv:""));break;case"message":""!==packet.data&&(data=packet.data);break;case"event":ev={name:packet.name},packet.args&&packet.args.length&&(ev.args=packet.args),data=JSON.stringify(ev);break;case"json":data=JSON.stringify(packet.data);break;case"connect":packet.qs&&(data=packet.qs);break;case"ack":data=packet.ackId+(packet.args&&packet.args.length?"+"+JSON.stringify(packet.args):"")}return encoded=[type,id+("data"==ack?"+":""),endpoint],null!==data&&void 0!==data&&encoded.push(data),encoded.join(":")},parser.encodePayload=function(packets){var i,l,packet,decoded="";if(1==packets.length){return packets[0]}for(i=0,l=packets.length;l>i;i++){packet=packets[i],decoded+=""+packet.length+""+packets[i]}return decoded},regexp=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/,parser.decodePacket=function(data){var id,packet,opts,pieces=data.match(regexp);if(!pieces){return{}}switch(id=pieces[2]||"",data=pieces[5]||"",packet={type:packets[pieces[1]],endpoint:pieces[4]||""},id&&(packet.id=id,packet.ack=pieces[3]?"data":!0),packet.type){case"error":pieces=data.split("+"),packet.reason=reasons[pieces[0]]||"",packet.advice=advice[pieces[1]]||"";break;case"message":packet.data=data||"";break;case"event":try{opts=JSON.parse(data),packet.name=opts.name,packet.args=opts.args}catch(e){}packet.args=packet.args||[];break;case"json":try{packet.data=JSON.parse(data)}catch(e){}break;case"connect":packet.qs=data||"";break;case"ack":if(pieces=data.match(/^([0-9]+)(\+)?(.*)/),pieces&&(packet.ackId=pieces[1],packet.args=[],pieces[3])){try{packet.args=pieces[3]?JSON.parse(pieces[3]):[]}catch(e){}}break;case"disconnect":case"heartbeat":}return packet},parser.decodePayload=function(data){var ret,i,length;if(""==data.charAt(0)){for(ret=[],i=1,length="";i<data.length;i++){""==data.charAt(i)?(ret.push(parser.decodePacket(data.substr(i+1).substr(0,length))),i+=Number(length)+1,length=""):length+=data.charAt(i)}return ret}return[parser.decodePacket(data)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io){function Transport(socket,sessid){this.socket=socket,this.sessid=sessid}exports.Transport=Transport,io.util.mixin(Transport,io.EventEmitter),Transport.prototype.heartbeats=function(){return!0},Transport.prototype.onData=function(data){var msgs,i,l;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==data&&(msgs=io.parser.decodePayload(data),msgs&&msgs.length)){for(i=0,l=msgs.length;l>i;i++){this.onPacket(msgs[i])}}return this},Transport.prototype.onPacket=function(packet){return this.socket.setHeartbeatTimeout(),"heartbeat"==packet.type?this.onHeartbeat():("connect"==packet.type&&""==packet.endpoint&&this.onConnect(),"error"==packet.type&&"reconnect"==packet.advice&&(this.isOpen=!1),this.socket.onPacket(packet),this)},Transport.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var self=this;this.closeTimeout=setTimeout(function(){self.onDisconnect()},this.socket.closeTimeout)}},Transport.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},Transport.prototype.onConnect=function(){return this.socket.onConnect(),this},Transport.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},Transport.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},Transport.prototype.packet=function(packet){this.send(io.parser.encodePacket(packet))},Transport.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},Transport.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},Transport.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},Transport.prototype.prepareUrl=function(){var options=this.socket.options;return this.scheme()+"://"+options.host+":"+options.port+"/"+options.resource+"/"+io.protocol+"/"+this.name+"/"+this.sessid},Transport.prototype.ready=function(socket,fn){fn.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function Socket(options){if(this.options={port:80,secure:!1,document:"document"in global?document:!1,resource:"socket.io",transports:io.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},io.util.merge(this.options,options),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||io.util.ua.hasCORS)){var self=this;io.util.on(global,"beforeunload",function(){self.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function empty(){}exports.Socket=Socket,io.util.mixin(Socket,io.EventEmitter),Socket.prototype.of=function(name){return this.namespaces[name]||(this.namespaces[name]=new io.SocketNamespace(this,name),""!==name&&this.namespaces[name].packet({type:"connect"})),this.namespaces[name]},Socket.prototype.publish=function(){var nsp,i;this.emit.apply(this,arguments);for(i in this.namespaces){this.namespaces.hasOwnProperty(i)&&(nsp=this.of(i),nsp.$emit.apply(nsp,arguments))}},Socket.prototype.handshake=function(fn){function complete(data){data instanceof Error?(self.connecting=!1,self.onError(data.message)):fn.apply(null,data.split(":"))}var insertAt,script,xhr,self=this,options=this.options,url=["http"+(options.secure?"s":"")+":/",options.host+":"+options.port,options.resource,io.protocol,io.util.query(this.options.query,"t="+ +new Date)].join("/");this.isXDomain()&&!io.util.ua.hasCORS?(insertAt=document.getElementsByTagName("script")[0],script=document.createElement("script"),script.src=url+"&jsonp="+io.j.length,insertAt.parentNode.insertBefore(script,insertAt),io.j.push(function(data){complete(data),script.parentNode.removeChild(script)})):(xhr=io.util.request(),xhr.open("GET",url,!0),this.isXDomain()&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){4==xhr.readyState&&(xhr.onreadystatechange=empty,200==xhr.status?complete(xhr.responseText):403==xhr.status?self.onError(xhr.responseText):(self.connecting=!1,!self.reconnecting&&self.onError(xhr.responseText)))},xhr.send(null))},Socket.prototype.getTransport=function(override){var i,transport,transports=override||this.transports;for(i=0;transport=transports[i];i++){if(io.Transport[transport]&&io.Transport[transport].check(this)&&(!this.isXDomain()||io.Transport[transport].xdomainCheck(this))){return new io.Transport[transport](this,this.sessionid)}}return null},Socket.prototype.connect=function(fn){if(this.connecting){return this}var self=this;return self.connecting=!0,this.handshake(function(sid,heartbeat,close,transports){function connect(transports){return self.transport&&self.transport.clearTimeouts(),self.transport=self.getTransport(transports),self.transport?(self.transport.ready(self,function(){self.connecting=!0,self.publish("connecting",self.transport.name),self.transport.open(),self.options["connect timeout"]&&(self.connectTimeoutTimer=setTimeout(function(){if(!self.connected&&(self.connecting=!1,self.options["try multiple transports"])){for(var remaining=self.transports;remaining.length>0&&remaining.splice(0,1)[0]!=self.transport.name;){}remaining.length?connect(remaining):self.publish("connect_failed")}},self.options["connect timeout"]))}),void 0):self.publish("connect_failed")}self.sessionid=sid,self.closeTimeout=1e3*close,self.heartbeatTimeout=1e3*heartbeat,self.transports||(self.transports=self.origTransports=transports?io.util.intersect(transports.split(","),self.options.transports):self.options.transports),self.setHeartbeatTimeout(),connect(self.transports),self.once("connect",function(){clearTimeout(self.connectTimeoutTimer),fn&&"function"==typeof fn&&fn()})}),this},Socket.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var self=this;this.heartbeatTimeoutTimer=setTimeout(function(){self.transport.onClose()},this.heartbeatTimeout)}},Socket.prototype.packet=function(data){return this.connected&&!this.doBuffer?this.transport.packet(data):this.buffer.push(data),this},Socket.prototype.setBuffer=function(v){this.doBuffer=v,!v&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},Socket.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},Socket.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},Socket.prototype.disconnectSync=function(){var xhr=io.util.request(),uri=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,io.protocol,"",this.sessionid].join("/")+"/?disconnect=1";xhr.open("GET",uri,!1),xhr.send(null),this.onDisconnect("booted")},Socket.prototype.isXDomain=function(){var port=global.location.port||("https:"==global.location.protocol?443:80);return this.options.host!==global.location.hostname||this.options.port!=port},Socket.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},Socket.prototype.onOpen=function(){this.open=!0},Socket.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},Socket.prototype.onPacket=function(packet){this.of(packet.endpoint).onPacket(packet)},Socket.prototype.onError=function(err){err&&err.advice&&"reconnect"===err.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",err&&err.reason?err.reason:err)},Socket.prototype.onDisconnect=function(reason){var wasConnected=this.connected,wasConnecting=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(wasConnected||wasConnecting)&&(this.transport.close(),this.transport.clearTimeouts(),wasConnected&&(this.publish("disconnect",reason),"booted"!=reason&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},Socket.prototype.reconnect=function(){function reset(){if(self.connected){for(var i in self.namespaces){self.namespaces.hasOwnProperty(i)&&""!==i&&self.namespaces[i].packet({type:"connect"})}self.publish("reconnect",self.transport.name,self.reconnectionAttempts)}clearTimeout(self.reconnectionTimer),self.removeListener("connect_failed",maybeReconnect),self.removeListener("connect",maybeReconnect),self.reconnecting=!1,delete self.reconnectionAttempts,delete self.reconnectionDelay,delete self.reconnectionTimer,delete self.redoTransports,self.options["try multiple transports"]=tryMultiple}function maybeReconnect(){return self.reconnecting?self.connected?reset():self.connecting&&self.reconnecting?self.reconnectionTimer=setTimeout(maybeReconnect,1e3):(self.reconnectionAttempts++>=maxAttempts?self.redoTransports?(self.publish("reconnect_failed"),reset()):(self.on("connect_failed",maybeReconnect),self.options["try multiple transports"]=!0,self.transports=self.origTransports,self.transport=self.getTransport(),self.redoTransports=!0,self.connect()):(self.reconnectionDelay<limit&&(self.reconnectionDelay*=2),self.connect(),self.publish("reconnecting",self.reconnectionDelay,self.reconnectionAttempts),self.reconnectionTimer=setTimeout(maybeReconnect,self.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var self=this,maxAttempts=this.options["max reconnection attempts"],tryMultiple=this.options["try multiple transports"],limit=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(maybeReconnect,this.reconnectionDelay),this.on("connect",maybeReconnect)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function SocketNamespace(socket,name){this.socket=socket,this.name=name||"",this.flags={},this.json=new Flag(this,"json"),this.ackPackets=0,this.acks={}}function Flag(nsp,name){this.namespace=nsp,this.name=name}exports.SocketNamespace=SocketNamespace,io.util.mixin(SocketNamespace,io.EventEmitter),SocketNamespace.prototype.$emit=io.EventEmitter.prototype.emit,SocketNamespace.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},SocketNamespace.prototype.packet=function(packet){return packet.endpoint=this.name,this.socket.packet(packet),this.flags={},this},SocketNamespace.prototype.send=function(data,fn){var packet={type:this.flags.json?"json":"message",data:data};return"function"==typeof fn&&(packet.id=++this.ackPackets,packet.ack=!0,this.acks[packet.id]=fn),this.packet(packet)},SocketNamespace.prototype.emit=function(name){var args=Array.prototype.slice.call(arguments,1),lastArg=args[args.length-1],packet={type:"event",name:name};return"function"==typeof lastArg&&(packet.id=++this.ackPackets,packet.ack="data",this.acks[packet.id]=lastArg,args=args.slice(0,args.length-1)),packet.args=args,this.packet(packet)},SocketNamespace.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},SocketNamespace.prototype.onPacket=function(packet){function ack(){self.packet({type:"ack",args:io.util.toArray(arguments),ackId:packet.id})}var params,self=this;switch(packet.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(packet.reason||"booted"):this.$emit("disconnect",packet.reason);break;case"message":case"json":params=["message",packet.data],"data"==packet.ack?params.push(ack):packet.ack&&this.packet({type:"ack",ackId:packet.id}),this.$emit.apply(this,params);break;case"event":params=[packet.name].concat(packet.args),"data"==packet.ack&&params.push(ack),this.$emit.apply(this,params);break;case"ack":this.acks[packet.ackId]&&(this.acks[packet.ackId].apply(this,packet.args),delete this.acks[packet.ackId]);break;case"error":packet.advice?this.socket.onError(packet):"unauthorized"==packet.reason?this.$emit("connect_failed",packet.reason):this.$emit("error",packet.reason)}},Flag.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},Flag.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function WS(){io.Transport.apply(this,arguments)}exports.websocket=WS,io.util.inherit(WS,io.Transport),WS.prototype.name="websocket",WS.prototype.open=function(){var Socket,query=io.util.query(this.socket.options.query),self=this;return Socket||(Socket=global.MozWebSocket||global.WebSocket),this.websocket=new Socket(this.prepareUrl()+query),this.websocket.onopen=function(){self.onOpen(),self.socket.setBuffer(!1)},this.websocket.onmessage=function(ev){self.onData(ev.data)},this.websocket.onclose=function(){self.onClose(),self.socket.setBuffer(!0)},this.websocket.onerror=function(e){self.onError(e)},this},WS.prototype.send=io.util.ua.iDevice?function(data){var self=this;return setTimeout(function(){self.websocket.send(data)},0),this}:function(data){return this.websocket.send(data),this},WS.prototype.payload=function(arr){for(var i=0,l=arr.length;l>i;i++){this.packet(arr[i])}return this},WS.prototype.close=function(){return this.websocket.close(),this},WS.prototype.onError=function(e){this.socket.onError(e)},WS.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},WS.check=function(){return"WebSocket"in global&&!("__addTask"in WebSocket)||"MozWebSocket"in global},WS.xdomainCheck=function(){return!0},io.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function XHR(socket){socket&&(io.Transport.apply(this,arguments),this.sendBuffer=[])}function empty(){}exports.XHR=XHR,io.util.inherit(XHR,io.Transport),XHR.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},XHR.prototype.payload=function(payload){var i,l,msgs=[];for(i=0,l=payload.length;l>i;i++){msgs.push(io.parser.encodePacket(payload[i]))}this.send(io.parser.encodePayload(msgs))},XHR.prototype.send=function(data){return this.post(data),this},XHR.prototype.post=function(data){function stateChange(){4==this.readyState&&(this.onreadystatechange=empty,self.posting=!1,200==this.status?self.socket.setBuffer(!1):self.onClose())}function onload(){this.onload=empty,self.socket.setBuffer(!1)}var self=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),global.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=onload:this.sendXHR.onreadystatechange=stateChange,this.sendXHR.send(data)},XHR.prototype.close=function(){return this.onClose(),this},XHR.prototype.request=function(method){var req=io.util.request(this.socket.isXDomain()),query=io.util.query(this.socket.options.query,"t="+ +new Date);if(req.open(method||"GET",this.prepareUrl()+query,!0),"POST"==method){try{req.setRequestHeader?req.setRequestHeader("Content-type","text/plain;charset=UTF-8"):req.contentType="text/plain"}catch(e){}}return req},XHR.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},XHR.check=function(socket,xdomain){try{var request=io.util.request(xdomain),usesXDomReq=global.XDomainRequest&&request instanceof XDomainRequest,socketProtocol=socket&&socket.options&&socket.options.secure?"https:":"http:",isXProtocol=global.location&&socketProtocol!=global.location.protocol;if(request&&(!usesXDomReq||!isXProtocol)){return!0}}catch(e){}return!1},XHR.xdomainCheck=function(socket){return XHR.check(socket,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io){function HTMLFile(){io.Transport.XHR.apply(this,arguments)}exports.htmlfile=HTMLFile,io.util.inherit(HTMLFile,io.Transport.XHR),HTMLFile.prototype.name="htmlfile",HTMLFile.prototype.get=function(){var iframeC,self,query;this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this,iframeC=this.doc.createElement("div"),iframeC.className="socketio",this.doc.body.appendChild(iframeC),this.iframe=this.doc.createElement("iframe"),iframeC.appendChild(this.iframe),self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date),this.iframe.src=this.prepareUrl()+query,io.util.on(window,"unload",function(){self.destroy()})},HTMLFile.prototype._=function(data,doc){data=data.replace(/\\\//g,"/"),this.onData(data);try{var script=doc.getElementsByTagName("script")[0];script.parentNode.removeChild(script)}catch(e){}},HTMLFile.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},HTMLFile.prototype.close=function(){return this.destroy(),io.Transport.XHR.prototype.close.call(this)},HTMLFile.check=function(socket){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window){try{var a=new(window[["Active"].concat("Object").join("X")])("htmlfile");return a&&io.Transport.XHR.check(socket)}catch(e){}}return!1},HTMLFile.xdomainCheck=function(){return!1},io.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,io,global){function XHRPolling(){io.Transport.XHR.apply(this,arguments)}function empty(){}exports["xhr-polling"]=XHRPolling,io.util.inherit(XHRPolling,io.Transport.XHR),io.util.merge(XHRPolling,io.Transport.XHR),XHRPolling.prototype.name="xhr-polling",XHRPolling.prototype.heartbeats=function(){return!1},XHRPolling.prototype.open=function(){var self=this;return io.Transport.XHR.prototype.open.call(self),!1},XHRPolling.prototype.get=function(){function stateChange(){4==this.readyState&&(this.onreadystatechange=empty,200==this.status?(self.onData(this.responseText),self.get()):self.onClose())}function onload(){this.onload=empty,this.onerror=empty,self.retryCounter=1,self.onData(this.responseText),self.get()}function onerror(){self.retryCounter++,!self.retryCounter||self.retryCounter>3?self.onClose():self.get()}if(this.isOpen){var self=this;this.xhr=this.request(),global.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=onload,this.xhr.onerror=onerror):this.xhr.onreadystatechange=stateChange,this.xhr.send(null)}},XHRPolling.prototype.onClose=function(){if(io.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=empty;try{this.xhr.abort()}catch(e){}this.xhr=null}},XHRPolling.prototype.ready=function(socket,fn){var self=this;io.util.defer(function(){fn.call(self,socket)})},io.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(exports,io,global){function JSONPPolling(){io.Transport["xhr-polling"].apply(this,arguments),this.index=io.j.length;var self=this;io.j.push(function(msg){self._(msg)})}var indicator=global.document&&"MozAppearance"in global.document.documentElement.style;exports["jsonp-polling"]=JSONPPolling,io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]),JSONPPolling.prototype.name="jsonp-polling",JSONPPolling.prototype.post=function(data){function complete(){initIframe(),self.socket.setBuffer(!1)}function initIframe(){self.iframe&&self.form.removeChild(self.iframe);try{iframe=document.createElement('<iframe name="'+self.iframeId+'">')}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var form,area,id,iframe,self=this,query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.form||(form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="socketio_iframe_"+this.index,form.className="socketio",form.style.position="absolute",form.style.top="0px",form.style.left="0px",form.style.display="none",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area),this.form.action=this.prepareUrl()+query,initIframe(),this.area.value=io.JSON.stringify(data);try{this.form.submit()}catch(e){}this.iframe.attachEvent?iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete,this.socket.setBuffer(!0)},JSONPPolling.prototype.get=function(){var insertAt,self=this,script=document.createElement("script"),query=io.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.prepareUrl()+query,script.onerror=function(){self.onClose()},insertAt=document.getElementsByTagName("script")[0],insertAt.parentNode.insertBefore(script,insertAt),this.script=script,indicator&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype._=function(msg){return this.onData(msg),this.isOpen&&this.get(),this},JSONPPolling.prototype.ready=function(socket,fn){var self=this;return indicator?(io.util.load(function(){fn.call(self)}),void 0):fn.call(this)},JSONPPolling.check=function(){return"document"in global},JSONPPolling.xdomainCheck=function(){return!0},io.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("odin/base/socket.io",[],function(){return io})}(),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/asset",["odin/core/game/log","odin/base/class"],function(Log,Class){function Asset(opts){opts||(opts={}),Class.call(this),this._name=void 0!=opts.name?opts.name:"Asset_"+this._id,this._loaded=!1,this.json=void 0!=opts.json?!!opts.json:!0,this.assets=void 0,this.load=void 0!=opts.load?!!opts.load:!!opts.src,this.src=opts.src,this.raw=opts.raw}var defineProperty=Object.defineProperty;return Class.extend(Asset),defineProperty(Asset.prototype,"name",{get:function(){return this._name},set:function(value){var hash,assets=this.assets;if(assets){if(hash=assets.hash,hash[value]){return Log.warn("Asset.set name: can't change name to "+value+" Assets already have an asset with same name"),void 0}delete hash[this.name],hash[value]=this}this._name=value}}),Asset.prototype.copy=function(other){return this.sync=other.sync,this.json=other.json,this.name=other.name+"."+this._id,this.src=other.src,this.raw=other.raw,other.assets&&this.assets!==other.assets&&other.assets.addAsset(this),this},Asset.prototype.clear=function(){return this.raw=null,this},Asset.prototype.destroy=function(){return this.assets?(this.assets.removeAsset(this),this.clear(),this):(Log.error("Asset.destroy: can't destroy Asset if it's not added to Assets"),this)},Asset.prototype.parse=function(raw){return this.raw=raw,this},Asset.prototype.toJSON=function(json,pack){return json=Class.prototype.toJSON.call(this,json),json.name=this.name,pack||(json.src=this.src),json},Asset.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.name=json.name,this.src=json.src,this},Asset}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/shader",["odin/core/assets/asset"],function(Asset){function Shader(opts){opts||(opts={}),Asset.call(this,opts),this.fallback=opts.fallback||"",this.vertex=opts.vertex||"void main(void) {}",this.fragment=opts.fragment||"void main(void) {}",this.lights=void 0!=opts.lights?opts.lights:!1,this.specular=void 0!=opts.specular?opts.specular:!0,this.vertexLit=void 0!=opts.vertexLit?opts.vertexLit:!1,this.shadows=void 0!=opts.shadows?opts.shadows:!1,this.fog=void 0!=opts.fog?opts.fog:!1,this.OES_standard_derivatives=void 0!=opts.OES_standard_derivatives?opts.OES_standard_derivatives:!1}return Asset.extend(Shader),Shader.prototype.copy=function(other){return Asset.prototype.copy.call(this,other),this.fallback=other.fallback,this.vertex=other.vertex,this.fragment=other.fragment,this.lights=other.lights,this.specular=other.specular,this.vertexLit=other.vertexLit,this.shadows=other.shadows,this.fog=other.fog,this.OES_standard_derivatives=other.OES_standard_derivatives,this},Shader.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this.fromJSON(raw),this},Shader.prototype.clear=function(){return Asset.prototype.clear.call(this),this.vertex="",this.fragment="",this},Shader.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack),json.fallback=this.fallback,json.vertex=this.vertex,json.fragment=this.fragment,json.lights=this.lights,json.specular=this.specular,json.vertexLit=this.vertexLit,json.shadows=this.shadows,json.fog=this.fog,json.OES_standard_derivatives=this.OES_standard_derivatives,json
},Shader.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),this.fallback=json.fallback,this.vertex=json.vertex,this.fragment=json.fragment,this.lights=json.lights,this.specular=json.specular,this.vertexLit=json.vertexLit,this.shadows=json.shadows,this.fog=json.fog,this.OES_standard_derivatives=json.OES_standard_derivatives,this},Shader}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/unlit",["odin/core/assets/shaders/shader"],function(Shader){function Unlit(){Shader.call(this,{name:"shader_unlit",load:!1,vertex:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","varying vec2 vUv;","void main() {","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	gl_FragColor = finalColor;","}"].join("\n")})}return Shader.extend(Unlit),Unlit}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/vertex_lit",["odin/core/assets/shaders/shader"],function(Shader){function VertexLit(){Shader.call(this,{name:"shader_vertex_lit",load:!1,lights:!0,vertexLit:!0,vertex:["varying vec2 vUv;","varying vec3 vDiffuseLight;","void main() {","	vUv = uv;","	VertexLight(transformedNormal, worldPosition.xyz, -mvPosition.xyz, vDiffuseLight);","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","varying vec2 vUv;","varying vec3 vDiffuseLight;","void main() {","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	gl_FragColor = vec4(vDiffuseLight * finalColor.xyz, finalColor.w);","}"].join("\n")})}return Shader.extend(VertexLit),VertexLit}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/diffuse",["odin/core/assets/shaders/shader"],function(Shader){function Diffuse(){Shader.call(this,{name:"shader_diffuse",load:!1,lights:!0,specular:!1,vertex:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","varying vec2 vUv;","void main() {","	vec3 diffuseLight = PixelLightNoSpec(normalize(vNormal));","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	gl_FragColor = vec4(diffuseLight * finalColor.xyz, finalColor.w);","}"].join("\n")})}return Shader.extend(Diffuse),Diffuse}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/specular",["odin/core/assets/shaders/shader"],function(Shader){function Specular(){Shader.call(this,{name:"shader_specular",load:!1,lights:!0,vertex:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","uniform float shininess;","varying vec2 vUv;","void main() {","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	vec3 diffuseLight, specularLight;","	PixelLight(normalize(vNormal), vec3(finalColor.w), finalColor.w, shininess, diffuseLight, specularLight);","	gl_FragColor = vec4(diffuseLight * finalColor.xyz + specularLight * finalColor.xyz, 1.0);","}"].join("\n")})}return Shader.extend(Specular),Specular}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/normal_diffuse",["odin/core/assets/shaders/shader"],function(Shader){function NormalDiffuse(){Shader.call(this,{name:"shader_normal_diffuse",load:!1,lights:!0,specular:!1,OES_standard_derivatives:!0,vertex:["varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	#ifdef USE_SKINNING","		vec4 boneTangent = boneMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * boneTangent.xyz );","	#else","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vUv = uv;","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","uniform sampler2D normalMap;","uniform float normalScale;","varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	vec3 normalTex = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= normalScale;","	mat3 tsb = mat3( vTangent, vBinormal, vNormal );","	vec3 normal = normalize(tsb * normalTex);","	vec3 diffuseLight = PixelLightNoSpec(normal);","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	gl_FragColor = vec4(diffuseLight * finalColor.xyz, finalColor.w);","}"].join("\n")})}return Shader.extend(NormalDiffuse),NormalDiffuse}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/normal_specular",["odin/core/assets/shaders/shader"],function(Shader){function NormalSpecular(){Shader.call(this,{name:"shader_normal_specular",load:!1,fallback:"specular",lights:!0,OES_standard_derivatives:!0,vertex:["varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	#ifdef USE_SKINNING","		vec4 boneTangent = boneMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * boneTangent.xyz );","	#else","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vUv = uv;","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","uniform sampler2D normalMap;","uniform float normalScale;","uniform float shininess;","varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	vec3 normalTex = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= normalScale;","	mat3 tsb = mat3( vTangent, vBinormal, vNormal );","	vec3 normal = normalize(tsb * normalTex);","	vec3 diffuseLight, specularLight;","	PixelLight(normal, vec3(finalColor.w), finalColor.w, shininess, diffuseLight, specularLight);","	gl_FragColor = vec4(diffuseLight * finalColor.xyz + specularLight * finalColor.xyz, 1.0);","}"].join("\n")})}return Shader.extend(NormalSpecular),NormalSpecular}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/normal/parallax_diffuse",["odin/core/assets/shaders/shader"],function(Shader){function ParallexDiffuse(){Shader.call(this,{name:"shader_parallex_diffuse",load:!1,lights:!0,specular:!1,OES_standard_derivatives:!0,vertex:["varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	#ifdef USE_SKINNING","		vec4 boneTangent = boneMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * boneTangent.xyz );","	#else","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vUv = uv;","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","uniform sampler2D normalMap;","uniform float normalScale;","varying vec2 vUv;","varying vec3 vTangent;","varying vec3 vBinormal;","void main() {","	vec3 normalTex = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= normalScale;","	mat3 tsb = mat3( vTangent, vBinormal, vNormal );","	vec3 normal = normalize(tsb * normalTex);","	vec3 diffuseLight = PixelLightNoSpec(normal);","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	gl_FragColor = vec4(diffuseLight * finalColor.xyz, finalColor.w);","}"].join("\n")})}return Shader.extend(ParallexDiffuse),ParallexDiffuse}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/particle/unlit",["odin/core/assets/shaders/shader"],function(Shader){function ParticleUnlit(){Shader.call(this,{name:"shader_particle_unlit",vertex:["void main() {","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform sampler2D diffuseMap;","void main() {","	float c = cos(vAngle);","	float s = sin(vAngle);","	vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,","						  c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);","	vec4 rotatedTexture = texture2D(diffuseMap, rotatedUV);","	gl_FragColor = vec4(vParticleColor * rotatedTexture.xyz, vAlpha * rotatedTexture.w);","}"].join("\n")})}return Shader.extend(ParticleUnlit),ParticleUnlit}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/reflective/reflective_vertex_lit",["odin/core/assets/shaders/shader"],function(Shader){function ReflectiveVertexLit(){Shader.call(this,{name:"shader_reflective_vertex_lit",load:!1,lights:!0,vertexLit:!0,vertex:["varying vec2 vUv;","varying vec3 vReflect;","varying vec3 vDiffuseLight;","void main() {","	vec3 worldNormal = normalize(mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * objectNormal);","	vec3 cameraToVertex = normalize(worldPosition.xyz - cameraPosition);","	vReflect = reflect(cameraToVertex, worldNormal);","	vUv = uv;","	VertexLight(transformedNormal, worldPosition.xyz, -mvPosition.xyz, vDiffuseLight);","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragment:["uniform vec3 diffuseColor;","uniform sampler2D diffuseMap;","uniform samplerCube envMap;","uniform float reflectivity;","uniform int combine;","varying vec2 vUv;","varying vec3 vReflect;","varying vec3 vDiffuseLight;","void main() {","	vec4 finalColor = texture2D(diffuseMap, vUv);","	finalColor.xyz *= diffuseColor;","	vec3 cubeColor = textureCube(envMap, vReflect).xyz;","	if (combine == 1) {","		finalColor.xyz = mix(finalColor.xyz, cubeColor, reflectivity);","	} else if (combine == 2) {","		finalColor.xyz += cubeColor * reflectivity;","	} else {","		finalColor.xyz = mix(finalColor.xyz, finalColor.xyz * cubeColor, reflectivity);","	}","	gl_FragColor = vec4(vDiffuseLight * finalColor.xyz, finalColor.w);","}"].join("\n")})}return Shader.extend(ReflectiveVertexLit),ReflectiveVertexLit}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/shaders/shader_lib",["odin/core/assets/shaders/normal/unlit","odin/core/assets/shaders/normal/vertex_lit","odin/core/assets/shaders/normal/diffuse","odin/core/assets/shaders/normal/specular","odin/core/assets/shaders/normal/normal_diffuse","odin/core/assets/shaders/normal/normal_specular","odin/core/assets/shaders/normal/parallax_diffuse","odin/core/assets/shaders/particle/unlit","odin/core/assets/shaders/reflective/reflective_vertex_lit"],function(Unlit,VertexLit,Diffuse,Specular,NormalDiffuse,NormalSpecular,ParallaxDiffuse,ParticleUnlit,ReflectiveVertexLit){return{Unlit:Unlit,VertexLit:VertexLit,Diffuse:Diffuse,Specular:Specular,NormalDiffuse:NormalDiffuse,NormalSpecular:NormalSpecular,ParallaxDiffuse:ParallaxDiffuse,ParticleUnlit:ParticleUnlit,ReflectiveVertexLit:ReflectiveVertexLit}}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/assets",["odin/base/class","odin/core/assets/asset","odin/core/game/log"],function(Class,Asset,Log){function Assets(){Array.call(this),this.hash={}}return Assets.prototype=Object.create(Array.prototype),Assets.prototype.constructor=Assets,Assets.prototype.get=function(name){var asset=this.hash[name];return asset?asset:(Log.error("Assets.get: can't find asset with name "+name+", it has not been added to Assets, use Assets.addAsset(asset)"),void 0)},Assets.prototype.addAsset=function(asset){if(!(asset instanceof Asset)){return Log.error("Assets.addAsset: can't add passed argument, it is not an instance of Asset"),this}var name=asset.name;return this.hash[name]?(Log.error("Assets.addAsset: Assets already have Asset named "+asset.name),void 0):(asset.assets=this,this.push(asset),this.hash[name]=asset,asset)},Assets.prototype.addAssets=function(){for(var i=0,il=arguments.length;il>i;i++){this.addAsset(arguments[i])}},Assets.prototype.removeAsset=function(asset){var name="string"==typeof asset?asset:asset.name;return(asset=this.hash[name])?(this.splice(this.indexOf(asset),1),this.hash[name]=null,asset):(Log.error("Assets.removeAsset: Assets does not have an Asset named "+name),void 0)},Assets.prototype.removeAssets=function(){for(var i=0,il=arguments.length;il>i;i++){this.removeAsset(arguments[i])}},Assets.prototype.toJSON=function(json,pack){json||(json={});for(var jsonAsset,jsonAssets=json.assets||(json.assets=[]),i=this.length;i--;){(jsonAsset=this[i]).json&&(jsonAssets[i]=jsonAsset.toJSON(jsonAssets[i],pack))}return json},Assets.prototype.fromJSON=function(json){for(var asset,jsonAsset,assetsHash=this.hash,jsonAssets=json.assets||(json.assets=[]),i=jsonAssets.length;i--;){(jsonAsset=jsonAssets[i])&&((asset=assetsHash[jsonAsset.name])?asset.fromJSON(jsonAsset):this.add(Class.fromJSON(jsonAsset)))}return this},new Assets}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/asset_loader",["odin/base/util","odin/base/event_emitter","odin/base/audio_ctx","odin/core/assets/asset","odin/core/assets/assets","odin/core/game/log"],function(util,EventEmitter,AudioCtx,Asset,Assets,Log){function getExt(src){return src?src.split(".").pop():"none"}function AssetLoader(){EventEmitter.call(this)}var isArray=util.isArray,ajax=util.ajax,each=util.each;return EventEmitter.extend(AssetLoader),AssetLoader.prototype.load=function(reload){var self=this,count=Assets.length,i=count,fn=function(err){err&&Log.error(err),count--,0>=count&&self.emit("load")};for(count||self.emit("load");i--;){this.loadAsset(Assets[i],fn,reload,!0)}},AssetLoader.prototype.loadAsset=function(asset,callback,reload,known){var raw,loaded,ext,self=this,src=asset.src;if(known&&-1!==Assets.indexOf(asset)||Assets.addAsset(asset),!asset.load||!src||asset.raw&&!reload){return asset._loaded=!0,callback&&callback(),void 0}if(isArray(src)){raw=[],loaded=src.length,each(src,function(s,i){var ext=getExt(s);return this[ext]?(this[ext](s,function(err,data){loaded--,raw[i]=data,err&&Log.error(err),0>=loaded&&(asset._loaded=!0,asset.parse(raw),asset.emit("load",raw),self.emit("loadAsset",asset),callback&&callback())}),!0):(callback&&callback(new Error("AssetLoader.load: has no loader named "+ext)),!1)},this)}else{if(ext=getExt(src),!this[ext]){return callback&&callback(new Error("AssetLoader.load: has no loader named "+ext)),void 0}this[ext](src,function(err,raw){return err?(callback&&callback(new Error("AssetLoader.load: "+err.message)),void 0):(asset._loaded=!0,asset.parse(raw),asset.emit("load",raw),self.emit("loadAsset",asset),callback&&callback(),void 0)})}},AssetLoader.prototype.gif=AssetLoader.prototype.jpg=AssetLoader.prototype.jpeg=AssetLoader.prototype.png=function(src,callback){var image=new Image;image.onload=function(){callback&&callback(null,image)},image.onerror=function(){callback&&callback(new Error("GET "+src+" 404 (Not Found)"))},image.src=src},AssetLoader.prototype.json=function(src,callback){ajax({src:src,before:function(){this.setRequestHeader("Content-Type","application/json")},success:function(){var json=this.responseText;try{json=JSON.parse(this.responseText)}catch(err){return callback&&callback(err),void 0}callback&&callback(null,json)},error:function(err){callback&&callback(err)}})},AssetLoader.prototype.ogg=AssetLoader.prototype.wav=AssetLoader.prototype.mp3=AssetLoader.prototype.aac=function(src,callback){ajax({src:src,before:function(){this.responseType="arraybuffer"},success:function(){if(AudioCtx){if(AudioCtx.decodeAudioData){AudioCtx.decodeAudioData(this.response,function(buffer){callback&&callback(null,buffer)},function(){callback&&callback(new Error("AudioContext Failed to parse Audio Clip"))})}else{var buffer=AudioCtx.createBuffer(this.response,!1);buffer?callback&&callback(null,buffer):callback&&callback(new Error("AudioContext Failed to parse Audio Clip"))}}else{callback&&callback(new Error("AudioContext (WebAudio API) is not supported by this browser"))}},error:function(err){callback&&callback(err)}})},new AssetLoader}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/audio_clip",["odin/base/util","odin/base/audio_ctx","odin/core/assets/asset"],function(util,AudioCtx,Asset){function AudioClip(opts){opts||(opts={}),Asset.call(this,opts)}var isArray=util.isArray,defineProperty=Object.defineProperty,arrayBufferToBase64=util.arrayBufferToBase64,base64ToArrayBuffer=util.base64ToArrayBuffer;return Asset.extend(AudioClip),defineProperty(AudioClip.prototype,"length",{get:function(){return this.raw?this.raw.duration:0}}),defineProperty(AudioClip.prototype,"samples",{get:function(){return this.raw?this.raw.length:0}}),defineProperty(AudioClip.prototype,"frequency",{get:function(){return this.raw?this.raw.sampleRate:44100}}),defineProperty(AudioClip.prototype,"channels",{get:function(){return this.raw?this.raw.numberOfChannels:0}}),AudioClip.prototype.parse=function(raw){Asset.prototype.parse.call(this,raw);var i;if(isArray(raw)){for(i=raw.length;i--;){raw[i]&&(this.raw=raw[i])}}return this},AudioClip.prototype.getData=function(array,offset){return array||(array=[]),this.raw?this.raw.getChannelData(array,offset):array},AudioClip.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack),!pack&&this.src||!this.raw||(json.raw=arrayBufferToBase64(this.raw)),json},AudioClip.prototype.fromJSON=function(json,pack){return Asset.prototype.fromJSON.call(this,json,pack),!pack&&this.src||!this.raw||(this.raw=base64ToArrayBuffer(json.raw)),this},AudioClip}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec3",["odin/math/mathf"],function(Mathf){function Vec3(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}var sqrt=Math.sqrt;return Mathf._classes.Vec3=Vec3,Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)},Vec3.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this},Vec3.prototype.set=function(x,y,z){return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this.z+=other.z,this},Vec3.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},Vec3.prototype.sadd=function(s){return this.x+=s,this.y+=s,this.z+=s,this},Vec3.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this.z-=other.z,this},Vec3.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},Vec3.prototype.ssub=function(s){return this.x-=s,this.y-=s,this.z-=s,this},Vec3.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this.z*=other.z,this},Vec3.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},Vec3.prototype.smul=function(s){return this.x*=s,this.y*=s,this.z*=s,this},Vec3.prototype.div=function(other){var x=other.x,y=other.y,z=other.z;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this.z*=0!==z?1/z:0,this},Vec3.prototype.vdiv=function(a,b){var x=b.x,y=b.y,z=b.z;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this.z=0!==z?a.z/z:0,this},Vec3.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this.z*=s,this},Vec3.prototype.length=function(){var x=this.x,y=this.y,z=this.z,lsq=x*x+y*y+z*z;return 1===lsq?1:0===lsq?0:sqrt(lsq)},Vec3.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z;return x*x+y*y+z*z},Vec3.prototype.setLength=function(length){var x=this.x,y=this.y,z=this.z,l=x*x+y*y+z*z;return 1===l?(this.x*=length,this.y*=length,this.z*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this.z*=l*length,this)},Vec3.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,l=x*x+y*y+z*z;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this)},Vec3.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},Vec3.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this.z=-other.z,this},Vec3.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this},Vec3.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this},Vec3.vdot=Vec3.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},Vec3.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z},Vec3.vcross=Vec3.prototype.vcross=function(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},Vec3.prototype.cross=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},Vec3.prototype.min=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this.z=az>bz?bz:az,this},Vec3.prototype.max=function(other){var ax=this.x,ay=this.y,az=this.z,bx=other.x,by=other.y,bz=other.z;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this.z=bz>az?bz:az,this},Vec3.prototype.clamp=function(min,max){var x=this.x,y=this.y,z=this.z,minx=min.x,miny=min.y,minz=min.z,maxx=max.x,maxy=max.y,maxz=max.z;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this.z=minz>z?minz:z>maxz?maxz:z,this},Vec3.prototype.transformMat3=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z;return this.x=x*me[0]+y*me[3]+z*me[6],this.y=x*me[1]+y*me[4]+z*me[7],this.z=x*me[2]+y*me[5]+z*me[8],this},Vec3.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z;return this.x=x*me[0]+y*me[4]+z*me[8]+me[12],this.y=x*me[1]+y*me[5]+z*me[9]+me[13],this.z=x*me[2]+y*me[6]+z*me[10]+me[14],this},Vec3.prototype.transformMat4Rotation=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z;return this.x=x*me[0]+y*me[4]+z*me[8],this.y=x*me[1]+y*me[5]+z*me[9],this.z=x*me[2]+y*me[6]+z*me[10],this},Vec3.prototype.transformProjection=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z,d=1/(me[3]*x+me[7]*y+me[11]*z+me[15]);return this.x=(me[0]*x+me[4]*y+me[8]*z+me[12])*d,this.y=(me[1]*x+me[5]*y+me[9]*z+me[13])*d,this.z=(me[2]*x+me[6]*y+me[10]*z+me[14])*d,this},Vec3.prototype.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this},Vec3.prototype.fromVec2=function(v){return this.x=v.x,this.y=v.y,this.z=0,this},Vec3.prototype.fromVec4=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},Vec3.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this.z=me[14],this},Vec3.prototype.scaleFromMat3=function(m){var me=m.elements,x=this.set(me[0],me[3],me[6]).length(),y=this.set(me[1],me[4],me[7]).length(),z=this.set(me[2],me[5],me[8]).length();return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.scaleFromMat4=function(m){var me=m.elements,x=this.set(me[0],me[4],me[8]).length(),y=this.set(me[1],me[5],me[9]).length(),z=this.set(me[2],me[6],me[10]).length();return this.x=x,this.y=y,this.z=z,this},Vec3.prototype.equals=function(other){return!(this.x!==other.x||this.y!==other.y||this.z!==other.z)},Vec3.prototype.notEquals=function(other){return this.x!==other.x||this.y!==other.y||this.z!==other.z},Vec3.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this},Vec3.prototype.toJSON=function(json){return json||(json={}),json._className="Vec3",json.x=this.x,json.y=this.y,json.z=this.z,json},Vec3.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this},Vec3.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array},Vec3.prototype.toString=function(){return"Vec3( "+this.x+", "+this.y+", "+this.z+" )"},Vec3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/rect",[],function(){function Rect(x,y,width,height){this._x=x||0,this._y=y||0,this._width=width||0,this._height=height||0,this._xMin=this._x,this._xMax=this._x+this._width,this._yMin=this._y,this._yMax=this._y+this._height}var defineProperty=Object.defineProperty;return defineProperty(Rect.prototype,"x",{get:function(){return this._x},set:function(value){this._x=value,this._xMin=value,this._xMax=value+this._width}}),defineProperty(Rect.prototype,"y",{get:function(){return this._y},set:function(value){this._y=value,this._yMin=value,this._yMax=value+this._height}}),defineProperty(Rect.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value,this._xMax=this._xMin+value}}),defineProperty(Rect.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value,this._yMax=this._yMin+value}}),defineProperty(Rect.prototype,"xMin",{get:function(){return this._xMin},set:function(value){this._xMin=value,this._x=value,this._width=this._xMax-this._xMin,this._xMax=value+this._width}}),defineProperty(Rect.prototype,"xMax",{get:function(){return this._xMax},set:function(value){this._xMax=value,this._width=value-this._xMin}}),defineProperty(Rect.prototype,"yMin",{get:function(){return this._yMin},set:function(value){this._yMin=value,this._y=value,this._height=this._yMax-this._yMin,this._yMax=value+this._height}}),defineProperty(Rect.prototype,"yMax",{get:function(){return this._yMax},set:function(value){this._yMax=value,this._height=value-this._yMin}}),defineProperty(Rect.prototype,"z",{get:function(){return this.width},set:function(value){this.width=value}}),defineProperty(Rect.prototype,"w",{get:function(){return this.height},set:function(value){this.height=value}}),Rect.prototype.clone=function(){return new Rect(this.x,this.y,this.width,this.height)},Rect.prototype.copy=function(other){return this._x=other._x,this._y=other._y,this._width=other._width,this._height=other._height,this._xMin=other._xMin,this._xMax=other._xMax,this._yMin=other._yMin,this._yMax=other._yMax,this},Rect.prototype.set=function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},Rect.prototype.center=function(v){return v.x=this._x+.5*this._width,v.y=this._y+.5*this._height,v},Rect.prototype.intersects=function(rect){return!(rect._xMax<this._xMin||rect._xMin>this._xMax||rect._yMax<this._yMin||rect._yMin>this._yMax)},Rect.prototype.contains=function(point){var x=point.x,y=point.y;return!(x<this._xMin||x>this._xMax||y<this._yMin||y>this._yMax)},Rect.prototype.toJSON=function(json){return json||(json={}),json.x=this._x,json.y=this._y,json.width=this._width,json.height=this._height,json},Rect.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.width=json.width,this.height=json.height,this},Rect.prototype.toString=function(){return"Rect( "+this._x+", "+this._y+", "+this._width+", "+this._height+" )"},Rect}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/color",["odin/math/mathf"],function(Mathf){function Color(r,g,b){this.r=0,this.g=0,this.b=0,this._r=0,this._g=0,this._b=0,this._hex="#000000",this._rgb="rgb(0,0,0)",this.set(r,g,b)}function singleToHEX(value){var str=(~~(255*clamp01(value))).toString(16);return 1===str.length?"0"+str:str}var colorNames,sqrt=Math.sqrt,floor=Math.floor,clamp01=Mathf.clamp01,defineProperty=Object.defineProperty;return Mathf._classes.Color=Color,defineProperty(Color.prototype,"x",{get:function(){return this.r},set:function(value){this.r=value}}),defineProperty(Color.prototype,"y",{get:function(){return this.g},set:function(value){this.g=value}}),defineProperty(Color.prototype,"z",{get:function(){return this.b},set:function(value){this.b=value}}),Color.prototype.clone=function(){return new Color(this.r,this.g,this.b)},Color.prototype.copy=function(other){return this.r=other.r,this.g=other.g,this.b=other.b,this},Color.prototype.set=function(r,g,b){var type=typeof r;return"number"===type?(this.r=r,this.g=g,this.b=b):"string"===type?this.setStyle(r):r instanceof Color&&(this.r=r.r,this.g=r.g,this.b=r.b),this},Color.prototype.setRGB=function(r,g,b){return this.r=r,this.g=g,this.b=b,this},Color.prototype.setStyle=function(){var rgb255=/^rgb\((\d+),(\d+),(\d+)\)$/i,rgb100=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i,hex6=/^\#([0.0-9a-f]{6})$/i,hex3=/^\#([0.0-9a-f])([0.0-9a-f])([0.0-9a-f])$/i,hex3to6=/#(.)(.)(.)/,hex3to6String="#$1$1$2$2$3$3",colorName=/^(\w+)$/i,inv255=1/255,inv100=.01;return function(style){var color;return rgb255.test(style)?(color=rgb255.exec(style),this.r=min(255,Number(color[1]))*inv255,this.g=min(255,Number(color[2]))*inv255,this.b=min(255,Number(color[3]))*inv255,this):rgb100.test(style)?(color=rgb100.exec(style),this.r=min(100,Number(color[1]))*inv100,this.g=min(100,Number(color[2]))*inv100,this.b=min(100,Number(color[3]))*inv100,this):hex6.test(style)?(this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):hex3.test(style)?(style=style.replace(hex3to6,hex3to6String),this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):colorName.test(style)?(style=colorNames[style],this.r=parseInt(style.substr(1,2),16)*inv255,this.g=parseInt(style.substr(3,2),16)*inv255,this.b=parseInt(style.substr(5,2),16)*inv255,this):this}}(),Color.prototype.toHEX=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var hexR=singleToHEX(this.r),hexG=singleToHEX(this.g),hexB=singleToHEX(this.b);this._r=this.r,this._g=this.g,this._b=this.b,this._hex="#"+hexR+hexG+hexB,this._rgb="rgb("+floor(256*clamp01(this.r))+","+floor(256*clamp01(this.g))+","+floor(256*clamp01(this.b))+")"}return this._hex},Color.prototype.toRGB=function(){if(this.r!==this._r||this.g!==this._g||this.b!==this._b){var r=floor(256*clamp01(this.r)),g=floor(256*clamp01(this.g)),b=floor(256*clamp01(this.b));this._r=this.r,this._g=this.g,this._b=this.b,this._rgb="rgb("+r+","+g+","+b+")",this._hex="#"+singleToHEX(this.r)+singleToHEX(this.g)+singleToHEX(this.b)}return this._rgb},Color.prototype.add=function(other){return this.r+=other.r,this.g+=other.g,this.b+=other.b,this},Color.prototype.cadd=function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},Color.prototype.sadd=function(s){return this.r+=s,this.g+=s,this.b+=s,this},Color.prototype.sub=function(other){return this.r-=other.r,this.g-=other.g,this.b-=other.b,this},Color.prototype.csub=function(a,b){return this.r=a.r-b.r,this.g=a.g-b.g,this.b=a.b-b.b,this},Color.prototype.ssub=function(s){return this.r-=s,this.g-=s,this.b-=s,this},Color.prototype.mul=function(other){return this.r*=other.r,this.g*=other.g,this.b*=other.b,this},Color.prototype.cmul=function(a,b){return this.r=a.r*b.r,this.g=a.g*b.g,this.b=a.b*b.b,this},Color.prototype.smul=function(s){return this.r*=s,this.g*=s,this.b*=s,this},Color.prototype.div=function(other){var x=other.r,y=other.g,z=other.b;return this.r*=0!==x?1/x:0,this.g*=0!==y?1/y:0,this.b*=0!==z?1/z:0,this},Color.prototype.cdiv=function(a,b){var x=b.r,y=b.g,z=b.b;return this.r=0!==x?a.r/x:0,this.g=0!==y?a.g/y:0,this.b=0!==z?a.b/z:0,this},Color.prototype.sdiv=function(s){return s=0===s?0:1/s,this.r*=s,this.g*=s,this.b*=s,this},Color.prototype.length=function(){var r=this.r,g=this.g,b=this.b,l=r*r+g*g+b*b;return l>0?1/sqrt(l):0},Color.prototype.lengthSq=function(){var r=this.r,g=this.g,b=this.b;return r*r+g*g+b*b},Color.prototype.normalize=function(){var r=this.r,g=this.g,b=this.b,l=r*r+g*g+b*b;return l=l>0?1/sqrt(l):0,this.r*=l,this.g*=l,this.b*=l,this
},Color.prototype.cnormalize=function(){var r=this.r,g=this.g,b=this.b;return this.r=r>1?1:r,this.g=g>1?1:g,this.b=b>1?1:b,this},Color.prototype.lerp=function(other,x){return this.r+=(other.r-this.r)*x,this.g+=(other.g-this.g)*x,this.b+=(other.b-this.b)*x,this},Color.prototype.clerp=function(a,b,x){var ax=a.r,ay=a.g,az=a.b;return this.r=ax+(b.r-ax)*x,this.g=ay+(b.g-ay)*x,this.b=az+(b.b-az)*x,this},Color.prototype.min=function(other){var ar=this.r,ag=this.g,ab=this.b,br=other.r,bg=other.g,bb=other.b;return this.r=ar>br?br:ar,this.g=ag>bg?bg:ag,this.b=ab>bb?bb:ab,this},Color.prototype.max=function(other){var ar=this.r,ag=this.g,ab=this.b,br=other.r,bg=other.g,bb=other.b;return this.r=br>ar?br:ar,this.g=bg>ag?bg:ag,this.b=bb>ab?bb:ab,this},Color.prototype.fromVec2=function(v){return this.r=v.x,this.g=v.y,this.b=0,this},Color.prototype.fromVec3=function(v){return this.r=v.x,this.g=v.y,this.b=v.z,this},Color.prototype.fromVec4=Color.prototype.fromVec3,Color.prototype.equals=function(other){return!(this.r!==other.r||this.g!==other.g||this.b!==other.b)},Color.prototype.notEquals=function(other){return this.r!==other.r||this.g!==other.g||this.b!==other.b},Color.prototype.fromJSON=function(json){return this.r=json.r,this.g=json.g,this.b=json.b,this},Color.prototype.toJSON=function(json){return json||(json={}),json._className="Color",json.r=this.r,json.g=this.g,json.b=this.b,json},Color.prototype.fromArray=function(array){return this.r=array[0],this.g=array[1],this.b=array[2],this},Color.prototype.toArray=function(array){return array||(array=[]),array[0]=this.r,array[1]=this.g,array[2]=this.b,array},Color.prototype.toString=function(){return"Color( "+this.r+", "+this.g+", "+this.b+" )"},colorNames=Color.colorNames={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Color}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/enums",["odin/base/enum"],function(Enum){return{AxisType:new Enum("Button Mouse MouseWheel Touch Joystick"),Blending:new Enum("Default None Additive Subtractive Muliply Custom"),Side:new Enum("Front Back Both"),CullFace:new Enum("None Back Front FrontBack"),EmitterType:new Enum("Circle Box Sphere"),LightType:new Enum("Point Directional Spot Hemi"),TextClipping:new Enum("Overflow Clip"),TextAnchor:new Enum("Left Center Right"),ShadowMapType:new Enum("BasicShadowMap PCFShadowMap PCFSoftShadowMap"),FilterMode:new Enum("None Linear"),TextureFormat:new Enum("RGB RGBA Luminance Alpha LuminanceAlpha"),TextureWrap:new Enum("Repeat Clamp MirrorRepeat"),WrapMode:new Enum("Once Loop PingPong Clamp")}}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/material",["odin/base/util","odin/math/vec3","odin/math/rect","odin/math/color","odin/core/assets/asset","odin/core/assets/assets","odin/core/enums"],function(util,Rect,Vec3,Color,Asset,Assets,Enums){function Material(opts){opts||(opts={}),Asset.call(this,opts),this.blending=void 0!=opts.blending?opts.blending:Enums.Blending.Default,this.side=void 0!=opts.side?opts.side:Enums.Side.Front,this.wireframe=void 0!=opts.wireframe?opts.wireframe:!1,this.wireframeLineWidth=void 0!=opts.wireframeLineWidth?opts.wireframeLineWidth:1,this.shader=void 0!=opts.shader?opts.shader:void 0,this.uniforms=merge(opts.uniforms||{},{diffuseColor:new Color(1,1,1),shininess:8,normalScale:1}),this.receiveShadow=void 0!=opts.receiveShadow?!!opts.receiveShadow:!0,this.castShadow=void 0!=opts.castShadow?!!opts.castShadow:!0,this.needsUpdate=!0}function toJSON(obj,json){var value,key;for(key in obj){value=obj[key],json[key]="object"!=typeof value?value:value.toJSON?value.toJSON(json[key]):value}return json}function fromJSON(obj,json){var value,key,classes=Class._classes,mathClasses=Mathf._classes;for(key in json){value=json[key],obj[key]="object"!=typeof value?value:mathClasses[value._className]?Mathf.fromJSON(value):classes[value._className]?Class.fromJSON(value):value}}function copy(obj){var value,key,out={},classes=Class._classes,mathClasses=Mathf._classes;for(key in obj){value=obj[key],out[key]="object"!=typeof value?value:mathClasses[value._className]?(new mathClasses[value._className]).copy(value):classes[value._className]?(new classes[value._className]).copy(value):value}return out}var merge=util.merge;return Asset.extend(Material),Material.prototype.copy=function(other){return Asset.prototype.copy.call(this,other),this.blending=other.blending,this.side=other.side,this.wireframe=other.wireframe,this.wireframeLineWidth=other.wireframeLineWidth,this.shader=other.shader,this.uniforms=copy(other.uniforms),this.receiveShadow=other.receiveShadow,this.castShadow=other.castShadow,this},Material.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this.fromJSON(raw),this},Material.prototype.clear=function(){return Asset.prototype.clear.call(this),this},Material.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json,pack),json.blending=this.blending,json.side=this.side,json.wireframe=this.wireframe,json.wireframeLineWidth=this.wireframeLineWidth,json.shader=void 0!=this.shader?this.shader.name:void 0,toJSON(this.uniforms,json.uniforms||(json.uniforms={})),json.receiveShadow=this.receiveShadow,json.castShadow=this.castShadow,json},Material.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),this.blending=json.blending,this.side=json.side,this.wireframe=json.wireframe,this.wireframeLineWidth=json.wireframeLineWidth,this.shader=void 0!=json.shader?Assets.get(json.shader):void 0,fromJSON(this.uniforms,json.uniforms),this.receiveShadow=json.receiveShadow,this.castShadow=json.castShadow,this},Material}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/quat",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function Quat(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!=w?w:1}var abs=Math.abs,sqrt=Math.sqrt,acos=Math.acos,sin=Math.sin,cos=Math.cos,EPSILON=Mathf.EPSILON;return Mathf._classes.Quat=Quat,Quat.prototype.clone=function(){return new Quat(this.x,this.y,this.z,this.w)},Quat.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this.w=other.w,this},Quat.prototype.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Quat.prototype.mul=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=other.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.qmul=function(a,b){var ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=b.x,by=b.y,bz=b.z,bw=b.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.div=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=-other.x,by=-other.y,bz=-other.z,bw=other.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.qdiv=function(a,b){var ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=-b.x,by=-b.y,bz=-b.z,bw=b.w;return this.x=ax*bw+aw*bx+ay*bz-az*by,this.y=ay*bw+aw*by+az*bx-ax*bz,this.z=az*bw+aw*bz+ax*by-ay*bx,this.w=aw*bw-ax*bx-ay*by-az*bz,this},Quat.prototype.length=function(){var x=this.x,y=this.y,z=this.z,w=this.w,lsq=x*x+y*y+z*z+w*w;return lsq>0?sqrt(lsq):0},Quat.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},Quat.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this.w*=l,this},Quat.prototype.inverse=function(){var x=this.x,y=this.y,z=this.z,w=this.w,d=x*x+y*y+z*z+w*w,invD=d>0?1/d:0;return this.x*=-invD,this.y*=-invD,this.z*=-invD,this.w*=invD,this},Quat.prototype.inverseQuat=function(other){var x=other.x,y=other.y,z=other.z,w=other.w,d=x*x+y*y+z*z+w*w,invD=d>0?1/d:0;return this.x=-x*invD,this.y=-y*invD,this.z=-z*invD,this.w=w*invD,this},Quat.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},Quat.prototype.calculateW=function(){var x=this.x,y=this.y,z=this.z;return this.w=-sqrt(abs(1-x*x-y*y-z*z)),this},Quat.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this},Quat.prototype.qlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this},Quat.prototype.nlerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this.normalize()},Quat.prototype.qnlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this.normalize()},Quat.prototype.slerp=function(other,x){var omega,sinom,scale0,scale1,ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=other.w,cosom=ax*bx+ay*by+az*bz+aw*bw;return 0>cosom&&(cosom*=-1,bx*=-1,by*=-1,bz*=-1,bw*=-1),1-cosom>EPSILON?(omega=acos(cosom),sinom=1/sin(omega),scale0=sin((1-x)*omega)*sinom,scale1=sin(x*omega)*sinom):(scale0=1-x,scale1=x),this.x=scale0*ax+scale1*bx,this.y=scale0*ay+scale1*by,this.z=scale0*az+scale1*bz,this.w=scale0*aw+scale1*bw,this},Quat.prototype.qslerp=function(a,b,x){var omega,sinom,scale0,scale1,ax=a.x,ay=a.y,az=a.z,aw=a.w,bx=b.x,by=b.y,bz=b.z,bw=b.w,cosom=ax*bx+ay*by+az*bz+aw*bw;return 0>cosom&&(cosom*=-1,bx*=-1,by*=-1,bz*=-1,bw*=-1),1-cosom>EPSILON?(omega=acos(cosom),sinom=1/sin(omega),scale0=sin((1-x)*omega)*sinom,scale1=sin(x*omega)*sinom):(scale0=1-x,scale1=x),this.x=scale0*ax+scale1*bx,this.y=scale0*ay+scale1*by,this.z=scale0*az+scale1*bz,this.w=scale0*aw+scale1*bw,this},Quat.qdot=Quat.prototype.qdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},Quat.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z+this.w*other.w},Quat.prototype.rotationX=function(){var w=this.w;return this.x/sqrt(1-w*w)},Quat.prototype.rotationY=function(){var w=this.w;return this.y/sqrt(1-w*w)},Quat.prototype.rotationZ=function(){var w=this.w;return this.z/sqrt(1-w*w)},Quat.prototype.rotateX=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c+w*s,this.y=y*c+z*s,this.z=z*c-y*s,this.w=w*c-x*s,this},Quat.prototype.rotateY=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c-z*s,this.y=y*c+w*s,this.z=z*c+x*s,this.w=w*c-y*s,this},Quat.prototype.rotateZ=function(angle){var halfAngle=.5*angle,x=this.x,y=this.y,z=this.z,w=this.w,s=sin(halfAngle),c=cos(halfAngle);return this.x=x*c+y*s,this.y=y*c-x*s,this.z=z*c+w*s,this.w=w*c-z*s,this},Quat.prototype.rotate=function(x,y,z){return this.rotateZ(z),this.rotateX(x),this.rotateY(y),this},Quat.prototype.lookRotation=function(forward,up){var fx=forward.x,fy=forward.y,fz=forward.z,ux=up.x,uy=up.y,uz=up.z,ax=uy*fz-uz*fy,ay=uz*fx-ux*fz,az=ux*fy-uy*fx,d=2*(1+ux*fx+uy*fy+uz*fz),dsq=d*d,s=1/dsq;return this.x=ax*s,this.y=ay*s,this.z=az*s,this.w=.5*dsq,this},Quat.prototype.fromAxisAngle=function(axis,angle){var halfAngle=.5*angle,s=sin(halfAngle);return this.x=axis.x*s,this.y=axis.y*s,this.z=axis.z*s,this.w=cos(halfAngle),this},Quat.prototype.fromVec3s=function(){var a=new Vec3;return function(u,v){return a.vcross(u,v),this.x=a.x,this.y=a.y,this.z=a.z,this.w=sqrt(u.lengthSq()*v.lengthSq())+u.dot(v),this.normalize()}}(),Quat.prototype.fromMat3=function(m){var s,invS,te=m.elements,m11=te[0],m12=te[3],m13=te[6],m21=te[1],m22=te[4],m23=te[7],m31=te[2],m32=te[5],m33=te[8],trace=m11+m22+m33;return trace>0?(s=.5/sqrt(trace+1),this.w=.25/s,this.x=(m32-m23)*s,this.y=(m13-m31)*s,this.z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),invS=1/s,this.w=(m32-m23)*invS,this.x=.25*s,this.y=(m12+m21)*invS,this.z=(m13+m31)*invS):m22>m33?(s=2*sqrt(1+m22-m11-m33),invS=1/s,this.w=(m13-m31)*invS,this.x=(m12+m21)*invS,this.y=.25*s,this.z=(m23+m32)*invS):(s=2*sqrt(1+m33-m11-m22),invS=1/s,this.w=(m21-m12)*invS,this.x=(m13+m31)*invS,this.y=(m23+m32)*invS,this.z=.25*s),this},Quat.prototype.fromMat4=function(m){var s,invS,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return trace>0?(s=.5/sqrt(trace+1),this.w=.25/s,this.x=(m32-m23)*s,this.y=(m13-m31)*s,this.z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),invS=1/s,this.w=(m32-m23)*invS,this.x=.25*s,this.y=(m12+m21)*invS,this.z=(m13+m31)*invS):m22>m33?(s=2*sqrt(1+m22-m11-m33),invS=1/s,this.w=(m13-m31)*invS,this.x=(m12+m21)*invS,this.y=.25*s,this.z=(m23+m32)*invS):(s=2*sqrt(1+m33-m11-m22),invS=1/s,this.w=(m21-m12)*invS,this.x=(m13+m31)*invS,this.y=(m23+m32)*invS,this.z=.25*s),this},Quat.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this.w=array[3],this},Quat.prototype.equals=function(other){return!(this.x!==other.x||this.y!==other.y||this.z!==other.z||this.w!==other.w)},Quat.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this.w=json.w,this},Quat.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array[3]=this.w,array},Quat.prototype.toJSON=function(json){return json||(json={}),json._className="Quat",json.x=this.x,json.y=this.y,json.z=this.z,json.w=this.w,json},Quat.prototype.toString=function(){return"Quat( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},Quat}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat4",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function Mat4(m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44){var te=new Float32Array(16);this.elements=te,te[0]=void 0!=m11?m11:1,te[4]=m12||0,te[8]=m13||0,te[12]=m14||0,te[1]=m21||0,te[5]=void 0!=m22?m22:1,te[9]=m23||0,te[13]=m24||0,te[2]=m31||0,te[6]=m32||0,te[10]=void 0!=m33?m33:1,te[14]=m34||0,te[3]=m41||0,te[7]=m42||0,te[11]=m43||0,te[15]=void 0!=m44?m44:1}var sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin,tan=Math.tan;return Mathf._classes.Mat4=Mat4,Mat4.prototype.clone=function(){var te=this.elements;return new Mat4(te[0],te[4],te[8],te[12],te[1],te[5],te[9],te[13],te[2],te[6],te[10],te[14],te[3],te[7],te[11],te[15])},Mat4.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this},Mat4.prototype.set=function(m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44){var te=this.elements;return te[0]=m11,te[4]=m12,te[8]=m13,te[12]=m14,te[1]=m21,te[5]=m22,te[9]=m23,te[13]=m24,te[2]=m31,te[6]=m32,te[10]=m33,te[14]=m34,te[3]=m41,te[7]=m42,te[11]=m43,te[15]=m44,this},Mat4.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return ae[0]=a11*b11+a12*b21+a13*b31+a14*b41,ae[4]=a11*b12+a12*b22+a13*b32+a14*b42,ae[8]=a11*b13+a12*b23+a13*b33+a14*b43,ae[12]=a11*b14+a12*b24+a13*b34+a14*b44,ae[1]=a21*b11+a22*b21+a23*b31+a24*b41,ae[5]=a21*b12+a22*b22+a23*b32+a24*b42,ae[9]=a21*b13+a22*b23+a23*b33+a24*b43,ae[13]=a21*b14+a22*b24+a23*b34+a24*b44,ae[2]=a31*b11+a32*b21+a33*b31+a34*b41,ae[6]=a31*b12+a32*b22+a33*b32+a34*b42,ae[10]=a31*b13+a32*b23+a33*b33+a34*b43,ae[14]=a31*b14+a32*b24+a33*b34+a34*b44,ae[3]=a41*b11+a42*b21+a43*b31+a44*b41,ae[7]=a41*b12+a42*b22+a43*b32+a44*b42,ae[11]=a41*b13+a42*b23+a43*b33+a44*b43,ae[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},Mat4.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},Mat4.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,te[9]*=s,te[10]*=s,te[11]*=s,te[12]*=s,te[13]*=s,te[14]*=s,te[15]*=s,this},Mat4.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,te[9]*=s,te[10]*=s,te[11]*=s,te[12]*=s,te[13]*=s,te[14]*=s,te[15]*=s,this},Mat4.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=1,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=0,this},Mat4.prototype.determinant=function(){var m11=ae[0],m12=ae[4],m13=ae[8],m14=ae[12],m21=ae[1],m22=ae[5],m23=ae[9],m24=ae[13],m31=ae[2],m32=ae[6],m33=ae[10],m34=ae[14],m41=ae[3],m42=ae[7],m43=ae[11],m44=ae[15];return m41*(m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34)+m42*(m11*m23*m34-m11*m24*m33+m14*m21*m33-m13*m21*m34+m13*m24*m31-m14*m23*m31)+m43*(m11*m24*m32-m11*m22*m34-m14*m21*m32+m12*m21*m34+m14*m22*m31-m12*m24*m31)+m44*(-m13*m22*m31-m11*m23*m32+m11*m22*m33+m13*m21*m32-m12*m21*m33+m12*m23*m31)},Mat4.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[4],m13=te[8],m14=te[12],m21=te[1],m22=te[5],m23=te[9],m24=te[13],m31=te[2],m32=te[6],m33=te[10],m34=te[14],m41=te[3],m42=te[7],m43=te[11],m44=te[15],me0=m23*m34*m42-m24*m33*m42+m24*m32*m43-m22*m34*m43-m23*m32*m44+m22*m33*m44,me4=m14*m33*m42-m13*m34*m42-m14*m32*m43+m12*m34*m43+m13*m32*m44-m12*m33*m44,me8=m13*m24*m42-m14*m23*m42+m14*m22*m43-m12*m24*m43-m13*m22*m44+m12*m23*m44,me12=m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34,det=m11*me0+m21*me4+m31*me8+m41*me12;return 0===det?this.identity():(te[0]=me0*det,te[4]=me4*det,te[8]=me8*det,te[12]=me12*det,te[1]=(m24*m33*m41-m23*m34*m41-m24*m31*m43+m21*m34*m43+m23*m31*m44-m21*m33*m44)*det,te[5]=(m13*m34*m41-m14*m33*m41+m14*m31*m43-m11*m34*m43-m13*m31*m44+m11*m33*m44)*det,te[9]=(m14*m23*m41-m13*m24*m41-m14*m21*m43+m11*m24*m43+m13*m21*m44-m11*m23*m44)*det,te[13]=(m13*m24*m31-m14*m23*m31+m14*m21*m33-m11*m24*m33-m13*m21*m34+m11*m23*m34)*det,te[2]=(m22*m34*m41-m24*m32*m41+m24*m31*m42-m21*m34*m42-m22*m31*m44+m21*m32*m44)*det,te[6]=(m14*m32*m41-m12*m34*m41-m14*m31*m42+m11*m34*m42+m12*m31*m44-m11*m32*m44)*det,te[10]=(m12*m24*m41-m14*m22*m41+m14*m21*m42-m11*m24*m42-m12*m21*m44+m11*m22*m44)*det,te[14]=(m14*m22*m31-m12*m24*m31-m14*m21*m32+m11*m24*m32+m12*m21*m34-m11*m22*m34)*det,te[3]=(m23*m32*m41-m22*m33*m41-m23*m31*m42+m21*m33*m42+m22*m31*m43-m21*m32*m43)*det,te[7]=(m12*m33*m41-m13*m32*m41+m13*m31*m42-m11*m33*m42-m12*m31*m43+m11*m32*m43)*det,te[11]=(m13*m22*m41-m12*m23*m41-m13*m21*m42+m11*m23*m42+m12*m21*m43-m11*m22*m43)*det,te[15]=(m12*m23*m31-m13*m22*m31+m13*m21*m32-m11*m23*m32-m12*m21*m33+m11*m22*m33)*det,this)},Mat4.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[4],m13=me[8],m14=me[12],m21=me[1],m22=me[5],m23=me[9],m24=me[13],m31=me[2],m32=me[6],m33=me[10],m34=me[14],m41=me[3],m42=me[7],m43=me[11],m44=me[15],me0=m23*m34*m42-m24*m33*m42+m24*m32*m43-m22*m34*m43-m23*m32*m44+m22*m33*m44,me4=m14*m33*m42-m13*m34*m42-m14*m32*m43+m12*m34*m43+m13*m32*m44-m12*m33*m44,me8=m13*m24*m42-m14*m23*m42+m14*m22*m43-m12*m24*m43-m13*m22*m44+m12*m23*m44,me12=m14*m23*m32-m13*m24*m32-m14*m22*m33+m12*m24*m33+m13*m22*m34-m12*m23*m34,det=m11*me0+m21*me4+m31*me8+m41*me12;return 0===det?this.identity():(te[0]=me0*det,te[4]=me4*det,te[8]=me8*det,te[12]=me12*det,te[1]=(m24*m33*m41-m23*m34*m41-m24*m31*m43+m21*m34*m43+m23*m31*m44-m21*m33*m44)*det,te[5]=(m13*m34*m41-m14*m33*m41+m14*m31*m43-m11*m34*m43-m13*m31*m44+m11*m33*m44)*det,te[9]=(m14*m23*m41-m13*m24*m41-m14*m21*m43+m11*m24*m43+m13*m21*m44-m11*m23*m44)*det,te[13]=(m13*m24*m31-m14*m23*m31+m14*m21*m33-m11*m24*m33-m13*m21*m34+m11*m23*m34)*det,te[2]=(m22*m34*m41-m24*m32*m41+m24*m31*m42-m21*m34*m42-m22*m31*m44+m21*m32*m44)*det,te[6]=(m14*m32*m41-m12*m34*m41-m14*m31*m42+m11*m34*m42+m12*m31*m44-m11*m32*m44)*det,te[10]=(m12*m24*m41-m14*m22*m41+m14*m21*m42-m11*m24*m42-m12*m21*m44+m11*m22*m44)*det,te[14]=(m14*m22*m31-m12*m24*m31-m14*m21*m32+m11*m24*m32+m12*m21*m34-m11*m22*m34)*det,te[3]=(m23*m32*m41-m22*m33*m41-m23*m31*m42+m21*m33*m42+m22*m31*m43-m21*m32*m43)*det,te[7]=(m12*m33*m41-m13*m32*m41+m13*m31*m42-m11*m33*m42-m12*m31*m43+m11*m32*m43)*det,te[11]=(m13*m22*m41-m12*m23*m41-m13*m21*m42+m11*m23*m42+m12*m21*m43-m11*m22*m43)*det,te[15]=(m12*m23*m31-m13*m22*m31+m13*m21*m32-m11*m23*m32-m12*m21*m33+m11*m22*m33)*det,this)},Mat4.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},Mat4.prototype.setTrace=function(v){var te=this.elements,w=v.w;return te[0]=v.x,te[5]=v.y,te[10]=v.z,te[15]=void 0!=w?w:1,this},Mat4.prototype.lookAt=function(){var dup=new Vec3(0,0,1),x=new Vec3,y=new Vec3,z=new Vec3;return function(eye,target,up){up||(up=dup);var te=this.elements;return z.vsub(eye,target).normalize(),0===z.length()&&(z.z=1),x.vcross(up,z).normalize(),0===x.length()&&(z.x+=1e-6,x.vcross(up,z).normalize()),y.vcross(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}}(),Mat4.prototype.compose=function(position,scale,rotation){var te=this.elements,x=rotation.x,y=rotation.y,z=rotation.z,w=rotation.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=scale.x,sy=scale.y,sz=scale.z;return te[0]=(1-(yy+zz))*sx,te[4]=(xy-wz)*sy,te[8]=(xz+wy)*sz,te[1]=(xy+wz)*sx,te[5]=(1-(xx+zz))*sy,te[9]=(yz-wx)*sz,te[2]=(xz-wy)*sx,te[6]=(yz+wx)*sy,te[10]=(1-(xx+yy))*sz,te[3]=0,te[7]=0,te[11]=0,te[12]=position.x,te[13]=position.y,te[14]=position.z,te[15]=1,this},Mat4.prototype.decompose=function(position,scale,quaternion){var trace,s,te=this.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],x=0,y=0,z=0,w=1,sx=scale.set(m11,m21,m31).length(),sy=scale.set(m12,m22,m32).length(),sz=scale.set(m13,m23,m33).length(),invSx=1/sx,invSy=1/sy,invSz=1/sz;return scale.x=sx,scale.y=sy,scale.z=sz,position.x=te[12],position.y=te[13],position.z=te[14],m11*=invSx,m12*=invSy,m13*=invSz,m21*=invSx,m22*=invSy,m23*=invSz,m31*=invSx,m32*=invSy,m33*=invSz,trace=m11+m22+m33,trace>0?(s=.5/sqrt(trace+1),w=.25/s,x=(m32-m23)*s,y=(m13-m31)*s,z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*sqrt(1+m11-m22-m33),w=(m32-m23)/s,x=.25*s,y=(m12+m21)/s,z=(m13+m31)/s):m22>m33?(s=2*sqrt(1+m22-m11-m33),w=(m13-m31)/s,x=(m12+m21)/s,y=.25*s,z=(m23+m32)/s):(s=2*sqrt(1+m33-m11-m22),w=(m21-m12)/s,x=(m13+m31)/s,y=(m23+m32)/s,z=.25*s),quaternion.x=x,quaternion.y=y,quaternion.w=w,quaternion.z=z,this},Mat4.prototype.setPosition=function(v){var te=this.elements,z=v.z;return te[12]=v.x,te[13]=v.y,te[14]=void 0!=z?z:0,this},Mat4.prototype.extractPosition=function(other){var te=this.elements,me=other.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this},Mat4.prototype.extractRotation=function(){var vec=new Vec3;return function(other){var te=this.elements,me=other.elements,lx=vec.set(me[0],me[1],me[2]).lengthSq(),ly=vec.set(me[4],me[5],me[6]).lengthSq(),lz=vec.set(me[8],me[9],me[10]).lengthSq(),scaleX=lx>0?1/sqrt(lx):0,scaleY=ly>0?1/sqrt(ly):0,scaleZ=lz>0?1/sqrt(lz):0;return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,this}}(),Mat4.prototype.extractRotationScale=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[8]=me[8],te[9]=me[9],te[10]=me[10],this},Mat4.prototype.translate=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z||0;return te[12]=te[0]*x+te[4]*y+te[8]*z+te[12],te[13]=te[1]*x+te[5]*y+te[9]*z+te[13],te[14]=te[2]*x+te[6]*y+te[10]*z+te[14],te[15]=te[3]*x+te[7]*y+te[11]*z+te[15],this},Mat4.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},Mat4.prototype.rotateX=function(angle){var te=this.elements,m12=te[4],m22=te[5],m32=te[6],m42=te[7],m13=te[8],m23=te[9],m33=te[10],m43=te[11],c=cos(angle),s=sin(angle);return te[4]=c*m12+s*m13,te[5]=c*m22+s*m23,te[6]=c*m32+s*m33,te[7]=c*m42+s*m43,te[8]=c*m13-s*m12,te[9]=c*m23-s*m22,te[10]=c*m33-s*m32,te[11]=c*m43-s*m42,this},Mat4.prototype.rotateY=function(angle){var te=this.elements,m11=te[0],m21=te[1],m31=te[2],m41=te[3],m13=te[8],m23=te[9],m33=te[10],m43=te[11],c=cos(angle),s=sin(angle);return te[0]=c*m11-s*m13,te[1]=c*m21-s*m23,te[2]=c*m31-s*m33,te[3]=c*m41-s*m43,te[8]=c*m13+s*m11,te[9]=c*m23+s*m21,te[10]=c*m33+s*m31,te[11]=c*m43+s*m41,this},Mat4.prototype.rotateZ=function(angle){var te=this.elements,m11=te[0],m21=te[1],m31=te[2],m41=te[3],m12=te[4],m22=te[5],m32=te[6],m42=te[7],c=cos(angle),s=sin(angle);return te[0]=c*m11+s*m12,te[1]=c*m21+s*m22,te[2]=c*m31+s*m32,te[3]=c*m41+s*m42,te[4]=c*m12-s*m11,te[5]=c*m22-s*m21,te[6]=c*m32-s*m31,te[7]=c*m42-s*m41,this},Mat4.prototype.makeTranslation=function(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1)},Mat4.prototype.makeScale=function(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1)},Mat4.prototype.makeRotationX=function(angle){var c=cos(angle),s=sin(angle);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1)},Mat4.prototype.makeRotationY=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1)},Mat4.prototype.makeRotationZ=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1)},Mat4.prototype.frustum=function(left,right,top,bottom,near,far){var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},Mat4.prototype.perspective=function(fov,aspect,near,far){var ymax=near*tan(.5*fov),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return this.frustum(xmin,xmax,ymax,ymin,near,far)},Mat4.prototype.orthographic=function(left,right,top,bottom,near,far){var te=this.elements,w=right-left,h=top-bottom,p=far-near,x=(right+left)/w,y=(top+bottom)/h,z=(far+near)/p;return te[0]=2/w,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=2/h,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=-2/p,te[11]=0,te[12]=-x,te[13]=-y,te[14]=-z,te[15]=1,this},Mat4.prototype.fromMat2=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=0,te[4]=me[2],te[5]=me[3],te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.fromMat32=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=0,te[4]=me[2],te[5]=me[3],te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=me[4],te[13]=me[5],te[14]=0,te[15]=1,this},Mat4.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=0,te[4]=me[3],te[5]=me[4],te[6]=me[5],te[7]=0,te[8]=me[6],te[9]=me[7],te[10]=me[8],te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.fromQuat=function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},Mat4.prototype.equals=function(other){var ae=this.elements,be=other.elements;return!(ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5]||ae[6]!==be[6]||ae[7]!==be[7]||ae[8]!==be[8]||ae[9]!==be[9]||ae[10]!==be[10]||ae[11]!==be[11]||ae[12]!==be[12]||ae[13]!==be[13]||ae[14]!==be[14]||ae[15]!==be[15])
},Mat4.prototype.notEquals=function(other){var ae=this.elements,be=other.elements;return ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5]||ae[6]!==be[6]||ae[7]!==be[7]||ae[8]!==be[8]||ae[9]!==be[9]||ae[10]!==be[10]||ae[11]!==be[11]||ae[12]!==be[12]||ae[13]!==be[13]||ae[14]!==be[14]||ae[15]!==be[15]},Mat4.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this},Mat4.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return json._className="Mat4",je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],je[6]=te[6],je[7]=te[7],je[8]=te[8],je[9]=te[9],je[10]=te[10],je[11]=te[11],je[12]=te[12],je[13]=te[13],je[14]=te[14],je[15]=te[15],json},Mat4.prototype.fromArray=function(array){var te=this.elements;return te[0]=array[0],te[1]=array[1],te[2]=array[2],te[3]=array[3],te[4]=array[4],te[5]=array[5],te[6]=array[6],te[7]=array[7],te[8]=array[8],te[9]=array[9],te[10]=array[10],te[11]=array[11],te[12]=array[12],te[13]=array[13],te[14]=array[14],te[15]=array[15],this},Mat4.prototype.toArray=function(array){array||(array=[]);var te=this.elements;return array[0]=te[0],array[1]=te[1],array[2]=te[2],array[3]=te[3],array[4]=te[4],array[5]=te[5],array[6]=te[6],array[7]=te[7],array[8]=te[8],array[9]=te[9],array[10]=te[10],array[11]=te[11],array[12]=te[12],array[13]=te[13],array[14]=te[14],array[15]=te[15],array},Mat4.prototype.toString=function(){var te=this.elements;return"Mat4["+te[0]+", "+te[4]+", "+te[8]+", "+te[12]+"]\n     ["+te[1]+", "+te[5]+", "+te[9]+", "+te[13]+"]\n     ["+te[2]+", "+te[6]+", "+te[10]+", "+te[14]+"]\n     ["+te[3]+", "+te[7]+", "+te[11]+", "+te[15]+"]"},Mat4}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/mesh_bone",["odin/math/vec3","odin/math/quat","odin/math/mat4"],function(Vec3,Quat,Mat4){function MeshBone(parentIndex,name){this.parentIndex=void 0!=parentIndex?parentIndex:-1,this.name=void 0!=name?name:"MeshBone_"+UNKNOWN++,this.skinned=!1,this.position=new Vec3,this.rotation=new Quat,this.scale=new Vec3,this.bindPose=new Mat4}var UNKNOWN=0;return MeshBone.prototype.clone=function(){return(new MeshBone).copy(this)},MeshBone.prototype.copy=function(other){return this.name=other.name,this.parentIndex=other.parentIndex,this.skinned=other.skinned,this.position.copy(other.position),this.rotation.copy(other.rotation),this.scale.copy(other.scale),this.bindPose.copy(other.bindPose),this},MeshBone.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.parentIndex=this.parentIndex,json.skinned=this.skinned,json.position=this.position.toJSON(json.position),json.rotation=this.rotation.toJSON(json.rotation),json.scale=this.scale.toJSON(json.scale),json.bindPose=this.bindPose.toJSON(json.bindPose),json},MeshBone.prototype.fromJSON=function(json){return this.name=json.name,this.parentIndex=json.parentIndex,this.skinned=json.skinned,this.position.fromJSON(json.position),this.rotation.fromJSON(json.rotation),this.scale.fromJSON(json.scale),this.bindPose.fromJSON(json.bindPose),this},MeshBone}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/vec4",["odin/math/mathf"],function(Mathf){function Vec4(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!=w?w:1}var sqrt=Math.sqrt;return Mathf._classes.Vec4=Vec4,Vec4.prototype.clone=function(){return new Vec4(this.x,this.y,this.z,this.w)},Vec4.prototype.copy=function(other){return this.x=other.x,this.y=other.y,this.z=other.z,this.w=other.w,this},Vec4.prototype.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Vec4.prototype.add=function(other){return this.x+=other.x,this.y+=other.y,this.z+=other.z,this.w+=other.w,this},Vec4.prototype.vadd=function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},Vec4.prototype.sadd=function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},Vec4.prototype.sub=function(other){return this.x-=other.x,this.y-=other.y,this.z-=other.z,this.w-=other.w,this},Vec4.prototype.vsub=function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},Vec4.prototype.ssub=function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},Vec4.prototype.mul=function(other){return this.x*=other.x,this.y*=other.y,this.z*=other.z,this.w*=other.w,this},Vec4.prototype.vmul=function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this.w=a.w*b.w,this},Vec4.prototype.smul=function(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},Vec4.prototype.div=function(other){var x=other.x,y=other.y,z=other.z,w=other.w;return this.x*=0!==x?1/x:0,this.y*=0!==y?1/y:0,this.z*=0!==z?1/z:0,this.w*=0!==w?1/w:0,this},Vec4.prototype.vdiv=function(a,b){var x=b.x,y=b.y,z=b.z,w=b.w;return this.x=0!==x?a.x/x:0,this.y=0!==y?a.y/y:0,this.z=0!==z?a.z/z:0,this.w=0!==w?a.w/w:0,this},Vec4.prototype.sdiv=function(s){return s=0===s?0:1/s,this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},Vec4.prototype.length=function(){var x=this.x,y=this.y,z=this.z,w=this.w,lsq=x*x+y*y+z*z+w*w;return 1===lsq?1:lsq>0?sqrt(lsq):0},Vec4.prototype.lengthSq=function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},Vec4.prototype.setLength=function(length){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return 1===l?(this.x*=length,this.y*=length,this.z*=length,this.w*=length,this):(l=l>0?1/sqrt(l):0,this.x*=l*length,this.y*=l*length,this.z*=l*length,this.w*=l*length,this)},Vec4.prototype.normalize=function(){var x=this.x,y=this.y,z=this.z,w=this.w,l=x*x+y*y+z*z+w*w;return 1===l?this:(l=l>0?1/sqrt(l):0,this.x*=l,this.y*=l,this.z*=l,this.w*=l,this)},Vec4.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},Vec4.prototype.inverseVec=function(other){return this.x=-other.x,this.y=-other.y,this.z=-other.z,this.w=-other.w,this},Vec4.prototype.lerp=function(other,x){return this.x+=(other.x-this.x)*x,this.y+=(other.y-this.y)*x,this.z+=(other.z-this.z)*x,this.w+=(other.w-this.w)*x,this},Vec4.prototype.vlerp=function(a,b,x){var ax=a.x,ay=a.y,az=a.z,aw=a.w;return this.x=ax+(b.x-ax)*x,this.y=ay+(b.y-ay)*x,this.z=az+(b.z-az)*x,this.w=aw+(b.w-aw)*x,this},Vec4.vdot=Vec4.prototype.vdot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w},Vec4.prototype.dot=function(other){return this.x*other.x+this.y*other.y+this.z*other.z+this.w*other.w},Vec4.prototype.min=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=this.w;return this.x=ax>bx?bx:ax,this.y=ay>by?by:ay,this.z=az>bz?bz:az,this.w=aw>bw?bw:aw,this},Vec4.prototype.max=function(other){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=other.x,by=other.y,bz=other.z,bw=this.w;return this.x=bx>ax?bx:ax,this.y=by>ay?by:ay,this.z=bz>az?bz:az,this.w=bw>aw?bw:aw,this},Vec4.prototype.clamp=function(min,max){var x=this.x,y=this.y,z=this.z,w=this.w,minx=min.x,miny=min.y,minz=min.z,minw=min.w,maxx=max.x,maxy=max.y,maxz=max.z,maxw=maxw;return this.x=minx>x?minx:x>maxx?maxx:x,this.y=miny>y?miny:y>maxy?maxy:y,this.z=minz>z?minz:z>maxz?maxz:z,this.w=minw>w?minw:w>maxw?maxw:w,this},Vec4.prototype.transformMat4=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z,w=this.w;return this.x=x*me[0]+y*me[4]+z*me[8]+w*me[12],this.y=x*me[1]+y*me[5]+z*me[9]+w*me[13],this.z=x*me[2]+y*me[6]+z*me[10]+w*me[14],this.w=x*me[3]+y*me[7]+z*me[11]+w*me[15],this},Vec4.prototype.transformProjection=function(m){var me=m.elements,x=this.x,y=this.y,z=this.z,w=this.w,d=1/(me[3]*x+me[7]*y+me[11]*z+me[15]);return this.x=(me[0]*x+me[4]*y+me[8]*z+me[12]*w)*d,this.y=(me[1]*x+me[5]*y+me[9]*z+me[13]*w)*d,this.z=(me[2]*x+me[6]*y+me[10]*z+me[14]*w)*d,this.w=(me[3]*x+me[7]*y+me[11]*z+me[15]*w)*d,this},Vec4.prototype.fromVec2=function(v){return this.x=v.x,this.y=v.y,this.z=0,this.w=1,this},Vec4.prototype.fromVec3=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=1,this},Vec4.prototype.fromRect=function(rect){return this.x=rect.x,this.y=rect.y,this.z=rect.width,this.w=rect.height,this},Vec4.prototype.positionFromMat4=function(m){var me=m.elements;return this.x=me[12],this.y=me[13],this.z=me[14],this.w=me[15],this},Vec4.prototype.equals=function(other){return!(this.x!==other.x||this.y!==other.y||this.z!==other.z||this.w!==other.w)},Vec4.prototype.notEquals=function(other){return this.x!==other.x||this.y!==other.y||this.z!==other.z||this.w!==other.w},Vec4.prototype.fromJSON=function(json){return this.x=json.x,this.y=json.y,this.z=json.z,this.w=json.w,this},Vec4.prototype.toJSON=function(json){return json||(json={}),json._className="Vec4",json.x=this.x,json.y=this.y,json.z=this.z,json.w=this.w,json},Vec4.prototype.fromArray=function(array){return this.x=array[0],this.y=array[1],this.z=array[2],this.w=array[3],this},Vec4.prototype.toArray=function(array){return array||(array=[]),array[0]=this.x,array[1]=this.y,array[2]=this.z,array[3]=this.w,array},Vec4.prototype.toString=function(){return"Vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )"},Vec4}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/mesh",["odin/core/assets/asset","odin/core/assets/mesh_bone","odin/math/vec2","odin/math/vec3","odin/math/vec4","odin/math/color"],function(Asset,MeshBone,Vec2,Vec3,Vec4,Color){function Mesh(opts){opts||(opts={}),Asset.call(this,opts),this.vertices=void 0!=opts.vertices?opts.vertices:[],this.normals=void 0!=opts.normals?opts.normals:[],this.tangents=void 0!=opts.tangents?opts.tangents:[],this.indices=void 0!=opts.indices?opts.indices:[],this.colors=void 0!=opts.colors?opts.colors:[],this.uvs=void 0!=opts.uvs?opts.uvs:[],this.uvs2=void 0!=opts.uvs2?opts.uvs2:[],this.bones=void 0!=opts.bones?opts.bones:[],this.boneIndices=void 0!=opts.boneIndices?opts.boneIndices:[],this.boneWeights=void 0!=opts.boneWeights?opts.boneWeights:[],this.dynamic=void 0!=opts.dynamic?!!opts.dynamic:!1,this.useBones=void 0!=opts.useBones?!!opts.useBones:this.bones.length>0?!0:!1,this.animations={},this.aabb=new AABB3,opts.vertices&&this.aabb.fromPoints(this.vertices),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.indicesNeedUpdate=!0,this.colorsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.uvs2NeedUpdate=!0,this.boneIndicesNeedUpdate=!0,this.boneWeightsNeedUpdate=!0,this._webglBuffersInitted=void 0,this._webglUsed=0,this._webglVertexBuffer=void 0,this._webglNormalBuffer=void 0,this._webglTangentBuffer=void 0,this._webglColorBuffer=void 0,this._webglUvBuffer=void 0,this._webglUv2Buffer=void 0,this._webglMeshBoneIndexBuffer=void 0,this._webglMeshBoneWeightBuffer=void 0,this._webglIndexBuffer=void 0,this._webglLineBuffer=void 0,this._webglVertexArray=void 0,this._webglNormalArray=void 0,this._webglTangentArray=void 0,this._webglColorArray=void 0,this._webglUvArray=void 0,this._webglUv2Array=void 0,this._webglMeshBoneIndexArray=void 0,this._webglMeshBoneWeightArray=void 0,this._webglIndexArray=void 0,this._webglLineArray=void 0,this._webglVertexCount=void 0,this._webglLineCount=void 0,opts.json&&this.fromJSON(opts.json)}function buildPlane(mesh,u,v,udir,vdir,width,ws,height,hs,depth,ds){var w,ix,iy,gridX1,gridY1,segment_width,segment_height,normal,vector,a,b,c,d,uva,uvb,uvc,uvd,vertices=mesh.vertices,normals=mesh.normals,indices=mesh.indices,uvs=mesh.uvs,gridX=ws,gridY=hs,width_half=width/2,height_half=height/2,offset=vertices.length;for("x"===u&&"y"===v||"y"===u&&"x"===v?w="z":"x"===u&&"z"===v||"z"===u&&"x"===v?(w="y",gridY=ds):("z"===u&&"y"===v||"y"===u&&"z"===v)&&(w="x",gridX=ds),gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new Vec3,normal[w]=depth>0?1:-1,iy=0;gridY1>iy;iy++){for(ix=0;gridX1>ix;ix++){vector=new Vec3,vector[u]=(ix*segment_width-width_half)*udir,vector[v]=(iy*segment_height-height_half)*vdir,vector[w]=depth,vertices.push(vector)}}for(iy=0;gridY>iy;iy++){for(ix=0;gridX>ix;ix++){a=offset+(ix+gridX1*iy),b=offset+(ix+gridX1*(iy+1)),c=offset+(ix+1+gridX1*(iy+1)),d=offset+(ix+1+gridX1*iy),uva=new Vec2(ix/gridX,1-iy/gridY),uvb=new Vec2(ix/gridX,1-(iy+1)/gridY),uvc=new Vec2((ix+1)/gridX,1-iy/gridY),uvd=new Vec2((ix+1)/gridX,1-(iy+1)/gridY),normals.push(normal.clone(),normal.clone(),normal.clone(),normal.clone()),uvs.push(uva,uvb,uvc,uvd),indices.push(a,b,c,a,c,d)}}}var EMPTY_ARRAY,PI,HALF_PI,TWO_PI,sin,cos;return Asset.extend(Mesh),Mesh.prototype.copy=function(other){Asset.prototype.copy.call(this,other);var i,vertices=this.vertices,otherVertices=other.vertices,normals=this.normals,otherNormals=other.normals,tangents=this.tangents,otherTangents=other.tangents,indices=this.indices,otherIndices=other.indices,colors=this.colors,otherColors=other.colors,uvs=this.uvs,otherUvs=other.uvs,uvs2=this.uvs2,otherUv2s=other.uvs2,bones=this.bones,otherMeshBones=other.bones,boneIndices=this.boneIndices,otherMeshBoneIndices=other.boneIndices,boneWeights=this.boneWeights,otherMeshBoneWeights=other.boneWeights;for(vertices.length=otherVertices.length,normals.length=otherNormals.length,tangents.length=otherTangents.length,indices.length=otherIndices.length,colors.length=otherColors.length,uvs.length=otherUvs.length,uvs2.length=otherUv2s.length,bones.length=otherMeshBones.length,boneIndices.length=otherMeshBoneIndices.length,boneWeights.length=otherMeshBoneWeights.length,i=otherVertices.length;i--;){vertices[i]=(vertices[i]||new Vec3).copy(otherVertices[i])}for(i=otherNormals.length;i--;){normals[i]=(normals[i]||new Vec3).copy(otherNormals[i])}for(i=otherTangents.length;i--;){tangents[i]=(tangents[i]||new Vec4).copy(otherTangents[i])}for(i=otherIndices.length;i--;){indices[i]=otherIndices[i]}for(i=otherColors.length;i--;){colors[i]=(colors[i]||new Color).copy(otherColors[i])}for(i=otherUvs.length;i--;){uvs[i]=(uvs[i]||new Vec2).copy(otherUvs[i])}for(i=otherUv2s.length;i--;){uvs2[i]=(uvs2[i]||new Vec2).copy(otherUv2s[i])}for(i=otherMeshBones.length;i--;){bones[i]=(bones[i]||new MeshBone).copy(otherMeshBones[i])}for(i=otherMeshBoneIndices.length;i--;){boneIndices[i]=otherMeshBoneIndices[i]}for(i=otherMeshBoneWeights.length;i--;){boneWeights[i]=otherMeshBoneWeights[i]}return this.dynamic=other.dynamic,this.useBones=other.useBones,this.aabb.fromPoints(this.vertices),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.indicesNeedUpdate=!0,this.colorsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.uvs2NeedUpdate=!0,this.boneIndicesNeedUpdate=!0,this.boneWeightsNeedUpdate=!0,this},Mesh.prototype.clear=function(){return Asset.prototype.clear.call(this),this.vertices.length=0,this.normals.length=0,this.tangents.length=0,this.indices.length=0,this.colors.length=0,this.uvs.length=0,this.uvs2.length=0,this.bones.length=0,this.boneIndices.length=0,this.boneWeights.length=0,this.aabb.clear(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.indicesNeedUpdate=!0,this.colorsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.uvs2NeedUpdate=!0,this.boneIndicesNeedUpdate=!0,this.boneWeightsNeedUpdate=!0,this},EMPTY_ARRAY=[],Mesh.prototype.parse=function(raw){Asset.prototype.parse.call(this,raw);var bone,items,item,i,il,vertices=this.vertices,normals=this.normals,tangents=this.tangents,indices=this.indices,colors=this.colors,uvs=this.uvs,uvs2=this.uvs2,bones=this.bones,boneWeights=this.boneWeights,boneIndices=this.boneIndices;for(vertices.length=normals.length=tangents.length=indices.length=colors.length=uvs.length=uvs2.length=0,bones.length=boneWeights.length=boneIndices.length=0,items=raw.vertices||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=3){vertices.push(new Vec3(items[i],items[i+1],items[i+2]))}for(items=raw.normals||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=3){normals.push(new Vec3(items[i],items[i+1],items[i+2]))}for(items=raw.tangents||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=4){tangents.push(new Vec4(items[i],items[i+1],items[i+2],items[i+3]))}for(items=raw.indices||raw.faces||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=3){indices.push(items[i],items[i+1],items[i+2])}for(items=raw.colors||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=3){colors.push(new Color(items[i],items[i+1],items[i+2]))}for(items=raw.uvs||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=2){uvs.push(new Vec2(items[i],items[i+1]))}for(items=raw.uvs2||EMPTY_ARRAY,i=0,il=items.length;il>i;i+=2){uvs2.push(new Vec2(items[i],items[i+1]))}for(items=raw.bones||EMPTY_ARRAY,i=0,il=items.length;il>i;i++){item=items[i],bone=new MeshBone(item.parent,item.name),bone.position.fromArray(item.position),bone.rotation.fromArray(item.rotation),bone.scale.fromArray(item.scale),bone.bindPose.fromArray(item.bindPose),bone.skinned=!!item.skinned,bones.push(bone)}for(items.length&&(this.useBones=!0),items=raw.boneWeights||EMPTY_ARRAY,i=0,il=items.length;il>i;i++){boneWeights.push(items[i])}for(items=raw.boneIndices||EMPTY_ARRAY,i=0,il=items.length;il>i;i++){boneIndices.push(items[i])}return this.animations=raw.animations,this.aabb.fromPoints(this.vertices),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.indicesNeedUpdate=!0,this.colorsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.uvs2NeedUpdate=!0,this.boneIndicesNeedUpdate=!0,this.boneWeightsNeedUpdate=!0,this},Mesh.prototype.calculateAABB=function(){this.aabb.fromPoints(this.vertices)},Mesh.prototype.calculateNormals=function(){var u=new Vec3,v=new Vec3,uv=new Vec3,faceNormal=new Vec3;return function(){var a,b,c,va,vb,vc,i,vertices=this.vertices,normals=this.normals,indices=this.indices;for(i=vertices.length;i--;){(normals[i]||(normals[i]=new Vec3)).set(0,0,0)}for(i=indices.length;i-=3;){a=indices[i],b=indices[i+1],c=indices[i+2],va=vertices[a],vb=vertices[b],vc=vertices[c],u.vsub(vc,vb),v.vsub(va,vb),uv.vcross(u,v),faceNormal.copy(uv).normalize(),normals[a].add(faceNormal),normals[b].add(faceNormal),normals[c].add(faceNormal)}for(i=indices.length;i-=3;){normals[indices[i]].normalize(),normals[indices[i+1]].normalize(),normals[indices[i+2]].normalize()}return this.normalsNeedUpdate=!0,this}}(),Mesh.prototype.calculateTangents=function(){var tan1=[],tan2=[],sdir=new Vec3,tdir=new Vec3,n=new Vec3,t=new Vec3,tmp1=new Vec3,tmp2=new Vec3;return function(){var v1,v2,v3,w1,w2,w3,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,a,b,c,r,w,i,indices=this.indices,vertices=this.vertices,normals=this.normals,tangents=this.tangents,uvs=this.uvs;for(i=vertices.length;i--;){(tan1[i]||(tan1[i]=new Vec3)).set(0,0,0),(tan2[i]||(tan2[i]=new Vec3)).set(0,0,0),(tangents[i]||(tangents[i]=new Vec4)).set(0,0,0,1)}for(i=vertices.length;i--;){uvs[i]=uvs[i]||(uvs[i]=new Vec2)}for(i=indices.length;i-=3;){a=indices[i],b=indices[i+1],c=indices[i+2],v1=vertices[a],v2=vertices[b],v3=vertices[c],w1=uvs[a],w2=uvs[b],w3=uvs[c],x1=v2.x-v1.x,x2=v3.x-v1.x,y1=v2.y-v1.y,y2=v3.y-v1.y,z1=v2.z-v1.z,z2=v3.z-v1.z,s1=w2.x-w1.x,s2=w3.x-w1.x,t1=w2.y-w1.y,t2=w3.y-w1.y,r=s1*t2-s2*t1,r=0!==r?1/r:0,sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),tan1[a].add(sdir),tan1[b].add(sdir),tan1[c].add(sdir),tan2[a].add(tdir),tan2[b].add(tdir),tan2[c].add(tdir)}for(i=vertices.length;i--;){t.copy(tan1[i]),n.copy(normals[i]),tmp1.copy(t),tmp1.sub(n.smul(n.dot(t))).normalize(),n.copy(normals[i]),tmp2.vcross(n,t),w=tmp2.dot(tan2[i])<0?-1:1,tangents[i].set(tmp1.x,tmp1.y,tmp1.z,w)}return this.tangentsNeedUpdate=!0,this}}(),Mesh.prototype.toJSON=function(json,pack){json=Asset.prototype.toJSON.call(this,json,pack);var i,vertices=this.vertices,jsonVertices=json.vertices||(json.vertices=[]),normals=this.normals,jsonNormals=json.normals||(json.normals=[]),tangents=this.tangents,jsonTangents=json.tangents||(json.tangents=[]),indices=this.indices,jsonIndices=json.indices||(json.indices=[]),colors=this.colors,jsonColors=json.colors||(json.colors=[]),uvs=this.uvs,jsonUvs=json.uvs||(json.uvs=[]),uvs2=this.uvs2,jsonUv2s=json.uvs2||(json.uvs2=[]),bones=this.bones,jsonMeshBones=json.bones||(json.bones=[]),boneIndices=this.boneIndices,jsonMeshBoneIndices=json.boneIndices||(json.boneIndices=[]),boneWeights=this.boneWeights,jsonMeshBoneWeights=json.boneWeights||(json.boneWeights=[]);for(jsonVertices.length=vertices.length,jsonNormals.length=normals.length,jsonTangents.length=tangents.length,jsonIndices.length=indices.length,jsonColors.length=colors.length,jsonUvs.length=uvs.length,jsonUv2s.length=uvs2.length,jsonMeshBones.length=bones.length,jsonMeshBoneIndices.length=boneIndices.length,jsonMeshBoneWeights.length=boneWeights.length,i=vertices.length;i--;){jsonVertices[i]=vertices[i].toJSON(jsonVertices[i])}for(i=normals.length;i--;){jsonNormals[i]=normals[i].toJSON(jsonNormals[i])}for(i=tangents.length;i--;){jsonTangents[i]=tangents[i].toJSON(jsonTangents[i])}for(i=indices.length;i--;){indices[i]=jsonIndices[i]}for(i=colors.length;i--;){jsonColors[i]=colors[i].toJSON(jsonColors[i])}for(i=uvs.length;i--;){jsonUvs[i]=uvs[i].toJSON(jsonUvs[i])}for(i=uvs2.length;i--;){jsonUv2s[i]=uvs2[i].toJSON(jsonUv2s[i])}for(i=bones.length;i--;){jsonMeshBones[i]=bones[i].toJSON(jsonMeshBones[i])}for(i=boneIndices.length;i--;){boneIndices[i]=jsonMeshBoneIndices[i]}for(i=boneWeights.length;i--;){boneWeights[i]=jsonMeshBoneWeights[i]}return json.dynamic=this.dynamic,json.useBones=this.useBones,json},Mesh.prototype.fromJSON=function(json){Asset.prototype.fromJSON.call(this,json);var i,vertices=this.vertices,jsonVertices=json.vertices,normals=this.normals,jsonNormals=json.normals,tangents=this.tangents,jsonTangents=json.tangents,indices=this.indices,jsonIndices=json.indices,colors=this.colors,jsonColors=json.colors,uvs=this.uvs,jsonUvs=json.uvs,uvs2=this.uvs2,jsonUv2s=json.uvs2,bones=this.bones,jsonMeshBones=json.bones,boneIndices=this.boneIndices,jsonMeshBoneIndices=json.boneIndices,boneWeights=this.boneWeights,jsonMeshBoneWeights=json.boneWeights;for(vertices.length=jsonVertices.length,normals.length=jsonNormals.length,tangents.length=jsonTangents.length,indices.length=jsonIndices.length,colors.length=jsonColors.length,uvs.length=jsonUvs.length,uvs2.length=jsonUv2s.length,bones.length=jsonMeshBones.length,boneIndices.length=jsonMeshBoneIndices.length,boneWeights.length=jsonMeshBoneWeights.length,i=jsonVertices.length;i--;){vertices[i]=(vertices[i]||new Vec3).copy(jsonVertices[i])}for(i=jsonNormals.length;i--;){normals[i]=(normals[i]||new Vec3).copy.fromJSON(jsonNormals[i])}for(i=jsonTangents.length;i--;){tangents[i]=(tangents[i]||new Vec4).fromJSON(jsonTangents[i])}for(i=jsonIndices.length;i--;){indices[i]=jsonIndices[i]}for(i=jsonColors.length;i--;){colors[i]=(colors[i]||new Color).fromJSON(jsonColors[i])}for(i=jsonUvs.length;i--;){uvs[i]=(uvs[i]||new Vec2).fromJSON(jsonUvs[i])}for(i=jsonUv2s.length;i--;){uvs2[i]=(uvs2[i]||new Vec2).fromJSON(jsonUv2s[i])}for(i=jsonMeshBones.length;i--;){bones[i]=(bones[i]||new MeshBone).fromJSON(jsonMeshBones[i])}for(i=jsonMeshBoneIndices.length;i--;){boneIndices[i]=jsonMeshBoneIndices[i]}for(i=jsonMeshBoneWeights.length;i--;){boneWeights[i]=jsonMeshBoneWeights[i]}return this.dynamic=json.dynamic,this.useBones=json.useBones,this.aabb.fromPoints(this.vertices),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.indicesNeedUpdate=!0,this.colorsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.uvs2NeedUpdate=!0,this.boneIndicesNeedUpdate=!0,this.boneWeightsNeedUpdate=!0,this},PI=Math.PI,HALF_PI=.5*PI,TWO_PI=2*PI,sin=Math.sin,cos=Math.cos,Mesh.Sphere=function(opts){opts||(opts={});var r,s,x,y,z,a,b,c,d,radius=void 0!=opts.radius?opts.radius:.5,segments=(void 0!=opts.segments?floor(max(opts.segments,3)):16)+1,rings=(void 0!=opts.rings?floor(max(opts.rings,3)):8)+2,R=1/(rings-1),S=1/(segments-1),mesh=new Mesh(opts),vertices=mesh.vertices,normals=mesh.normals,uvs=mesh.uvs,colors=mesh.colors,indices=mesh.indices;for(r=0;rings>r;r++){for(s=0;segments>s;s++){z=sin(-HALF_PI+PI*r*R),x=cos(TWO_PI*s*S)*sin(PI*r*R),y=sin(TWO_PI*s*S)*sin(PI*r*R),vertices.push(new Vec3(x,y,z).smul(radius)),normals.push(new Vec3(x,y,z)),uvs.push(new Vec2(s*S,r*R)),colors.push(new Vec3(s*S,r*R,0))}}for(r=0;rings-1>r;r++){for(s=0;segments-1>s;s++){a=r*segments+s,b=r*segments+(s+1),c=(r+1)*segments+(s+1),d=(r+1)*segments+s,indices.push(a,b,c),indices.push(a,c,d)}}return mesh.calculateAABB(),mesh.load=!1,opts.tangents&&mesh.calculateTangents(),mesh},Mesh.Cube=function(opts){opts||(opts={});var w=opts.width||1,h=opts.height||1,d=opts.depth||1,hw=.5*w,hh=.5*h,hd=.5*d,ws=opts.widthSegments||1,hs=opts.heightSegments||1,ds=opts.depthSegments||1,mesh=new Mesh(opts);return buildPlane(mesh,"z","y",-1,-1,d,ds,h,hs,hw,ws),buildPlane(mesh,"z","y",1,-1,d,ds,h,hs,-hw,ws),buildPlane(mesh,"x","z",1,1,w,ws,d,ds,hh,hs),buildPlane(mesh,"x","z",1,-1,w,ws,d,ds,-hh,hs),buildPlane(mesh,"x","y",1,-1,w,ws,h,hs,hd,ds),buildPlane(mesh,"x","y",-1,-1,w,ws,h,hs,-hd,ds),mesh.calculateAABB(),mesh.load=!1,opts.tangents&&mesh.calculateTangents(),mesh},Mesh.Plane=function(opts){opts||(opts={});var w=opts.width||1,h=opts.height||1,ws=opts.widthSegments||1,hs=opts.heightSegments||1,mesh=new Mesh(opts);return buildPlane(mesh,"x","y",1,-1,w,ws,h,hs,0,0),mesh.calculateAABB(),mesh.load=!1,opts.tangents&&mesh.calculateTangents(),mesh},Mesh.MeshBone=MeshBone,Mesh}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/sprite_sheet",["odin/core/assets/asset"],function(Asset){function SpriteSheet(opts){opts||(opts={}),Asset.call(this,opts)}return Asset.extend(SpriteSheet),SpriteSheet.prototype.copy=function(other){Asset.prototype.copy.call(this,other);var key,raw=other.raw;for(key in raw){this[key]=raw[key]}return this},SpriteSheet.prototype.parse=function(raw){Asset.prototype.parse.call(this,raw);for(var key in raw){this[key]?Log.error("SpriteSheet.parse: invalid animation name "+key+" in file "+this.src):this[key]=raw[key]}return this},SpriteSheet.prototype.clear=function(){for(var key in this.raw){this[key]=null}return Asset.prototype.clear.call(this),this},SpriteSheet.prototype.toJSON=function(json,pack){return json=Asset.prototype.toJSON.call(this,json),!pack&&this.src||!this.raw||(json.raw=JSON.stringify(this.raw)),json},SpriteSheet.prototype.fromJSON=function(json){return Asset.prototype.fromJSON.call(this,json),!json.src&&json.raw&&(this.raw=JSON.parse(json.raw)),this.parse(this.raw),this},SpriteSheet}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/texture",["odin/core/enums","odin/core/assets/asset"],function(Enums,Asset){function Texture(opts){opts||(opts={}),Asset.call(this,opts),this.width=0,this.height=0,this.invWidth=0,this.invHeight=0,this.generateMipmap=void 0!=opts.generateMipmap?!!opts.generateMipmap:!0,this.flipY=void 0!=opts.flipY?!!opts.flipY:!0,this.premultiplyAlpha=void 0!=opts.premultiplyAlpha?!!opts.premultiplyAlpha:!1,this.anisotropy=void 0!=opts.anisotropy?opts.anisotropy:1,this.filter=void 0!=opts.filter?opts.filter:Enums.FilterMode.Linear,this.format=void 0!=opts.format?opts.format:Enums.TextureFormat.RGBA,this.wrap=void 0!=opts.wrap?opts.wrap:Enums.TextureWrap.Repeat,this._webgl=void 0,this._webglUsed=0,this.needsUpdate=!0}return Asset.extend(Texture),Texture.prototype.copy=function(other){return Asset.prototype.copy.call(this,other),this.width=other.width,this.height=other.height,this.invWidth=other.invWidth,this.invHeight=other.invHeight,this.generateMipmap=other.generateMipmap,this.flipY=other.flipY,this.premultiplyAlpha=other.premultiplyAlpha,this.anisotropy=other.anisotropy,this.filter=other.filter,this.format=other.format,this.wrap=other.wrap,this},Texture.prototype.parse=function(raw){return Asset.prototype.parse.call(this,raw),this.width=raw.width,this.height=raw.height,this.invWidth=1/this.width,this.invHeight=1/this.height,this},Texture.prototype.setMipmap=function(value){this.generateMipmap=void 0!=value?!!value:!this.generateMipmap,this.needsUpdate=!0},Texture.prototype.setAnisotropy=function(value){this.anisotropy=value,this.needsUpdate=!0},Texture.prototype.setFilter=function(value){this.filter=value,this.needsUpdate=!0},Texture.prototype.setFormat=function(value){this.format=value,this.needsUpdate=!0},Texture.prototype.setWrap=function(value){this.wrap=value,this.needsUpdate=!0},Texture.prototype.toJSON=function(json,pack){if(json=Asset.prototype.toJSON.call(this,json),(pack||!this.src)&&this.raw){if("undefined"==typeof window){json.raw=this.raw}else{var raw=this.raw,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=raw.width,canvas.height=raw.height,ctx.drawImage(raw,0,0),json.raw=canvas.toDataURL()}}return json.width=this.width,json.height=this.height,json.invWidth=this.invWidth,json.invHeight=this.invHeight,json.generateMipmap=this.generateMipmap,json.flipY=this.flipY,json.premultiplyAlpha=this.premultiplyAlpha,json.anisotropy=this.anisotropy,json.filter=this.filter,json.format=this.format,json.wrap=this.wrap,json},Texture.prototype.fromJSON=function(json){if(Asset.prototype.fromJSON.call(this,json),!json.src&&json.raw){if("undefined"==typeof window){this.raw=json.raw}else{var image=new Image;image.src=json.raw,this.raw=image}}return this.width=json.width,this.height=json.height,this.invWidth=json.invWidth,this.invHeight=json.invHeight,this.generateMipmap=json.generateMipmap,this.flipY=json.flipY,this.premultiplyAlpha=json.premultiplyAlpha,this.anisotropy=json.anisotropy,this.filter=json.filter,this.format=json.format,this.wrap=json.wrap,this},Texture}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/assets/texture_cube",["odin/core/enums","odin/core/assets/asset"],function(Enums,Asset){function TextureCube(opts){opts||(opts={}),Asset.call(this,opts),this.mipmap=void 0!=opts.mipmap?!!opts.mipmap:!0,this.flipY=void 0!=opts.flipY?!!opts.flipY:!0,this.premultiplyAlpha=void 0!=opts.premultiplyAlpha?!!opts.premultiplyAlpha:!1,this.anisotropy=void 0!=opts.anisotropy?opts.anisotropy:1,this.filter=void 0!=opts.filter?opts.filter:Enums.FilterMode.Linear,this.format=void 0!=opts.format?opts.format:Enums.TextureFormat.RGBA,this.wrap=void 0!=opts.wrap?opts.wrap:Enums.TextureWrap.Repeat,this._webgl=void 0,this._webglUsed=0,this.needsUpdate=!0}function imageToDataUrl(image){if("undefined"==typeof window){return image}var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");return canvas.width=image.width,canvas.height=image.height,ctx.drawImage(image,0,0),canvas.toDataURL()}return Asset.extend(TextureCube),TextureCube.prototype.copy=function(other){return Asset.prototype.copy.call(this,other),this.mipmap=other.mipmap,this.flipY=other.flipY,this.premultiplyAlpha=other.premultiplyAlpha,this.anisotropy=other.anisotropy,this.filter=other.filter,this.format=other.format,this.wrap=other.wrap,this},TextureCube.prototype.setMipmap=function(value){this.mipmap=void 0!=value?!!value:!this.mipmap,this.needsUpdate=!0},TextureCube.prototype.setAnisotropy=function(value){this.anisotropy=value,this.needsUpdate=!0},TextureCube.prototype.setFilter=function(value){this.filter=value,this.needsUpdate=!0},TextureCube.prototype.setFormat=function(value){this.format=value,this.needsUpdate=!0},TextureCube.prototype.setWrap=function(value){this.wrap=value,this.needsUpdate=!0},TextureCube.prototype.toJSON=function(json,pack){if(json=Asset.prototype.toJSON.call(this,json),(pack||!this.src)&&this.raw){if("undefined"==typeof window){json.raw=this.raw}else{for(var jsonRaw=json.raw||(json.raw=[]),raw=this.raw,i=0,il=raw.length;il>i;i++){jsonRaw[i]=imageToDataUrl(raw[i])}}}return json.width=this.width,json.height=this.height,json.invWidth=this.invWidth,json.invHeight=this.invHeight,json.mipmap=this.mipmap,json.flipY=this.flipY,json.premultiplyAlpha=this.premultiplyAlpha,json.anisotropy=this.anisotropy,json.filter=this.filter,json.format=this.format,json.wrap=this.wrap,json},TextureCube.prototype.fromJSON=function(json){var jsonRaw,raw,i,il,image;if(Asset.prototype.fromJSON.call(this,json),!json.src&&json.raw){if("undefined"==typeof window){this.raw=json.raw
}else{for(jsonRaw=json.raw,raw=this.raw,i=0,il=jsonRaw.length;il>i;i++){image=new Image,image.src=sonRaw[i],raw[i]=image}}}return this.width=json.width,this.height=json.height,this.invWidth=json.invWidth,this.invHeight=json.invHeight,this.mipmap=json.mipmap,this.flipY=json.flipY,this.premultiplyAlpha=json.premultiplyAlpha,this.anisotropy=json.anisotropy,this.filter=json.filter,this.format=json.format,this.wrap=json.wrap,this},TextureCube}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/component",["odin/base/class","odin/base/util","odin/core/game/log"],function(Class,util,Log){function Component(type,opts){opts||(opts={}),Class.call(this),this._type=type||"UnknownComponent",this._name=camelize(this._type,!0),this.sync=void 0!=opts.sync?!!opts.sync:!1,this.json=void 0!=opts.json?!!opts.json:!0,this.gameObject=void 0}var camelize=util.camelize;return Class.extend(Component),Component.prototype.copy=function(other){return this.sync=other.sync,this.json=other.json,this},Component.prototype.init=function(){return this},Component.prototype.start=function(){return this},Component.prototype.update=function(){},Component.prototype.clear=function(){return this.off(),this},Component.prototype.destroy=function(){return this.gameObject?(this.gameObject.removeComponent(this),this.emit("destroy"),this.clear(),this):(Log.error("Component.destroy: can't destroy Component if it's not added to a GameObject"),this)},Component.prototype.remove=function(){return this.gameObject?(this.gameObject.removeComponent(this,!0),this):(Log.error("Component.remove: can't remove Component if it's not added to a GameObject"),this)},Component.prototype.sort=function(){return 0},Component.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json._type=this._type,json.sync=this.sync,json.json=this.json,json},Component.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.sync=json.sync,this.json=json.json,this},Component}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/tween",["odin/base/class","odin/math/mathf"],function(Class,Mathf){function Tween(opts){opts||(opts={}),this.times=opts.times||[],this.values=opts.values||[]}function fromJSON(json){var classes=Class._classes,mathClasses=Mathf._classes;return"object"!=typeof json?json:mathClasses[json._className]?Mathf.fromJSON(json):classes[json._className]?Class.fromJSON(json):json}return Tween.prototype.copy=function(other){return this.times=other.times.slice(),this.values=other.values.slice(),this},Tween.prototype.clear=function(){return this.times.length=0,this.values.length=0,this},Tween.prototype.update=function(time,out){for(var t,times=this.times,values=this.values,n=times.length,i=0;n>i&&time>times[i];){i++}return 0===i?values[0]:i===n?values[n-1]:(t=(time-times[i-1])/(times[i]-times[i-1]),out?out.copy(values[i-1]).lerp(values[i],t):values[i-1]+t*(values[i]-values[i-1]))},Tween.prototype.toJSON=function(json){json||(json={});var i,times=this.times,values=this.values,jsonTimes=json.times||(json.times=[]),jsonValues=json.values||(json.values=[]);for(i=times.length;i--;){jsonTimes[i]=times[i]}for(i=values.length;i--;){jsonValues[i]=values[i].toJSON?values[i].toJSON(jsonValues[i]):values[i]}return json},Tween.prototype.fromJSON=function(json){var i,times=this.times,values=this.values,jsonTimes=json.times,jsonValues=json.values;for(i=jsonTimes.length;i--;){times[i]=fromJSON(jsonTimes[i])}for(i=jsonValues.length;i--;){values[i]=fromJSON(jsonValues[i])}return this},Tween}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/particle",["odin/math/vec3","odin/math/color"],function(Vec3,Color){function Particle(){this.z=1,this.alpha=1,this.lifeTime=0,this.life=1,this.size=1,this.color=new Color,this.position=new Vec3,this.velocity=new Vec3,this.acceleration=new Vec3,this.angle=0,this.angularVelocity=0,this.angularAcceleration=0}return Particle.prototype.update=function(dt){var pos=this.position,vel=this.velocity,acc=this.acceleration;pos.x+=vel.x*dt,pos.y+=vel.y*dt,pos.z+=vel.z*dt,vel.x+=acc.x*dt,vel.y+=acc.y*dt,vel.z+=acc.z*dt,this.angle+=this.angularVelocity*dt,this.angularVelocity+=this.angularAcceleration*dt,this.lifeTime+=dt},Particle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/emitter",["odin/base/object_pool","odin/base/class","odin/math/mathf","odin/math/vec3","odin/math/color","odin/core/enums","odin/core/assets/assets","odin/core/components/particle_system/tween","odin/core/components/particle_system/particle"],function(ObjectPool,Class,Mathf,Vec3,Color,Enums,Assets,Tween,Particle){function Emitter(opts){opts||(opts={}),Class.call(this),this.sort=void 0!=opts.sort?opts.sort:!0,this.positionType=void 0!=opts.positionType?opts.positionType:EmitterType.Box,this.velocityType=void 0!=opts.velocityType?opts.velocityType:EmitterType.Box,this.material=void 0!=opts.material?opts.material:void 0,this.positionSpread=void 0!=opts.positionSpread?opts.positionSpread:new Vec3(.5,.5,.5),this.positionRadius=void 0!=opts.positionRadius?opts.positionRadius:.5,this.speed=void 0!=opts.speed?opts.speed:0,this.speedSpread=void 0!=opts.speedSpread?opts.speedSpread:0,this.particleSystem=void 0,this.worldSpace=void 0!=opts.worldSpace?opts.worldSpace:!0,this.position=void 0!=opts.position?opts.position:new Vec3,this.minEmission=void 0!=opts.minEmission?opts.minEmission:1,this.maxEmission=void 0!=opts.maxEmission?opts.maxEmission:2,this.minLife=void 0!=opts.minLife?opts.minLife:1,this.maxLife=void 0!=opts.maxLife?opts.maxLife:2,this.minSize=void 0!=opts.minSize?opts.minSize:.1,this.maxSize=void 0!=opts.maxSize?opts.maxSize:.5,this.sizeTween=new Tween(opts.sizeTween),this.alphaTween=new Tween(opts.alphaTween),this.colorTween=new Tween(opts.colorTween),this.velocity=void 0!=opts.velocity?opts.velocity:new Vec3,this.velocitySpread=void 0!=opts.velocitySpread?opts.velocitySpread:new Vec3,this.acceleration=void 0!=opts.acceleration?opts.acceleration:new Vec3,this.accelerationSpread=void 0!=opts.accelerationSpread?opts.accelerationSpread:new Vec3,this.angularVelocity=void 0!=opts.angularVelocity?opts.angularVelocity:0,this.angularVelocitySpread=void 0!=opts.angularVelocitySpread?opts.angularVelocitySpread:0,this.angularAcceleration=void 0!=opts.angularAcceleration?opts.angularAcceleration:0,this.angularAccelerationSpread=void 0!=opts.angularAccelerationSpread?opts.angularAccelerationSpread:0,this.randomAngle=void 0!=opts.randomAngle?opts.randomAngle:!0,this.emissionRate=void 0!=opts.emissionRate?opts.emissionRate:1/60,this.color=void 0!=opts.color?opts.color:new Color,this.colorSpread=void 0!=opts.colorSpread?opts.colorSpread:new Color,this.time=void 0!=opts.time?opts.time:0,this._time=0,this.duration=void 0!=opts.duration?opts.duration:0,this.loop=void 0!=opts.loop?opts.loop:!0,this.playing=void 0!=opts.playing?opts.playing:!0,this.emitting=void 0!=opts.emitting?opts.emitting:!0,this.particles=[],this._webglInitted=void 0,this._webglVertexBuffer=void 0,this._webglParticleBuffer=void 0,this._webglParticleColorBuffer=void 0,this._webglVertexArray=void 0,this._webglParticleArray=void 0,this._webglParticleColorArray=void 0}var VEC,EmitterType=Enums.EmitterType,PI=Math.PI,TWO_PI=2*PI,random=Math.random,randInt=Mathf.randInt,randFloat=Mathf.randFloat,clampTop=Mathf.clampTop,sqrt=Math.sqrt,PARTICLE_POOL=Emitter.PARTICLE_POOL=new ObjectPool(Particle);return Class.extend(Emitter),Emitter.prototype.copy=function(other){return this.sort=other.sort,this.positionType=other.positionType,this.velocityType=other.velocityType,this.material=other.material,this.position.copy(other.position),this.positionSpread.copy(other.positionSpread),this.positionRadius=other.positionRadius,this.speed=other.speed,this.speedSpread=other.speedSpread,this.worldSpace=other.worldSpace,this.minEmission=other.minEmission,this.maxEmission=other.maxEmission,this.minLife=other.minLife,this.maxLife=other.maxLife,this.minSize=other.minSize,this.maxSize=other.maxSize,this.sizeTween.copy(other.sizeTween),this.alphaTween.copy(other.alphaTween),this.colorTween.copy(other.colorTween),this.velocity.copy(other.velocity),this.velocitySpread.copy(other.velocitySpread),this.acceleration.copy(other.acceleration),this.accelerationSpread.copy(other.accelerationSpread),this.angularVelocity=other.angularVelocity,this.angularVelocitySpread=other.angularVelocitySpread,this.angularAcceleration=other.angularAcceleration,this.angularAccelerationSpread=other.angularAccelerationSpread,this.randomAngle=other.randomAngle,this.emissionRate=other.emissionRate,this.color.copy(other.color),this.colorSpread.copy(other.colorSpread),this.time=other.time,this._time=other._time,this.duration=other.duration,this.loop=other.loop,this.playing=other.playing,this.emitting=other.emitting,this},Emitter.prototype.play=function(){return this.time=0,this.playing=!0,this.emitting=!0,this},Emitter.prototype.clear=function(){var particles=this.particles,i=particles.length;for(this.time=0,this._time=0,this.playing=!1,this.emitting=!1;i--;){PARTICLE_POOL.removeObject(particles[i])}return particles.length=0,this},VEC=new Vec3,Emitter.prototype.spawn=function(count){var posx,posy,posz,vel,acc,pos,col,x,y,z,len,r,dx,dy,dz,spd,particle,transform=this.particleSystem.transform||this.particleSystem.transform2d,transformPosition=transform.toWorld(VEC.set(0,0,0)),transformMatrix=transform.matrixWorld,position=this.position,positionSpread=this.positionSpread,positionRadius=this.positionRadius,speed=this.speed,speedSpread=this.speedSpread,particles=this.particles,numParticle2Ds=particles.length,worldSpace=this.worldSpace,randomAngle=this.randomAngle,color=this.color,colorSpread=this.colorSpread,useRandColor=colorSpread.lengthSq()>0,velocity=this.velocity,velocitySpread=this.velocitySpread,acceleration=this.acceleration,accelerationSpread=this.accelerationSpread,angularVelocity=this.angularVelocity,angularVelocitySpread=this.angularVelocitySpread,angularAcceleration=this.angularAcceleration,angularAccelerationSpread=this.angularAccelerationSpread,minLife=this.minLife,maxLife=this.maxLife,minSize=this.minSize,maxSize=this.maxSize,positionType=this.positionType,velocityType=this.velocityType,limit=clampTop(numParticle2Ds+count,Emitter.MAX_PARTICLES)-numParticle2Ds;for(positionType!==EmitterType.Box&&(posx=randFloat(-positionSpread.x,positionSpread.x),posy=randFloat(-positionSpread.y,positionSpread.y),posz=randFloat(-positionSpread.z,positionSpread.z));limit--;){particle=PARTICLE_POOL.create(),pos=particle.position,vel=particle.velocity,acc=particle.acceleration,col=particle.color,col.r=color.r,col.g=color.g,col.b=color.b,useRandColor&&(col.r+=colorSpread.r*random(),col.g+=colorSpread.g*random(),col.b+=colorSpread.b*random(),col.cnormalize()),worldSpace?(pos.x=position.x+transformPosition.x,pos.y=position.y+transformPosition.y,pos.z=position.z+transformPosition.z):(pos.x=position.x,pos.y=position.y,pos.z=position.z),positionType===EmitterType.Box?(pos.x+=randFloat(-positionSpread.x,positionSpread.x),pos.y+=randFloat(-positionSpread.y,positionSpread.y),pos.z+=randFloat(-positionSpread.z,positionSpread.z)):(x=randFloat(-1,1),y=randFloat(-1,1),z=randFloat(-1,1),len=x*x+y*y+z*z,len=0!==len?1/sqrt(len):len,pos.x+=posx+x*len*positionRadius,pos.y+=posy+y*len*positionRadius,pos.z+=posz+z*len*positionRadius),velocityType===EmitterType.Box?(vel.x=velocity.x+randFloat(-velocitySpread.x,velocitySpread.x),vel.y=velocity.y+randFloat(-velocitySpread.y,velocitySpread.y),vel.z=velocity.z+randFloat(-velocitySpread.z,velocitySpread.z)):(worldSpace?(dx=pos.x-(position.x+transformPosition.x),dy=pos.y-(position.y+transformPosition.y),dz=pos.z-(position.z+transformPosition.z)):(dx=pos.x-position.x,dy=pos.y-position.y,dz=pos.z-position.z),spd=speed+randFloat(-speedSpread,speedSpread),r=dx*dx+dy*dy+dz*dz,r=0!==r?1/sqrt(r):r,vel.x=dx*r*spd,vel.y=dy*r*spd,vel.z=dz*r*spd),vel.transformMat4Rotation(transformMatrix),acc.x=acceleration.x+randFloat(-accelerationSpread.x,accelerationSpread.x),acc.y=acceleration.y+randFloat(-accelerationSpread.y,accelerationSpread.y),acc.z=acceleration.z+randFloat(-accelerationSpread.z,accelerationSpread.z),particle.angularVelocity=angularVelocity+randFloat(-angularVelocitySpread,angularVelocitySpread),particle.angularAcceleration=angularAcceleration+randFloat(-angularAccelerationSpread,angularAccelerationSpread),particle.alpha=1,particle.angle=randomAngle?random()*TWO_PI:0,particle.lifeTime=0,particle.life=randFloat(minLife,maxLife),particle.size=randFloat(minSize,maxSize),particles.push(particle)}},Emitter.prototype.update=function(dt){if(this.playing){var particle,life,count,i,particles=this.particles,sizeTween=this.sizeTween,alphaTween=this.alphaTween,colorTween=this.colorTween,sizeTweenUpdate=sizeTween.times.length>0,alphaTweenUpdate=alphaTween.times.length>0,colorTweenUpdate=colorTween.times.length>0;for(this.time+=dt,this._time+=dt,count=this._time/this.emissionRate,this.emitting&&count>=1&&(this._time=0,this.spawn(randInt(this.minEmission,this.maxEmission)*(0|count)),!this.loop&&this.time>this.duration&&(this.emitting=!1)),i=particles.length;i--;){particle=particles[i],particle.update(dt),life=particle.lifeTime/particle.life,sizeTweenUpdate&&(particle.size=sizeTween.update(life)),alphaTweenUpdate&&(particle.alpha=alphaTween.update(life)),colorTweenUpdate&&colorTween.update(life,particle.color),life>1&&(PARTICLE_POOL.removeObject(particle),particles.splice(i,1))}this.emitting||0!==particles.length||(this.playing=!1)}},Emitter.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.type=1,json.sort=this.sort,json.positionType=this.positionType,json.velocityType=this.velocityType,json.material=this.material?this.material.name:void 0,json.position=this.position.toJSON(json.position),json.positionSpread=this.positionSpread.toJSON(json.positionSpread),json.positionRadius=this.positionRadius,json.speed=this.speed,json.speedSpread=this.speedSpread,json.worldSpace=this.worldSpace,json.minEmission=this.minEmission,json.maxEmission=this.maxEmission,json.minLife=this.minLife,json.maxLife=this.maxLife,json.minSize=this.minSize,json.maxSize=this.maxSize,json.sizeTween=this.sizeTween.toJSON(json.sizeTween),json.alphaTween=this.alphaTween.toJSON(json.alphaTween),json.colorTween=this.colorTween.toJSON(json.colorTween),json.velocity=this.velocity.toJSON(json.velocity),json.velocitySpread=this.velocitySpread.toJSON(json.velocitySpread),json.acceleration=this.acceleration.toJSON(json.acceleration),json.accelerationSpread=this.accelerationSpread.toJSON(json.accelerationSpread),json.angularVelocity=this.angularVelocity,json.angularAcceleration=this.angularAcceleration,json.angularVelocitySpread=this.angularVelocitySpread,json.randomAngle=this.randomAngle,json.emissionRate=this.emissionRate,json.color=this.color.toJSON(json.color),json.colorSpread=this.colorSpread.toJSON(json.colorSpread),json.time=this.time,json._time=this._time,json.duration=this.duration,json.loop=this.loop,json.playing=this.playing,json.emitting=this.emitting,json},Emitter.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.sort=json.sort,this.positionType=json.positionType,this.velocityType=json.velocityType,this.material=json.material?Assets.hash[json.material]:void 0,this.position.fromJSON(json.position),this.positionSpread.fromJSON(json.positionSpread),this.positionRadius=json.positionRadius,this.speed=json.speed,this.speedSpread=json.speedSpread,this.worldSpace=json.worldSpace,this.minEmission=json.minEmission,this.maxEmission=json.maxEmission,this.minLife=json.minLife,this.maxLife=json.maxLife,this.minSize=json.minSize,this.maxSize=json.maxSize,this.sizeTween.fromJSON(json.sizeTween),this.alphaTween.fromJSON(json.alphaTween),this.colorTween.fromJSON(json.colorTween),this.velocity.fromJSON(json.velocity),this.velocitySpread.fromJSON(json.velocitySpread),this.acceleration.fromJSON(json.acceleration),this.accelerationSpread.fromJSON(json.accelerationSpread),this.angularVelocity=json.angularVelocity,this.angularAcceleration=json.angularAcceleration,this.angularVelocitySpread=json.angularVelocitySpread,this.randomAngle=json.randomAngle,this.emissionRate=json.emissionRate,this.color.fromJSON(json.color),this.colorSpread.fromJSON(json.colorSpread),this.time=json.time,this._time=json._time,this.duration=json.duration,this.loop=json.loop,this.playing=json.playing,this.emitting=json.emitting,this},Emitter.MAX_PARTICLES=1024,Emitter}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/particle_2d",["odin/math/vec2","odin/math/color"],function(Vec2,Color){function Particle2D(){this.alpha=1,this.lifeTime=0,this.life=1,this.size=1,this.color=new Color,this.position=new Vec2,this.velocity=new Vec2,this.acceleration=new Vec2,this.angle=0,this.angularVelocity=0,this.angularAcceleration=0}return Particle2D.prototype.update=function(dt){var pos=this.position,vel=this.velocity,acc=this.acceleration;pos.x+=vel.x*dt,pos.y+=vel.y*dt,vel.x+=acc.x*dt,vel.y+=acc.y*dt,this.angle+=this.angularVelocity*dt,this.angularVelocity+=this.angularAcceleration*dt,this.lifeTime+=dt},Particle2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/emitter_2d",["odin/base/object_pool","odin/base/class","odin/math/mathf","odin/math/vec2","odin/math/color","odin/core/enums","odin/core/assets/assets","odin/core/components/particle_system/tween","odin/core/components/particle_system/particle_2d"],function(ObjectPool,Class,Mathf,Vec2,Color,Enums,Assets,Tween,Particle2D){function Emitter2D(opts){opts||(opts={}),Class.call(this),this.positionType=void 0!=opts.positionType?opts.positionType:EmitterType.Box,this.velocityType=void 0!=opts.velocityType?opts.velocityType:EmitterType.Box,this.material=void 0!=opts.material?opts.material:void 0,this.positionSpread=void 0!=opts.positionSpread?opts.positionSpread:new Vec2(.5,.5),this.positionRadius=void 0!=opts.positionRadius?opts.positionRadius:.5,this.speed=void 0!=opts.speed?opts.speed:0,this.speedSpread=void 0!=opts.speedSpread?opts.speedSpread:0,this.particleSystem=void 0,this.worldSpace=void 0!=opts.worldSpace?opts.worldSpace:!0,this.position=void 0!=opts.position?opts.position:new Vec2,this.minEmission=void 0!=opts.minEmission?opts.minEmission:1,this.maxEmission=void 0!=opts.maxEmission?opts.maxEmission:2,this.minLife=void 0!=opts.minLife?opts.minLife:1,this.maxLife=void 0!=opts.maxLife?opts.maxLife:2,this.minSize=void 0!=opts.minSize?opts.minSize:.1,this.maxSize=void 0!=opts.maxSize?opts.maxSize:.5,this.sizeTween=new Tween(opts.sizeTween),this.alphaTween=new Tween(opts.alphaTween),this.colorTween=new Tween(opts.colorTween),this.velocity=void 0!=opts.velocity?opts.velocity:new Vec2,this.velocitySpread=void 0!=opts.velocitySpread?opts.velocitySpread:new Vec2,this.acceleration=void 0!=opts.acceleration?opts.acceleration:new Vec2,this.accelerationSpread=void 0!=opts.accelerationSpread?opts.accelerationSpread:new Vec2,this.angularVelocity=void 0!=opts.angularVelocity?opts.angularVelocity:0,this.angularVelocitySpread=void 0!=opts.angularVelocitySpread?opts.angularVelocitySpread:0,this.angularAcceleration=void 0!=opts.angularAcceleration?opts.angularAcceleration:0,this.angularAccelerationSpread=void 0!=opts.angularAccelerationSpread?opts.angularAccelerationSpread:0,this.randomAngle=void 0!=opts.randomAngle?opts.randomAngle:!0,this.emissionRate=void 0!=opts.emissionRate?opts.emissionRate:1/60,this.color=void 0!=opts.color?opts.color:new Color,this.colorSpread=void 0!=opts.colorSpread?opts.colorSpread:new Color,this.time=void 0!=opts.time?opts.time:0,this._time=0,this.duration=void 0!=opts.duration?opts.duration:0,this.loop=void 0!=opts.loop?opts.loop:!0,this.playing=void 0!=opts.playing?opts.playing:!0,this.emitting=void 0!=opts.emitting?opts.emitting:!0,this.particles=[],this._webglInitted=void 0,this._webglVertexBuffer=void 0,this._webglParticleBuffer=void 0,this._webglParticleColorBuffer=void 0,this._webglVertexArray=void 0,this._webglParticleArray=void 0,this._webglParticleColorArray=void 0}var VEC,EmitterType=Enums.EmitterType,PI=Math.PI,TWO_PI=2*PI,random=Math.random,randInt=Mathf.randInt,randFloat=Mathf.randFloat,clampTop=Mathf.clampTop,cos=Math.cos,sin=Math.sin,sqrt=Math.sqrt,PARTICLE_POOL=Emitter2D.PARTICLE_POOL=new ObjectPool(Particle2D);return Class.extend(Emitter2D),Emitter2D.prototype.copy=function(other){return this.positionType=other.positionType,this.velocityType=other.velocityType,this.material=other.material,this.position.copy(other.position),this.positionSpread.copy(other.positionSpread),this.positionRadius=other.positionRadius,this.speed=other.speed,this.speedSpread=other.speedSpread,this.worldSpace=other.worldSpace,this.minEmission=other.minEmission,this.maxEmission=other.maxEmission,this.minLife=other.minLife,this.maxLife=other.maxLife,this.minSize=other.minSize,this.maxSize=other.maxSize,this.sizeTween.copy(other.sizeTween),this.alphaTween.copy(other.alphaTween),this.colorTween.copy(other.colorTween),this.velocity.copy(other.velocity),this.velocitySpread.copy(other.velocitySpread),this.acceleration.copy(other.acceleration),this.accelerationSpread.copy(other.accelerationSpread),this.angularVelocity=other.angularVelocity,this.angularVelocitySpread=other.angularVelocitySpread,this.angularAcceleration=other.angularAcceleration,this.angularAccelerationSpread=other.angularAccelerationSpread,this.randomAngle=other.randomAngle,this.emissionRate=other.emissionRate,this.color.copy(other.color),this.colorSpread.copy(other.colorSpread),this.time=other.time,this._time=other._time,this.duration=other.duration,this.loop=other.loop,this.playing=other.playing,this.emitting=other.emitting,this},Emitter2D.prototype.play=function(){return this.time=0,this.playing=!0,this.emitting=!0,this},Emitter2D.prototype.clear=function(){var particles=this.particles,i=particles.length;for(this.time=0,this._time=0,this.playing=!1,this.emitting=!1;i--;){PARTICLE_POOL.removeObject(particles[i])}return particles.length=0,this},VEC=new Vec2,Emitter2D.prototype.spawn=function(count){var posx,posy,vel,acc,pos,col,angle,u,r,dx,dy,spd,particle,transform=this.particleSystem.transform||this.particleSystem.transform2d,transformPosition=transform.toWorld(VEC.set(0,0)),position=this.position,positionSpread=this.positionSpread,positionRadius=this.positionRadius,speed=this.speed,speedSpread=this.speedSpread,particles=this.particles,numParticle2Ds=particles.length,worldSpace=this.worldSpace,randomAngle=this.randomAngle,color=this.color,colorSpread=this.colorSpread,useRandColor=colorSpread.lengthSq()>0,velocity=this.velocity,velocitySpread=this.velocitySpread,acceleration=this.acceleration,accelerationSpread=this.accelerationSpread,angularVelocity=this.angularVelocity,angularVelocitySpread=this.angularVelocitySpread,angularAcceleration=this.angularAcceleration,angularAccelerationSpread=this.angularAccelerationSpread,minLife=this.minLife,maxLife=this.maxLife,minSize=this.minSize,maxSize=this.maxSize,positionType=this.positionType,velocityType=this.velocityType,limit=clampTop(numParticle2Ds+count,Emitter2D.MAX_PARTICLES)-numParticle2Ds;for((positionType===EmitterType.Circle||positionType===EmitterType.CircleEdge)&&(posx=randFloat(-positionSpread.x,positionSpread.x),posy=randFloat(-positionSpread.y,positionSpread.y));limit--;){particle=PARTICLE_POOL.create(),pos=particle.position,vel=particle.velocity,acc=particle.acceleration,col=particle.color,col.r=color.r,col.g=color.g,col.b=color.b,useRandColor&&(col.r+=colorSpread.r*random(),col.g+=colorSpread.g*random(),col.b+=colorSpread.b*random(),col.cnormalize()),worldSpace?(pos.x=position.x+transformPosition.x,pos.y=position.y+transformPosition.y):(pos.x=position.x,pos.y=position.y),positionType===EmitterType.Box?(pos.x+=randFloat(-positionSpread.x,positionSpread.x),pos.y+=randFloat(-positionSpread.y,positionSpread.y)):(angle=TWO_PI*random(),u=random()+random(),r=u>1?2-u:u,pos.x+=posx+r*cos(angle)*positionRadius,pos.y+=posy+r*sin(angle)*positionRadius),velocityType===EmitterType.Box?(vel.x=velocity.x+randFloat(-velocitySpread.x,velocitySpread.x),vel.y=velocity.y+randFloat(-velocitySpread.y,velocitySpread.y)):(worldSpace?(dx=pos.x-(position.x+transformPosition.x),dy=pos.y-(position.y+transformPosition.y)):(dx=pos.x-position.x,dy=pos.y-position.y),spd=speed+randFloat(-speedSpread,speedSpread),r=dx*dx+dy*dy,r=0!==r?1/sqrt(r):r,vel.x=dx*r*spd,vel.y=dy*r*spd),acc.x=acceleration.x+randFloat(-accelerationSpread.x,accelerationSpread.x),acc.y=acceleration.y+randFloat(-accelerationSpread.y,accelerationSpread.y),particle.angularVelocity=angularVelocity+randFloat(-angularVelocitySpread,angularVelocitySpread),particle.angularAcceleration=angularAcceleration+randFloat(-angularAccelerationSpread,angularAccelerationSpread),particle.alpha=1,particle.angle=randomAngle?random()*TWO_PI:0,particle.lifeTime=0,particle.life=randFloat(minLife,maxLife),particle.size=randFloat(minSize,maxSize),particles.push(particle)}},Emitter2D.prototype.update=function(dt){if(this.playing){var particle,life,count,i,particles=this.particles,sizeTween=this.sizeTween,alphaTween=this.alphaTween,colorTween=this.colorTween,sizeTweenUpdate=sizeTween.times.length>0,alphaTweenUpdate=alphaTween.times.length>0,colorTweenUpdate=colorTween.times.length>0;for(this.time+=dt,this._time+=dt,count=this._time/this.emissionRate,this.emitting&&count>=1&&(this._time=0,this.spawn(randInt(this.minEmission,this.maxEmission)*(0|count)),!this.loop&&this.time>this.duration&&(this.emitting=!1)),i=particles.length;i--;){particle=particles[i],particle.update(dt),life=particle.lifeTime/particle.life,sizeTweenUpdate&&(particle.size=sizeTween.update(life)),alphaTweenUpdate&&(particle.alpha=alphaTween.update(life)),colorTweenUpdate&&colorTween.update(life,particle.color),life>1&&(PARTICLE_POOL.removeObject(particle),particles.splice(i,1))}this.emitting||0!==particles.length||(this.playing=!1)}},Emitter2D.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.type=1,json.positionType=this.positionType,json.velocityType=this.velocityType,json.material=this.material?this.material.name:void 0,json.position=this.position.toJSON(json.position),json.positionSpread=this.positionSpread.toJSON(json.positionSpread),json.positionRadius=this.positionRadius,json.speed=this.speed,json.speedSpread=this.speedSpread,json.worldSpace=this.worldSpace,json.minEmission=this.minEmission,json.maxEmission=this.maxEmission,json.minLife=this.minLife,json.maxLife=this.maxLife,json.minSize=this.minSize,json.maxSize=this.maxSize,json.sizeTween=this.sizeTween.toJSON(json.sizeTween),json.alphaTween=this.alphaTween.toJSON(json.alphaTween),json.colorTween=this.colorTween.toJSON(json.colorTween),json.velocity=this.velocity.toJSON(json.velocity),json.velocitySpread=this.velocitySpread.toJSON(json.velocitySpread),json.acceleration=this.acceleration.toJSON(json.acceleration),json.accelerationSpread=this.accelerationSpread.toJSON(json.accelerationSpread),json.angularVelocity=this.angularVelocity,json.angularAcceleration=this.angularAcceleration,json.angularVelocitySpread=this.angularVelocitySpread,json.randomAngle=this.randomAngle,json.emissionRate=this.emissionRate,json.color=this.color.toJSON(json.color),json.colorSpread=this.colorSpread.toJSON(json.colorSpread),json.time=this.time,json._time=this._time,json.duration=this.duration,json.loop=this.loop,json.playing=this.playing,json.emitting=this.emitting,json},Emitter2D.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.positionType=json.positionType,this.velocityType=json.velocityType,this.material=json.material?Assets.get(json.material):void 0,this.position.fromJSON(json.position),this.positionSpread.fromJSON(json.positionSpread),this.positionRadius=json.positionRadius,this.speed=json.speed,this.speedSpread=json.speedSpread,this.worldSpace=json.worldSpace,this.minEmission=json.minEmission,this.maxEmission=json.maxEmission,this.minLife=json.minLife,this.maxLife=json.maxLife,this.minSize=json.minSize,this.maxSize=json.maxSize,this.sizeTween.fromJSON(json.sizeTween),this.alphaTween.fromJSON(json.alphaTween),this.colorTween.fromJSON(json.colorTween),this.velocity.fromJSON(json.velocity),this.velocitySpread.fromJSON(json.velocitySpread),this.acceleration.fromJSON(json.acceleration),this.accelerationSpread.fromJSON(json.accelerationSpread),this.angularVelocity=json.angularVelocity,this.angularAcceleration=json.angularAcceleration,this.angularVelocitySpread=json.angularVelocitySpread,this.randomAngle=json.randomAngle,this.emissionRate=json.emissionRate,this.color.fromJSON(json.color),this.colorSpread.fromJSON(json.colorSpread),this.time=json.time,this._time=json._time,this.duration=json.duration,this.loop=json.loop,this.playing=json.playing,this.emitting=json.emitting,this},Emitter2D.MAX_PARTICLES=1024,Emitter2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/particle_system/particle_system",["odin/base/class","odin/base/time","odin/core/game/log","odin/core/components/component","odin/core/components/particle_system/emitter","odin/core/components/particle_system/emitter_2d","odin/core/components/particle_system/tween"],function(Class,Time,Log,Component,Emitter,Emitter2D,Tween){function ParticleSystem(opts){opts||(opts={}),Component.call(this,"ParticleSystem",opts),this.playing=void 0!=opts.playing?opts.playing:!0,this.emitters=[],this._emitterHash={},this._emitterJSONHash={},opts.emitter&&this.addEmitter(opts.emitter),opts.emitters&&this.add.apply(this,opts.emitters)}return ParticleSystem.type="ParticleSystem",Component.extend(ParticleSystem),ParticleSystem.Emitter=Emitter,ParticleSystem.Emitter2D=Emitter2D,ParticleSystem.Tween=Tween,ParticleSystem.prototype.copy=function(other){for(var emitter,otherEmitter,emitters=this.emitters,otherEmitters=other.emitters,i=otherEmitters.length,j=emitters.length;i-->j;){this.removeEmitter(emitters[i])}for(i=otherEmitters.length;i--;){otherEmitter=otherEmitters[i],(emitter=emitters[i])?emitter._className===otherEmitter._className?otherEmitters[i].copy(other):(this.removeEmitter(emitter),this.addEmitter(otherEmitter.clone())):this.addEmitter(otherEmitter.clone())}return this.playing=other.playing,this},ParticleSystem.prototype.clear=function(){Component.prototype.clear.call(this);for(var emitters=this.emitters,i=emitters.length;i--;){emitters[i].clear()}return this},ParticleSystem.prototype.addEmitter=function(emitter){var emitters=this.emitters,index=emitters.indexOf(emitter);return-1===index?(emitter.particleSystem&&(emitter=emitter.clone()),emitter.particleSystem=this,emitters.push(emitter),this._emitterHash[emitter._id]=emitter,-1!==emitter._jsonId&&(this._emitterHash[emitter._jsonId]=emitter)):Log.error("ParticleSystem.addEmitter: ParticleSystem already has passed Emitter"),this},ParticleSystem.prototype.add=function(){for(var i=arguments.length;i--;){this.addEmitter(arguments[i])}return this},ParticleSystem.prototype.removeEmitter=function(emitter){var emitters=this.emitters,index=emitters.indexOf(emitter);return-1!==index?(emitters.splice(index,1),this._emitterHash[emitter._id]=void 0,-1!==emitter._jsonId&&(this._emitterHash[emitter._jsonId]=void 0),emitter.clear(),emitter.particleSystem=void 0,emitter.transform=void 0):Log.error("ParticleSystem.removeEmitter: ParticleSystem does not have passed Emitter"),this},ParticleSystem.prototype.remove=function(){for(var i=arguments.length;i--;){this.removeEmitter(arguments[i])}return this},ParticleSystem.prototype.findEmitterById=function(id){return this._emitterHash[id]},ParticleSystem.prototype.findEmitterByJSONId=function(id){return this._emitterJSONHash[id]},ParticleSystem.prototype.play=function(){for(var emitters=this.emitters,i=emitters.length;i--;){emitters[i].play()
}return this.playing=!0,this},ParticleSystem.prototype.update=function(){if(this.playing){for(var emitter,dt=Time.delta,emitters=this.emitters,playing=!1,i=emitters.length;i--;){emitter=emitters[i],emitter.update(dt),emitter.playing&&(playing=!0)}this.playing=playing}},ParticleSystem.prototype.toJSON=function(json){json=Component.prototype.toJSON.call(this,json);for(var emitters=this.emitters,jsonEmitters=json.emitters||(json.emitters=[]),i=emitters.length;i--;){jsonEmitters[i]=emitters[i].toJSON(jsonEmitters[i])}return json.playing=this.playing,json},ParticleSystem.prototype.fromJSON=function(json){Component.prototype.fromJSON.call(this,json);for(var emitter,jsonEmitter,jsonEmitters=json.emitters,i=jsonEmitters.length;i--;){jsonEmitter=jsonEmitters[i],(emitter=this.findEmitterByJSONId(jsonEmitter._id))?emitter.fromJSON(jsonEmitter):this.addEmitter(Class.fromJSON(jsonEmitter))}return this.playing=json.playing,this},ParticleSystem}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/audio_source",["odin/base/audio_ctx","odin/base/time","odin/math/mathf","odin/math/vec2","odin/math/vec3","odin/core/assets/assets","odin/core/components/component"],function(AudioCtx,Time,Mathf,Vec2,Vec3,Assets,Component){function AudioSource(opts){opts||(opts={}),Component.call(this,"AudioSource",opts),this.clip=opts.clip,this._source=void 0,this._gain=void 0,this._panner=void 0,this.dopplerLevel=void 0!=opts.dopplerLevel?opts.dopplerLevel:1,this._loop=void 0!=opts.loop?!!opts.loop:!1,this.maxDistance=void 0!=opts.maxDistance?opts.maxDistance:15,this.minDistance=void 0!=opts.minDistance?opts.minDistance:1,this.offset=void 0!=opts.offset?opts.offset:new Vec3,this.pitch=void 0!=opts.pitch?opts.pitch:0,this.playOnInit=void 0!=opts.playOnInit?!!opts.playOnInit:!1,this.spread=void 0!=opts.spread?opts.spread:0,this.time=void 0!=opts.time?opts.time:0,this._volume=void 0!=opts.volume?opts.volume:1,this.playing=!1,this.stopped=!1,this.paused=!1,this._startTime=0;var self=this;this._onended=function(){self.playing=!1,self.time=0}}var VEC2,VEC3,now=Time.now,clamp01=Mathf.clamp01,defineProperty=Object.defineProperty;return Component.extend(AudioSource),defineProperty(AudioSource.prototype,"volume",{get:function(){return this._volume},set:function(value){this._volume=clamp01(value),this._gain&&(this._gain.gain.value=this._volume)}}),defineProperty(AudioSource.prototype,"loop",{get:function(){return this._loop},set:function(value){this._loop=!!value,this._source&&(this._source.loop=this._loop)}}),AudioSource.prototype.copy=function(other){return this.clip=other.clip,this.dopplerLevel=other.dopplerLevel,this.loop=other.loop,this.maxDistance=other.maxDistance,this.minDistance=other.minDistance,this.offset.copy(other.offset),this.panLevel=other.panLevel,this.pitch=other.pitch,this.playOnInit=other.playOnInit,this.spread=other.spread,this.time=other.time,this.volume=other.volume,this.playing=!1,this.stopped=!1,this.paused=!1,this},AudioSource.prototype.clear=function(){Component.prototype.clear.call(this),this.playing&&this.stop(),this.clip=void 0,this._source=void 0,this._gain=void 0,this._panner=void 0},AudioSource.prototype.init=function(){this.playOnInit&&this.play()},VEC2=new Vec2,VEC3=new Vec3,AudioSource.prototype.update=function(){if(0!==this.dopplerLevel&&this.playing){var transform2d,transform,camera,cameraTransform,panner;(camera=this.gameObject.scene.game.camera)&&(panner=this._panner)&&(transform=this.transform,transform2d=this.transform2d,cameraTransform=camera.transform||camera.transform2d,transform2d?(VEC2.vadd(transform2d.position,this.offset),VEC2.sub(cameraTransform.position),VEC2.smul(this.dopplerLevel),panner.setPosition(VEC2.x,VEC2.y,.5*camera.orthographicSize)):(VEC3.vadd(transform.position,this.offset),VEC3.sub(cameraTransform.position),VEC3.smul(this.dopplerLevel),panner.setPosition(VEC3.x,VEC3.y,VEC3.z||0)))}},AudioSource.prototype.play=function(delay,offset){return AudioCtx&&this.clip&&this.clip.raw?(delay||(delay=0),offset||(offset=this.time),this._refresh(),this.playing=!0,this.stopped=!1,this.paused=!1,this._startTime=now(),this.time=offset,this._source.start(delay,this.time),this):this},AudioSource.prototype.pause=function(){return AudioCtx&&this.clip&&this.clip.raw?(this.playing=!1,this.stopped=!1,this.paused=!0,this.time=now()-this._startTime,this._source.stop(this.time),this):this},AudioSource.prototype.stop=function(){return AudioCtx&&this.clip&&this.clip.raw?(this.time=0,this.playing=!1,this.stopped=!0,this.paused=!1,this._source.stop(this.time),this):this},AudioSource.prototype._refresh=function(){var panner,source=this._source=AudioCtx.createBufferSource(),gain=this._gain=AudioCtx.createGain();return 0===this.dopplerLevel?(gain.connect(AudioCtx.destination),source.connect(gain)):(panner=this._panner=AudioCtx.createPanner(),gain.connect(AudioCtx.destination),panner.connect(gain),source.connect(panner)),source.buffer=this.clip.raw,source.onended=this._onended,gain.gain.value=this.volume,source.loop=this.loop,this},AudioSource.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.clip=this.clip?this.clip.name:void 0,json.dopplerLevel=this.dopplerLevel,json.loop=this.loop,json.maxDistance=this.maxDistance,json.minDistance=this.minDistance,json.offset=this.offset.toJSON(json.offset),json.panLevel=this.panLevel,json.pitch=this.pitch,json.playOnInit=this.playOnInit,json.spread=this.spread,json.time=this.time,json.volume=this.volume,json},AudioSource.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.clip=json.clip?Assets.get(json.clip):void 0,this.dopplerLevel=json.dopplerLevel,this.loop=json.loop,this.maxDistance=json.maxDistance,this.minDistance=json.minDistance,this.offset.fromJSON(json.offset),this.panLevel=json.panLevel,this.pitch=json.pitch,this.playOnInit=json.playOnInit,this.spread=json.spread,this.time=json.time,this.volume=json.volume,this},AudioSource}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/camera",["odin/math/mathf","odin/math/color","odin/math/vec3","odin/math/mat4","odin/core/components/component"],function(Mathf,Color,Vec3,Mat4,Component){function Camera(opts){opts||(opts={}),Component.call(this,"Camera",opts),this.width=960,this.height=640,this.invWidth=1/this.width,this.invHeight=1/this.height,this.autoResize=void 0!=opts.autoResize?!!opts.autoResize:!0,this.background=void 0!=opts.background?opts.background:new Color(.5,.5,.5),this.aspect=this.width/this.height,this.fov=void 0!=opts.fov?opts.fov:35,this.near=void 0!=opts.near?opts.near:.0625,this.far=void 0!=opts.far?opts.far:16384,this.orthographic=void 0!=opts.orthographic?!!opts.orthographic:!1,this.orthographicSize=void 0!=opts.orthographicSize?opts.orthographicSize:2,this.minOrthographicSize=void 0!=opts.minOrthographicSize?opts.minOrthographicSize:EPSILON,this.maxOrthographicSize=void 0!=opts.maxOrthographicSize?opts.maxOrthographicSize:1024,this.projection=new Mat4,this.guiProjection=new Mat4,this.view=new Mat4,this.needsUpdate=!0,this._active=!1}var MAT4,VEC3,degsToRads=Mathf.degsToRads,clamp=Mathf.clamp,EPSILON=Mathf.EPSILON;return Component.extend(Camera),Camera.prototype.copy=function(other){return this.width=other.width,this.height=other.height,this.aspect=other.aspect,this.invWidth=1/this.width,this.invHeight=1/this.height,this.autoResize=other.autoResize,this.background.copy(other.background),this.far=other.far,this.near=other.near,this.fov=other.fov,this.orthographic=other.orthographic,this.orthographicSize=other.orthographicSize,this.minOrthographicSize=other.minOrthographicSize,this.maxOrthographicSize=other.maxOrthographicSize,this.needsUpdate=!0,this},Camera.prototype.set=function(width,height){this.width=width,this.height=height,this.invWidth=1/this.width,this.invHeight=1/this.height,this.aspect=width/height,this.needsUpdate=!0},Camera.prototype.setWidth=function(width){this.width=width,this.aspect=width/this.height,this.invWidth=1/this.width,this.needsUpdate=!0},Camera.prototype.setHeight=function(height){this.height=height,this.aspect=this.width/height,this.invHeight=1/this.height,this.needsUpdate=!0},Camera.prototype.setFov=function(value){this.fov=value,this.needsUpdate=!0},Camera.prototype.setNear=function(value){this.near=value,this.needsUpdate=!0},Camera.prototype.setFar=function(value){this.far=value,this.needsUpdate=!0},Camera.prototype.setOrthographic=function(value){this.orthographic=!!value,this.needsUpdate=!0},Camera.prototype.toggleOrthographic=function(){this.orthographic=!this.orthographic,this.needsUpdate=!0},Camera.prototype.setOrthographicSize=function(size){this.orthographicSize=clamp(size,this.minOrthographicSize,this.maxOrthographicSize),this.needsUpdate=!0},MAT4=new Mat4,VEC3=new Vec3,Camera.prototype.toWorld=function(v,out){return out||(out=new Vec3),out.x=2*v.x*this.invWidth-1,out.y=-2*v.y*this.invHeight+1,out.transformMat4(MAT4.mmul(this.projection,this.view).inverse()),out.z=this.near,out},Camera.prototype.toScreen=function(v,out){return out||(out=new Vec2),VEC3.copy(v),VEC3.transformMat4(MAT4.mmul(this.projection,this.view)),out.x=.5*(VEC3.x+1)*this.width,out.y=.5*(1-VEC3.y)*this.height,v},Camera.prototype.update=function(force){if(force||this._active){if(this.needsUpdate){if(this.orthographic){this.orthographicSize=clamp(this.orthographicSize,this.minOrthographicSize,this.maxOrthographicSize);var orthographicSize=this.orthographicSize,right=orthographicSize*this.aspect,left=-right,top=orthographicSize,bottom=-top;this.projection.orthographic(left,right,top,bottom,this.near,this.far)}else{this.projection.perspective(degsToRads(this.fov),this.aspect,this.near,this.far)}this.guiProjection.orthographic(0,this.width,0,this.height,-1,1),this.needsUpdate=!1}this.view.inverseMat((this.transform||this.transform2d).matrixWorld)}},Camera.prototype.sort=function(a,b){return a._active?-1:b._active?1:-1},Camera.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.width=this.width,json.height=this.height,json.aspect=this.aspect,json.autoResize=this.autoResize,json.background=this.background.toJSON(json.background),json.far=this.far,json.near=this.near,json.fov=this.fov,json.orthographic=this.orthographic,json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.width=json.width,this.height=json.height,this.aspect=json.aspect,this.autoResize=json.autoResize,this.background.fromJSON(json.background),this.far=json.far,this.near=json.near,this.fov=json.fov,this.orthographic=json.orthographic,this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this.needsUpdate=!0,this},Camera}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/camera_2d",["odin/math/mathf","odin/math/color","odin/math/vec2","odin/math/mat32","odin/math/mat4","odin/core/components/component"],function(Mathf,Color,Vec2,Mat32,Mat4,Component){function Camera2D(opts){opts||(opts={}),Component.call(this,"Camera2D",opts),this.width=960,this.height=640,this.invWidth=1/this.width,this.invHeight=1/this.height,this.autoResize=void 0!=opts.autoResize?!!opts.autoResize:!0,this.background=void 0!=opts.background?opts.background:new Color(.5,.5,.5),this.aspect=this.width/this.height,this.orthographicSize=void 0!=opts.orthographicSize?opts.orthographicSize:2,this.minOrthographicSize=void 0!=opts.minOrthographicSize?opts.minOrthographicSize:EPSILON,this.maxOrthographicSize=void 0!=opts.maxOrthographicSize?opts.maxOrthographicSize:1024,this.projection=new Mat4,this._projection=new Mat32,this.guiProjection=new Mat4,this.view=new Mat4,this._view=new Mat32,this.needsUpdate=!0,this._active=!1}var MAT32,VEC2,clamp=Mathf.clamp,EPSILON=Mathf.EPSILON;return Component.extend(Camera2D),Camera2D.prototype.copy=function(other){return this.width=other.width,this.height=other.height,this.invWidth=1/this.width,this.invHeight=1/this.height,this.autoResize=other.autoResize,this.background.copy(other.background),this.orthographicSize=other.orthographicSize,this.minOrthographicSize=other.minOrthographicSize,this.maxOrthographicSize=other.maxOrthographicSize,this.needsUpdate=!0,this},Camera2D.prototype.set=function(width,height){this.width=width,this.height=height,this.invWidth=1/this.width,this.invHeight=1/this.height,this.aspect=width/height,this.needsUpdate=!0},Camera2D.prototype.setWidth=function(width){this.width=width,this.aspect=width/this.height,this.invWidth=1/this.width,this.needsUpdate=!0},Camera2D.prototype.setHeight=function(height){this.height=height,this.aspect=this.width/height,this.invHeight=1/this.height,this.needsUpdate=!0},Camera2D.prototype.setOrthographicSize=function(size){this.orthographicSize=clamp(size,this.minOrthographicSize,this.maxOrthographicSize),this.needsUpdate=!0},MAT32=new Mat32,VEC2=new Vec2,Camera2D.prototype.toWorld=function(v,out){return out||(out=new Vec2),out.x=2*v.x*this.invWidth-1,out.y=-2*v.y*this.invHeight+1,out.transformMat32(MAT32.mmul(this._projection,this._view).inverse()),out},Camera2D.prototype.toScreen=function(v,out){return out||(out=new Vec2),VEC2.copy(v).transformMat32(MAT32.mmul(this._projection,this._view)),out.x=.5*(VEC2.x+1)*this.width,out.y=.5*(1-VEC2.y)*this.height,out},Camera2D.prototype.update=function(){if(this._active){if(this.needsUpdate){var orthographicSize=this.orthographicSize,right=orthographicSize*this.aspect,left=-right,top=orthographicSize,bottom=-top;this.projection.orthographic(left,right,top,bottom,-1,1),this._projection.fromMat4(this.projection),this.needsUpdate=!1,this.guiProjection.orthographic(0,this.width,0,this.height,-1,1)}this.view.inverseMat((this.transform||this.transform2d).matrixWorld),this._view.fromMat4(this.view)}},Camera2D.prototype.sort=function(a,b){return a._active?-1:b._active?1:-1},Camera2D.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.width=this.width,json.height=this.height,json.autoResize=this.autoResize,json.background=this.background.toJSON(json.background),json.orthographicSize=this.orthographicSize,json.minOrthographicSize=this.minOrthographicSize,json.maxOrthographicSize=this.maxOrthographicSize,json},Camera2D.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.width=json.width,this.height=json.height,this.autoResize=json.autoResize,this.background.fromJSON(json.background),this.orthographicSize=json.orthographicSize,this.minOrthographicSize=json.minOrthographicSize,this.maxOrthographicSize=json.maxOrthographicSize,this.needsUpdate=!0,this},Camera2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/gui_element",["odin/math/rect","odin/core/components/component"],function(Rect,Component){function GUIElement(type,opts){opts||(opts={}),Component.call(this,type||"GUIElement",opts)}Component.extend(GUIElement);var RECT=new Rect;return GUIElement.prototype.screen=function(camera,rect){return rect||(rect=RECT),camera||(camera=this.gameObject.scene.game.camera),rect.x=0,rect.y=0,rect.width=camera.width,rect.height=camera.height,rect},GUIElement}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/gui_text",["odin/math/rect","odin/math/color","odin/core/enums","odin/core/assets/assets","odin/core/components/gui_element"],function(Rect,Color,Enums,Assets,GUIElement){function GUIText(opts){opts||(opts={}),GUIElement.call(this,"GUIText",opts),this.text=void 0!=opts.text?opts.text:"",this.font=opts.font||"Arial",this.fontSize=opts.fontSize||16,this.fontStyle=opts.fontStyle||FontStyle.Normal,this.lineHeight=opts.lineHeight||24,this.lineSpacing=opts.lineSpacing||0,this.color=void 0!=opts.color?opts.color:new Color(1,1,1),this.offset=void 0!=opts.offset?opts.offset:new Vec2,this.alignment=opts.alignment||TextAnchor.MiddleLeft}var FontStyle=Enums.FontStyle,TextAnchor=Enums.TextAnchor;return GUIElement.extend(GUIText),GUIText.prototype.copy=function(other){return this.text=other.text,this.font=other.font,this.fontSize=other.fontSize,this.fontStyle=other.fontStyle,this.lineHeight=other.lineHeight,this.lineSpacing=other.lineSpacing,this.color.copy(other.color),this.offset.copy(other.offset),this.alignment=other.alignment,this},GUIText.prototype.toJSON=function(json){return json=GUIElement.prototype.toJSON.call(this,json),json.text=this.text,json.font=this.font,json.fontSize=this.fontSize,json.fontStyle=this.fontStyle,json.lineHeight=this.lineHeight,json.lineSpacing=this.lineSpacing,json.color=this.color.toJSON(json.color),json.offset=this.offset.toJSON(json.offset),json.alignment=this.alignment,json},GUIText.prototype.fromJSON=function(json){return GUIElement.prototype.fromJSON.call(this,json),this.text=json.text,this.font=json.font,this.fontSize=json.fontSize,this.fontStyle=json.fontStyle,this.lineHeight=json.lineHeight,this.lineSpacing=json.lineSpacing,this.color.fromJSON(json.color),this.offset.fromJSON(json.offset),this.alignment=this.alignment,this},GUIText}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/gui_texture",["odin/math/rect","odin/math/color","odin/core/assets/assets","odin/core/components/gui_element"],function(Rect,Color,Assets,GUIElement){function GUITexture(opts){opts||(opts={}),GUIElement.call(this,"GUITexture",opts),this.texture=opts.texture,this.color=void 0!=opts.color?opts.color:new Color(1,1,1),this.position=void 0!=opts.position?opts.position:new Rect,this.x=opts.x||0,this.y=opts.y||0,this.w=opts.w||1,this.h=opts.h||1,this.alpha=void 0!=opts.alpha?opts.alpha:1}return GUIElement.extend(GUITexture),GUITexture.prototype.copy=function(other){return this.texture=other.texture,this.color.copy(other.color),this.position.copy(other.position),this.x=other.x,this.y=other.y,this.w=other.w,this.h=other.h,this.alpha=other.alpha,this},GUITexture.prototype.clear=function(){return GUIElement.prototype.clear.call(this),this.texture=void 0,this},GUITexture.prototype.toJSON=function(json){return json=GUIElement.prototype.toJSON.call(this,json),json.texture=this.texture?this.texture.name:void 0,json.color=this.color.toJSON(json.color),json.position=this.position.toJSON(json.position),json.x=this.x,json.y=this.y,json.w=this.w,json.h=this.h,json.alpha=this.alpha,json},GUITexture.prototype.fromJSON=function(json){return GUIElement.prototype.fromJSON.call(this,json),this.texture=json.texture?Assets.get(json.texture):void 0,this.color.fromJSON(json.color),this.position.fromJSON(json.position),this.x=json.x,this.y=json.y,this.w=json.w,this.h=json.h,this.alpha=json.alpha,this},GUITexture}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/light",["odin/core/enums","odin/math/vec3","odin/math/color","odin/core/components/component"],function(Enums,Vec3,Color,Component){function Light(opts){opts||(opts={}),Component.call(this,"Light",opts),this.type=void 0!=opts.type?opts.type:Enums.LightType.Point,this.visible=void 0!=opts.visible?!!opts.visible:!0,this.onlyShadow=void 0!=opts.onlyShadow?!!opts.onlyShadow:!1,this.castShadow=void 0!=opts.castShadow?!!opts.castShadow:!0,this.color=void 0!=opts.color?opts.color:new Color(1,1,1),this.energy=void 0!=opts.energy?opts.energy:1,this.distance=void 0!=opts.distance?opts.distance:0,this._angleCos=0,this._angle=0,this.angle=void 0!=opts.angle?opts.angle:.0625*Math.PI,this.exponent=void 0!=opts.exponent?opts.exponent:10,this.target=void 0!=opts.target?opts.target:new Vec3}var cos=Math.cos,defineProperty=Object.defineProperty;return Component.extend(Light),defineProperty(Light.prototype,"angle",{get:function(){return this._angle},set:function(value){this._angle=value,this._angleCos=cos(value)}}),Light.prototype.copy=function(other){return this.type=other.type,this.visible=other.visible,this.onlyShadow=other.onlyShadow,this.castShadow=other.castShadow,this.color.copy(other.color),this.energy=other.energy,this.distance=other.distance,this.angle=other.angle,this},Light.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.type=this.type,json.visible=this.visible,json.onlyShadow=this.onlyShadow,json.castShadow=this.castShadow,json.color=this.color.toJSON(json.color),json.energy=this.energy,json.distance=this.distance,json.angle=this.angle,json},Light.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.type=json.type,this.visible=json.visible,this.onlyShadow=json.onlyShadow,this.castShadow=json.castShadow,this.color.fromJSON(json.color),this.energy=json.energy,this.distance=json.distance,this.angle=json.angle,this},Light}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/mesh_animation",["odin/base/time","odin/math/mathf","odin/math/mat4","odin/math/vec3","odin/math/quat","odin/core/assets/assets","odin/core/components/component","odin/core/enums"],function(Time,Mathf,Mat4,Vec3,Quat,Assets,Component,Enums){function MeshAnimation(opts){opts||(opts={}),Component.call(this,"MeshAnimation",opts),this.current=void 0!=opts.current?opts.current:"idle",this.mode=void 0!=opts.mode?opts.mode:WrapMode.Loop,this.rate=void 0!=opts.rate?opts.rate:1/24,this._time=0,this._frame=0,this._lastFrame=0,this._order=1,this.playing=this.sheet?!0:!1}var POSITION,LAST_POSITION,ROTATION,LAST_ROTATION,SCALE,LAST_SCALE,MAT4,clamp01=Mathf.clamp01,abs=Math.abs,WrapMode=Enums.WrapMode;return Component.extend(MeshAnimation),MeshAnimation.order=-1e6,MeshAnimation.prototype.copy=function(other){return this.current=other.current,this.mode=other.mode,this.rate=other.rate,this._time=other._time,this._frame=other._frame,this._lastFrame=other._lastFrame,this._order=other._order,this.playing=other.playing,this},MeshAnimation.prototype.play=function(name,mode,rate){var meshFilter=this.meshFilter;return this.playing&&this.current===name||!meshFilter||!meshFilter.mesh.animations[name]?this:(this.current=name,this.rate=void 0!=rate?rate:rate=this.rate,this.mode=mode||(mode=this.mode),this._frame=0,this._lastFrame=0,this._order=1,this._time=0,this.playing=!0,this.emit("play",name,mode,rate),this)},MeshAnimation.prototype.stop=function(){return this.playing&&this.emit("stop"),this.playing=!1,this._frame=0,this._lastFrame=0,this._order=1,this._time=0,this},POSITION=new Vec3,LAST_POSITION=new Vec3,ROTATION=new Quat,LAST_ROTATION=new Quat,SCALE=new Vec3,LAST_SCALE=new Vec3,MAT4=new Mat4,MeshAnimation.prototype.update=function(){if(this.playing){var meshBones,mesh,bonesLength,boneCurrent,boneTransform,uniform,parentIndex,boneFrame,lastBoneFrame,pos,rot,scl,current,dt,count,length,order,frame,lastFrame,mode,frameState,lastFrameState,i,meshFilter=this.meshFilter,alpha=0;if(meshFilter&&(meshBones=meshFilter._bones,mesh=meshFilter.mesh,mesh&&(bonesLength=meshBones.length)&&(i=bonesLength,current=mesh.animations[this.current]))){for(dt=Time.delta,order=this._order,frame=this._frame,lastFrame=this._lastFrame,mode=this.mode,!this.rate||1/0===this.rate||this.rate<0?frame=abs(frame)%current.length:(this._time+=dt,count=this._time/this.rate,alpha=count,count>=1&&(lastFrame=frame,alpha=0,this._time=0,length=current.length,frame+=order*(0|count),mode===WrapMode.Loop?frame%=length:mode===WrapMode.Once?order>0?frame>=length&&(frame=length-1,this.stop()):0>frame&&(frame=0,this.stop()):mode===WrapMode.PingPong?order>0?frame>=length&&(this._order=-1,frame=length-1):0>frame&&(this._order=1,frame=0):mode===WrapMode.Clamp&&(order>0?frame>=length&&(frame=length-1):0>frame&&(frame=0)))),alpha=clamp01(alpha),frameState=current[frame],lastFrameState=current[lastFrame]||frameState;i--;){boneCurrent=meshBones[i],boneTransform=boneCurrent.transform,uniform=boneCurrent.uniform,parentIndex=boneCurrent.parentIndex,pos=boneTransform.position,rot=boneTransform.rotation,scl=boneTransform.scale,boneFrame=frameState[i],lastBoneFrame=lastFrameState[i],LAST_POSITION.x=lastBoneFrame[0],LAST_POSITION.y=lastBoneFrame[1],LAST_POSITION.z=lastBoneFrame[2],LAST_ROTATION.x=lastBoneFrame[3],LAST_ROTATION.y=lastBoneFrame[4],LAST_ROTATION.z=lastBoneFrame[5],LAST_ROTATION.w=lastBoneFrame[6],LAST_SCALE.x=lastBoneFrame[7],LAST_SCALE.y=lastBoneFrame[8],LAST_SCALE.z=lastBoneFrame[9],POSITION.x=boneFrame[0],POSITION.y=boneFrame[1],POSITION.z=boneFrame[2],ROTATION.x=boneFrame[3],ROTATION.y=boneFrame[4],ROTATION.z=boneFrame[5],ROTATION.w=boneFrame[6],SCALE.x=boneFrame[7],SCALE.y=boneFrame[8],SCALE.z=boneFrame[9],pos.vlerp(LAST_POSITION,POSITION,alpha),rot.qlerp(LAST_ROTATION,ROTATION,alpha),scl.vlerp(LAST_SCALE,SCALE,alpha)}this._frame=frame,this._lastFrame=lastFrame}}},MeshAnimation.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.current=this.current,json.mode=this.mode,json.rate=this.rate,json._time=this._time,json._frame=this._frame,json._order=this._order,json.playing=this.playing,json},MeshAnimation.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.current=json.current,this.mode=json.mode,this.rate=json.rate,this._time=json._time,this._frame=json._frame,this._order=json._order,this.playing=json.playing,this},MeshAnimation}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game_object",["odin/base/class","odin/core/components/component","odin/core/game/log"],function(Class,Component,Log){function GameObject(opts){opts||(opts={}),Class.call(this),this.name=void 0!=opts.name?opts.name:"GameObject_"+this._id,this.scene=void 0,this.tags=[],this.components=[],this._componentType={},this._componentHash={},this._componentJSONHash={},opts.tag&&this.addTag(opts.tag),opts.tags&&this.addTags.apply(this,opts.tags),opts.components&&this.addComponents.apply(this,opts.components)}return Class.extend(GameObject),GameObject.prototype.copy=function(other){for(var otherComponent,component,components=this.components,otherComponents=other.components,tags=other.tags,i=components.length;i--;){component=components[i],other.hasComponent(component._className)||this.removeComponent(component)}for(i=otherComponents.length;i--;){otherComponent=otherComponents[i],(component=this.getComponent(otherComponent._type))?component.copy(otherComponent):this.addComponent(otherComponent.clone())}for(i=tags.length;i--;){this.addTag(tags[i])}return this},GameObject.prototype.clear=function(){var i,components=this.components,tags=this.tags,componentLength=components.length;for(i=componentLength;i--;){components[i].clear()}for(i=tags.length;i--;){this.removeTag(tags[i])}for(i=componentLength;i--;){this.removeComponent(components[i])}return this.off(),this},GameObject.prototype.destroy=function(){return this.scene?(this.scene.removeGameObject(this),this.emit("destroy"),this.clear(),this):(Log.error("GameObject.destroy: can't destroy GameObject if it's not added to a Scene"),this)},GameObject.prototype.remove=function(){return this.scene?(this.scene.removeGameObject(this),this):(Log.error("GameObject.remove: can't remove GameObject if it's not added to a Scene"),this)},GameObject.prototype.addTag=function(tag){var tags=this.tags;return-1===tags.indexOf(tag)&&tags.push(tag),this},GameObject.prototype.addTags=function(){for(var i=arguments.length;i--;){this.addTag(arguments[i])}return this},GameObject.prototype.removeTag=function(tag){var tags=this.tags,index=tags.indexOf(tag);return-1!==index&&tags.splice(index,1),this},GameObject.prototype.removeTags=function(){for(var i=arguments.length;i--;){this.removeTag(arguments[i])}return this},GameObject.prototype.hasTag=function(tag){return-1!==this.tags.indexOf(tag)},GameObject.prototype.addComponent=function(component,others){if("string"==typeof component&&(component=new Class._classes[component]),!(component instanceof Component)){return Log.error("GameObject.addComponent: can't add passed argument, it is not an instance of Component"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){Log.error("GameObject.addComponent: GameObject already has a(n) "+component._type+" Component")}else{if(component.gameObject&&(component=component.clone()),components.push(component),this._componentType[component._type]=component,this._componentHash[component._id]=component,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=component),component.gameObject=this,this[name]=component,!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){comp[components[j]._name]=components[j]}}}component.init(),component.emit("init")}this.emit("add"+component._type,component),this.emit("addComponent",component),component.emit("add",this),this.scene&&this.scene._addComponent(component)}return this},GameObject.prototype.addComponents=function(){var component,name,i,j,length=arguments.length,components=this.components;for(i=length;i--;){this.addComponent(arguments[i],!0)}for(i=components.length;i--;){if(component=components[i]){for(j=components.length;j--;){name=components[j]._name,component[name]=components[j]}}}for(i=components.length;i--;){component=components[i],component.init(),component.emit("init")}return this},GameObject.prototype.removeComponent=function(component,clear,others){if("string"==typeof component&&(component=this.getComponent(component)),!(component instanceof Component)){return Log.error("GameObject.removeComponent: can't remove passed argument, it is not an instance of Component"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){if(component.emit("remove",this),this.emit("remove"+component._type,component),this.emit("removeComponent",component),!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){name===components[j]._name&&(comp[name]=void 0)}}}}components.splice(components.indexOf(component),1),this._componentType[component._type]=void 0,this._componentHash[component._id]=void 0,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=void 0),component.gameObject=void 0,this[name]=void 0,this.scene&&this.scene._removeComponent(component),clear&&component.clear()}else{Log.error("GameObject.removeComponent: GameObject does not have a(n) "+type+" Component")}return this},GameObject.prototype.removeComponents=function(){var component,name,i,j,length=arguments.length,components=this.components,toRemove=arguments;for(i=length;i--;){this.removeComponent(arguments[i],null,!0)}for(i=components.length;i--;){if(component=components[i]){for(name=component._name,j=toRemove.length;j--;){name===toRemove[i]._name&&(component[name]=void 0)}}}return this},GameObject.prototype.getComponent=function(type){return this._componentType[type]},GameObject.prototype.hasComponent=function(type){for(var components=this.components,i=components.length;i--;){if(components[i]._type===type){return!0}}return!1},GameObject.prototype.find=function(name){var children,child,i,transform=this.transform||this.transform2d;if(!transform){return void 0}for(children=transform.children,i=children.length;i--;){if(child=children[i],child.gameObject.name===name){return child.gameObject}if(child=child.find(name)){return child}}return void 0},GameObject.prototype.findComponentById=function(id){return this._componentHash[id]},GameObject.prototype.findComponentByJSONId=function(id){return this._componentJSONHash[id]},GameObject.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);for(var component,components=this.components,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=components.length;i--;){(component=components[i]).json&&(jsonComponents[i]=component.toJSON(jsonComponents[i]))}for(i=tags.length;i--;){jsonTags[i]=tags[i]}return json.name=this.name,json},GameObject.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);
for(var component,jsonComponent,tag,has,type,j,components=this.components,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=components.length;i--;){for(component=components[i],type=component._type,has=!1,j=jsonComponents.length;j--;){jsonComponent=jsonComponents[i],type===jsonComponent._type&&(has=!0)}has||this.removeComponent(component)}for(i=jsonComponents.length;i--;){(jsonComponent=jsonComponents[i])&&((component=this.findComponentByJSONId(jsonComponent._id))||(component=this.getComponent(jsonComponent._type))?component.fromJSON(jsonComponent):this.addComponent(Class.fromJSON(jsonComponent)))}for(i=jsonTags.length;i--;){-1===tags.indexOf(tag=jsonTags[i])&&tags.push(tag)}return this.name=json.name,this},GameObject}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/bone",["odin/math/vec3","odin/math/quat","odin/math/mat4","odin/core/components/component"],function(Vec3,Quat,Mat4,Component){function Bone(opts){opts||(opts={}),Component.call(this,"Bone",opts),this.parentIndex=void 0!=opts.parentIndex?opts.parentIndex:-1,this.name=void 0!=opts.name?opts.name:"Bone_"+UNKNOWN++,this.skinned=void 0!=opts.skinned?opts.skinned:!1,this.bindPose=void 0!=opts.bindPose?opts.bindPose:new Mat4,this.uniform=new Mat4,this.inheritPosition=void 0!=opts.inheritPosition?opts.inheritPosition:!0,this.inheritRotation=void 0!=opts.inheritRotation?opts.inheritRotation:!0,this.inheritScale=void 0!=opts.inheritScale?opts.inheritScale:!0}var MAT,POSITION,SCALE,ROTATION,UNKNOWN=0;return Component.extend(Bone),Bone.order=1e6,Bone.prototype.copy=function(other){return this.name=other.name,this.parentIndex=other.parentIndex,this.skinned=other.skinned,this.bindPose.copy(other.bindPose),this.inheritPosition=other.inheritPosition,this.inheritRotation=other.inheritRotation,this.inheritScale=other.inheritScale,this},MAT=new Mat4,POSITION=new Vec3,SCALE=new Vec3,ROTATION=new Quat,Bone.prototype.update=function(){if(this.skinned){var transform=this.transform,uniform=this.uniform,parent=transform.parent,inheritPosition=this.inheritPosition,inheritScale=this.inheritScale,inheritRotation=this.inheritRotation;uniform.copy(transform.matrix),parent&&-1!==this.parentIndex&&(MAT.copy(parent.bone.uniform),inheritPosition&&inheritScale&&inheritRotation||(MAT.decompose(POSITION,SCALE,ROTATION),inheritPosition||POSITION.set(0,0,0),inheritScale||SCALE.set(1,1,1),inheritRotation||ROTATION.set(0,0,0,1),MAT.compose(POSITION,SCALE,ROTATION)),uniform.mmul(MAT,uniform))}},Bone.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.name=this.name,json.parentIndex=this.parentIndex,json.skinned=this.skinned,json.bindPose=this.bindPose.toJSON(json.bindPose),json.inheritPosition=this.inheritPosition,json.inheritRotation=this.inheritRotation,json.inheritScale=this.inheritScale,json},Bone.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.name=json.name,this.parentIndex=json.parentIndex,this.skinned=json.skinned,this.bindPose.fromJSON(json.bindPose),this.inheritPosition=json.inheritPosition,this.inheritRotation=json.inheritRotation,this.inheritScale=json.inheritScale,this},Bone.prototype.sort=function(a,b){return b.parentIndex-a.parentIndex},Bone}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/mesh_filter",["odin/core/assets/assets","odin/core/game_object","odin/core/components/component","odin/core/components/bone"],function(Assets,GameObject,Component,Bone){function MeshFilter(opts){opts||(opts={}),Component.call(this,"MeshFilter",opts),this.mesh=void 0!=opts.mesh?opts.mesh:void 0,this.material=void 0!=opts.material?opts.material:void 0,this._bones=[],this._webglMeshInitted=!1}return Component.extend(MeshFilter),MeshFilter.prototype.copy=function(other){return this.mesh=other.mesh,this.material=other.material,this._bones.length=0,this._webglMeshInitted=!1,this},MeshFilter.prototype.init=function(){var subGameObject,meshBone,bone,parent,transform=this.transform,bones=this._bones,meshBones=this.mesh.bones,i=meshBones.length;if(i){for(;i--;){meshBone=meshBones[i],subGameObject=(new GameObject).addComponents(new Bone({name:meshBone.name,parentIndex:meshBone.parentIndex,skinned:meshBone.skinned,bindPose:meshBone.bindPose}),new Transform({position:meshBone.position.clone(),rotation:meshBone.rotation.clone(),scale:meshBone.scale.clone()})),subGameObject.name=meshBone.name,bones[i]=subGameObject.bone}for(transform.addChild(bones[0].transform),i=meshBones.length;i--;){bone=bones[i],parent=bones[bone.parentIndex],parent&&parent.transform.addChild(bone.transform)}}},MeshFilter.prototype.clear=function(){return Component.prototype.clear.call(this),this.mesh=void 0,this.material=void 0,this._bones.length=0,this._webglMeshInitted=!1,this},MeshFilter.prototype.sort=function(a,b){return a.mesh===b.mesh?-1:1},MeshFilter.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.mesh=this.mesh?this.mesh.name:void 0,json.material=this.material?this.material.name:void 0,json},MeshFilter.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.mesh=json.mesh?Assets.get(json.mesh):void 0,this.material=json.material?Assets.get(json.material):void 0,this._bones.length=0,this._webglMeshInitted=!1,this},MeshFilter}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/button",[],function(){function Button(name){this.name=name,this.timeDown=-1,this.timeUp=-1,this.frameDown=-1,this.frameUp=-1,this.value=!1,this._first=!0,this._SYNC={}}return Button.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.name=this.name,json.timeDown=this.timeDown,json.timeUp=this.timeUp,json.frameDown=this.frameDown,json.frameUp=this.frameUp,json.value=this.value,json},Button.prototype.fromSYNC=function(json){return this.name=json.name,this.timeDown=json.timeDown,this.timeUp=json.timeUp,this.frameDown=json.frameDown,this.frameUp=json.frameUp,this.value=json.value,this},Button.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.timeDown=this.timeDown,json.timeUp=this.timeUp,json.frameDown=this.frameDown,json.frameUp=this.frameUp,json.value=this.value,json},Button.prototype.fromJSON=function(json){return this.name=json.name,this.timeDown=json.timeDown,this.timeUp=json.timeUp,this.frameDown=json.frameDown,this.frameUp=json.frameUp,this.value=json.value,this},Button}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/buttons",["odin/base/time","odin/core/input/button","odin/core/game/log"],function(Time,Button,Log){function Buttons(){Array.call(this),this.hash={},this._SYNC={},this.add("mouse0"),this.add("mouse1"),this.add("mouse2")}return Buttons.prototype=Object.create(Array.prototype),Buttons.prototype.constructor=Buttons,Buttons.prototype.add=function(name){if(this.hash[name]){return Log.error("Buttons.add: Buttons already have Button name "+name),void 0}var button=new Button(name);return this.push(button),this.hash[name]=button,button},Buttons.prototype.get=function(name){return this.hash[name]},Buttons.prototype.on=function(name){var button=this.hash[name]||this.add(name);return button._first&&(button.frameDown=Time.frameCount+1,button.timeDown=Time.stamp(),button._first=!1),button.value=!0,button},Buttons.prototype.off=function(name){var button=this.hash[name]||this.add(name);return button.frameUp=Time.frameCount+1,button.timeUp=Time.stamp(),button.value=!1,button._first=!0,button},Buttons.prototype.toSYNC=function(json){json||(json=this._SYNC);var i,jsonButtons=json.buttons||(json.buttons=[]);for(i=this.length;i--;){jsonButtons[i]=this[i].toSYNC(jsonButtons[i])}return json},Buttons.prototype.fromSYNC=function(json){var button,jsonButton,i,buttonHash=this.hash,jsonButtons=json.buttons||(json.buttons=[]);for(i=jsonButtons.length;i--;){jsonButton=jsonButtons[i],(button=buttonHash[jsonButton.name])?button.fromSYNC(jsonButton):this.add(jsonButton.name).fromJSON(jsonButton)}return this},Buttons.prototype.toJSON=function(json){json||(json={});var i,jsonButtons=json.buttons||(json.buttons=[]);for(i=this.length;i--;){jsonButtons[i]=this[i].toJSON(jsonButtons[key])}return json},Buttons.prototype.fromJSON=function(json){var button,jsonButton,i,buttonHash=this.hash,jsonButtons=json.buttons||(json.buttons=[]);for(i=jsonButtons.length;i--;){jsonButton=jsonButtons[i],(button=buttonHash[jsonButton.name])?button.fromJSON(jsonButton):this.add(jsonButton.name).fromJSON(jsonButton)}return this},Buttons}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/axis",["odin/core/enums"],function(Enums){function Axis(opts){opts||(opts={}),this.name=void 0!=opts.name?opts.name:"unknown",this.negButton=void 0!=opts.negButton?opts.negButton:"",this.posButton=void 0!=opts.posButton?opts.posButton:"",this.altNegButton=void 0!=opts.altNegButton?opts.altNegButton:"",this.altPosButton=void 0!=opts.altPosButton?opts.altPosButton:"",this.gravity=void 0!=opts.gravity?opts.gravity:3,this.sensitivity=void 0!=opts.sensitivity?opts.sensitivity:3,this.dead=void 0!=opts.dead?opts.dead:.001,this.type=void 0!=opts.type?opts.type:AxisType.BUTTON,this.axis=void 0!=opts.axis?opts.axis:"x",this.index=void 0!=opts.index?opts.index:0,this.joyNum=void 0!=opts.joyNum?opts.joyNum:0,this.value=0,this._SYNC={}}var AxisType=Enums.AxisType;return Axis.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.name=this.name,json.value=this.value,json},Axis.prototype.fromSYNC=function(json){return this.name=json.name,this.value=json.value,this},Axis.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.negButton=this.negButton,json.posButton=this.posButton,json.altNegButton=this.altNegButton,json.altPosButton=this.altPosButton,json.gravity=this.gravity,json.sensitivity=this.sensitivity,json.dead=this.dead,json.type=this.type,json.axis=this.axis,json.index=this.index,json.joyNum=this.joyNum,json.value=this.value,json},Axis.prototype.fromJSON=function(json){return this.name=json.name,this.negButton=json.negButton,this.posButton=json.posButton,this.altNegButton=json.altNegButton,this.altPosButton=json.altPosButton,this.gravity=json.gravity,this.sensitivity=json.sensitivity,this.dead=json.dead,this.type=json.type,this.axis=json.axis,this.index=json.index,this.joyNum=json.joyNum,this.value=json.value,this},Axis}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/axes",["odin/core/enums","odin/core/input/axis","odin/core/game/log"],function(Enums,Axis,Log){function Axes(){Array.call(this),this.hash={},this._SYNC={},this.add({name:"horizontal",posButton:"right",negButton:"left",altPosButton:"d",altNegButton:"a",type:AxisType.Button}),this.add({name:"vertical",posButton:"up",negButton:"down",altPosButton:"w",altNegButton:"s",type:AxisType.Button}),this.add({name:"fire",posButton:"ctrl",negButton:"",altPosButton:"mouse0",altNegButton:"",type:AxisType.Button}),this.add({name:"jump",posButton:"space",negButton:"",altPosButton:"mouse2",altNegButton:"",type:AxisType.Button}),this.add({name:"mouseX",type:AxisType.Mouse,axis:"x"}),this.add({name:"mouseY",type:AxisType.Mouse,axis:"y"}),this.add({name:"touchX",type:AxisType.Touch,axis:"x"}),this.add({name:"touchY",type:AxisType.Touch,axis:"y"}),this.add({name:"mouseWheel",type:AxisType.MouseWheel})}var AxisType=Enums.AxisType;return Axes.prototype=Object.create(Array.prototype),Axes.prototype.constructor=Axes,Axes.prototype.add=function(name,opts){if("object"==typeof name&&(opts=name,name=opts.name),this.hash[name]){return Log.error("Axes.add: Axes already have Axis named "+name+' use Axes.get("'+name+'") and edit it instead'),void 0}opts||(opts={}),opts.name=name;var axis=new Axis(opts);return this.push(axis),this.hash[name]=axis,axis},Axes.prototype.get=function(name){return this.hash[name]},Axes.prototype.toSYNC=function(json){json||(json=this._SYNC);var i,jsonAxes=json.axes||(json.axes=[]);for(i=this.length;i--;){jsonAxes[i]=this[i].toSYNC(jsonAxes[i])}return json},Axes.prototype.fromSYNC=function(json){var axis,jsonAxis,i,axisHash=this.hash,jsonAxes=json.axes||(json.axes=[]);for(i=jsonAxes.length;i--;){jsonAxis=jsonAxes[i],(axis=axisHash[jsonAxis.name])?axis.fromSYNC(jsonAxis):this.add(jsonAxis.name).fromJSON(jsonAxis)}return this},Axes.prototype.toJSON=function(json){json||(json={});var i,jsonAxes=json.axes||(json.axes=[]);for(i=this.length;i--;){jsonAxes[i]=this[i].toJSON(jsonAxes[i])}return json},Axes.prototype.fromJSON=function(json){var axis,jsonAxis,i,axisHash=this.hash,jsonAxes=json.axes||(json.axes=[]);for(i=jsonAxes.length;i--;){jsonAxis=jsonAxes[i],(axis=axisHash[jsonAxis.name])?axis.fromJSON(jsonAxis):this.add(jsonAxis.name).fromJSON(jsonAxis)}return this},Axes}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/touch",["odin/math/vec2"],function(Vec2){function Touch(){this.id=-1,this.radiusX=0,this.radiusY=0,this.rotationAngle=0,this.force=0,this.delta=new Vec2,this.position=new Vec2,this._last=new Vec2,this._first=!1,this._SYNC={}}return Touch.prototype.clear=function(){return this.id=-1,this.position.set(0,0),this.delta.set(0,0),this._last.set(0,0),this.radiusX=0,this.radiusY=0,this.rotationAngle=0,this.force=0,this._first=!1,this},Touch.prototype.fromEvent=function(e){var position=this.position,delta=this.delta,last=this._last,first=this._first,element=e.target||e.srcElement,offsetX=element.offsetLeft,offsetY=element.offsetTop,x=(e.pageX||e.clientX)-offsetX,y=(e.pageY||e.clientY)-offsetY;return last.x=first?position.x:x,last.y=first?position.y:y,position.x=x,position.y=y,delta.x=position.x-last.x,delta.y=position.y-last.y,this.radiusX=e.radiusX||e.webkitRadiusX||e.mozRadiusX||e.oRadiusX||e.msRadiusX||1,this.radiusY=e.radiusY||e.webkitRadiusY||e.mozRadiusY||e.oRadiusY||e.msRadiusY||1,this.rotationAngle=e.rotationAngle||e.webkitRotationAngle||e.mozRotationAngle||e.oRotationAngle||e.msRotationAngle||0,this.force=e.force||e.webkitForce||e.mozForce||e.oForce||e.msForce||1,this._first=!0,this},Touch.prototype.toSYNC=function(json){return json||(json=this._SYNC),json.id=this.id,json.delta=this.delta.toJSON(json.delta),json.position=this.position.toJSON(json.position),json._last=this._last.toJSON(json._last),json._first=this._first,json},Touch.prototype.fromSYNC=function(json){return this.id=json.id,this.delta.fromJSON(json.delta),this.position.fromJSON(json.position),this._last.fromJSON(json._last),this._first=json._first,this},Touch.prototype.toJSON=function(json){return json||(json={}),json.id=this.id,json.delta=this.delta.toJSON(json.delta),json.position=this.position.toJSON(json.position),json._last=this._last.toJSON(json._last),json._first=this._first,json},Touch.prototype.fromJSON=function(json){return this.id=json.id,this.delta.fromJSON(json.delta),this.position.fromJSON(json.position),this._last.fromJSON(json._last),this._first=json._first,this},Touch}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/touches",["odin/base/object_pool","odin/core/input/touch"],function(ObjectPool,Touch){function Touches(){Array.call(this),this._SYNC={}}var TOUCH_POOL=new ObjectPool(Touch),OBJECT_POOL=new ObjectPool(Object);return Touches.prototype=Object.create(Array.prototype),Touches.prototype.constructor=Touches,Touches.TOUCH_POOL=TOUCH_POOL,Touches.prototype.start=function(index,targetTouch){var touch=TOUCH_POOL.create();return touch.clear(),touch.id=targetTouch.identifier,touch.fromEvent(targetTouch),this.push(touch),touch},Touches.prototype.end=function(index){var touch=this[index];return TOUCH_POOL.removeObject(touch),this.splice(index,1),touch},Touches.prototype.cancel=function(){return TOUCH_POOL.clear(),this.length=0,this},Touches.prototype.move=function(index,targetTouch){var touch=this[index];return touch.fromEvent(targetTouch),touch},Touches.prototype.toSYNC=function(json){json||(json=this._SYNC);var jsonTouches=json.touches||(json.touches=[]),i=this.length;for(jsonTouches.length=0,OBJECT_POOL.clear();i--;){jsonTouches[i]=this[i].toSYNC(OBJECT_POOL.create())}return json},Touches.prototype.fromSYNC=function(json){var jsonTouches=json.touches,i=jsonTouches.length;for(this.length=0,TOUCH_POOL.clear();i--;){this[i]=TOUCH_POOL.create().fromSYNC(jsonTouches[i])}return this},Touches.prototype.toJSON=function(json){json||(json={});var i,jsonTouches=json.touches||(json.touches=[]);for(i=this.length;i--;){jsonTouches[i]=this[i].toJSON(jsonTouches[i])}return json},Touches.prototype.fromJSON=function(json){var touch,i,j,tl,jsonTouches=json.touches;for(i=jsonTouches.length,tl=this.length,j=tl;i--;){tl>i&&(this.splice(j--,1),TOUCH_POOL.removeObject(this[j])),(touch=this[i])?touch.fromJSON(jsonTouches[i]):this[i]=TOUCH_POOL.create().fromJSON(jsonTouches[i])}return this},Touches}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/input",["odin/base/event_emitter","odin/base/object_pool","odin/base/time","odin/math/mathf","odin/math/vec2","odin/math/vec3","odin/core/enums","odin/core/input/buttons","odin/core/input/button","odin/core/input/axes","odin/core/input/axis","odin/core/input/touches"],function(EventEmitter,ObjectPool,Time,Mathf,Vec2,Vec3,Enums,Buttons,Button,Axes,Axis,Touches){function Input(){EventEmitter.call(this),this.axes=new Axes,this.buttons=new Buttons,this.mouseWheel=0,this.mousePosition=new Vec2,this.mouseDelta=new Vec2,this.mouseMoveNeedsUpdate=!1,this.touches=new Touches,this.touchesMoveNeedsUpdate=!1,this.acceleration=new Vec3,this.frameCount=0,this._frameCount=void 0,this.time=0,this._time=void 0,this._SYNC={}}var abs=Math.abs,sign=Mathf.sign,clamp=Mathf.clamp,AxisType=Enums.AxisType,MOUSE_BUTTONS={0:"mouse0",1:"mouse1",2:"mouse2"};return EventEmitter.extend(Input),Input.prototype.update=function(){var button,altButton,axis,value,type,touch,sensitivity,pos,neg,tmp,i,axes=this.axes,buttons=this.buttons.hash,dt=Time.delta;for(this.frameCount=this._frameCount?this._frameCount:Time.frameCount,this.time=this._time?this._time:Time.stamp(),this.mouseMoveNeedsUpdate=!0,this.touchesMoveNeedsUpdate=!0,i=axes.length;i--;){if(axis=axes[i],value=axis.value,type=axis.type,sensitivity=axis.sensitivity,type===AxisType.Button){button=buttons[axis.negButton],altButton=buttons[axis.altNegButton],neg=button&&button.value||altButton&&altButton.value,button=buttons[axis.posButton],altButton=buttons[axis.altPosButton],pos=button&&button.value||altButton&&altButton.value}else{if(type===AxisType.Mouse){axis.value=this.mouseDelta[axis.axis];continue}if(type===AxisType.Touch){if(touch=this.touches[axis.index],!touch){continue}axis.value=touch.delta[axis.axis]}else{type===AxisType.MouseWheel?value+=this.mouseWheel:type===AxisType.Joystick}}neg&&(value-=sensitivity*dt),pos&&(value+=sensitivity*dt),pos||neg||0===value||(tmp=abs(value),value-=clamp(sign(value)*axis.gravity*dt,-tmp,tmp)),value=clamp(value,-1,1),abs(value)<=axis.dead&&(value=0),axis.value=value}this.mouseWheel=0},Input.prototype.axis=function(name){var axis=this.axes.hash[name];return axis?axis.value:0},Input.prototype.mouseButton=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.value},Input.prototype.mouseButtonDown=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.value&&button.frameDown>=this.frameCount},Input.prototype.mouseButtonUp=function(id){var button=this.buttons.hash[MOUSE_BUTTONS[id]];return button&&button.frameUp>=this.frameCount},Input.prototype.anyKey=function(){var i,buttons=this.buttons;for(i=buttons.length;i--;){if(buttons[i].value){return!0}}return!1},Input.prototype.anyKeyDown=function(){var button,i,buttons=this.buttons;for(i=buttons.length;i--;){if((button=buttons[i]).value&&button.frameDown>=this.frameCount){return!0}}return!1},Input.prototype.key=function(name){var button=this.buttons.hash[name];return button&&button.value},Input.prototype.keyDown=function(name){var button=this.buttons.hash[name];return button&&button.value&&button.frameDown>=this.frameCount},Input.prototype.keyUp=function(name){var button=this.buttons.hash[name];return button&&button.frameUp>=this.frameCount},Input.prototype.toSYNC=function(json){return json||(json=this._SYNC),json._frameCount=Time.frameCount,json._time=Time.stamp(),json.buttons=this.buttons.toSYNC(json.buttons),json.mousePosition=this.mousePosition.toJSON(json.mousePosition),json.mouseDelta=this.mouseDelta.toJSON(json.mouseDelta),json.acceleration=this.acceleration.toJSON(json.acceleration),json.touches=this.touches.toSYNC(json.touches),json},Input.prototype.fromSYNC=function(json){return this._frameCount=json._frameCount,this._time=json._time,this.buttons.fromSYNC(json.buttons),this.mousePosition.fromJSON(json.mousePosition),this.mouseDelta.fromJSON(json.mouseDelta),this.acceleration.fromJSON(json.acceleration),this.touches.fromSYNC(json.touches),this},Input.prototype.toJSON=function(json){return json||(json={}),json.buttons=this.buttons.toJSON(json.buttons),json.axes=this.axes.toJSON(json.axes),json.mousePosition=this.mousePosition.toJSON(json.mousePosition),json.mouseDelta=this.mouseDelta.toJSON(json.mouseDelta),json.acceleration=this.acceleration.toJSON(json.acceleration),json.touches=this.touches.toJSON(json.touches),json},Input.prototype.fromJSON=function(json){return this.buttons.fromJSON(json.buttons),this.axes.fromJSON(json.axes),this.mousePosition.fromJSON(json.mousePosition),this.mouseDelta.fromJSON(json.mouseDelta),this.acceleration.fromJSON(json.acceleration),this.touches.fromJSON(json.touches),this},new Input}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/orbit_control",["odin/base/device","odin/math/mathf","odin/math/vec2","odin/math/vec3","odin/core/input/input","odin/core/components/component"],function(Device,Mathf,Vec2,Vec3,Input,Component){function OrbitControl(opts){opts||(opts={}),Component.call(this,"OrbitControl",opts),this.speed=opts.speed>EPSILON?opts.speed:1,this.zoomSpeed=opts.zoomSpeed>EPSILON?opts.zoomSpeed:2,this.allowZoom=void 0!=opts.allowZoom?!!opts.allowZoom:!0,this.allowPan=void 0!=opts.allowPan?!!opts.allowPan:!0,this.allowRotate=void 0!=opts.allowRotate?!!opts.allowRotate:!0,this.target=opts.target||new Vec3,this._offset=new Vec3,this._pan=new Vec3,this._scale=1,this._thetaDelta=0,this._phiDelta=0,this._state=NONE}var LEFT_MOUSE,MIDDLE_MOUSE,panOffset,pow=Math.pow,sqrt=Math.sqrt,sin=Math.sin,cos=Math.cos,tan=Math.tan,atan2=Math.atan2,min=Math.min,max=Math.max,PI=Math.PI,MIN_POLOR=0,MAX_POLOR=PI,degsToRads=Mathf.degsToRads,EPSILON=Mathf.EPSILON,NONE=1,ROTATE=2,PAN=3;return Component.extend(OrbitControl),OrbitControl.prototype.copy=function(){return this},OrbitControl.prototype.start=function(){return Device.mobile?(Input.on("touchstart",this.onTouchStart,this),Input.on("touchend",this.onTouchEnd,this),Input.on("touchmove",this.onTouchMove,this)):(Input.on("mouseup",this.onMouseUp,this),Input.on("mousedown",this.onMouseDown,this),Input.on("mousemove",this.onMouseMove,this),Input.on("mousewheel",this.onMouseWheel,this)),this.updateOrbit(),this},OrbitControl.prototype.clear=function(){return Component.prototype.clear.call(this),Device.mobile?(Input.on("touchstart",this.onTouchStart,this),Input.on("touchend",this.onTouchEnd,this),Input.on("touchmove",this.onTouchMove,this)):(Input.off("mouseup",this.onMouseUp,this),Input.off("mousedown",this.onMouseDown,this),Input.off("mousemove",this.onMouseMove,this),Input.off("mousewheel",this.onMouseWheel,this)),this},OrbitControl.prototype.onTouchStart=function(){var length=Input.touches.length;this._state=1===length?ROTATE:2===length&&this.allowPan?PAN:NONE},LEFT_MOUSE="mouse0",MIDDLE_MOUSE="mouse1",OrbitControl.prototype.onMouseDown=function(button){this._state=button===LEFT_MOUSE&&this.allowRotate?ROTATE:button===MIDDLE_MOUSE&&this.allowPan?PAN:NONE},OrbitControl.prototype.onTouchEnd=OrbitControl.prototype.onMouseUp=function(){this._state=NONE},OrbitControl.prototype.onTouchMove=function(){var camera,update=!1,touch=Input.touches[0],delta=touch.delta;this._state===ROTATE?(update=!0,camera=this.camera,this._thetaDelta+=2*PI*delta.x*camera.invWidth*this.speed,this._phiDelta-=2*PI*delta.y*camera.invHeight*this.speed):this._state===PAN&&(update=!0,this.pan(delta)),update&&this.updateOrbit()},OrbitControl.prototype.onMouseMove=function(){var camera,update=!1,mouseDelta=Input.mouseDelta;this._state===ROTATE?(update=!0,camera=this.camera,this._thetaDelta+=2*PI*mouseDelta.x*camera.invWidth*this.speed,this._phiDelta-=2*PI*mouseDelta.y*camera.invHeight*this.speed):this._state===PAN&&(update=!0,this.pan(mouseDelta)),update&&this.updateOrbit()},OrbitControl.prototype.onMouseWheel=function(mouseWheel){if(this.allowZoom){var update=!1;mouseWheel>0?(update=!0,this._scale*=pow(.95,this.zoomSpeed)):(update=!0,this._scale/=pow(.95,this.zoomSpeed)),update&&this.updateOrbit()}},OrbitControl.prototype.clear=function(){return Component.prototype.clear.call(this),this},panOffset=new Vec3,OrbitControl.prototype.pan=function(delta){var targetDistance,pan=this._pan,camera=this.camera,transform=this.transform,te=transform.matrixWorld.elements,position=transform.position;panOffset.vsub(position,this.target),targetDistance=panOffset.length(),camera.orthographic?(targetDistance*=.5*camera.orthographicSize,panOffset.set(te[0],te[1],te[2]).smul(-2*delta.x*targetDistance*camera.invWidth),pan.add(panOffset),panOffset.set(te[4],te[5],te[6]).smul(2*delta.y*targetDistance*camera.invHeight),pan.add(panOffset)):(targetDistance*=tan(degsToRads(.5*camera.fov)),panOffset.set(te[0],te[1],te[2]).smul(-2*delta.x*targetDistance*camera.invWidth),pan.add(panOffset),panOffset.set(te[4],te[5],te[6]).smul(2*delta.y*targetDistance*camera.invHeight),pan.add(panOffset))},OrbitControl.prototype.updateOrbit=function(){var theta,phi,radius,transform=this.transform,position=transform.position,target=this.target,offset=this._offset,pan=this._pan;offset.vsub(position,target),theta=atan2(offset.x,offset.y),phi=atan2(sqrt(offset.x*offset.x+offset.y*offset.y),offset.z),theta+=this._thetaDelta,phi+=this._phiDelta,phi=max(MIN_POLOR,min(MAX_POLOR,phi)),phi=max(EPSILON,min(PI-EPSILON,phi)),radius=offset.length()*this._scale,target.add(pan),offset.x=radius*sin(phi)*sin(theta),offset.y=radius*sin(phi)*cos(theta),offset.z=radius*cos(phi),position.vadd(target,offset),transform.lookAt(target),this._scale=1,this._thetaDelta=0,this._phiDelta=0,pan.set(0,0,0)},OrbitControl.prototype.setTarget=function(target){this.target.copy(target),this.transform.lookAt(this.target)},OrbitControl}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/rigid_body_2d",["odin/base/class","odin/math/vec2","odin/math/vec3","odin/core/components/component","odin/phys2d/phys2d"],function(Class,Vec2,Vec3,Component,Phys2D){function RigidBody2D(opts){opts||(opts={}),Component.call(this,"RigidBody2D",opts),this.body=new Phys2D.P2Rigidbody(opts)}function onCollide(body,si,sj){body.userData&&this.emit("collide",body.userData,body,si,sj)}function onColliding(body,si,sj){body.userData&&this.emit("colliding",body.userData,body,si,sj)}Class.extend(RigidBody2D,Component),RigidBody2D.prototype.copy=function(other){return this.body.off("collide",onCollide,this),this.body.off("colliding",onColliding,this),this.body=other.body.clone(),this.body.on("collide",onCollide,this),this.body.on("colliding",onColliding,this),this},RigidBody2D.prototype.clear=function(){Component.prototype.clear.call(this),this.body.off("collide",onCollide,this),this.body.off("colliding",onColliding,this),this.body.userData=void 0},RigidBody2D.prototype.start=function(){var body=this.body,gameObject=this.gameObject,transform=gameObject.transform,transform2d=gameObject.transform2d;transform?(body.position.copy(transform.position),body.rotation=transform.rotation.rotationZ()):(body.position.copy(transform2d.position),body.rotation=transform2d.rotation),body.init(),body.userData=this,body.on("collide",onCollide,this),body.on("colliding",onColliding,this)};var zAxis=new Vec3(0,0,1);return RigidBody2D.prototype.update=function(){var body=this.body,gameObject=this.gameObject,transform=gameObject.transform,transform2d=gameObject.transform2d;transform?(transform.position.copy(body.position),transform.rotation.fromAxisAngle(zAxis,body.rotation)):(transform2d.position.copy(body.position),transform2d.rotation=body.rotation)},RigidBody2D.prototype.applyForce=function(force,worldPoint){this.body.applyForce(force,worldPoint)},RigidBody2D.prototype.applyTorque=function(torque){this.body.applyTorque(torque)},RigidBody2D.prototype.applyImpulse=function(impulse,worldPoint){this.body.applyImpulse(impulse,worldPoint)},RigidBody2D.prototype.applyVelocity=function(velocity){this.body.applyVelocity(velocity)},RigidBody2D.prototype.applyAngularVelocity=function(angularVelocity){this.body.applyAngularVelocity(angularVelocity)},RigidBody2D.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.body=this.body.toJSON(json.body),json},RigidBody2D.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.body.fromJSON(json.body),this},RigidBody2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/sprite",["odin/core/enums","odin/core/components/component","odin/core/assets/assets"],function(Enums,Component,Assets){function Sprite(opts){opts||(opts={}),Component.call(this,"Sprite",opts),this.visible=void 0!=opts.visible?!!opts.visible:!0,this.blending=void 0!=opts.blending?opts.blending:Enums.Blending.Default,this.z=void 0!=opts.z?opts.z:0,this.alpha=void 0!=opts.alpha?opts.alpha:1,this.material=void 0!=opts.material?opts.material:void 0,this.width=opts.width||1,this.height=opts.height||1,this.x=opts.x||0,this.y=opts.y||0,this.w=opts.w||1,this.h=opts.h||1,this._webglInitted=!1}return Component.extend(Sprite),Sprite.prototype.copy=function(other){return this.visible=other.visible,this.blending=other.blending,this.z=other.z,this.alpha=other.alpha,this.material=other.material,this.width=other.width,this.height=other.height,this.x=other.x,this.y=other.y,this.w=other.w,this.h=other.h,this._webglInitted=!1,this},Sprite.prototype.clear=function(){return Component.prototype.clear.call(this),this.material=void 0,this._webglInitted=!1,this},Sprite.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.visible=this.visible,json.blending=this.blending,json.z=this.z,json.alpha=this.alpha,json.material=this.material?this.material.name:void 0,json.width=this.width,json.height=this.height,json.x=this.x,json.y=this.y,json.w=this.w,json.h=this.h,json},Sprite.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.visible=json.visible,this.blending=json.blending,this.z=json.z,this.alpha=json.alpha,this.material=json.material?Assets.get(json.material):void 0,this.width=json.width,this.height=json.height,this.x=json.x,this.y=json.y,this.w=json.w,this.h=json.h,this._webglInitted=!1,this},Sprite.prototype.sort=function(a,b){return b.z-a.z},Sprite}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/sprite_animation",["odin/base/time","odin/core/assets/assets","odin/core/components/component","odin/core/enums"],function(Time,Assets,Component,Enums){function SpriteAnimation(opts){opts||(opts={}),Component.call(this,"SpriteAnimation",opts),this.sheet=void 0!=opts.sheet?opts.sheet:void 0,this.current=void 0!=opts.current?opts.current:"idle",this.mode=void 0!=opts.mode?opts.mode:WrapMode.Loop,this.rate=void 0!=opts.rate?opts.rate:1/24,this._time=0,this._frame=0,this._order=1,this.playing=this.sheet?!0:!1}var abs=Math.abs,WrapMode=Enums.WrapMode;return Component.extend(SpriteAnimation),SpriteAnimation.prototype.copy=function(other){return this.sheet=other.sheet,this.current=other.current,this.mode=other.mode,this.rate=other.rate,this._time=other._time,this._frame=other._frame,this._order=other._order,this.playing=other.playing,this
},SpriteAnimation.prototype.clear=function(){return Component.prototype.clear.call(this),this.sheet=void 0,this},SpriteAnimation.prototype.play=function(name,mode,rate){return this.sheet?this.playing&&this.current===name||!this.sheet[name]?this:(this.current=name,this.rate=void 0!=rate?rate:rate=this.rate,this.mode=mode||(mode=this.mode),this._frame=0,this._order=1,this._time=0,this.playing=!0,this.emit("play",name,mode,rate),this):this},SpriteAnimation.prototype.stop=function(){return this.playing&&this.emit("stop"),this.playing=!1,this._frame=0,this._order=1,this._time=0,this},SpriteAnimation.prototype.update=function(){if(this.playing){var rate,dt,count,length,order,frame,mode,animation,sprite=this.sprite,sheet=this.sheet,current=sheet[this.current];sprite&&sheet&&current&&(rate=this.rate,dt=Time.delta,order=this._order,frame=this._frame,mode=this.mode,!rate||1/0===rate||0>rate?frame=abs(frame)%current.length:(this._time+=dt,count=this._time/rate,count>=1&&(this._time=0,length=current.length,frame+=order*(0|count),mode===WrapMode.Loop?frame%=length:mode===WrapMode.Once?order>0?frame>=length&&(frame=length-1,this.stop()):0>frame&&(frame=0,this.stop()):mode===WrapMode.PingPong?order>0?frame>=length&&(this._order=-1,frame=length-1):0>frame&&(this._order=1,frame=0):mode===WrapMode.Clamp&&(order>0?frame>=length&&(frame=length-1):0>frame&&(frame=0)))),animation=current[frame],sprite.x=animation[0],sprite.y=animation[1],sprite.w=animation[2],sprite.h=animation[3],this._frame=frame)}},SpriteAnimation.prototype.toJSON=function(json){return json=Component.prototype.toJSON.call(this,json),json.sheet=this.sheet?this.sheet.name:void 0,json.current=this.current,json.mode=this.mode,json.rate=this.rate,json._time=this._time,json._frame=this._frame,json._order=this._order,json.playing=this.playing,json},SpriteAnimation.prototype.fromJSON=function(json){return Component.prototype.fromJSON.call(this,json),this.sheet=json.sheet?Assets.get(json.sheet):void 0,this.current=json.current,this.mode=json.mode,this.rate=json.rate,this._time=json._time,this._frame=json._frame,this._order=json._order,this.playing=json.playing,this},SpriteAnimation}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat3",["odin/math/mathf"],function(Mathf){function Mat3(m11,m12,m13,m21,m22,m23,m31,m32,m33){var te=new Float32Array(9);this.elements=te,te[0]=void 0!=m11?m11:1,te[3]=m12||0,te[6]=m13||0,te[1]=m21||0,te[4]=void 0!=m22?m22:1,te[7]=m23||0,te[2]=m31||0,te[5]=m32||0,te[8]=void 0!=m33?m33:1}var cos=Math.cos,sin=Math.sin;return Mathf._classes.Mat3=Mat3,Mat3.prototype.clone=function(){var te=this.elements;return new Mat3(te[0],te[3],te[6],te[1],te[4],te[7],te[2],te[5],te[8])},Mat3.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this},Mat3.prototype.set=function(m11,m12,m13,m21,m22,m23,m31,m32,m33){var te=this.elements;return te[0]=m11,te[3]=m12,te[6]=m13,te[1]=m21,te[4]=m22,te[7]=m23,te[2]=m31,te[5]=m32,te[8]=m33,this},Mat3.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return ae[0]=a11*b11+a21*b12+a31*b13,ae[3]=a12*b11+a22*b12+a32*b13,ae[6]=a13*b11+a23*b12+a33*b13,ae[1]=a11*b21+a21*b22+a31*b23,ae[4]=a12*b21+a22*b22+a32*b23,ae[7]=a13*b21+a23*b22+a33*b23,ae[2]=a11*b31+a21*b32+a31*b33,ae[5]=a12*b31+a22*b32+a32*b33,ae[8]=a13*b31+a23*b32+a33*b33,this},Mat3.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return te[0]=a11*b11+a21*b12+a31*b13,te[3]=a12*b11+a22*b12+a32*b13,te[6]=a13*b11+a23*b12+a33*b13,te[1]=a11*b21+a21*b22+a31*b23,te[4]=a12*b21+a22*b22+a32*b23,te[7]=a13*b21+a23*b22+a33*b23,te[2]=a11*b31+a21*b32+a31*b33,te[5]=a12*b31+a22*b32+a32*b33,te[8]=a13*b31+a23*b32+a33*b33,this},Mat3.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,this},Mat3.prototype.sdiv=function(s){var te=this.elements;return s=0===s?0:1/s,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,te[4]*=s,te[5]*=s,te[6]*=s,te[7]*=s,te[8]*=s,this},Mat3.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=0,te[4]=1,te[5]=0,te[6]=0,te[7]=0,te[8]=1,this},Mat3.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=0,te[6]=0,te[7]=0,te[8]=0,this},Mat3.prototype.determinant=function(){var te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},Mat3.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[3],m13=te[6],m21=te[1],m22=te[4],m23=te[7],m31=te[2],m32=te[5],m33=te[8],m0=m22*m33-m23*m32,m3=m13*m32-m12*m33,m6=m12*m23-m13*m22,det=m11*m0+m21*m3+m31*m6;return det=0!==det?1/det:1,te[0]=m0*det,te[1]=(m23*m31-m21*m33)*det,te[2]=(m21*m32-m22*m31)*det,te[3]=m3*det,te[4]=(m11*m33-m13*m31)*det,te[5]=(m12*m31-m11*m32)*det,te[6]=m6*det,te[7]=(m13*m21-m11*m23)*det,te[8]=(m11*m22-m12*m21)*det,this},Mat3.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[3],m13=me[6],m21=me[1],m22=me[4],m23=me[7],m31=me[2],m32=me[5],m33=me[8],m0=m22*m33-m23*m32,m3=m13*m32-m12*m33,m6=m12*m23-m13*m22,det=m11*m0+m21*m3+m31*m6;return det=0===det?0:1/det,te[0]=m0*det,te[1]=(m23*m31-m21*m33)*det,te[2]=(m21*m32-m22*m31)*det,te[3]=m3*det,te[4]=(m11*m33-m13*m31)*det,te[5]=(m12*m31-m11*m32)*det,te[6]=m6*det,te[7]=(m13*m21-m11*m23)*det,te[8]=(m11*m22-m12*m21)*det,this},Mat3.prototype.inverseMat4=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[4],m13=me[8],m21=me[1],m22=me[5],m23=me[9],m31=me[2],m32=me[6],m33=me[10],m0=m22*m33-m23*m32,m3=m13*m32-m12*m33,m6=m12*m23-m13*m22,det=m11*m0+m21*m3+m31*m6;return det=0===det?0:1/det,te[0]=m0*det,te[1]=(m23*m31-m21*m33)*det,te[2]=(m21*m32-m22*m31)*det,te[3]=m3*det,te[4]=(m11*m33-m13*m31)*det,te[5]=(m12*m31-m11*m32)*det,te[6]=m6*det,te[7]=(m13*m21-m11*m23)*det,te[8]=(m11*m22-m12*m21)*det,this},Mat3.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[3],te[3]=tmp,tmp=te[2],te[2]=te[6],te[6]=tmp,tmp=te[5],te[5]=te[7],te[7]=tmp,this},Mat3.prototype.setTrace=function(v){var te=this.elements;return te[0]=v.x,te[4]=v.y,te[8]=v.z,this},Mat3.prototype.scale=function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[3]*=y,te[6]*=z,te[1]*=x,te[4]*=y,te[7]*=z,te[2]*=x,te[5]*=y,te[8]*=z,this},Mat3.prototype.makeScale=function(x,y,z){return this.set(x,0,0,0,y,0,0,0,z)},Mat3.prototype.makeRotationX=function(angle){var c=cos(angle),s=sin(angle);return this.set(1,0,0,0,c,-s,0,s,c)},Mat3.prototype.makeRotationY=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,0,s,0,1,0,-s,0,c)},Mat3.prototype.makeRotationZ=function(angle){var c=cos(angle),s=sin(angle);return this.set(c,-s,0,s,c,0,0,0,1)},Mat3.prototype.fromMat2=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=0,te[3]=me[2],te[4]=me[3],te[5]=0,te[6]=0,te[7]=0,te[8]=1,this},Mat3.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[4],te[4]=me[5],te[5]=me[6],te[6]=me[8],te[7]=me[9],te[8]=me[10],this},Mat3.prototype.fromQuat=function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[1]=xy+wz,te[2]=xz-wy,te[3]=xy-wz,te[4]=1-(xx+zz),te[5]=yz+wx,te[6]=xz+wy,te[7]=yz-wx,te[8]=1-(xx+yy),this},Mat3.prototype.equals=function(other){var ae=this.elements,be=other.elements;return!(ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5]||ae[6]!==be[6]||ae[7]!==be[7]||ae[8]!==be[8])},Mat3.prototype.notEquals=function(other){var ae=this.elements,be=other.elements;return ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]||ae[4]!==be[4]||ae[5]!==be[5]||ae[6]!==be[6]||ae[7]!==be[7]||ae[8]!==be[8]},Mat3.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this},Mat3.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return json._className="Mat3",je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],je[4]=te[4],je[5]=te[5],je[6]=te[6],je[7]=te[7],je[8]=te[8],json},Mat3.prototype.fromArray=function(array){var te=this.elements;return te[0]=array[0],te[1]=array[1],te[2]=array[2],te[3]=array[3],te[4]=array[4],te[5]=array[5],te[6]=array[6],te[7]=array[7],te[8]=array[8],this},Mat3.prototype.toArray=function(array){array||(array=[]);var te=this.elements;return array[0]=te[0],array[1]=te[1],array[2]=te[2],array[3]=te[3],array[4]=te[4],array[5]=te[5],array[6]=te[6],array[7]=te[7],array[8]=te[8],array},Mat3.prototype.toString=function(){var te=this.elements;return"Mat3["+te[0]+", "+te[3]+", "+te[6]+"]\n     ["+te[1]+", "+te[4]+", "+te[7]+"]\n     ["+te[2]+", "+te[5]+", "+te[8]+"]"},Mat3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/transform",["odin/math/mathf","odin/math/vec3","odin/math/quat","odin/math/mat3","odin/math/mat4","odin/core/components/component","odin/core/game/log"],function(Mathf,Vec3,Quat,Mat3,Mat4,Component,Log){function Transform(opts){opts||(opts={}),opts.sync=void 0!=opts.sync?opts.sync:!0,Component.call(this,"Transform",opts),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=opts.position?opts.position:new Vec3,this.rotation=void 0!=opts.rotation?opts.rotation:new Quat,this.scale=void 0!=opts.scale?opts.scale:new Vec3(1,1,1),this.matrix=new Mat4,this.matrixWorld=new Mat4,this.modelView=new Mat4,this.normalMatrix=new Mat3}function updateDepth(transform,depth){var children=transform.children,i=children.length;for(transform.depth=depth;i--;){updateDepth(children[i],depth+1)}}var EPSILON=Mathf.EPSILON;return Component.extend(Transform),Transform.order=-999999,Transform.prototype.copy=function(other){var children=other.children,i=children.length;for(this.position.copy(other.position),this.scale.copy(other.scale),this.rotation.copy(other.rotation);i--;){this.addChild(children[i].gameObject.clone().transform)}return other.parent&&other.parent.addChild(this),this},Transform.prototype.clear=function(){Component.prototype.clear.call(this);for(var children=this.children,i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0,0),this.scale.set(1,1,1),this.rotation.set(0,0,0,1),this.root=this,this.depth=0,this},Transform.prototype.translate=function(){var vec=new Vec3;return function(translation,relativeTo){return vec.copy(translation),relativeTo instanceof Transform?vec.transformQuat(relativeTo.rotation):relativeTo instanceof Quat&&vec.transformQuat(relativeTo),this.position.add(vec),this}}(),Transform.prototype.rotate=function(){var vec=new Vec3;return function(rotation,relativeTo){return vec.copy(rotation),relativeTo instanceof Transform?vec.transformQuat(relativeTo.rotation):relativeTo instanceof Quat&&vec.transformQuat(relativeTo),this.rotation.rotate(vec.x,vec.y,vec.z),this}}(),Transform.prototype.lookAt=function(){var mat=new Mat4,vec=new Vec3,dup=new Vec3(0,0,1);return function(target,up){return up=up||dup,target instanceof Transform?vec.set(0,0,0).transformMat4(target.matrixWorld):vec.copy(target),mat.lookAt(this.position,vec,up),this.rotation.fromMat4(mat),this}}(),Transform.prototype.follow=function(){var target=new Vec3,position=new Vec3,delta=new Vec3;return function(transform,speed){return position.set(0,0,0).transformMat4(this.matrixWorld),target.set(0,0,0).transformMat4(transform.matrixWorld),delta.vsub(target,position),delta.lengthSq()>EPSILON&&this.position.add(delta.smul(speed)),this}}(),Transform.prototype.addChild=function(child,others){if(!(child instanceof Transform)){return Log.error("Transform.add: can't add passed argument, it is not an instance of Transform"),this}var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.removeChild(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform.sort(this.sort)}else{Log.error("Transform.add: child is not a member of this Transform")}return this},Transform.prototype.addChildren=function(){for(var scene,i=arguments.length;i--;){this.addChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform.sort(this.sort),this},Transform.prototype.removeChild=function(child,others){var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform.sort(this.sort)}else{Log.error("Transform.remove: child is not a member of this Transform")}return this},Transform.prototype.removeChildren=function(){for(var scene,i=arguments.length;i--;){this.removeChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform.sort(this.sort),this},Transform.prototype.detachChildren=function(){for(var children=this.children,i=children.length;i--;){this.removeChild(children[i])}return this},Transform.prototype.hasChild=function(child){return!!~this.children.indexOf(child)},Transform.prototype.find=function(name){for(var child,children=this.children,i=children.length;i--;){if(child=children[i],child.gameObject.name===name){return child.gameObject}if(child=child.find(name)){return child}}return void 0},Transform.prototype.toWorld=function(v){return v.transformMat4(this.matrixWorld)},Transform.prototype.toLocal=function(){var mat=new Mat4;return function(v){return v.transformMat4(mat.inverseMat(this.matrixWorld))}}(),Transform.prototype.update=function(){var matrix=this.matrix,parent=this.parent;matrix.compose(this.position,this.scale,this.rotation),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix)},Transform.prototype.updateMatrices=function(viewMatrix){this.modelView.mmul(viewMatrix,this.matrixWorld),this.normalMatrix.inverseMat4(this.modelView).transpose()},Transform.prototype.sort=function(a,b){return b.depth-a.depth},Transform.prototype.toJSON=function(json){json=Component.prototype.toJSON.call(this,json);for(var children=this.children,jsonChildren=json.children||(json.children=[]),i=children.length;i--;){jsonChildren[i]=children[i]._id}return json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation.toJSON(json.rotation),json},Transform.prototype.fromJSON=function(json){Component.prototype.fromJSON.call(this,json);var child,scene,children=json.children,i=children.length;if(this.gameObject&&(scene=this.gameObject.scene)){for(;i--;){child=scene.findComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}}else{this.once("start",function(){for(var scene=this.gameObject.scene;i--;){child=scene.findComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}})}return this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation.fromJSON(json.rotation),this},Transform}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/components/transform_2d",["odin/math/mathf","odin/math/vec2","odin/math/mat32","odin/math/mat3","odin/math/mat4","odin/core/components/component","odin/core/game/config","odin/core/game/log"],function(Mathf,Vec2,Mat32,Mat3,Mat4,Component,Config,Log){function Transform2D(opts){opts||(opts={}),opts.sync=void 0!=opts.sync?opts.sync:!0,Component.call(this,"Transform2D",opts),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=opts.position?opts.position:new Vec2,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.scale=void 0!=opts.scale?opts.scale:new Vec2(1,1),this.matrix=new Mat4,this.matrixWorld=new Mat4,this.modelView=new Mat4,this.normalMatrix=new Mat3}function updateDepth(transform,depth){var children=transform.children,i=children.length;for(transform.depth=depth;i--;){updateDepth(children[i],depth+1)}}var EPSILON=Mathf.EPSILON;return Component.extend(Transform2D),Transform2D.order=-999999,Transform2D.prototype.copy=function(other){var children=other.children,i=children.length;for(this.position.copy(other.position),this.scale.copy(other.scale),this.rotation=other.rotation;i--;){this.addChild(children[i].gameObject.clone().transform)}return other.parent&&other.parent.addChild(this),this},Transform2D.prototype.clear=function(){Component.prototype.clear.call(this);for(var children=this.children,i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0),this.scale.set(1,1),this.rotation=0,this.root=this,this.depth=0,this},Transform2D.prototype.translate=function(){var vec=new Vec2;return function(translation,relativeTo){return vec.copy(translation),relativeTo instanceof Transform2D?vec.transformAngle(relativeTo.rotation):relativeTo&&vec.transformAngle(relativeTo),this.position.add(vec),this}}(),Transform2D.prototype.rotate=function(rotation,relativeTo){return relativeTo instanceof Transform2D?rotation+=relativeTo.rotation:relativeTo&&(rotation+=relativeTo),this.rotation+=rotation,this},Transform2D.prototype.lookAt=function(){var mat=new Mat32,vec=new Vec2;return function(target){return target instanceof Transform2D?vec.copy(target.position):vec.copy(target),mat.lookAt(this.position,vec),this.rotation=mat.getRotation(),this}}(),Transform2D.prototype.follow=function(){var target=new Vec2,position=new Vec2,delta=new Vec2;return function(transform,speed){return position.set(0,0).transformMat4(this.matrixWorld),target.set(0,0).transformMat4(transform.matrixWorld),delta.vsub(target,position),delta.lengthSq()>EPSILON&&this.position.add(delta.smul(speed)),this}}(),Transform2D.prototype.addChild=function(child,others){if(!(child instanceof Transform2D)){return Log.error("Transform2D.add: can't add passed argument, it is not an instance of Transform2D"),this}var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.remove(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform2D.sort(this.sort)}else{Log.error("Transform2D.add: child is not a member of this Transform2D")}return this},Transform2D.prototype.addChildren=function(){for(var scene,i=arguments.length;i--;){this.addChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform2D.sort(this.sort),this},Transform2D.prototype.removeChild=function(child,others){var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform2D.sort(this.sort)}else{Log.error("Transform2D.remove: child is not a member of this Transform2D")}return this},Transform2D.prototype.removeChildren=function(){for(var scene,i=arguments.length;i--;){this.removeChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.Transform2D.sort(this.sort),this},Transform2D.prototype.detachChildren=function(){for(var i=arguments.length;i--;){this.removeChild(children[i])}return this},Transform2D.prototype.hasChild=function(child){return!!~this.children.indexOf(child)},Transform2D.prototype.find=function(name){for(var child,children=this.children,i=children.length;i--;){if(child=children[i],child.gameObject.name===name){return child}if(child=child.find(name)){return child}}return void 0},Transform2D.prototype.toWorld=function(v){return v.transformMat4(this.matrixWorld)},Transform2D.prototype.toLocal=function(){var mat=new Mat4;return function(v){return v.transformMat4(mat.inverseMat(this.matrixWorld))}}(),Transform2D.prototype.update=function(){var mat=new Mat32;return function(){var matrix=this.matrix,parent=this.parent;matrix.fromMat32(mat.compose(this.position,this.scale,this.rotation)),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix)}}(),Transform2D.prototype.updateMatrices=function(viewMatrix){this.modelView.mmul(viewMatrix,this.matrixWorld),this.normalMatrix.inverseMat4(this.modelView).transpose()},Transform2D.prototype.sort=function(a,b){return b.depth-a.depth},Transform2D.prototype.toJSON=function(json){json=Component.prototype.toJSON.call(this,json);for(var children=this.children,jsonChildren=json.children||(json.children=[]),i=children.length;i--;){jsonChildren[i]=children[i]._id}return json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation,json},Transform2D.prototype.fromJSON=function(json){Component.prototype.fromJSON.call(this,json);var child,scene,children=json.children,i=children.length;if(this.gameObject&&(scene=this.gameObject.scene)){for(;i--;){child=scene.findComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}}else{this.once("start",function(){for(var scene=this.gameObject.scene;i--;){child=scene.findComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}})}return this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation=json.rotation,this},Transform2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/loop",["odin/base/request_animation_frame","odin/core/game/log"],function(requestAnimationFrame,Log){function Loop(callback,ctx){ctx||(ctx=this),this.paused=!0,this.callback=callback,this.ctx=ctx||this;var self=this;this._run=function(ms){self.callback&&(self.callback.call(ctx,ms),self.paused||self._pump())}}return Loop.prototype.resume=function(){return this.callback?(this.paused=!1,this._pump(),void 0):(Log.warn("Loop.resume: can't run loop without callback"),void 0)},Loop.prototype.pause=function(){this.paused=!0},Loop.prototype.isRunning=function(){return!this.paused},Loop.prototype.isPaused=function(){return this.paused},Loop.prototype._pump=function(){requestAnimationFrame(this._run)},Loop}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/world/world",["odin/base/class","odin/math/color"],function(Class,Color){function World(opts){opts||(opts={}),Class.call(this),this.scene=void 0,this.ambient=void 0!=opts.ambient?opts.ambient:new Color}return Class.extend(World),World.prototype.init=function(){},World.prototype.start=function(){},World.prototype.update=function(){},World.prototype.clear=function(){return this},World.prototype.destroy=function(){return this.scene?(this.scene.removeWorld(),this.emit("destroy"),this.clear(),this):(Log.error("World.destroy: can't destroy World if it's not set to a Scene"),this)},World.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.ambient=this.ambient.toJSON(json.ambient),json},World.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.ambient.fromJSON(json.ambient),this},World}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/scene",["odin/base/class","odin/core/game_object","odin/core/world/world","odin/core/game/log"],function(Class,GameObject,World,Log){function Scene(opts){opts||(opts={}),Class.call(this),this.game=void 0,this.name=void 0!=opts.name?opts.name:"Scene_"+this._id,this.world=void 0,this.gameObjects=[],this._gameObjectHash={},this._gameObjectJSONHash={},this.components={},this._componentTypes=[],this._componentHash={},this._componentJSONHash={},this.setWorld(opts.world instanceof World?opts.world:new World(opts.world)),opts.gameObjects&&this.addGameObjects.apply(this,opts.gameObjects)}function sortComponentTypes(a,b){return(b[0].constructor.order||0)-(a[0].constructor.order||0)}return Class.extend(Scene),Scene.prototype.copy=function(other){var otherGameObjects=other.gameObjects,i=otherGameObjects.length;for(this.clear(),this.name=other.name+"."+this._id;i--;){this.addGameObject(otherGameObjects[i].clone())}return this},Scene.prototype.init=function(){var gameObjects=this.gameObjects,componentTypes=this._componentTypes,i=componentTypes.length;for(this.world&&this.world.init(),i=gameObjects.length;i--;){gameObjects[i].emit("init")}},Scene.prototype.start=function(){var components,component,i,j,types=this._componentTypes,gameObjects=this.gameObjects;for(this.world&&this.world.start(),i=types.length;i--;){for(components=types[i],j=components.length;j--;){component=components[j],component.start(),component.emit("start")}}for(i=gameObjects.length;i--;){gameObjects[i].emit("start")}},Scene.prototype.update=function(){var components,i,j,types=this._componentTypes,gameObjects=this.gameObjects;for(this.world&&this.world.update(),i=types.length;i--;){for(components=types[i],j=components.length;j--;){components[j].update()}}for(i=gameObjects.length;i--;){gameObjects[i].emit("update")}},Scene.prototype.clear=function(){var gameObjects=this.gameObjects,i=gameObjects.length;for(this.world=void 0;i--;){this.removeGameObject(gameObjects[i],!0)}return this.off(),this},Scene.prototype.destroy=function(){return this.emit("destroy"),this.clear(),this},Scene.prototype.setWorld=function(world){return this.world&&this.removeWorld(),world.scene=this,this.world=world,this.game&&world.init(),this},Scene.prototype.removeWorld=function(){if(!this.world){return this}var world=this.world;return world.scene=void 0,this.world=void 0,this},Scene.prototype.addGameObject=function(gameObject){if(!(gameObject instanceof GameObject)){return Log.error("Scene.addGameObject: can't add argument to Scene, it's not an instance of GameObject"),this}var components,transform,children,child,i,gameObjects=this.gameObjects,index=gameObjects.indexOf(gameObject);if(-1===index){for(gameObject.scene&&gameObject.scene.removeGameObject(gameObject),gameObjects.push(gameObject),this._gameObjectHash[gameObject._id]=gameObject,-1!==gameObject._jsonId&&(this._gameObjectJSONHash[gameObject._jsonId]=gameObject),gameObject.scene=this,components=gameObject.components,i=components.length;i--;){this._addComponent(components[i])}if(transform=gameObject.transform||gameObject.transform2d){for(i=(children=transform.children).length;i--;){(child=children[i].gameObject)&&!this.hasGameObject(child)&&this.addGameObject(child)}}this.game&&gameObject.emit("init"),this.emit("addGameObject",gameObject)}else{Log.error("Scene.addGameObject: GameObject is already a member of Scene")}return this},Scene.prototype.addGameObjects=function(){for(var i=arguments.length;i--;){this.addGameObject(arguments[i])}return this},Scene.prototype._addComponent=function(component){if(component){var type=component._type,components=this.components,isNew=!components[type],types=components[type]||(components[type]=[]),componentTypes=this._componentTypes;this._componentHash[component._id]=component,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=component),types.push(component),isNew&&(componentTypes.push(types),componentTypes.sort(sortComponentTypes)),types.sort(component.sort),this.emit("add"+type,component),this.emit("addComponent",component),this.game&&(component.start(),component.emit("start"))}},Scene.prototype.removeGameObject=function(gameObject,clear){if(!(gameObject instanceof GameObject)){return Log.error("Scene.removeGameObject: can't remove argument from Scene, it's not an instance of GameObject"),this}var components,transform,children,child,i,gameObjects=this.gameObjects,index=gameObjects.indexOf(gameObject);if(-1!==index){for(gameObjects.splice(index,1),this._gameObjectHash[gameObject._id]=void 0,-1!==gameObject._jsonId&&(this._gameObjectJSONHash[gameObject._jsonId]=void 0),gameObject.scene=void 0,components=gameObject.components,i=components.length;i--;){this._removeComponent(components[i],clear)}if(transform=gameObject.transform||gameObject.transform2d){for(i=(children=transform.children).length;i--;){(child=children[i].gameObject)&&this.hasGameObject(child)&&this.removeGameObject(child)}}this.emit("removeGameObject",gameObject),gameObject.emit("remove",gameObject),clear&&gameObject.clear()}else{Log.error("Scene.removeGameObject: GameObject is not a member of Scene")}return this},Scene.prototype.removeGameObjects=function(){for(var i=arguments.length;i--;){this.removeGameObject(arguments[i])}return this},Scene.prototype._removeComponent=function(component,clear){if(component){var type=component._type,components=this.components,types=components[type],index=types.indexOf(component);this._componentHash[component._id]=void 0,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=void 0),types.splice(index,1),types.sort(component.sort),this.emit("remove"+type,component),this.emit("removeComponent",component),clear&&component.clear()}},Scene.prototype.hasGameObject=function(gameObject){return!!~this.gameObjects.indexOf(gameObject)},Scene.prototype.findByTag=function(tag,out){out||(out=[]);for(var gameObject,gameObjects=this.gameObjects,i=gameObjects.length;i--;){(gameObject=gameObjects[i]).hasTag(tag)&&out.push(gameObject)}return out},Scene.prototype.findByTagFirst=function(tag){for(var gameObject,gameObjects=this.gameObjects,i=gameObjects.length;i--;){if((gameObject=gameObjects[i]).hasTag(tag)){return gameObject}}return void 0},Scene.prototype.findById=function(id){return this._gameObjectHash[id]},Scene.prototype.findByJSONId=function(id){return this._gameObjectJSONHash[id]},Scene.prototype.findComponentById=function(id){return this._componentHash[id]},Scene.prototype.findComponentByJSONId=function(id){return this._componentJSONHash[id]},Scene.prototype.find=function(name){for(var child,gameObjects=this.gameObjects,i=gameObjects.length;i--;){if(child=gameObjects[i],child.name===name){return child}if(child=child.find(name)){return child}}return void 0},Scene.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);var gameObject,gameObjects=this.gameObjects,jsonGameObjects=json.gameObjects||(json.gameObjects=[]),i=gameObjects.length;for(json.name=this.name,json.world=this.world.toJSON(json.world);i--;){(gameObject=gameObjects[i])&&(jsonGameObjects[i]=gameObject.toJSON(jsonGameObjects[i]))}return json},Scene.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);var gameObject,jsonGameObject,jsonGameObjects=json.gameObjects,i=jsonGameObjects.length;for(this.name=json.name,this.world._className===json.world._className?this.world.fromJSON(json.world):this.setWorld(Class.fromJSON(json.world));i--;){(jsonGameObject=jsonGameObjects[i])&&((gameObject=this.findByJSONId(jsonGameObject._id))?gameObject.fromJSON(jsonGameObject):this.addGameObject(Class.fromJSON(jsonGameObject)))}return this},Scene}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/components/gui_component",["odin/base/class","odin/base/util","odin/core/game/log"],function(Class,util,Log){function GUIComponent(type,opts){opts||(opts={}),Class.call(this),this._type=type||"UnknownGUIComponent",this._name=camelize(this._type,!0),this.sync=void 0!=opts.sync?!!opts.sync:!1,this.json=void 0!=opts.json?!!opts.json:!0,this.guiObject=void 0
}var camelize=util.camelize;return Class.extend(GUIComponent),GUIComponent.prototype.init=function(){},GUIComponent.prototype.start=function(){},GUIComponent.prototype.update=function(){},GUIComponent.prototype.clear=function(){this.off()},GUIComponent.prototype.destroy=function(){return this.guiObject?(this.guiObject.removeGUIComponent(this,!0),this.emit("destroy"),this.clear(),this):(Log.error("GUIComponent.destroy: can't destroy GUIComponent if it's not added to a GameObject"),this)},GUIComponent.prototype.remove=function(){return this.guiObject?(this.guiObject.removeGUIComponent(this,!0),this):(Log.error("GUIComponent.destroy: can't destroy GUIComponent if it's not added to a GameObject"),this)},GUIComponent.prototype.sort=function(a,b){return a===b?-1:1},GUIComponent.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json._type=this._type,json.sync=this.sync,json.json=this.json,json},GUIComponent.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.sync=json.sync,this.json=json.json,this},GUIComponent}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/components/gui_transform",["odin/math/mathf","odin/math/rect","odin/math/vec2","odin/math/mat32","odin/math/mat3","odin/math/mat4","odin/core/gui/components/gui_component","odin/core/game/config","odin/core/game/log"],function(Mathf,Rect,Vec2,Mat32,Mat3,Mat4,GUIComponent,Config,Log){function GUITransform(opts){opts||(opts={}),opts.sync=void 0!=opts.sync?opts.sync:!0,GUIComponent.call(this,"GUITransform",opts),this.root=this,this.depth=0,this.parent=void 0,this.children=[],this.position=void 0!=opts.position?opts.position:new Rect,this.rotation=void 0!=opts.rotation?opts.rotation:0,this.scale=void 0!=opts.scale?opts.scale:new Vec2(1,1),this.matrix=new Mat32,this.matrixWorld=new Mat32,this.modelView=new Mat4,this._matricesNeedsUpdate=!1}function updateDepth(transform,depth){var children=transform.children,i=children.length;for(transform.depth=depth;i--;){updateDepth(children[i],depth+1)}}var EPSILON=Mathf.EPSILON;return GUIComponent.extend(GUITransform),GUITransform.order=-999999,GUITransform.prototype.copy=function(other){var children=other.children,i=children.length;for(this.position.copy(other.position),this.scale.copy(other.scale),this.rotation=other.rotation;i--;){this.addChild(children[i].gameObject.clone().transform)}return other.parent&&other.parent.addChild(this),this._matricesNeedsUpdate=!0,this},GUITransform.prototype.clear=function(){GUIComponent.prototype.clear.call(this);for(var children=this.children,i=children.length;i--;){this.removeChild(children[i])}return this.position.set(0,0,0,0),this.scale.set(1,1),this.rotation=0,this.root=this,this.depth=0,this._matricesNeedsUpdate=!0,this},GUITransform.prototype.translate=function(){var vec=new Vec2;return function(translation,relativeTo){var position=this.position;return vec.copy(translation),relativeTo instanceof GUITransform?vec.transformAngle(relativeTo.rotation):relativeTo&&vec.transformAngle(relativeTo),position.x+=vec.x,position.y+=vec.y,this}}(),GUITransform.prototype.rotate=function(rotation,relativeTo){return relativeTo instanceof GUITransform?rotation+=relativeTo.rotation:relativeTo&&(rotation+=relativeTo),this.rotation+=rotation,this},GUITransform.prototype.lookAt=function(){var mat=new Mat32,vec=new Vec2,vec_2=new Vec2;return function(target){return target instanceof GUITransform?vec.copy(target.position):vec.copy(target),mat.lookAt(this.position.center(vec_2),vec),this.rotation=mat.getRotation(),this}}(),GUITransform.prototype.follow=function(){var target=new Vec2,pos=new Vec2,delta=new Vec2;return function(transform,speed){var position=this.position;return pos.set(0,0).transformMat32(this.matrixWorld),target.set(0,0).transformMat32(transform.matrixWorld),delta.vsub(target,pos),delta.lengthSq()>EPSILON&&(position.x+=delta.x*speed,position.y+=delta.y*speed),this}}(),GUITransform.prototype.addChild=function(child,others){if(!(child instanceof GUITransform)){return Log.error("GUITransform.add: can't add passed argument, it is not an instance of GUITransform"),this}var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1===index){for(child.parent&&child.parent.remove(child),child.parent=this,children.push(child),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=root,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.GUITransform.sort(this.sort)}else{Log.error("GUITransform.add: child is not a member of this GUITransform")}return this},GUITransform.prototype.addChildren=function(){for(var scene,i=arguments.length;i--;){this.addChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.GUITransform.sort(this.sort),this},GUITransform.prototype.removeChild=function(child,others){var root,depth,scene,children=this.children,index=children.indexOf(child);if(-1!==index){for(child.parent=void 0,children.splice(index,1),root=this,depth=0;root.parent;){root=root.parent,depth++}child.root=child,this.root=root,updateDepth(this,depth),others||this.gameObject&&(scene=this.gameObject.scene)&&scene.components.GUITransform.sort(this.sort)}else{Log.error("GUITransform.remove: child is not a member of this GUITransform")}return this},GUITransform.prototype.removeChildren=function(){for(var scene,i=arguments.length;i--;){this.removeChild(arguments[i],!0)}return this.gameObject&&(scene=this.gameObject.scene)&&scene.components.GUITransform.sort(this.sort),this},GUITransform.prototype.detachChildren=function(){for(var i=arguments.length;i--;){this.removeChild(children[i])}return this},GUITransform.prototype.hasChild=function(child){return!!~this.children.indexOf(child)},GUITransform.prototype.find=function(name){for(var child,children=this.children,i=children.length;i--;){if(child=children[i],child.gameObject.name===name){return child}if(child=child.find(name)){return child}}return void 0},GUITransform.prototype.toWorld=function(v){return v.transformMat32(this.matrixWorld)},GUITransform.prototype.toLocal=function(){var mat=new Mat32;return function(v){return v.transformMat32(mat.inverseMat(this.matrixWorld))}}(),GUITransform.prototype.update=function(){var matrix=this.matrix,parent=this.parent;matrix.compose(this.position,this.scale,this.rotation),parent?this.matrixWorld.mmul(parent.matrixWorld,matrix):this.matrixWorld.copy(matrix),this._matricesNeedsUpdate=!0},GUITransform.prototype.updateMatrices=function(){var mat=new Mat4;return function(viewMatrix){this._matricesNeedsUpdate&&(this.modelView.mmul(viewMatrix,mat.fromMat32(this.matrixWorld)),this._matricesNeedsUpdate=!1)}}(),GUITransform.prototype.sort=function(a,b){return b.depth-a.depth},GUITransform.prototype.toJSON=function(json){json=GUIComponent.prototype.toJSON.call(this,json);for(var children=this.children,jsonChildren=json.children||(json.children=[]),i=children.length;i--;){jsonChildren[i]=children[i]._id}return json.position=this.position.toJSON(json.position),json.scale=this.scale.toJSON(json.scale),json.rotation=this.rotation,json},GUITransform.prototype.fromJSON=function(json){GUIComponent.prototype.fromJSON.call(this,json);var child,scene,children=json.children,i=children.length;if(this.guiObject&&(scene=this.guiObject.scene)){for(;i--;){child=scene.findGUIComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}}else{this.once("start",function(){for(var scene=this.guiObject.scene;i--;){child=scene.findGUIComponentByJSONId(children[i]),this.hasChild(child)||this.addChild(child)}})}return this.position.fromJSON(json.position),this.scale.fromJSON(json.scale),this.rotation=json.rotation,this._matricesNeedsUpdate=!0,this},GUITransform}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_object",["odin/base/class","odin/core/gui/components/gui_component","odin/core/gui/components/gui_transform","odin/core/game/log"],function(Class,GUIComponent,GUITransform,Log){function GUIObject(opts){opts||(opts={}),Class.call(this),this.name=void 0!=opts.name?opts.name:"GUIObject_"+this._id,this.gui=void 0,this.tags=[],this.components=[],this._componentType={},this._componentHash={},this._componentJSONHash={},opts.tag&&this.addTag(opts.tag),opts.tags&&this.addTags.apply(this,opts.tags),this.addComponent(new GUITransform(opts)),opts.components&&this.addComponents.apply(this,opts.components)}return Class.extend(GUIObject),GUIObject.prototype.copy=function(other){for(var otherComponent,component,components=other.components,tags=other.tags,i=components.length;i--;){otherComponent=components[i],(component=this.getComponent(otherComponent._type))?component.copy(otherComponent):this.addComponent(otherComponent.clone())}for(i=tags.length;i--;){this.addTag(tags[i])}return this},GUIObject.prototype.clear=function(){var i,components=this.components,tags=this.tags,componentLength=components.length;for(i=componentLength;i--;){components[i].clear()}for(i=tags.length;i--;){this.removeTag(tags[i])}for(i=componentLength;i--;){this.removeComponent(components[i])}return this.off(),this},GUIObject.prototype.destroy=function(){return this.gui?(this.gui.removeGUIObject(this),this.emit("destroy"),this.clear(),this):(Log.error("GUIObject.destroy: can't destroy GUIObject if it's not added to a Scene"),this)},GUIObject.prototype.remove=function(){return this.gui?(this.gui.removeGUIObject(this),this):(Log.error("GUIObject.remove: can't remove GUIObject if it's not added to a Scene"),this)},GUIObject.prototype.addTag=function(tag){var tags=this.tags;return-1===tags.indexOf(tag)&&tags.push(tag),this},GUIObject.prototype.addTags=function(){for(var i=arguments.length;i--;){this.addTag(arguments[i])}return this},GUIObject.prototype.removeTag=function(tag){var tags=this.tags,index=tags.indexOf(tag);return-1!==index&&tags.splice(index,1),this},GUIObject.prototype.removeTags=function(){for(var i=arguments.length;i--;){this.removeTag(arguments[i])}return this},GUIObject.prototype.hasTag=function(tag){return-1!==this.tags.indexOf(tag)},GUIObject.prototype.addComponent=function(component,others){if("string"==typeof component&&(component=new Class._classes[component]),!(component instanceof GUIComponent)){return Log.error("GUIObject.addComponent: can't add passed argument, it is not an instance of GUIComponent"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){Log.error("GUIObject.addComponent: GUIObject already has a(n) "+component._type+" GUIComponent")}else{if(component.guiObject&&(component=component.clone()),components.push(component),this._componentType[component._type]=component,this._componentHash[component._id]=component,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=component._jsonId),component.guiObject=this,this[name]=component,!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){comp[components[j]._name]=components[j]}}}component.init(),component.emit("init")}this.emit("add"+component._type,component),this.emit("addComponent",component),component.emit("add",this),this.gui&&this.gui._addComponent(component)}return this},GUIObject.prototype.addComponents=function(){var component,name,i,j,length=arguments.length,components=this.components;for(i=length;i--;){this.addComponent(arguments[i],!0)}for(i=components.length;i--;){if(component=components[i]){for(j=components.length;j--;){name=components[j]._name,component[name]=components[j]}}}for(i=components.length;i--;){component=components[i],component.init(),component.emit("init")}return this},GUIObject.prototype.removeComponent=function(component,clear,others){if("string"==typeof component&&(component=this.getComponent(component)),!(component instanceof GUIComponent)){return Log.error("GUIObject.removeComponent: can't remove passed argument, it is not an instance of GUIComponent"),this}var comp,i,j,name=component._name,components=this.components;if(this[name]){if(component.emit("remove",this),this.emit("remove"+component._type,component),this.emit("removeComponent",component),!others){for(i=components.length;i--;){if(comp=components[i]){for(j=components.length;j--;){name===components[j]._name&&(comp[name]=void 0)}}}}components.splice(components.indexOf(component),1),this._componentType[component._type]=void 0,this._componentHash[component._id]=void 0,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=void 0),component.guiObject=void 0,this[name]=void 0,this.gui&&this.gui._removeComponent(component),clear&&component.clear()}else{Log.error("GUIObject.removeComponent: GUIObject does not have a(n) "+type+" GUIComponent")}return this},GUIObject.prototype.removeComponents=function(){var component,name,i,j,length=arguments.length,components=this.components,toRemove=arguments;for(i=length;i--;){this.removeComponent(arguments[i],null,!0)}for(i=components.length;i--;){if(component=components[i]){for(name=component._name,j=toRemove.length;j--;){name===toRemove[i]._name&&(component[name]=void 0)}}}return this},GUIObject.prototype.getComponent=function(type){return this._componentType[type]||this[type]||this[type.toLowerCase()]},GUIObject.prototype.hasComponent=function(type){for(var components=this.components,i=components.length;i--;){if(components[i]._type===type){return!0}}return!1},GUIObject.prototype.find=function(name){var children,child,i,transform=this.transform||this.transform2d;if(!transform){return void 0}for(children=transform.children,i=children.length;i--;){if(child=children[i],child.guiObject.name===name){return child.guiObject}if(child=child.find(name)){return child}}return void 0},GUIObject.prototype.findComponentById=function(id){return this._componentHash[id]},GUIObject.prototype.findComponentByJSONId=function(id){return this._componentJSONHash[id]},GUIObject.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);for(var component,components=this.components,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=components.length;i--;){(component=components[i]).json&&(jsonComponents[i]=component.toJSON(jsonComponents[i]))}for(i=tags.length;i--;){jsonTags[i]=tags[i]}return json.name=this.name,json},GUIObject.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);for(var component,jsonComponent,tag,jsonComponents=json.components||(json.components=[]),tags=this.tags,jsonTags=json.tags||(json.tags=[]),i=jsonComponents.length;i--;){(jsonComponent=jsonComponents[i])&&((component=this.findComponentById(jsonComponent._id))||(component=this.getComponent(jsonComponent._type))?component.fromJSON(jsonComponent):this.addComponent(Class.fromJSON(jsonComponent)))}for(i=jsonTags.length;i--;){-1===tags.indexOf(tag=jsonTags[i])&&tags.push(tag)}return this.name=json.name,this},GUIObject}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui",["odin/base/class","odin/core/gui/gui_object","odin/core/game/log"],function(Class,GUIObject,Log){function GUI(opts){opts||(opts={}),Class.call(this),this.game=void 0,this.name=void 0!=opts.name?opts.name:"GUI_"+this._id,this.width=960,this.height=640,this.aspect=this.width/this.height,this.invWidth=1/this.width,this.invHeight=1/this.height,this.guiObjects=[],this._guiObjectHash={},this._guiObjectJSONHash={},this.components={},this._componentTypes=[],this._componentHash={},this._componentJSONHash={},opts.guiObjects&&this.addGUIObjects.apply(this,opts.guiObjects)}function sortComponentTypes(a,b){return(b[0].constructor.order||0)-(a[0].constructor.order||0)}return Class.extend(GUI),GUI.prototype.copy=function(other){var otherGUIObjects=other.guiObjects,i=otherGUIObjects.length;for(this.clear(),this.name=other.name+"."+this._id;i--;){this.addGUIObject(otherGUIObjects[i].clone())}return this},GUI.prototype.init=function(){var guiObjects=this.guiObjects,componentTypes=this._componentTypes,i=componentTypes.length;for(i=guiObjects.length;i--;){guiObjects[i].emit("init")}},GUI.prototype.start=function(){var components,component,i,j,types=this._componentTypes,guiObjects=this.guiObjects;for(i=types.length;i--;){for(components=types[i],j=components.length;j--;){component=components[j],component.start(),component.emit("start")}}for(i=guiObjects.length;i--;){guiObjects[i].emit("start")}},GUI.prototype.update=function(){var components,i,j,types=this._componentTypes,guiObjects=this.guiObjects;for(i=types.length;i--;){for(components=types[i],j=components.length;j--;){components[j].update()}}for(i=guiObjects.length;i--;){guiObjects[i].emit("update")}},GUI.prototype.clear=function(){for(var guiObjects=this.guiObjects,i=guiObjects.length;i--;){this.removeGUIObject(guiObjects[i],!0)}return this.off(),this},GUI.prototype.destroy=function(){return this.emit("destroy"),this.clear(),this},GUI.prototype.addGUIObject=function(guiObject){if(!(guiObject instanceof GUIObject)){return Log.error("GUI.addGUIObject: can't add argument to GUI, it's not an instance of GUIObject"),this}var components,transform,children,child,i,guiObjects=this.guiObjects,index=guiObjects.indexOf(guiObject);if(-1===index){for(guiObject.gui&&guiObject.gui.removeGUIObject(guiObject),guiObjects.push(guiObject),this._guiObjectHash[guiObject._id]=guiObject,-1!==guiObject._jsonId&&(this._guiObjectJSONHash[guiObject._jsonId]=guiObject),guiObject.gui=this,components=guiObject.components,i=components.length;i--;){this._addComponent(components[i])}if(transform=guiObject.guiTransform){for(i=(children=transform.children).length;i--;){(child=children[i].guiObject)&&!this.hasGUIObject(child)&&this.addGUIObject(child)}}this.game&&guiObject.emit("init"),this.emit("addGUIObject",guiObject)}else{Log.error("GUI.addGUIObject: GUIObject is already a member of GUI")}return this},GUI.prototype.addGUIObjects=function(){for(var i=arguments.length;i--;){this.addGUIObject(arguments[i])}return this},GUI.prototype._addComponent=function(component){if(component){var type=component._type,components=this.components,isNew=!components[type],types=components[type]||(components[type]=[]),componentTypes=this._componentTypes;this._componentHash[component._id]=component,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=component),types.push(component),isNew&&(componentTypes.push(types),componentTypes.sort(sortComponentTypes)),types.sort(component.sort),this.emit("add"+type,component),this.emit("addComponent",component),this.game&&(component.start(),component.emit("start"))}},GUI.prototype.removeGUIObject=function(guiObject,clear){if(!(guiObject instanceof GUIObject)){return Log.error("GUI.removeGUIObject: can't remove argument from GUI, it's not an instance of GUIObject"),this}var components,transform,children,child,i,guiObjects=this.guiObjects,index=guiObjects.indexOf(guiObject);if(-1!==index){for(guiObjects.splice(index,1),this._guiObjectHash[guiObject._id]=void 0,-1!==guiObject._jsonId&&(this._guiObjectJSONHash[guiObject._jsonId]=void 0),guiObject.gui=void 0,components=guiObject.components,i=components.length;i--;){this._removeComponent(components[i])}if(transform=guiObject.guiTransform){for(i=(children=transform.children).length;i--;){(child=children[i].guiObject)&&this.hasGUIObject(child)&&this.removeGUIObject(child)}}this.emit("removeGUIObject",guiObject),guiObject.emit("remove",guiObject),clear&&guiObject.clear()}else{Log.error("GUI.removeGUIObject: GUIObject is not a member of GUI")}return this},GUI.prototype.removeGUIObjects=function(){for(var i=arguments.length;i--;){this.removeGUIObject(arguments[i])}return this},GUI.prototype._removeComponent=function(component){if(component){var type=component._type,components=this.components,types=components[type],index=types.indexOf(component);this._componentHash[component._id]=void 0,-1!==component._jsonId&&(this._componentJSONHash[component._jsonId]=void 0),types.splice(index,1),types.sort(component.sort),this.emit("remove"+type,component),this.emit("removeComponent",component),component.clear()}},GUI.prototype.hasGUIObject=function(guiObject){return!!~this.guiObjects.indexOf(guiObject)},GUI.prototype.findByTag=function(tag,out){out||(out=[]);for(var guiObject,guiObjects=this.guiObjects,i=guiObjects.length;i--;){(guiObject=guiObjects[i]).hasTag(tag)&&out.push(guiObject)}return out},GUI.prototype.findByTagFirst=function(tag){for(var guiObject,guiObjects=this.guiObjects,i=guiObjects.length;i--;){if((guiObject=guiObjects[i]).hasTag(tag)){return guiObject}}return void 0},GUI.prototype.findById=function(id){return this._guiObjectHash[id]},GUI.prototype.findByJSONId=function(id){return this._guiObjectJSONHash[id]},GUI.prototype.findComponentById=function(id){return this._componentHash[id]},GUI.prototype.findComponentByJSONId=function(id){return this._componentJSONHash[id]},GUI.prototype.find=function(name){for(var child,guiObjects=this.guiObjects,i=guiObjects.length;i--;){if(child=guiObjects[i],child.name===name){return child}if(child=child.find(name)){return child}}return void 0},GUI.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);var guiObject,guiObjects=this.guiObjects,jsonGUIObjects=json.guiObjects||(json.guiObjects=[]),i=guiObjects.length;for(json.name=this.name;i--;){(guiObject=guiObjects[i])&&(jsonGUIObjects[i]=guiObject.toJSON(jsonGUIObjects[i]))}return json},GUI.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);var guiObject,jsonGUIObject,jsonGUIObjects=json.guiObjects,i=jsonGUIObjects.length;for(this.name=json.name;i--;){(jsonGUIObject=jsonGUIObjects[i])&&((guiObject=this.findByJSONId(jsonGUIObject._id))?guiObject.fromJSON(jsonGUIObject):this.addGUIObject(Class.fromJSON(jsonGUIObject)))}return this},GUI}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/base_game",["odin/base/class","odin/core/game/loop","odin/core/scene","odin/core/gui/gui","odin/core/game/log"],function(Class,Loop,Scene,GUI,Log){function BaseGame(opts){opts||(opts={}),Class.call(this),this._loop=new Loop(this.loop,this),this.guis=[],this._guiHash={},this._guiJSONHash={},this._guiNameHash={},this.scenes=[],this._sceneHash={},this._sceneJSONHash={},this._sceneNameHash={}}return Class.extend(BaseGame),BaseGame.prototype.init=function(){return this._loop.resume(),this.emit("init"),this},BaseGame.prototype.clear=function(){for(var scenes=this.scenes,i=scenes.length;i--;){this.removeScene(scenes[i],!0)}return this},BaseGame.prototype.destroy=function(){return this.emit("destroy"),this.clear(),this},BaseGame.prototype.addScene=function(scene){if(!(scene instanceof Scene)){return Log.error("BaseGame.addScene: can't add argument to BaseGame, it's not an instance of Scene"),this}var json,sceneHash=this._sceneHash,sceneNameHash=this._sceneNameHash,name=scene.name,id=scene._id;return sceneNameHash[name]||sceneHash[id]?Log.error("BaseGame.addScene: Scene is already a member of BaseGame"):(json=scene.toJSON(),sceneNameHash[name]=json,sceneHash[id]=json,this.scenes.push(json),-1!==scene._jsonId&&(this._sceneJSONHash[scene._jsonId]=json),this.emit("addScene",name)),this},BaseGame.prototype.addScenes=function(){for(var i=arguments.length;i--;){this.addScene(arguments[i])}return this},BaseGame.prototype.removeScene=function(scene){"string"==typeof scene?scene=this._sceneNameHash[scene]:"number"==typeof scene&&(scene=this._sceneHash[scene]);var json,scenes=this.scenes,sceneHash=this._sceneHash,sceneNameHash=this._sceneNameHash,name=scene.name,id=scene._id;return sceneNameHash[name]&&sceneHash[id]?(json=sceneNameHash[name],sceneNameHash[name]=void 0,sceneHash[id]=void 0,scenes.splice(scenes.indexOf(json),1),-1!==json._jsonId&&(this._sceneJSONHash[json._jsonId]=void 0),this.emit("removeScene",name)):Log.error("BaseGame.removeScene: Scene not a member of BaseGame"),this},BaseGame.prototype.removeScenes=function(){for(var i=arguments.length;i--;){this.removeScene(arguments[i])}return this},BaseGame.prototype.addGUI=function(gui){if(!(gui instanceof GUI)){return Log.error("BaseGame.addGUI: can't add argument to BaseGame, it's not an instance of GUI"),this}var json,guiHash=this._guiHash,guiNameHash=this._guiNameHash,name=gui.name,id=gui._id;return guiNameHash[name]||guiHash[id]?Log.error("BaseGame.addGUI: GUI is already a member of BaseGame"):(json=gui.toJSON(),guiNameHash[name]=json,guiHash[id]=json,this.guis.push(json),-1!==gui._jsonId&&(this._guiJSONHash[gui._jsonId]=json),this.emit("addGUI",name)),this},BaseGame.prototype.addGUIs=function(){for(var i=arguments.length;i--;){this.addGUI(arguments[i])}return this},BaseGame.prototype.removeGUI=function(gui){"string"==typeof gui?gui=this._guiNameHash[gui]:"number"==typeof gui&&(gui=this._guiHash[gui]);var json,guis=this.guis,guiHash=this._guiHash,guiNameHash=this._guiNameHash,name=gui.name,id=gui._id;return guiNameHash[name]&&guiHash[id]?(json=guiNameHash[name],guiNameHash[name]=void 0,guiHash[id]=void 0,guis.splice(guis.indexOf(json),1),-1!==json._jsonId&&(this._guiJSONHash[json._jsonId]=void 0),this.emit("removeGUI",name)):Log.error("BaseGame.removeGUI: GUI not a member of BaseGame"),this},BaseGame.prototype.removeGUIs=function(){for(var i=arguments.length;i--;){this.removeGUI(arguments[i])}return this},BaseGame.prototype.findSceneByName=function(name){return this._sceneNameHash[name]},BaseGame.prototype.findSceneById=function(id){return this._sceneHash[id]},BaseGame.prototype.findSceneByJSONId=function(id){return this._sceneJSONHash[id]},BaseGame.prototype.pause=function(){return this._loop.pause(),this},BaseGame.prototype.resume=function(){return this._loop.resume(),this},BaseGame.prototype.loop=function(ms){this.emit("update",ms)},BaseGame.prototype.toJSON=function(json){json=Class.prototype.toJSON.call(this,json);for(var scenes=this.scenes,jsonScenes=json.scenes||(json.scenes=[]),i=scenes.length;i--;){jsonScenes[i]=scenes[i]}return json},BaseGame.prototype.fromJSON=function(json){Class.prototype.fromJSON.call(this,json);for(var scene,jsonScene,jsonScenes=json.scenes,i=jsonScenes.length;i--;){jsonScene=jsonScenes[i],(scene=this.findSceneByJSONId(jsonScene._id))?this.removeScene(scene).addScene(jsonScene):this.addScene(jsonScene)}return this},BaseGame}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/renderer/canvas",["odin/base/event_emitter","odin/base/device","odin/base/dom","odin/core/game/config"],function(EventEmitter,Device,Dom,Config){function Canvas(opts){opts||(opts={}),EventEmitter.call(this),this.canvasId=++CANVAS_ID,this.fullScreen=opts.fullScreen?opts.fullScreen:void 0==opts.width&&void 0==opts.height?!0:!1,this.customCursor=void 0!=opts.customCursor?opts.customCursor:!1,this.hideMouse=void 0!=opts.hideMouse?opts.hideMouse:!1,this.width=void 0!=opts.width?opts.width:window.innerWidth,this.height=void 0!=opts.height?opts.height:window.innerHeight,this.aspect=this.width/this.height,this.pixelWidth=this.width,this.pixelHeight=this.height,this.element=void 0}var addEvent=Dom.addEvent,removeEvent=Dom.removeEvent,addMeta=Dom.addMeta,floor=Math.floor,CANVAS_ID=0,SCALE_REG=/-scale\s *=\s*[.0-9]+/g,VIEWPORT="viewport",VIEWPORT_WIDTH="viewport-width",VIEWPORT_HEIGHT="viewport-height",CANVAS_STYLE=["background: #000000;","position: absolute;","top: 50%;","left: 50%;","padding: 0px;","margin: 0px;"].join("\n");return addMeta(VIEWPORT,"viewport","initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"),addMeta(VIEWPORT_WIDTH,"viewport","width=device-width"),addMeta(VIEWPORT_HEIGHT,"viewport","height=device-height"),EventEmitter.extend(Canvas),Canvas.prototype.init=function(){this.element&&this.destroy();var element=document.createElement("canvas"),style=element.style;element.id="canvas-"+this.canvasId,style.cssText=CANVAS_STYLE,style.cursor=this.customCursor?"url("+this.customCursor+")":this.hideMouse?"none":"default",document.body.appendChild(element),Config.debug||(element.oncontextmenu=function(){return!1}),addEvent(window,"resize orientationchange",this.handleResize,this),element.requestPointerLock||(element.requestPointerLock=element.webkitRequestPointerLock||element.mozRequestPointerLock||element.oRequestPointerLock||element.msRequestPointerLock),element.exitPointerLock||(element.exitPointerLock=document.webkitExitPointerLock||document.mozExitPointerLock||document.oExitPointerLock||document.msExitPointerLock),element.requestFullscreen||(element.requestFullscreen=element.webkitRequestFullscreen||element.mozRequestFullscreen||element.oRequestFullscreen||element.msRequestFullscreen),element.exitFullscreen||(element.exitFullscreen=element.webkitExitFullscreen||element.mozExitFullscreen||element.oExitFullscreen||element.msExitFullscreen),this.element=element,this.handleResize()},Canvas.prototype.clear=function(){return this.element?(removeEvent(window,"resize orientationchange",this.handleResize,this),document.body.removeChild(this.element),this.element=void 0,this):this},Canvas.prototype.setFullscreen=function(value){return this.element&&this.fullScreen!==value?(this.fullScreen=!!value,this.handleResize(),this):this},Canvas.prototype.setWidth=function(width){return this.element&&this.width!==width?(this.width=width,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},Canvas.prototype.setHeight=function(height){return this.element&&this.height!==height?(this.height=height,this.fullScreen=!1,this.aspect=this.width/this.height,this.handleResize(),this):this},Canvas.prototype.style=function(key,value){return this.element?(this.element.style[key]=value,this):this},Canvas.prototype.setBackgroundColor=function(color){return this.element?(this.element.style.background=color,this):this},Canvas.prototype.handleResize=function(){var width,height,viewportScale=document.getElementById(VIEWPORT).getAttribute("content"),w=window.innerWidth,h=window.innerHeight,aspect=w/h,element=this.element,style=element.style;this.fullScreen?(width=w,height=h):aspect>this.aspect?(width=h*this.aspect,height=h):(width=w,height=w/this.aspect),this.pixelWidth=floor(width),this.pixelHeight=floor(height),element.width=width,element.height=height,style.marginLeft=-floor(.5*(width+1))+"px",style.marginTop=-floor(.5*(height+1))+"px",style.width=floor(width)+"px",style.height=floor(height)+"px",document.getElementById(VIEWPORT).setAttribute("content",viewportScale.replace(SCALE_REG,"-scale="+Device.invPixelRatio)),document.getElementById(VIEWPORT_WIDTH).setAttribute("content","width="+w),document.getElementById(VIEWPORT_HEIGHT).setAttribute("content","height="+h),window.scrollTo(1,1),this.emit("resize")},Canvas}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/rect_offset",[],function(){function RectOffset(left,right,top,bottom){this.left=left||0,this.right=right||0,this.top=top||0,this.bottom=bottom||0}var defineProperty=Object.defineProperty;return defineProperty(RectOffset.prototype,"horizontal",{get:function(){return this.left+this.right}}),defineProperty(RectOffset.prototype,"vertical",{get:function(){return this.top+this.bottom}}),RectOffset.prototype.clone=function(){return new RectOffset(this.left,this.right,this.top,this.bottom)},RectOffset.prototype.copy=function(other){return this.left=other.left,this.right=other.right,this.top=other.top,this.bottom=other.bottom,this},RectOffset.prototype.set=function(left,right,top,bottom){return this.left=left,this.right=right,this.top=top,this.bottom=bottom,this},RectOffset.prototype.add=function(rect){return rect.xMin-=this.left,rect.xMax+=this.right,rect.yMin-=this.top,rect.yMax+=this.bottom,rect},RectOffset.prototype.sub=function(rect){return rect.xMin+=this.left,rect.xMax-=this.right,rect.yMin+=this.top,rect.yMax-=this.bottom,rect},RectOffset.prototype.toJSON=function(json){return json||(json={}),json.left=this.left,json.right=this.right,json.top=this.top,json.bottom=this.bottom,json},RectOffset.prototype.fromJSON=function(json){return this.left=json.left,this.right=json.right,this.top=json.top,this.bottom=json.bottom,this
},RectOffset.prototype.toString=function(){return"RectOffset( "+this.left+", "+this.right+", "+this.top+", "+this.bottom+" )"},RectOffset}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/mat2",["odin/math/mathf"],function(Mathf){function Mat2(m11,m12,m21,m22){var te=new Float32Array(4);this.elements=te,te[0]=void 0!=m11?m11:1,te[2]=m12||0,te[1]=m21||0,te[3]=void 0!=m22?m22:1}var cos=Math.cos,sin=Math.sin,atan2=Math.atan2;return Mathf._classes.Mat2=Mat2,Mat2.prototype.clone=function(){var te=this.elements;return new Mat2(te[0],te[1],te[2],te[3])},Mat2.prototype.copy=function(other){var te=this.elements,me=other.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],this},Mat2.prototype.set=function(m11,m12,m21,m22){var te=this.elements;return te[0]=m11,te[2]=m12,te[1]=m21,te[3]=m22,this},Mat2.prototype.mul=function(other){var ae=this.elements,be=other.elements,a11=ae[0],a12=ae[2],a21=ae[1],a22=ae[3],b11=be[0],b12=be[2],b21=be[1],b22=be[3];return ae[0]=a11*b11+a21*b12,ae[1]=a12*b11+a22*b12,ae[2]=a11*b21+a21*b22,ae[3]=a12*b21+a22*b22,this},Mat2.prototype.mmul=function(a,b){var te=this.elements,ae=a.elements,be=b.elements,a11=ae[0],a12=ae[2],a21=ae[1],a22=ae[3],b11=be[0],b12=be[2],b21=be[1],b22=be[3];return te[0]=a11*b11+a21*b12,te[1]=a12*b11+a22*b12,te[2]=a11*b21+a21*b22,te[3]=a12*b21+a22*b22,this},Mat2.prototype.smul=function(s){var te=this.elements;return te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,this},Mat2.prototype.sdiv=function(s){var te=this.elements;return s=0!==s?1/s:1,te[0]*=s,te[1]*=s,te[2]*=s,te[3]*=s,this},Mat2.prototype.identity=function(){var te=this.elements;return te[0]=1,te[1]=0,te[2]=0,te[3]=1,this},Mat2.prototype.zero=function(){var te=this.elements;return te[0]=0,te[1]=0,te[2]=0,te[3]=0,this},Mat2.prototype.determinant=function(){var te=this.elements;return te[0]*te[3]-te[2]*te[1]},Mat2.prototype.inverse=function(){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],det=m11*m22-m12*m21;return det=0===det?0:1/det,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,this},Mat2.prototype.inverseMat=function(other){var te=this.elements,me=other.elements,m11=me[0],m12=me[2],m21=me[1],m22=me[3],det=m11*m22-m12*m21;return det=0===det?0:1/det,te[0]=m22*det,te[1]=-m12*det,te[2]=-m21*det,te[3]=m11*det,this},Mat2.prototype.transpose=function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[2],te[2]=tmp,this},Mat2.prototype.setTrace=function(x,y){var te=this.elements;return te[0]=x,te[3]=y,this},Mat2.prototype.setRotation=function(angle){var te=this.elements,c=cos(angle),s=sin(angle);return te[0]=c,te[1]=s,te[2]=-s,te[3]=c,this},Mat2.prototype.getRotation=function(){var te=this.elements;return atan2(te[1],te[0])},Mat2.prototype.rotate=function(angle){var te=this.elements,m11=te[0],m12=te[2],m21=te[1],m22=te[3],s=sin(angle),c=sin(angle);return te[0]=m11*c+m12*s,te[1]=m11*-s+m12*c,te[2]=m21*c+m22*s,te[3]=m21*-s+m22*c,this},Mat2.prototype.fromMat3=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[3],te[3]=me[4],this},Mat2.prototype.fromMat4=function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[4],te[3]=me[5],this},Mat2.prototype.equals=function(other){var ae=this.elements,be=other.elements;return!(ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3])},Mat2.prototype.notEquals=function(other){var ae=this.elements,be=other.elements;return ae[0]!==be[0]||ae[1]!==be[1]||ae[2]!==be[2]||ae[3]!==be[3]},Mat2.prototype.fromJSON=function(json){var te=this.elements,me=json.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],this},Mat2.prototype.toJSON=function(json){json||(json={});var te=this.elements,je=json.elements||(json.elements=[]);return json._className="Mat2",je[0]=te[0],je[1]=te[1],je[2]=te[2],je[3]=te[3],json},Mat2.prototype.fromArray=function(array){var te=this.elements;return te[0]=array[0],te[1]=array[1],te[2]=array[2],te[3]=array[3],this},Mat2.prototype.toArray=function(array){array||(array=[]);var te=this.elements;return array[0]=te[0],array[1]=te[1],array[2]=te[2],array[3]=te[3],array},Mat2.prototype.toString=function(){var te=this.elements;return"Mat2[ "+te[0]+", "+te[2]+"]\n     [ "+te[1]+", "+te[3]+"]"},Mat2}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/renderer/render_target",["odin/base/class","odin/core/enums"],function(Class,Enums){function RenderTarget(opts){opts||(opts={}),Class.call(this),this.width=opts.width||512,this.height=opts.height||512,this.invWidth=1/this.width,this.invHeight=1/this.height,this.depthOnly=void 0!=opts.depthOnly?!!opts.depthOnly:!1,this.depthBuffer=void 0!=opts.depthBuffer?!!opts.depthBuffer:!0,this.stencilBuffer=void 0!=opts.stencilBuffer?!!opts.stencilBuffer:!0,this.generateMipmap=void 0!=opts.generateMipmap?!!opts.generateMipmap:!0,this.flipY=void 0!=opts.flipY?!!opts.flipY:!0,this.premultiplyAlpha=void 0!=opts.premultiplyAlpha?!!opts.premultiplyAlpha:!1,this.anisotropy=void 0!=opts.anisotropy?opts.anisotropy:1,this.filter=void 0!=opts.filter?opts.filter:Enums.FilterMode.Linear,this.format=void 0!=opts.format?opts.format:Enums.TextureFormat.RGBA,this.wrap=void 0!=opts.wrap?opts.wrap:Enums.TextureWrap.Repeat,this._webglUsed=0,this._webgl=void 0,this._webglFramebuffer=void 0,this._webglRenderbuffer=void 0}return Class.extend(RenderTarget),RenderTarget.prototype.clone=function(){return(new RenderTarget).copy(this)},RenderTarget.prototype.copy=function(other){return this.width=other.width,this.height=other.height,this.invWidth=other.invWidth,this.invHeight=other.invHeight,this.generateMipmap=other.generateMipmap,this.flipY=other.flipY,this.premultiplyAlpha=other.premultiplyAlpha,this.anisotropy=other.anisotropy,this.filter=other.filter,this.format=other.format,this.wrap=other.wrap,this},RenderTarget.prototype.setWidth=function(width){this.width=width||this.width,this.needsUpdate=!0},RenderTarget.prototype.setHeight=function(height){this.height=height||this.height,this.needsUpdate=!0},RenderTarget.prototype.setMipmap=function(value){this.generateMipmap=void 0!=value?!!value:!this.generateMipmap,this.needsUpdate=!0},RenderTarget.prototype.setAnisotropy=function(value){this.anisotropy=value,this.needsUpdate=!0},RenderTarget.prototype.setFilter=function(value){this.filter=value,this.needsUpdate=!0},RenderTarget.prototype.setFormat=function(value){this.format=value,this.needsUpdate=!0},RenderTarget.prototype.setWrap=function(value){this.wrap=value,this.needsUpdate=!0},RenderTarget.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.width=this.width,json.height=this.height,json.invWidth=this.invWidth,json.invHeight=this.invHeight,json.generateMipmap=this.generateMipmap,json.flipY=this.flipY,json.premultiplyAlpha=this.premultiplyAlpha,json.anisotropy=this.anisotropy,json.filter=this.filter,json.format=this.format,json.wrap=this.wrap,json},RenderTarget.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.width=json.width,this.height=json.height,this.invWidth=json.invWidth,this.invHeight=json.invHeight,this.generateMipmap=json.generateMipmap,this.flipY=json.flipY,this.premultiplyAlpha=json.premultiplyAlpha,this.anisotropy=json.anisotropy,this.filter=json.filter,this.format=json.format,this.wrap=json.wrap,this},RenderTarget}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/renderer/render_target_cube",["odin/core/renderer/render_target","odin/core/enums"],function(RenderTarget){function RenderTargetCube(opts){opts||(opts={}),RenderTarget.call(this,opts),this.activeCubeFace=0}return RenderTarget.extend(RenderTargetCube),RenderTargetCube.prototype.clone=function(){return(new RenderTargetCube).copy(this)},RenderTargetCube.prototype.copy=function(other){return RenderTarget.prototype.copy.call(this,other),this},RenderTargetCube.prototype.toJSON=function(json){return json=RenderTarget.prototype.toJSON.call(this,json)},RenderTargetCube.prototype.fromJSON=function(json){return RenderTarget.prototype.fromJSON.call(this,json),this},RenderTargetCube}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/renderer/shader_chunks",[],function(){var ShaderChunks={dHdxy_fwd:["vec2 dHdxy_fwd(sampler2D map, vec2 uv, float scale) {","	vec2 dSTdx = dFdx(uv);","	vec2 dSTdy = dFdy(uv);","	float Hll = scale * texture2D(map, uv).x;","	float dBx = scale * texture2D(map, uv + dSTdx).x - Hll;","	float dBy = scale * texture2D(map, uv + dSTdy).x - Hll;","	return vec2(dBx, dBy);","}",""].join("\n"),perturbNormalArb:["vec3 perturbNormalArb(vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {","	vec3 vSigmaX = dFdx(surf_pos);","	vec3 vSigmaY = dFdy(surf_pos);","	vec3 vN = surf_norm;","	vec3 R1 = cross(vSigmaY, vN);","	vec3 R2 = cross(vN, vSigmaX);","	float fDet = dot(vSigmaX, R1);","	vec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);","	return normalize(abs(fDet) * surf_norm - vGrad);","}",""].join("\n"),perturbNormal2Arb:["vec3 perturbNormal2Arb(sampler2D map, vec2 uv, vec3 eye_pos, vec3 surf_norm, float scale) {","	vec3 q0 = dFdx(eye_pos.xyz);","	vec3 q1 = dFdy(eye_pos.xyz);","	vec2 st0 = dFdx(uv.st);","	vec2 st1 = dFdy(uv.st);","	vec3 S = normalize(q0 * st1.t - q1 * st0.t);","	vec3 T = normalize(-q0 * st1.s + q1 * st0.s);","	vec3 N = normalize(surf_norm);","	vec3 mapN = texture2D(map, uv).xyz * 2.0 - 1.0;","	mapN.xy = scale * mapN.xy;","	mat3 tsn = mat3(S, T, N);","	return normalize(tsn * mapN);","}",""].join("\n"),composeMat4:["mat4 composeMat4(vec3 position, vec3 scale, vec4 rotation) {","	mat4 mat;","	float x = rotation.x, y = rotation.y, z = rotation.z, w = rotation.w,","		x2 = x + x, y2 = y + y, z2 = z + z,","		xx = x * x2, xy = x * y2, xz = x * z2,","		yy = y * y2, yz = y * z2, zz = z * z2,","		wx = w * x2, wy = w * y2, wz = w * z2,","		sx = scale.x, sy = scale.y, sz = scale.z;","	mat[0][0] = (1.0 - (yy + zz)) * sx;","	mat[1][0] = (xy - wz) * sy;","	mat[2][0] = (xz + wy) * sz;","	mat[0][1] = (xy + wz) * sx;","	mat[1][1] = (1.0 - (xx + zz)) * sy;","	mat[2][1] = (yz - wx) * sz;","	mat[0][2] = (xz - wy) * sx;","	mat[1][2] = (yz + wx) * sy;","	mat[2][2] = (1.0 - (xx + yy)) * sz;","	mat[0][3] = 0.0;","	mat[1][3] = 0.0;","	mat[2][3] = 0.0;","	mat[3][0] = position.x;","	mat[3][1] = position.y;","	mat[3][2] = position.z;","	mat[3][3] = 1.0;","	return mat;","}",""].join("\n"),getBoneMatrix:["#ifdef USE_SKINNING","mat4 getBoneMatrix() {","	mat4 result = boneWeight.x * composeMat4(bonesPos[int(boneIndex.x)], bonesScl[int(boneIndex.x)], bonesRot[int(boneIndex.x)]);","	result = result + boneWeight.y * composeMat4(bonesPos[int(boneIndex.y)], bonesScl[int(boneIndex.y)], bonesRot[int(boneIndex.y)]);","	result = result + boneWeight.z * composeMat4(bonesPos[int(boneIndex.z)], bonesScl[int(boneIndex.z)], bonesRot[int(boneIndex.z)]);","	return result;","}","#endif",""].join("\n"),bone:["	#ifdef USE_SKINNING","		mat4 boneMatrix = getBoneMatrix();","		#ifdef USE_MORPHTARGETS","			vec4 boneVertex = vec4( morphed, 1.0 );","		#else","			vec4 boneVertex = vec4( position, 1.0 );","		#endif","		vec4 bone = boneMatrix * boneVertex;","	#endif",""].join("\n"),boneNormal:["	#ifdef USE_SKINNING","		#ifdef USE_MORPHNORMALS","			vec4 boneNormal = boneMatrix * vec4( morphedNormal, 0.0 );","		#else","			vec4 boneNormal = boneMatrix * vec4( normal, 0.0 );","		#endif","	#endif",""].join("\n"),transformedNormal:["	#ifdef USE_SKINNING","	vec3 objectNormal = boneNormal.xyz;","	#endif","	#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","	vec3 objectNormal = morphedNormal;","	#endif","	#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","	vec3 objectNormal = normal;","	#endif","	vec3 transformedNormal = normalMatrix * objectNormal;",""].join("\n"),worldPosition:["	#ifdef USE_SKINNING","	vec4 worldPosition = modelMatrix * bone;","	#endif","	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","	vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","	#endif","	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	#endif",""].join("\n"),worldPosition_sprite:["	vec4 worldPosition = modelMatrix * vec4( position.xy * size, position.z, 1.0 );",""].join("\n"),worldPosition_emitter:["	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );",""].join("\n"),mvPosition:["	#ifdef USE_SKINNING","	vec4 mvPosition = modelViewMatrix * bone;","	#endif","	#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","	#endif","	#if !defined( USE_SKINNING ) && !defined( USE_MORPHTARGETS )","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#endif",""].join("\n"),mvPosition_sprite:["	vec4 mvPosition = modelViewMatrix * vec4( position.xy * size, position.z, 1.0 );",""].join("\n"),mvPosition_emitter:["	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",""].join("\n"),particle_header_vertex:["attribute vec3 particleColor;","uniform float particleSizeRatio;",""].join("\n"),particle_header:["varying float vAngle;","varying float vAlpha;","varying float vSize;","varying vec3 vParticleColor;",""].join("\n"),particle_vertex:["	vAngle = data.x;","	vAlpha = data.z;","	vSize = data.y;","	vParticleColor = particleColor;",""].join("\n"),particle_vertex_size:["	gl_PointSize = vSize * (particleSizeRatio / length(mvPosition.xyz));\n",""].join("\n"),particle_vertex_size_2d:["	gl_PointSize = vSize * particleSizeRatio;\n",""].join("\n"),sprite_header:["uniform vec2 size;","uniform vec4 crop;",""].join("\n"),sprite_vertex_after:["	vUv.x = vUv.x * crop.z + crop.x;","	vUv.y = vUv.y * crop.w + crop.y;",""].join("\n"),lights:["uniform vec3 ambient;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemiLightColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemiLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif",""].join("\n"),VertexLight:["void VertexLight(vec3 normal, vec3 worldPosition, vec3 viewPosition, inout vec3 diffuseLight) {","	#if MAX_DIR_LIGHTS > 0","		for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, dirVector );","			vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += directionalLightColor[ i ] * directionalLightWeighting;","		}","	#endif","	#if MAX_POINT_LIGHTS > 0","		for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + viewPosition;","			float lDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 ) {","				lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","			}","			lVector = normalize( lVector );","			float dotProduct = dot( normal, lVector );","			vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += pointLightColor[ i ] * pointLightWeighting * lDistance;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + viewPosition;","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","				float lDistance = 1.0;","				if ( spotLightDistance[ i ] > 0.0 ) {","					lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","				}","				lVector = normalize( lVector );","				float dotProduct = dot( normal, lVector );","				vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","				diffuseLight += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","			}","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemiLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			diffuseLight += hemiLightColor[ i ] * hemiDiffuseWeight;","		}","	#endif","	diffuseLight += ambient;","}",""].join("\n"),perPixelVaryingHeader:["varying vec3 vWorldPosition;","varying vec3 vViewPosition;","varying vec3 vNormal;",""].join("\n"),perPixelVaryingMain:["	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	vNormal = transformedNormal;"].join("\n"),PixelLight:["void PixelLight(vec3 normal, vec3 specularColor, float specularStrength, float shininess, inout vec3 diffuseLight, inout vec3 specularLight) {","	#if MAX_DIR_LIGHTS > 0","		for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, dirVector );","			vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += directionalLightColor[ i ] * directionalLightWeighting;","			vec3 dirHalfVector = normalize( dirVector + vViewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0001 ) / 8.0;","			vec3 schlick = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","			specularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * directionalLightWeighting * specularNormalization;","		}","	#endif","	#if MAX_POINT_LIGHTS > 0","		for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + vViewPosition;","			float lDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 ) {","				lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","			}","			lVector = normalize( lVector );","			float dotProduct = dot( normal, lVector );","			vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += pointLightColor[ i ] * pointLightWeighting * lDistance;","			vec3 pointHalfVector = normalize( lVector + vViewPosition );","			float pointDiffuseWeight = max( dotProduct, 0.0 );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0001 ) / 8.0;","			vec3 schlick = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","			specularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + vViewPosition;","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","				float lDistance = 1.0;","				if ( spotLightDistance[ i ] > 0.0 ) {","					lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","				}","				lVector = normalize( lVector );","				float dotProduct = dot( normal, lVector );","				vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","				diffuseLight += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","				vec3 spotHalfVector = normalize( lVector + vViewPosition );","				float spotDiffuseWeight = max( dotProduct, 0.0 );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0001 ) / 8.0;","				vec3 schlick = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","				specularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemiLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","			diffuseLight += hemiLightColor[ i ] * hemiDiffuseWeight;","			vec3 hemiHalfVector = normalize( lVector + vViewPosition );","			float hemiDotNormalHalf = max( dot( normal, hemiHalfVector ), 0.0 );","			float hemiSpecularWeight = specularStrength * max( pow( hemiDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0001 ) / 8.0;","			vec3 schlick = specularColor + vec3( 1.0 - specularColor ) * pow( 1.0 - dot( lVector, hemiHalfVector ), 5.0 );","			specularLight += schlick * hemiLightColor[ i ] * hemiSpecularWeight * hemiDiffuseWeight * specularNormalization;","		}","	#endif","	diffuseLight += ambient;","}",""].join("\n"),PixelLightNoSpec:["vec3 PixelLightNoSpec(vec3 normal) {","	vec3 diffuseLight;","	#if MAX_DIR_LIGHTS > 0","		for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, dirVector );","			vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += directionalLightColor[ i ] * directionalLightWeighting;","		}","	#endif","	#if MAX_POINT_LIGHTS > 0","		for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + vViewPosition;","			float lDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 ) {","				lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","			}","			lVector = normalize( lVector );","			float dotProduct = dot( normal, lVector );","			vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","			diffuseLight += pointLightColor[ i ] * pointLightWeighting * lDistance;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 lVector = lPosition.xyz + vViewPosition;","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","				float lDistance = 1.0;","				if ( spotLightDistance[ i ] > 0.0 ) {","					lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","				}","				lVector = normalize( lVector );","				float dotProduct = dot( normal, lVector );","				vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","				diffuseLight += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","			}","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemiLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","			diffuseLight += hemiLightColor[ i ] * hemiDiffuseWeight;","		}","	#endif","	diffuseLight += ambient;","	return diffuseLight;","}",""].join("\n")};return ShaderChunks}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/renderer/renderer",["odin/base/event_emitter","odin/base/device","odin/base/dom","odin/base/util","odin/math/mathf","odin/math/color","odin/math/rect","odin/math/rect_offset","odin/math/vec2","odin/math/vec3","odin/math/vec4","odin/math/quat","odin/math/mat2","odin/math/mat3","odin/math/mat4","odin/core/enums","odin/core/game/log","odin/core/game/config","odin/core/renderer/render_target","odin/core/renderer/render_target_cube","odin/core/renderer/shader_chunks","odin/core/assets/texture","odin/core/assets/texture_cube","odin/core/components/mesh_filter","odin/core/components/sprite","odin/core/components/particle_system/emitter","odin/core/components/particle_system/emitter_2d"],function(EventEmitter,Device,Dom,util,Mathf,Color,Rect,RectOffset,Vec2,Vec3,Vec4,Quat,Mat2,Mat3,Mat4,Enums,Log,Config,RenderTarget,RenderTargetCube,ShaderChunks,Texture,TextureCube,MeshFilter,Sprite,Emitter,Emitter2D){function Renderer(opts){function render(camera,scene,gui,renderTarget){var lineWidth,blending,cullFace,background,i,w,h,components,ambient,lights,meshFilters,sprites,particleSystems,meshFilter,particleSystem,sprite,transform,guiContents,guiContent;if(_context&&camera){if(background=camera.background,setRenderTarget(renderTarget),(_lastClearColor.r!==background.r||_lastClearColor.g!==background.g||_lastClearColor.b!==background.b)&&(_lastClearColor.copy(background),_gl.clearColor(background.r,background.g,background.b,1),this.autoClear||clearCanvas(!0,this.autoClearDepth,this.autoClearStencil)),_lastCamera!==camera&&(camera.autoResize?(w=_canvas.pixelWidth,h=_canvas.pixelHeight,camera.set(w,h),setViewport(0,0,w,h),_lastResizeFn&&_canvas.off("resize",_lastResizeFn),_lastResizeFn=function(){var w=this.pixelWidth,h=this.pixelHeight;camera.set(w,h),setViewport(0,0,w,h)},_canvas.on("resize",_lastResizeFn)):setViewport(0,0,camera.width,camera.height),_lastCamera=camera),scene&&_lastScene!==scene&&(_lastScene&&removeSceneEvents(_lastScene),addSceneEvents(scene),_lastScene=scene),gui&&_lastGUI!==gui&&(_lastGUI&&removeGUIEvents(_lastGUI),addGUIEvents(gui),_lastScene=gui),_projScreenMatrix.mmul(camera.projection,camera.view),this.autoClear&&clearCanvas(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),scene){for(components=scene.components,ambient=scene.world.ambient,lights=components.Light||EMPTY_ARRAY,meshFilters=components.MeshFilter||EMPTY_ARRAY,sprites=components.Sprite||EMPTY_ARRAY,particleSystems=components.ParticleSystem||EMPTY_ARRAY,lineWidth=_lastLineWidth,blending=_lastBlending,cullFace=_lastCullFace,i=meshFilters.length;i--;){meshFilter=meshFilters[i],transform=meshFilter.transform||meshFilter.transform2d,transform&&(transform.updateMatrices(camera.view),renderMeshFilter(camera,lights,ambient,transform,meshFilter))}for(i=sprites.length;i--;){sprite=sprites[i],transform=sprite.transform||sprite.transform2d,transform&&(transform.updateMatrices(camera.view),renderSprite(camera,lights,ambient,transform,sprite))}for(i=particleSystems.length;i--;){particleSystem=particleSystems[i],transform=particleSystem.transform||sprite.transform2d,transform&&(transform.updateMatrices(camera.view),renderParticleSystem(camera,lights,ambient,transform,particleSystem))}setCullFace(cullFace),setBlending(blending),setLineWidth(lineWidth)}if(gui){for(components=gui.components,guiContents=components.GUIContent||EMPTY_ARRAY,lineWidth=_lastLineWidth,blending=_lastBlending,cullFace=_lastCullFace,useDepth&&setDepthTest(!1),setCullFace(CullFace.Back),i=guiContents.length;i--;){guiContent=guiContents[i],transform=guiContent.guiTransform,transform&&(transform.updateMatrices(camera.guiProjection),renderGUIContent(camera,transform,guiContent))}setBlending(blending),setLineWidth(lineWidth),setCullFace(cullFace),useDepth&&setDepthTest(!0)}}}function renderGUIContent(camera,transform,guiContent){_guiBuffers||createGUIBuffers(),_guiContentShader||createGUIContentShader();var force=setProgram(_guiContentShader.program),uniforms=_guiContentShader.uniforms,attributes=_guiContentShader.attributes,texture=guiContent.texture,text=guiContent.text,style=guiContent.style,styleState=style._state,innerRect=(style[styleState],_rect.copy(transform.position)),outerRect=_rect_2;if(texture){}else{if(!text){return}texture=createTextTexture(guiContent,innerRect,text,style),outerRect.copy(innerRect)}_lastBuffers!==_guiBuffers&&(disableAttributes(),attributes.position.set(_guiBuffers._webglVertexBuffer),attributes.uv.set(_guiBuffers._webglUvBuffer),_lastBuffers=_guiBuffers),style.padding.add(outerRect),style.margin.add(outerRect),uniforms.mvpMatrix.set(transform.modelView,force),uniforms.size.set(_vector2.set(outerRect.width,outerRect.height),force),uniforms.crop.set(_vector4.set(0,0,1,1),force),uniforms.alpha.set(style.alpha,force),_gl.activeTexture(_gl.TEXTURE0),_gl.bindTexture(_gl.TEXTURE_2D,texture._webgl),_gl.uniform1i(uniforms.texture.location,0),_gl.drawArrays(_gl.TRIANGLE_STRIP,0,_guiBuffers._webglVertexCount)}function createTextTexture(guiContent,innerRect,text,style){var canvas,TEXTURE_2D,lineHeight,lineSpacing,halfLineSpacing,fontHeight,ctxStyle,maxWidth,maxHeight,width,height,lines,line,x,y,i,il,texture=_textTextures[guiContent._id];if(!guiContent._needsUpdate){return innerRect.width=texture.width,innerRect.height=texture.height,texture}for(canvas=_canvas2d,TEXTURE_2D=_gl.TEXTURE_2D,lineHeight=style.lineHeight,lineSpacing=style.lineSpacing,halfLineSpacing=.5*lineSpacing,fontHeight=determineFontHeight(style.font),ctxStyle=style.fontStyle+" "+style.fontSize+"pt "+style.font,maxWidth=innerRect.width,maxHeight=innerRect.height,lines=wwLastLines,x=0,y=0,texture=texture||(_textTextures[guiContent._id]={}),_ctx.font=ctxStyle,lineHeight=lineHeight>fontHeight?lineHeight:fontHeight,style.wordWrap&&!style.stretchWidth?(wordWrap(text,maxWidth,lineHeight,lineSpacing),width=wwLastX,height=wwLastY):(lines.length=0,lines.push(text),width=_ctx.measureText(text).width,height=lineHeight+lineSpacing),canvas.width=style.fixedWidth||width,canvas.height=style.fixedHeight||height,_ctx.font=ctxStyle,_ctx.textAlign="left",_ctx.textBaseline="top",i=0,il=lines.length;il>i;i++){line=lines[i],y+=halfLineSpacing,_ctx.fillText(line,x,y),y+=lineHeight+halfLineSpacing}return texture.width=innerRect.width=width,texture.height=innerRect.height=height,texture._webgl=texture._webgl||(texture._webgl=_gl.createTexture()),_gl.bindTexture(TEXTURE_2D,texture._webgl),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,0),_gl.texImage2D(TEXTURE_2D,0,_gl.RGBA,_gl.RGBA,_gl.UNSIGNED_BYTE,canvas),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,_gl.NEAREST),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,_gl.NEAREST),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.bindTexture(TEXTURE_2D,null),guiContent._needsUpdate=!1,texture}function wordWrap(text,maxWidth,lineHeight,lineSpacing){wwLastLines.length=0,wwLastX=0,wwLastY=lineHeight+lineSpacing;for(var word,testLine,testWidth,words=text.split(" "),line="",i=0,il=words.length;il>i;i++){word=words[i],testLine=line+word+" ",testWidth=_ctx.measureText(testLine).width,testWidth>maxWidth&&i>0?(wwLastLines.push(line),line=word+" ",wwLastY+=lineHeight+lineSpacing,testWidth=_ctx.measureText(line).width,wwLastX=testWidth>wwLastX?testWidth:wwLastX):line=testLine
}wwLastLines.push(line)}function determineFontHeight(fontStyle){var body,dummy,dummyText,result=heightCache[fontStyle];return result||(body=document.body||document.getElementsByTagName("body")[0],dummy=document.createElement("div"),dummyText=document.createTextNode("M"),dummy.appendChild(dummyText),dummy.setAttribute("style","font: "+fontStyle+";font-size:1em;line-height:1;position:absolute;top:0;left:0;padding:0;margin:0;"),body.appendChild(dummy),result=dummy.offsetHeight,heightCache[fontStyle]=result,body.removeChild(dummy)),result}function renderMeshFilter(camera,lights,ambient,transform,meshFilter){var side,shader,mesh=meshFilter.mesh,material=meshFilter.material;mesh&&material&&(setBlending(material.blending),side=material.side,side===Side.Front?setCullFace(CullFace.Back):side===Side.Back?setCullFace(CullFace.Front):side===Side.Both&&setCullFace(),createMeshBuffers(mesh),shader=createShader(mesh,material,lights),shader.bind(meshFilter,mesh,material,transform,camera,lights,ambient),meshFilter._webglMeshInitted||(mesh._webglUsed+=1,shader.markAsUsed(material),meshFilter._webglMeshInitted=!0),material.wireframe?(setLineWidth(material.wireframeLineWidth),_gl.drawElements(_gl.LINES,mesh._webglLineCount,_gl.UNSIGNED_SHORT,0)):_gl.drawElements(_gl.TRIANGLES,mesh._webglIndexCount,_gl.UNSIGNED_SHORT,0))}function renderSprite(camera,lights,ambient,transform,sprite){var side,shader,material=sprite.material;material&&(_spriteBuffers||createSprite(),setBlending(material.blending),side=material.side,side===Side.Front?setCullFace(CullFace.Back):side===Side.Back?setCullFace(CullFace.Front):side===Side.Both&&setCullFace(),shader=createShader(sprite,material,lights),sprite._webglInitted||(shader.markAsUsed(material),sprite._webglInitted=!0),shader.bind(sprite,sprite,material,transform,camera,lights,ambient),material.wireframe?(setLineWidth(material.wireframeLineWidth),_gl.drawArrays(_gl.LINE_STRIP,0,_spriteBuffers._webglVertexCount)):_gl.drawArrays(_gl.TRIANGLE_STRIP,0,_spriteBuffers._webglVertexCount))}function renderParticleSystem(camera,lights,ambient,transform,particleSystem){var shader,emitter,emitters=particleSystem.emitters,material=particleSystem.material,i=emitters.length;for(setCullFace(CullFace.Back);i--;){if(emitter=emitters[i],emitter instanceof Emitter){if(material=emitter.material,!material){return}setBlending(material.blending),setCullFace(CullFace.Back),createEmitterBuffers(emitter,transform),shader=createShader(emitter,material,lights),shader.bind(particleSystem,emitter,material,transform,camera,lights,ambient),emitter._webglInitted||(shader.markAsUsed(material),emitter._webglInitted=!0),_gl.drawArrays(_gl.POINTS,0,emitter._webglParticleCount)}else{if(emitter instanceof Emitter2D){if(material=emitter.material,!material){return}setBlending(material.blending),setCullFace(CullFace.Back),createEmitter2DBuffers(emitter,transform),shader=createShader(emitter,material,lights),shader.bind(particleSystem,emitter,material,transform,camera,lights,ambient),emitter._webglInitted||(shader.markAsUsed(material),emitter._webglInitted=!0),_gl.drawArrays(_gl.POINTS,0,emitter._webglParticleCount)}}}}function addSceneEvents(scene){var i,components=scene.components,meshFilters=components.MeshFilter||EMPTY_ARRAY,sprites=components.Sprite||EMPTY_ARRAY,particleSystems=components.ParticleSystem||EMPTY_ARRAY;for(i=meshFilters.length;i--;){meshFilters[i].on("remove",onMeshFilterRemove)}for(i=sprites.length;i--;){sprites[i].on("remove",onSpriteRemove)}for(i=particleSystems.length;i--;){particleSystems[i].on("remove",onParticleSystemRemove)}scene.on("addMeshFilter",onMeshFilterAdd),scene.on("addSprite",onSpriteAdd),scene.on("addParticleSystem",onParticleSystemAdd)}function removeSceneEvents(scene){scene.off("addMeshFilter",onMeshFilterAdd),scene.off("addSprite",onSpriteAdd),scene.off("addParticleSystem",onMeshFilterAdd)}function onMeshFilterAdd(meshFilter){meshFilter.on("remove",onMeshFilterRemove)}function onSpriteAdd(sprite){sprite.on("remove",onSpriteRemove)}function onParticleSystemAdd(particleSystem){particleSystem.on("remove",onParticleSystemRemove)}function onMeshFilterRemove(){var mesh=this.mesh;deleteMeshBuffers(mesh),deleteShader(mesh),this.off("remove",onMeshFilterRemove)}function onSpriteRemove(){deleteShader(this),this.off("remove",onSpriteRemove)}function onParticleSystemRemove(){for(var emitter,emitters=this.emitters,i=emitters.length;i--;){emitter=emitters[i],deleteEmitterBuffers(emitter),deleteShader(emitter)}this.off("remove",onParticleSystemRemove)}function deleteMeshBuffers(mesh){return mesh._webglUsed>1?(mesh._webglUsed-=1,void 0):(void 0!=mesh._webglVertexBuffer&&_gl.deleteBuffer(mesh._webglVertexBuffer),void 0!=mesh._webglNormalBuffer&&_gl.deleteBuffer(mesh._webglNormalBuffer),void 0!=mesh._webglTangentBuffer&&_gl.deleteBuffer(mesh._webglTangentBuffer),void 0!=mesh._webglColorBuffer&&_gl.deleteBuffer(mesh._webglColorBuffer),void 0!=mesh._webglUvBuffer&&_gl.deleteBuffer(mesh._webglUvBuffer),void 0!=mesh._webglUv2Buffer&&_gl.deleteBuffer(mesh._webglUv2Buffer),void 0!=mesh._webglBoneIndexBuffer&&_gl.deleteBuffer(mesh._webglBoneIndexBuffer),void 0!=mesh._webglBoneWeightBuffer&&_gl.deleteBuffer(mesh._webglBoneWeightBuffer),void 0!=mesh._webglIndexBuffer&&_gl.deleteBuffer(mesh._webglIndexBuffer),void 0!=mesh._webglLineBuffer&&_gl.deleteBuffer(mesh._webglLineBuffer),mesh._webglVertexArray=mesh._webglVertexArray=void 0,mesh._webglNormalBuffer=mesh._webglNormalArray=void 0,mesh._webglTangentBuffer=mesh._webglTangentArray=void 0,mesh._webglColorBuffer=mesh._webglColorArray=void 0,mesh._webglUvBuffer=mesh._webglUvArray=void 0,mesh._webglUv2Buffer=mesh._webglUv2Array=void 0,mesh._webglBoneIndexBuffer=mesh._webglBoneIndexArray=void 0,mesh._webglBoneWeightBuffer=mesh._webglBoneWeightArray=void 0,mesh._webglIndexBuffer=mesh._webglIndexArray=void 0,mesh._webglLineBuffer=mesh._webglLineArray=void 0,mesh._webglUsed=0,void 0)}function deleteEmitterBuffers(emitter){void 0!=emitter._webglVertexBuffer&&_gl.deleteBuffer(emitter._webglVertexBuffer),void 0!=emitter._webglParticleBuffer&&_gl.deleteBuffer(emitter._webglParticleBuffer),void 0!=emitter._webglParticleColorBuffer&&_gl.deleteBuffer(emitter._webglParticleColorBuffer),emitter._webglVertexBuffer=emitter._webglVertexArray=void 0,emitter._webglParticleBuffer=emitter._webglParticleArray=void 0,emitter._webglParticleColorBuffer=emitter._webglParticleColorArray=void 0}function addGUIEvents(gui){var i,components=gui.components,guiContents=components.GUIContent||EMPTY_ARRAY;for(i=guiContents.length;i--;){guiContents[i].on("remove",onGUIContentRemove)}gui.on("addGUIContent",onGUIContentAdd)}function removeGUIEvents(gui){gui.off("addGUIContent",onGUIContentAdd)}function onGUIContentAdd(guiContent){guiContent.on("remove",onGUIContentRemove)}function onGUIContentRemove(){deleteShader(this),this.off("remove",onGUIContentRemove)}function deleteShader(obj){var material,i,shader=_shaders[obj._id];if(shader){if(material=obj.material||obj.materials){if(i=material.length){for(;i--;){deleteMaterial(material[i])}}else{deleteMaterial(material)}}if(shader.used>1){return shader.used--,void 0}_shaders[obj._id]=void 0,shader.program&&_gl.deleteProgram(shader.program)}}function deleteMaterial(material){var key,materialUniforms=material.uniforms;for(key in materialUniforms){deleteTexture(materialUniforms[key])}}function deleteTexture(obj){if(obj instanceof Texture){if(obj._webglUsed>1){return obj._webglUsed-=1,void 0}_gl.deleteTexture(obj._webgl),obj._webgl=void 0,obj._webglUsed=0}else{if(obj instanceof TextureCube){if(obj._webglUsed>1){return obj._webglUsed-=1,void 0}for(var j=obj._webgl.length;j--;){_gl.deleteTexture(obj._webgl[j]),obj._webgl[j]=void 0,obj._webglUsed=0}}}}function createMeshBuffers(mesh){if(mesh.dynamic||!mesh._webglBuffersInitted){var bufferArray,items,item,i,len,offset,vertexIndex,DRAW=mesh.dynamic?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW,ARRAY_BUFFER=_gl.ARRAY_BUFFER,ELEMENT_ARRAY_BUFFER=_gl.ELEMENT_ARRAY_BUFFER;if(items=mesh.vertices||EMPTY_ARRAY,len=items.length,len&&mesh.verticesNeedUpdate){for(bufferArray=mesh._webglVertexArray,bufferArray&&bufferArray.length===3*len||(bufferArray=mesh._webglVertexArray=new Float32Array(3*len),mesh._webglVertexCount=len),i=len;i--;){item=items[i],offset=3*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y,bufferArray[offset+2]=item.z}mesh._webglVertexBuffer=mesh._webglVertexBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglVertexBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.verticesNeedUpdate=!1}if(items=mesh.normals||EMPTY_ARRAY,len=items.length,len&&mesh.normalsNeedUpdate){for(bufferArray=mesh._webglNormalArray,bufferArray&&bufferArray.length===3*len||(bufferArray=mesh._webglNormalArray=new Float32Array(3*len)),i=len;i--;){item=items[i],offset=3*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y,bufferArray[offset+2]=item.z}mesh._webglNormalBuffer=mesh._webglNormalBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglNormalBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.normalsNeedUpdate=!1}if(items=mesh.tangents||EMPTY_ARRAY,len=items.length,len&&mesh.tangentsNeedUpdate){for(bufferArray=mesh._webglTangentArray,bufferArray&&bufferArray.length===4*len||(bufferArray=mesh._webglTangentArray=new Float32Array(4*len)),i=len;i--;){item=items[i],offset=4*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y,bufferArray[offset+2]=item.z,bufferArray[offset+3]=item.w}mesh._webglTangentBuffer=mesh._webglTangentBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglTangentBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.tangentsNeedUpdate=!1}if(items=mesh.indices||EMPTY_ARRAY,len=items.length,len&&mesh.indicesNeedUpdate){for(bufferArray=mesh._webglIndexArray,bufferArray&&bufferArray.length===len||(bufferArray=mesh._webglIndexArray=new Uint16Array(len),mesh._webglIndexCount=len),i=len;i--;){bufferArray[i]=items[i]}for(mesh._webglIndexBuffer=mesh._webglIndexBuffer||_gl.createBuffer(),_gl.bindBuffer(ELEMENT_ARRAY_BUFFER,mesh._webglIndexBuffer),_gl.bufferData(ELEMENT_ARRAY_BUFFER,bufferArray,DRAW),bufferArray=mesh._webglLineArray,bufferArray&&bufferArray.length===3*len||(bufferArray=mesh._webglLineArray=new Uint16Array(3*len),mesh._webglLineCount=3*len),i=len,vertexIndex=offset=0;i--;){bufferArray[offset]=items[vertexIndex],bufferArray[offset+1]=items[vertexIndex+1],bufferArray[offset+2]=items[vertexIndex],bufferArray[offset+3]=items[vertexIndex+2],bufferArray[offset+4]=items[vertexIndex+1],bufferArray[offset+5]=items[vertexIndex+2],offset+=6,vertexIndex+=3}mesh._webglLineBuffer=mesh._webglLineBuffer||_gl.createBuffer(),_gl.bindBuffer(ELEMENT_ARRAY_BUFFER,mesh._webglLineBuffer),_gl.bufferData(ELEMENT_ARRAY_BUFFER,bufferArray,DRAW),mesh.indicesNeedUpdate=!1}if(items=mesh.colors||EMPTY_ARRAY,len=items.length,len&&mesh.colorsNeedUpdate){for(bufferArray=mesh._webglColorArray,bufferArray&&bufferArray.length===3*len||(bufferArray=mesh._webglColorArray=new Float32Array(3*len)),i=len;i--;){item=items[i],offset=3*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y,bufferArray[offset+2]=item.z}mesh._webglColorBuffer=mesh._webglColorBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglColorBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.colorsNeedUpdate=!1}if(items=mesh.uvs||EMPTY_ARRAY,len=items.length,len&&mesh.uvsNeedUpdate){for(bufferArray=mesh._webglUvArray,bufferArray&&bufferArray.length===2*len||(bufferArray=mesh._webglUvArray=new Float32Array(2*len)),i=len;i--;){item=items[i],offset=2*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y}mesh._webglUvBuffer=mesh._webglUvBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglUvBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.uvsNeedUpdate=!1}if(items=mesh.uv2s||EMPTY_ARRAY,len=items.length,len&&mesh.uv2sNeedUpdate){for(bufferArray=mesh._webglUv2Array,bufferArray&&bufferArray.length===2*len||(bufferArray=mesh._webglUv2Array=new Float32Array(2*len)),i=len;i--;){item=items[i],offset=2*i,bufferArray[offset]=item.x,bufferArray[offset+1]=item.y}mesh._webglUv2Buffer=mesh._webglUv2Buffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglUv2Buffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.uvsNeedUpdate=!1}if(items=mesh.boneIndices||EMPTY_ARRAY,len=items.length,len&&mesh.boneIndicesNeedUpdate){for(bufferArray=mesh._webglBoneIndexArray,bufferArray&&bufferArray.length===len||(bufferArray=mesh._webglBoneIndexArray=new Float32Array(len)),i=len;i--;){bufferArray[i]=items[i]}mesh._webglBoneIndexBuffer=mesh._webglBoneIndexBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglBoneIndexBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.boneIndicesNeedUpdate=!1}if(items=mesh.boneWeights||EMPTY_ARRAY,len=items.length,len&&mesh.boneWeightsNeedUpdate){for(bufferArray=mesh._webglBoneWeightArray,bufferArray&&bufferArray.length===len||(bufferArray=mesh._webglBoneWeightArray=new Float32Array(len)),i=len;i--;){bufferArray[i]=items[i]}mesh._webglBoneWeightBuffer=mesh._webglBoneWeightBuffer||_gl.createBuffer(),_gl.bindBuffer(ARRAY_BUFFER,mesh._webglBoneWeightBuffer),_gl.bufferData(ARRAY_BUFFER,bufferArray,DRAW),mesh.boneWeightsNeedUpdate=!1}mesh._webglBuffersInitted=!0}}function createEmitterBuffers(emitter,transform){var positionArray,dataArray,colorArray,positionBuffer,dataBuffer,colorBuffer,particle,offset,position,color,me,x,y,z,m13,m23,m33,m43,m14,m24,m34,m44,MAX=Emitter.MAX_PARTICLES,DRAW=_gl.DYNAMIC_DRAW,ARRAY_BUFFER=_gl.ARRAY_BUFFER,particles=emitter.particles,i=0,len=particles.length;if(len){if(emitter.sort){for(emitter.worldSpace?_mat4.copy(_projScreenMatrix):_mat4.mmul(_projScreenMatrix,transform.matrixWorld),me=_mat4.elements,m13=me[2],m23=me[6],m33=me[10],m43=me[14],m14=me[3],m24=me[7],m34=me[11],m44=me[15],i=len;i--;){particle=particles[i],position=particle.position,x=position.x,y=position.y,z=position.z,particle.z=(m13*x+m23*y+m33*z+m43)/(m14*x+m24*y+m34*z+m44)}particles.sort(zSort)}for(positionArray=emitter._webglVertexArray||(emitter._webglVertexArray=new Float32Array(3*MAX)),dataArray=emitter._webglParticleArray||(emitter._webglParticleArray=new Float32Array(3*MAX)),colorArray=emitter._webglParticleColorArray||(emitter._webglParticleColorArray=new Float32Array(3*MAX)),i=len;i--;){particle=particles[i],position=particle.position,color=particle.color,offset=3*i,positionArray[offset]=position.x,positionArray[offset+1]=position.y,positionArray[offset+2]=position.z,dataArray[offset]=particle.angle,dataArray[offset+1]=particle.size,dataArray[offset+2]=particle.alpha,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b}positionBuffer=emitter._webglVertexBuffer||(emitter._webglVertexBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,positionBuffer),_gl.bufferData(ARRAY_BUFFER,positionArray,DRAW),dataBuffer=emitter._webglParticleBuffer||(emitter._webglParticleBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,dataBuffer),_gl.bufferData(ARRAY_BUFFER,dataArray,DRAW),colorBuffer=emitter._webglParticleColorBuffer||(emitter._webglParticleColorBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,colorBuffer),_gl.bufferData(ARRAY_BUFFER,colorArray,DRAW)}emitter._webglParticleCount=len}function createEmitter2DBuffers(emitter){var positionArray,dataArray,colorArray,positionBuffer,dataBuffer,colorBuffer,particle,offset,position,color,MAX=Emitter2D.MAX_PARTICLES,DRAW=_gl.DYNAMIC_DRAW,ARRAY_BUFFER=_gl.ARRAY_BUFFER,particles=emitter.particles,i=0,len=particles.length;if(len){for(positionArray=emitter._webglVertexArray||(emitter._webglVertexArray=new Float32Array(3*MAX)),dataArray=emitter._webglParticleArray||(emitter._webglParticleArray=new Float32Array(3*MAX)),colorArray=emitter._webglParticleColorArray||(emitter._webglParticleColorArray=new Float32Array(3*MAX)),i=len;i--;){particle=particles[i],position=particle.position,color=particle.color,offset=3*i,positionArray[offset]=position.x,positionArray[offset+1]=position.y,positionArray[offset+2]=0,dataArray[offset]=particle.angle,dataArray[offset+1]=particle.size,dataArray[offset+2]=particle.alpha,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b}positionBuffer=emitter._webglVertexBuffer||(emitter._webglVertexBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,positionBuffer),_gl.bufferData(ARRAY_BUFFER,positionArray,DRAW),dataBuffer=emitter._webglParticleBuffer||(emitter._webglParticleBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,dataBuffer),_gl.bufferData(ARRAY_BUFFER,dataArray,DRAW),colorBuffer=emitter._webglParticleColorBuffer||(emitter._webglParticleColorBuffer=_gl.createBuffer()),_gl.bindBuffer(ARRAY_BUFFER,colorBuffer),_gl.bufferData(ARRAY_BUFFER,colorArray,DRAW)}emitter._webglParticleCount=len}function zSort(a,b){return b.z-a.z}function createShader(obj,material,lights){if(!material.needsUpdate&&_shaders[obj._id]){return _shaders[obj._id]}var shader=material.shader,uniforms=material.uniforms,OES_standard_derivatives=!!_extensions.OES_standard_derivatives,parameters={};return parameters.mobile=Device.mobile,obj instanceof MeshFilter?parameters.mesh=!0:obj instanceof Sprite?parameters.sprite=!0:obj instanceof Emitter?(parameters.emitter=!0,parameters.worldSpace=obj.worldSpace):obj instanceof Emitter2D&&(parameters.emitter=!0,parameters.emitter2d=!0,parameters.worldSpace=obj.worldSpace),parameters.useLights=shader.lights,parameters.useShadows=shader.shadows,parameters.useFog=shader.fog,parameters.useBones=obj.useBones&&obj.bones.length>0,parameters.useVertexLit=shader.vertexLit,parameters.useSpecular=shader.specular,parameters.useNormal=!!uniforms.normalMap,parameters.useBump=!!uniforms.bumpMap,parameters.positions=!0,parameters.normals=parameters.useNormal||obj.normals&&obj.normals.length>0,parameters.tangents=parameters.useNormal||obj.tangents&&obj.tangents.length>0,parameters.uvs=parameters.sprite||obj.uvs&&obj.uvs.length>0,parameters.colors=parameters.sprite||obj.colors&&obj.colors.length>0,parameters.OES_standard_derivatives=OES_standard_derivatives&&shader.OES_standard_derivatives,parameters.useBones&&(parameters.bones=obj.bones.length),allocateLights(lights,parameters),allocateShadows(lights,parameters),parameters.shadowMapEnabled=_this.shadowMapEnabled&&material.receiveShadow&&parameters.maxShadows>0,parameters.shadowMapType=_this.shadowMapType,parameters.shadowMapDebug=_this.shadowMapDebug,parameters.shadowMapCascade=_this.shadowMapCascade,material.needsUpdate=!1,_shaders[obj._id]=createShaderProgram(shader.vertex,shader.fragment,parameters)}function allocateLights(lights,parameters){for(var light,type,maxPointLights=0,maxDirectionalLights=0,maxSpotLights=0,maxHemiLights=0,i=lights.length;i--;){light=lights[i],light.visible&&!light.onlyShadow&&(type=light.type,type===LightType.Point?maxPointLights++:type===LightType.Directional?maxDirectionalLights++:type===LightType.Spot?maxSpotLights++:type===LightType.Hemi&&maxHemiLights++)}parameters.maxPointLights=maxPointLights,parameters.maxDirectionalLights=maxDirectionalLights,parameters.maxSpotLights=maxSpotLights,parameters.maxHemiLights=maxHemiLights}function allocateShadows(lights,parameters){for(var light,type,maxShadows=0,i=lights.length;i--;){light=lights[i],light.visible&&light.castShadow&&(type=light.type,type===LightType.Directional?maxShadows++:type===LightType.Spot&&maxShadows++)}parameters.maxShadows=maxShadows}function createShaderProgram(vertexShader,fragmentShader,parameters){var key,program,code,key,chunks=[];chunks.push(vertexShader,fragmentShader);for(key in parameters){chunks.push(key,parameters[key])}code=chunks.join();for(key in _shaders){if(program=_shaders[key],program.code===code){return program.used++,program}}return program=new Shader(vertexShader,fragmentShader,parameters,code).buildShader()}function Shader(vertex,fragment,parameters,code){this.vertex=vertex,this.fragment=fragment,this.parameters=parameters,this.code=code,this.used=0,this.program=void 0,this.attributes=void 0,this.uniforms=void 0,this._customAttributes=void 0,this._customUniforms=void 0}function bindCustomUniforms(customUniforms,uniforms,materialName,materialUniforms,force){for(var customUniform,uniformValue,length,name,value,j,i=customUniforms.length;i--;){if(customUniform=customUniforms[i],name=customUniform,uniformValue=uniforms[name],value=materialUniforms[name],uniformValue){if(!value){throw"WebGLRenderer bindShader: material "+materialName+" was not given a uniform named "+name}if(length=uniformValue.length){for(j=length;j--;){uniformValue.set(value[j],force)}}else{uniformValue.set(value,force)}}}}function createBuffer(obj,name,array){obj[name]=obj[name]||_gl.createBuffer(),_gl.bindBuffer(_gl.ARRAY_BUFFER,obj[name]),_gl.bufferData(_gl.ARRAY_BUFFER,array,_gl.STATIC_DRAW)}function createSprite(){_spriteBuffers={},createBuffer(_spriteBuffers,"_webglVertexBuffer",new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])),createBuffer(_spriteBuffers,"_webglUvBuffer",new Float32Array([0,0,0,1,1,0,1,1])),createBuffer(_spriteBuffers,"_webglNormalBuffer",new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])),createBuffer(_spriteBuffers,"_webglTangentBuffer",new Float32Array([0,0,0,1,0,1,0,1,1,0,0,1,1,1,0,1])),_spriteBuffers._webglVertexCount=4}function createGUIBuffers(){_guiBuffers={},createBuffer(_guiBuffers,"_webglVertexBuffer",new Float32Array([0,0,0,0,1,0,1,0,0,1,1,0])),createBuffer(_guiBuffers,"_webglUvBuffer",new Float32Array([0,0,0,1,1,0,1,1])),_guiBuffers._webglVertexCount=4}function createGUIContentShader(){var shader=_guiContentShader=new Shader,header=["precision "+_precision+" float;","precision "+_precision+" int;",""].join("\n"),vertexShader=header+guiContent_vertex,fragmentShader=header+guiContent_fragment;shader.program=createProgram(_gl,vertexShader,fragmentShader),parseUniformsAttributes(shader.program,vertexShader,fragmentShader,shader.attributes={},shader.uniforms={})}function setViewport(x,y,width,height){x||(x=0),y||(y=0),width||(width=_canvas.pixelWidth),height||(height=_canvas.pixelHeight),(_viewportX!==x||_viewportY!==y||_viewportWidth!==width||_viewportHeight!==height)&&(_viewportX=x,_viewportY=y,_viewportWidth=width,_viewportHeight=height,_gl.viewport(x,y,width,height))}function setDepthTest(depthTest){_lastDepthTest!==depthTest&&(depthTest?_gl.enable(_gl.DEPTH_TEST):_gl.disable(_gl.DEPTH_TEST),_lastDepthTest=depthTest)}function setDepthWrite(depthWrite){_lastDepthWrite!==depthWrite&&(_gl.depthMask(depthWrite),_lastDepthWrite=depthWrite)}function setLineWidth(width){_lastLineWidth!==width&&(_gl.lineWidth(width),_lastLineWidth=width)}function setCullFace(cullFace){if(_lastCullFace!==cullFace){if(_lastCullFace&&_lastCullFace!==CullFace.None||(_cullFaceDisabled=!0),cullFace===CullFace.Front){_cullFaceDisabled&&_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.FRONT)}else{if(cullFace===CullFace.Back){_cullFaceDisabled&&_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.BACK)}else{if(cullFace!==CullFace.FrontBack){return _gl.disable(_gl.CULL_FACE),_lastCullFace=CullFace.None,void 0}_cullFaceDisabled&&_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.FRONT_AND_BACK)}}_lastCullFace=cullFace}}function setBlending(blending){if(blending!==_lastBlending){if(blending===Blending.None){_gl.disable(_gl.BLEND)}else{if(blending===Blending.Additive){_gl.enable(_gl.BLEND),_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE)}else{if(blending===Blending.Subtractive){_gl.enable(_gl.BLEND),_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ZERO,_gl.ONE_MINUS_SRC_COLOR)}else{if(blending===Blending.Muliply){_gl.enable(_gl.BLEND),_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ZERO,_gl.SRC_COLOR)}else{if(blending===Blending.Default){return _gl.enable(_gl.BLEND),_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA),_lastBlending=Blending.Default,void 0}}}}}_lastBlending=blending}}function setScissor(x,y,width,height){_gl.scissor(x,y,width,height)}function setClearColor(color,alpha){alpha||(alpha=1),_lastClearColor.equals(color)&&alpha===_lastClearAlpha||(_lastClearColor.copy(color),_lastClearAlpha=alpha,this.context.clearColor(_lastClearColor.r,_lastClearColor.g,_lastClearColor.b,_lastClearAlpha))}function clearCanvas(color,depth,stencil){var bits=0;(void 0===color||color)&&(bits|=_gl.COLOR_BUFFER_BIT),(void 0===depth||depth)&&(bits|=_gl.DEPTH_BUFFER_BIT),(void 0===stencil||stencil)&&(bits|=_gl.STENCIL_BUFFER_BIT),_gl.clear(bits)}function clearColor(){_gl.clear(_gl.COLOR_BUFFER_BIT)}function clearDepth(){_gl.clear(_gl.DEPTH_BUFFER_BIT)}function clearStencil(){_gl.clear(_gl.STENCIL_BUFFER_BIT)}function setProgram(program){return _lastProgram!==program?(_gl.useProgram(program),_lastProgram=program,!0):!1}function enableAttribute(attribute){0===_enabledAttributes[attribute]&&(_gl.enableVertexAttribArray(attribute),_enabledAttributes[attribute]=1)}function disableAttributes(){for(var i=_maxAttributes;i--;){1===_enabledAttributes[i]&&(_gl.disableVertexAttribArray(i),_enabledAttributes[i]=0)}}function setTexture(location,texture){var index,glTexture,raw,TFA,isPOT,anisotropy,TEXTURE_2D,generateMipmap,filter,format,wrap,WRAP,MAG_FILTER,MIN_FILTER,FORMAT;if(texture){return _textureIndex>=_maxTextures&&Log.warn("Renderer setTexure: using "+_textureIndex+" texture units, GPU only supports "+_maxTextures),(!texture.needsUpdate||texture instanceof RenderTarget)&&(glTexture=texture._webgl)?(index=_textureIndex++,_gl.activeTexture(_gl.TEXTURE0+index),_gl.bindTexture(_gl.TEXTURE_2D,glTexture),_gl.uniform1i(location,index),void 0):(texture.raw&&(glTexture=texture._webgl||(texture._webgl=_gl.createTexture()),index=_textureIndex++,raw=texture.raw,TFA=_extensions.EXT_texture_filter_anisotropic,isPOT=isPowerOfTwo(raw.width)&&isPowerOfTwo(raw.height),anisotropy=clamp(texture.anisotropy||1,1,_maxAnisotropy),TEXTURE_2D=_gl.TEXTURE_2D,generateMipmap=texture.generateMipmap,filter=texture.filter,format=texture.format,wrap=texture.wrap,filter===FilterMode.None?(MAG_FILTER=_gl.NEAREST,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_NEAREST:_gl.NEAREST):(MAG_FILTER=_gl.LINEAR,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_LINEAR:_gl.LINEAR),format===TextureFormat.RGB?FORMAT=_gl.RGB:format===TextureFormat.RGBA?FORMAT=_gl.RGBA:format===TextureFormat.LuminanceAlpha?FORMAT=_gl.LUMINANCE_ALPHA:format===TextureFormat.Luminance?FORMAT=_gl.LUMINANCE:format===TextureFormat.Alpha&&(FORMAT=_gl.ALPHA),WRAP=wrap===TextureWrap.Clamp?_gl.CLAMP_TO_EDGE:wrap===TextureWrap.MirrorRepeat?isPOT?_gl.MIRRORED_REPEAT:_gl.CLAMP_TO_EDGE:isPOT?_gl.REPEAT:_gl.CLAMP_TO_EDGE,_gl.activeTexture(_gl.TEXTURE0+index),_gl.bindTexture(TEXTURE_2D,glTexture),_gl.uniform1i(location,index),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY?1:0),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha?1:0),_gl.texImage2D(TEXTURE_2D,0,FORMAT,FORMAT,_gl.UNSIGNED_BYTE,clampToMaxSize(raw,_maxTextureSize)),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,MAG_FILTER),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,MIN_FILTER),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_WRAP_S,WRAP),_gl.texParameteri(TEXTURE_2D,_gl.TEXTURE_WRAP_T,WRAP),TFA&&_gl.texParameterf(TEXTURE_2D,TFA.TEXTURE_MAX_ANISOTROPY_EXT,anisotropy),generateMipmap&&isPOT&&_gl.generateMipmap(TEXTURE_2D),texture.needsUpdate=!1),void 0)}}function setTextureCube(location,cubeTexture){var glTexture,index,raw,TFA,first,isPOT,anisotropy,TEXTURE_CUBE_MAP,TEXTURE_CUBE_MAP_POSITIVE_X,UNSIGNED_BYTE,generateMipmap,filter,format,wrap,WRAP,MAG_FILTER,MIN_FILTER,FORMAT;if(cubeTexture&&cubeTexture.raw){if(glTexture=cubeTexture._webgl,_textureIndex>=_maxTextures){return Log.warn("Renderer setTextureCube: using "+_textureIndex+" texture units, GPU only supports "+_maxTextures),void 0}if(!cubeTexture.needsUpdate&&glTexture){return index=_textureIndex++,_gl.activeTexture(_gl.TEXTURE0+index),_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,glTexture),_gl.uniform1i(location,index),void 0}glTexture=cubeTexture._webgl||(cubeTexture._webgl=_gl.createTexture()),index=_textureIndex++,raw=cubeTexture.raw,TFA=_extensions.EXT_texture_filter_anisotropic,first=raw[0],isPOT=isPowerOfTwo(first.width)&&isPowerOfTwo(first.height),anisotropy=clamp(cubeTexture.anisotropy||1,1,_maxAnisotropy),TEXTURE_CUBE_MAP=_gl.TEXTURE_CUBE_MAP,TEXTURE_CUBE_MAP_POSITIVE_X=_gl.TEXTURE_CUBE_MAP_POSITIVE_X,UNSIGNED_BYTE=_gl.UNSIGNED_BYTE,generateMipmap=cubeTexture.generateMipmap,filter=cubeTexture.filter,format=cubeTexture.format,wrap=cubeTexture.wrap,filter===FilterMode.None?(MAG_FILTER=_gl.NEAREST,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_NEAREST:_gl.NEAREST):(MAG_FILTER=_gl.LINEAR,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_LINEAR:_gl.LINEAR),format===TextureFormat.RGB?FORMAT=_gl.RGB:format===TextureFormat.RGBA?FORMAT=_gl.RGBA:format===TextureFormat.LuminanceAlpha?FORMAT=_gl.LUMINANCE_ALPHA:format===TextureFormat.Luminance?FORMAT=_gl.LUMINANCE:format===TextureFormat.Alpha&&(FORMAT=_gl.ALPHA),WRAP=wrap===TextureWrap.Clamp?_gl.CLAMP_TO_EDGE:isPOT?_gl.REPEAT:_gl.CLAMP_TO_EDGE,_gl.activeTexture(_gl.TEXTURE0+index),_gl.bindTexture(TEXTURE_CUBE_MAP,glTexture),_gl.uniform1i(location,index),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,cubeTexture.flipY?1:0),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,cubeTexture.premultiplyAlpha?1:0),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[0],_maxCubeTextureSize)),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[1],_maxCubeTextureSize)),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[2],_maxCubeTextureSize)),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[3],_maxCubeTextureSize)),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[4],_maxCubeTextureSize)),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,FORMAT,FORMAT,UNSIGNED_BYTE,clampToMaxSize(raw[5],_maxCubeTextureSize)),_gl.texParameteri(TEXTURE_CUBE_MAP,_gl.TEXTURE_MAG_FILTER,MAG_FILTER),_gl.texParameteri(TEXTURE_CUBE_MAP,_gl.TEXTURE_MIN_FILTER,MIN_FILTER),_gl.texParameteri(TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_S,WRAP),_gl.texParameteri(TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_T,WRAP),TFA&&_gl.texParameterf(TEXTURE_CUBE_MAP,TFA.TEXTURE_MAX_ANISOTROPY_EXT,anisotropy),generateMipmap&&isPOT&&_gl.generateMipmap(TEXTURE_CUBE_MAP),cubeTexture.needsUpdate=!1}}function clampToMaxSize(image,maxSize){if(image.height<=maxSize&&image.width<=maxSize){return image}var maxDim=1/max(image.width,image.height),newWidth=floor(image.width*maxSize*maxDim),newHeight=floor(image.height*maxSize*maxDim),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");return canvas.width=newWidth,canvas.height=newHeight,ctx.drawImage(image,0,0,image.width,image.height,0,0,newWidth,newHeight),Log.once("Renderer clampToMaxSize: image height larger than machines max size (max = "+maxSize+")"),canvas}function setRenderTarget(renderTarget){var width,height,vx,vy,TFA,isPOT,anisotropy,GL_TEXTURE_TYPE,UNSIGNED_BYTE,UNSIGNED_SHORT,DEPTH_COMPONENT,generateMipmap,filter,format,wrap,WRAP,MAG_FILTER,MIN_FILTER,FORMAT,webglFramebuffer,webglRenderbuffer,depthOnly,i,isRenderTarget=!!renderTarget,isCube=renderTarget instanceof RenderTargetCube,framebuffer=null;if(isRenderTarget&&!renderTarget._webglFramebuffer){if(width=renderTarget.width,height=renderTarget.height,renderTarget._webgl=_gl.createTexture(),TFA=_extensions.EXT_texture_filter_anisotropic,isPOT=isPowerOfTwo(width)&&isPowerOfTwo(height),anisotropy=clamp(renderTarget.anisotropy||1,1,_maxAnisotropy),GL_TEXTURE_TYPE=isCube?_gl.TEXTURE_CUBE_MAP:_gl.TEXTURE_2D,UNSIGNED_BYTE=_gl.UNSIGNED_BYTE,UNSIGNED_SHORT=_gl.UNSIGNED_SHORT,DEPTH_COMPONENT=_gl.DEPTH_COMPONENT,generateMipmap=renderTarget.generateMipmap,filter=renderTarget.filter,format=renderTarget.format,wrap=renderTarget.wrap,depthOnly=renderTarget.depthOnly,filter===FilterMode.None?(MAG_FILTER=_gl.NEAREST,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_NEAREST:_gl.NEAREST):(MAG_FILTER=_gl.LINEAR,MIN_FILTER=generateMipmap&&isPOT?_gl.LINEAR_MIPMAP_LINEAR:_gl.LINEAR),format===TextureFormat.RGB?FORMAT=_gl.RGB:format===TextureFormat.RGBA?FORMAT=_gl.RGBA:format===TextureFormat.LuminanceAlpha?FORMAT=_gl.LUMINANCE_ALPHA:format===TextureFormat.Luminance?FORMAT=_gl.LUMINANCE:format===TextureFormat.Alpha&&(FORMAT=_gl.ALPHA),WRAP=wrap===TextureWrap.Clamp?_gl.CLAMP_TO_EDGE:wrap===TextureWrap.MirrorRepeat?isPOT?_gl.MIRRORED_REPEAT:_gl.CLAMP_TO_EDGE:isPOT?_gl.REPEAT:_gl.CLAMP_TO_EDGE,_gl.bindTexture(GL_TEXTURE_TYPE,renderTarget._webgl),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,renderTarget.flipY?1:0),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,renderTarget.premultiplyAlpha?1:0),isCube){for(webglFramebuffer=renderTarget._webglFramebuffer=[],webglRenderbuffer=renderTarget._webglRenderbuffer=[],renderTarget.depthOnly?(_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_BYTE,null)):(_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null)),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_MAG_FILTER,MAG_FILTER),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_MIN_FILTER,MIN_FILTER),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_WRAP_S,WRAP),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_WRAP_T,WRAP),i=6;i--;){webglFramebuffer[i]=_gl.createFramebuffer(),webglRenderbuffer[i]=_gl.createRenderbuffer(),setupFrameBuffer(webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i),setupRenderBuffer(webglRenderbuffer[i],renderTarget)
}}else{renderTarget._webglFramebuffer=_gl.createFramebuffer(),renderTarget._webglRenderbuffer=_gl.createRenderbuffer(),renderTarget.depthOnly?_gl.texImage2D(GL_TEXTURE_TYPE,0,DEPTH_COMPONENT,width,height,0,DEPTH_COMPONENT,UNSIGNED_SHORT,null):_gl.texImage2D(GL_TEXTURE_TYPE,0,FORMAT,width,height,0,FORMAT,UNSIGNED_BYTE,null),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_MAG_FILTER,MAG_FILTER),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_MIN_FILTER,MIN_FILTER),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_WRAP_S,WRAP),_gl.texParameteri(GL_TEXTURE_TYPE,_gl.TEXTURE_WRAP_T,WRAP),setupFrameBuffer(renderTarget._webglFramebuffer,renderTarget,GL_TEXTURE_TYPE),setupRenderBuffer(renderTarget._webglRenderbuffer,renderTarget)}TFA&&_gl.texParameterf(GL_TEXTURE_TYPE,TFA.TEXTURE_MAX_ANISOTROPY_EXT,anisotropy),generateMipmap&&isPOT&&_gl.generateMipmap(GL_TEXTURE_TYPE),_gl.bindTexture(GL_TEXTURE_TYPE,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}isRenderTarget?(framebuffer=isCube?renderTarget._webglFramebuffer[renderTarget.activeCubeFace]:renderTarget._webglFramebuffer,vx=0,vy=0,width=renderTarget.width,height=renderTarget.height):(vx=_viewportX,vy=_viewportY,width=_viewportWidth,height=_viewportHeight),framebuffer!==_currentFramebuffer&&(_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),_gl.viewport(vx,vy,width,height),_currentFramebuffer=framebuffer),_currentWidth=width,_currentHeight=height}function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,renderTarget._webgl,0)}function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer),renderTarget.depthBuffer&&!renderTarget.stencilBuffer?(_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)):!renderTarget.depthBuffer&&renderTarget.stencilBuffer?(_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.STENCIL_INDEX8,renderTarget.width,renderTarget.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)):renderTarget.depthBuffer&&renderTarget.stencilBuffer?(_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)):_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}function handleWebGLContextLost(e){e.preventDefault(),Log.warn("Renderer: webgl context was lost"),_context=!1,this.emit("webglcontextlost",e)}function handleWebGLContextRestored(e){Log.log("Renderer: webgl context was restored"),initGL(),setDefaultGLState(),_context=!0,this.emit("webglcontextrestored",e)}function getGPUInfo(){var VERTEX_SHADER=_gl.VERTEX_SHADER,FRAGMENT_SHADER=_gl.FRAGMENT_SHADER,HIGH_FLOAT=_gl.HIGH_FLOAT,MEDIUM_FLOAT=_gl.MEDIUM_FLOAT,EXT_texture_filter_anisotropic=_extensions.EXT_texture_filter_anisotropic,vsHighpFloat=_gl.getShaderPrecisionFormat(VERTEX_SHADER,HIGH_FLOAT),vsMediumpFloat=_gl.getShaderPrecisionFormat(VERTEX_SHADER,MEDIUM_FLOAT),fsHighpFloat=_gl.getShaderPrecisionFormat(FRAGMENT_SHADER,HIGH_FLOAT),fsMediumpFloat=_gl.getShaderPrecisionFormat(FRAGMENT_SHADER,MEDIUM_FLOAT),highpAvailable=vsHighpFloat.precision>0&&fsHighpFloat.precision>0,mediumpAvailable=vsMediumpFloat.precision>0&&fsMediumpFloat.precision>0,precision="highp";(!highpAvailable||Device.mobile)&&(precision=mediumpAvailable?"mediump":"lowp"),_precision=precision,_maxAnisotropy=EXT_texture_filter_anisotropic?_gl.getParameter(EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,_maxTextures=_gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS),_maxVertexTextures=_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_maxTextureSize=_gl.getParameter(_gl.MAX_TEXTURE_SIZE),_maxCubeTextureSize=_gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE),_maxRenderBufferSize=_gl.getParameter(_gl.MAX_RENDERBUFFER_SIZE),_maxUniforms=4*max(_gl.getParameter(_gl.MAX_FRAGMENT_UNIFORM_VECTORS),_gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS)),_maxVaryings=4*_gl.getParameter(_gl.MAX_VARYING_VECTORS),_maxAttributes=_gl.getParameter(_gl.MAX_VERTEX_ATTRIBS)}function getExtensions(){_extensions={},getExtension("EXT_texture_filter_anisotropic"),getExtension("WEBGL_compressed_texture_s3tc"),_extensions.WEBGL_compressed_texture_s3tc_formats=_extensions.WEBGL_compressed_texture_s3tc?_gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS):null,getExtension("OES_standard_derivatives")}function getExtension(name){var i,extension=_extensions[name]||(_extensions[name]=_gl.getExtension(name));if(void 0==extension){for(i=getExtension_length;i--;){if(extension=_gl.getExtension(getExtension_prefixes[i]+"_"+name)){return _extensions[name]=extension}}}return extension}function initGL(){_gl=getWebGLContext(_element,_attributes),_gl.getShaderPrecisionFormat||(_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),getExtensions(),getGPUInfo(),_enabledAttributes=new Uint8Array(_maxAttributes)}function setDefaultGLState(){_gl.clearColor(0,0,0,1),useDepth&&_gl.clearDepth(1),_gl.clearStencil(0),useDepth&&setDepthTest(!0),useDepth&&_gl.depthFunc(_gl.LEQUAL),_gl.frontFace(_gl.CCW),setCullFace(CullFace.Back),setBlending(Blending.Default),setLineWidth(1),setViewport()}function parseUniformsAttributesArrays(vertexShader,fragmentShader,attributes,uniforms){for(var matchAttributes,matchUniforms,line,src=vertexShader+fragmentShader,lines=src.split(SHADER_SPLITER),i=lines.length;i--;){line=lines[i],matchAttributes=line.match(ATTRIBURE),matchUniforms=line.match(UNIFORM),matchAttributes?attributes.push(matchAttributes[3]):matchUniforms&&uniforms.push(matchUniforms[3])}}function parseUniformsAttributes(program,vertexShader,fragmentShader,attributes,uniforms){var matchAttributes,matchUniforms,matchDefines,uniformArray,name,type,location,length,line,i,j,src=vertexShader+fragmentShader,lines=src.split(SHADER_SPLITER),defines={};for(i=lines.length;i--;){matchDefines=lines[i].match(DEFINE),matchDefines&&(defines[matchDefines[1]]=Number(matchDefines[2]))}for(i=lines.length;i--;){if(line=lines[i],matchAttributes=line.match(ATTRIBURE),matchUniforms=line.match(UNIFORM),matchAttributes){name=matchAttributes[3],attributes[name]=createAttribute(matchAttributes[2],_gl.getAttribLocation(program,name))}else{if(matchUniforms){if(type=matchUniforms[2],name=matchUniforms[3],length=matchUniforms[5]){for(length=defines[length.trim()]||length,uniformArray=uniforms[name]=[],j=length;j--;){uniformArray[j]=createUniform(type,_gl.getUniformLocation(program,name+"["+j+"]"))}}else{location=_gl.getUniformLocation(program,name),location&&(uniforms[name]=createUniform(type,location))}}}}}function createAttribute(type,location){return 0>location?null:"int"===type?new Attribute1i(location):"float"===type?new Attribute1f(location):"vec2"===type?new Attribute2f(location):"vec3"===type?new Attribute3f(location):"vec4"===type?new Attribute4f(location):null}function Attribute1i(location){this.location=location}function Attribute1f(location){this.location=location}function Attribute2f(location){this.location=location}function Attribute3f(location){this.location=location}function Attribute4f(location){this.location=location}function createUniform(type,location){return location?"int"===type?new Uniform1i(location):"float"===type?new Uniform1f(location):"vec2"===type?new Uniform2f(location):"vec3"===type?new Uniform3f(location):"vec4"===type?new Uniform4f(location):"mat2"===type?new UniformMatrix2fv(location):"mat3"===type?new UniformMatrix3fv(location):"mat4"===type?new UniformMatrix4fv(location):"sampler2D"===type?new UniformTexture(location):"samplerCube"===type?new UniformTextureCube(location):null:null}function Uniform1f(location){this.location=location,this.value=void 0}function Uniform1i(location){this.location=location,this.value=void 0}function Uniform2f(location){this.location=location,this.value=new Vec2(0/0,0/0)}function Uniform3f(location){this.location=location,this.value=new Vec3(0/0,0/0,0/0)}function Uniform4f(location){this.location=location,this.value=new Vec4(0/0,0/0,0/0,0/0)}function UniformMatrix2fv(location){this.location=location,this.value=new Mat2(0/0,0/0,0/0,0/0)}function UniformMatrix3fv(location){this.location=location,this.value=new Mat3(0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0)}function UniformMatrix4fv(location){this.location=location,this.value=new Mat4(0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0,0/0)}function UniformTexture(location){this.location=location}function UniformTextureCube(location){this.location=location}var _lastCamera,_lastResizeFn,_lastScene,_lastGUI,_mat4,_projScreenMatrix,_quat,_vector2,_vector3,_vector3_2,_vector4,_rect,_rect_2,_rectOffset,_color,_shaders,_lastBuffers,_spriteBuffers,_textTextures,_canvas2d,_ctx,_guiBuffers,_guiContentShader,wwLastLines,wwLastX,wwLastY,heightCache,HEADER,MAIN_FUNCTION,MAIN_SPLITER,useDepth,_this,_gl,_canvas,_element,_context,_extensions,_precision,_maxAnisotropy,_maxTextures,_maxVertexTextures,_maxTextureSize,_maxCubeTextureSize,_maxRenderBufferSize,_maxUniforms,_maxVaryings,_maxAttributes,_viewportX,_viewportY,_viewportWidth,_viewportHeight,_currentWidth,_currentHeight,_textureIndex,_lastClearColor,_lastClearAlpha,_lastBlending,_lastCullFace,_cullFaceDisabled,_lastDepthTest,_lastDepthWrite,_lastLineWidth,_currentFramebuffer,_enabledAttributes,_lastProgram,_attributes,getExtension_prefixes,getExtension_length,SHADER_SPLITER,ATTRIBURE,UNIFORM,DEFINE;opts||(opts={}),EventEmitter.call(this),this.autoClear=void 0!=opts.autoClear?opts.autoClear:!0,this.autoClearColor=void 0!=opts.autoClearColor?opts.autoClearColor:!0,this.autoClearDepth=void 0!=opts.autoClearDepth?opts.autoClearDepth:!0,this.autoClearStencil=void 0!=opts.autoClearStencil?opts.autoClearStencil:!0,this.shadowMapEnabled=void 0!=opts.shadowMapEnabled?opts.shadowMapEnabled:!0,this.shadowMapAutoUpdate=void 0!=opts.shadowMapAutoUpdate?opts.shadowMapAutoUpdate:!0,this.shadowMapType=void 0!=opts.shadowMapType?opts.shadowMapType:ShadowMapType.PCFShadowMap,this.shadowMapCullFace=void 0!=opts.shadowMapCullFace?opts.shadowMapCullFace:CullFace.Front,this.shadowMapDebug=void 0!=opts.shadowMapDebug?opts.shadowMapDebug:!1,this.shadowMapCascade=void 0!=opts.shadowMapCascade?opts.shadowMapCascade:!1,_lastCamera=void 0,_lastResizeFn=void 0,_lastScene=void 0,_lastGUI=void 0,_mat4=new Mat4,_projScreenMatrix=new Mat4,_quat=new Quat,_vector2=new Vec2,_vector3=new Vec3,_vector3_2=new Vec3,_vector4=new Vec4,_rect=new Rect,_rect_2=new Rect,_rectOffset=new RectOffset,_color=new Color,_shaders={},_lastBuffers=void 0,_spriteBuffers=void 0,_textTextures={},_canvas2d=void 0,_ctx=void 0,this.render=render,_guiBuffers=void 0,_guiContentShader=void 0,wwLastLines=[],wwLastX=0,wwLastY=0,heightCache={},HEADER=/([\s\S]*)?(void[\s]+main)/,MAIN_FUNCTION=/void[\s]+main([\s]+)?(\((void)?\))([\s]+)?{([^}]*)}/,MAIN_SPLITER=/void[\s]+main([\s]+)?(\((void)?\))([\s]+)?{/,Shader.prototype.markAsUsed=function(material){if(this.used+=1,material){var uniform,key,uniforms=material.uniforms;for(key in uniforms){uniform=uniforms[key],uniform instanceof Texture?uniform._webglUsed+=1:uniform instanceof TextureCube&&(uniform._webglUsed+=1)}}},Shader.prototype.bind=function(component,obj,material,transform,camera,lights,ambient){var texture,w,h,i,length,particleSizeRatio,bone,boneTransform,bones,uBonesPos,uBonesScl,uBonesRot,maxPointLights,maxDirectionalLights,maxSpotLights,maxHemiLights,pointLights,pointLightColor,pointLightPosition,pointLightDistance,directionalLights,directionalLightColor,directionalLightDirection,spotLights,spotLightColor,spotLightPosition,spotLightDirection,spotLightDistance,spotLightAngleCos,spotLightExponent,hemiLights,hemiLightColor,hemiLightDirection,light,type,program=this.program,parameters=this.parameters,uniforms=this.uniforms,attributes=this.attributes,force=setProgram(program),sprite=parameters.sprite;if(sprite?_lastBuffers!==_spriteBuffers&&(disableAttributes(),attributes.position.set(_spriteBuffers._webglVertexBuffer),attributes.uv.set(_spriteBuffers._webglUvBuffer),attributes.normal&&attributes.normal.set(_spriteBuffers._webglNormalBuffer),attributes.tangent&&attributes.tangent.set(_spriteBuffers._webglTangentBuffer),_lastBuffers=_spriteBuffers):_lastBuffers!==obj&&(disableAttributes(),obj._webglVertexBuffer&&attributes.position&&attributes.position.set(obj._webglVertexBuffer),obj._webglNormalBuffer&&attributes.normal&&attributes.normal.set(obj._webglNormalBuffer),obj._webglTangentBuffer&&attributes.tangent&&attributes.tangent.set(obj._webglTangentBuffer),obj._webglColorBuffer&&attributes.color&&attributes.color.set(obj._webglColorBuffer),obj._webglUvBuffer&&attributes.uv&&attributes.uv.set(obj._webglUvBuffer),obj._webglUv2Buffer&&attributes.uv2&&attributes.uv2.set(obj._webglUv2Buffer),obj._webglBoneIndexBuffer&&attributes.boneIndex&&attributes.boneIndex.set(obj._webglBoneIndexBuffer),obj._webglBoneWeightBuffer&&attributes.boneWeight&&attributes.boneWeight.set(obj._webglBoneWeightBuffer),obj._webglParticleBuffer&&attributes.data&&attributes.data.set(obj._webglParticleBuffer),obj._webglParticleColorBuffer&&attributes.particleColor&&attributes.particleColor.set(obj._webglParticleColorBuffer),material.wireframe?obj._webglLineBuffer&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,obj._webglLineBuffer):obj._webglIndexBuffer&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,obj._webglIndexBuffer),_lastBuffers=obj),sprite){if(texture=material.uniforms.diffuseMap,!texture){throw"Shader.bind: Sprite material and shader requires diffuseMap"}w=texture.invWidth,h=texture.invHeight,uniforms.size.set(_vector2.set(obj.width,obj.height),force),uniforms.crop.set(_vector4.set(obj.x*w,obj.y*h,obj.w*w,obj.h*h),force)}if(parameters.emitter&&parameters.worldSpace?(uniforms.modelMatrix&&uniforms.modelMatrix.set(_mat4.identity(),force),uniforms.modelViewMatrix&&uniforms.modelViewMatrix.set(camera.view,force)):(uniforms.modelMatrix&&uniforms.modelMatrix.set(transform.matrixWorld,force),uniforms.modelViewMatrix&&uniforms.modelViewMatrix.set(transform.modelView,force)),uniforms.particleSizeRatio&&(particleSizeRatio=_currentHeight>_currentWidth?_currentWidth:_currentHeight,particleSizeRatio*=parameters.emitter2d||camera.camera2d||camera.orthographic?1/(2*camera.orthographicSize):2,uniforms.particleSizeRatio.set(particleSizeRatio)),uniforms.projectionMatrix&&uniforms.projectionMatrix.set(camera.projection,force),uniforms.viewMatrix&&uniforms.viewMatrix.set(camera.view,force),uniforms.normalMatrix&&uniforms.normalMatrix.set(transform.normalMatrix,force),uniforms.cameraPosition&&uniforms.cameraPosition.set(_vector3.positionFromMat4((camera.transform||camera.transform2d).matrixWorld),force),uniforms.ambient&&uniforms.ambient.set(ambient,force),parameters.useBones){for(uBonesPos=uniforms.bonesPos,uBonesScl=uniforms.bonesScl,uBonesRot=uniforms.bonesRot,bones=component._bones,i=bones.length;i--;){bone=bones[i],boneTransform=bone.transform,_mat4.mmul(bone.uniform,bone.bindPose).decompose(_vector3,_vector3_2,_quat),uBonesPos[i].set(_vector3),uBonesScl[i].set(_vector3_2),uBonesRot[i].set(_quat)}}if(force&&parameters.useLights&&(length=lights.length)){for(maxPointLights=parameters.maxPointLights,maxDirectionalLights=parameters.maxDirectionalLights,maxSpotLights=parameters.maxSpotLights,maxHemiLights=parameters.maxHemiLights,pointLights=0,pointLightColor=uniforms.pointLightColor,pointLightPosition=uniforms.pointLightPosition,pointLightDistance=uniforms.pointLightDistance,directionalLights=0,directionalLightColor=uniforms.directionalLightColor,directionalLightDirection=uniforms.directionalLightDirection,spotLights=0,spotLightColor=uniforms.spotLightColor,spotLightPosition=uniforms.spotLightPosition,spotLightDirection=uniforms.spotLightDirection,spotLightDistance=uniforms.spotLightDistance,spotLightAngleCos=uniforms.spotLightAngleCos,spotLightExponent=uniforms.spotLightExponent,hemiLights=0,hemiLightColor=uniforms.hemiLightColor,hemiLightDirection=uniforms.hemiLightDirection,i=0;length>i;i++){if(light=lights[i],light.visible){if(type=light.type,_color.copy(light.color).smul(light.energy),pointLightColor.length&&type===LightType.Point){if(pointLights>=maxPointLights){continue}_vector3.positionFromMat4((light.transform||light.transform2d).matrixWorld),pointLightColor[pointLights].set(_color,force),pointLightPosition[pointLights].set(_vector3,force),pointLightDistance[pointLights].set(light.distance,force),pointLights++}else{if(directionalLightColor.length&&type===LightType.Directional){if(directionalLights>=maxDirectionalLights){continue}if(_vector3.positionFromMat4((light.transform||light.transform2d).matrixWorld).sub(light.target).normalize(),0===_vector3.lengthSq()){continue}directionalLightColor[directionalLights].set(_color,force),directionalLightDirection[directionalLights].set(_vector3,force),directionalLights++}else{if(spotLightColor.length&&type===LightType.Spot){if(spotLights>=maxSpotLights){continue}if(_vector3.positionFromMat4((light.transform||light.transform2d).matrixWorld),0===_vector3.lengthSq()){continue}if(_vector3_2.copy(_vector3).sub(light.target).normalize(),0===_vector3_2.lengthSq()){continue}spotLightColor[spotLights].set(_color,force),spotLightPosition[spotLights].set(_vector3,force),spotLightDirection[spotLights].set(_vector3_2,force),spotLightDistance[spotLights].set(light.distance,force),spotLightAngleCos[spotLights].set(light._angleCos,force),spotLightExponent[spotLights].set(light.exponent,force),spotLights++}else{if(hemiLightColor.length&&type===LightType.Hemi){if(hemiLights>=maxHemiLights){continue}if(_vector3.positionFromMat4((light.transform||light.transform2d).matrixWorld).sub(light.target).normalize(),0===_vector3.lengthSq()){continue}hemiLightColor[hemiLights].set(_color,force),hemiLightDirection[hemiLights].set(_vector3,force),hemiLights++}}}}}}}bindCustomUniforms(this._customUniforms,uniforms,material.name,material.uniforms,force),_textureIndex=0},Shader.prototype.buildShader=function(){var parameters=this.parameters,vertexShader=this.vertex,fragmentShader=this.fragment,sprite=parameters.sprite,emitter=parameters.emitter,useLights=parameters.useLights,useShadows=parameters.useShadows,useFog=parameters.useFog,useBones=parameters.useBones,useVertexLit=parameters.useVertexLit,useSpecular=parameters.useSpecular,OES_standard_derivatives=parameters.OES_standard_derivatives,definesPrefix=["precision "+_precision+" float;","precision "+_precision+" int;",useFog?"#define USE_FOG":"",useLights?"#define USE_LIGHTS":"",useShadows?"#define USE_SHADOWS":"",useBones?"#define USE_SKINNING":"",sprite?"#define IS_SPRITE":"",useLights?"#define MAX_DIR_LIGHTS "+parameters.maxDirectionalLights:"",useLights?"#define MAX_POINT_LIGHTS "+parameters.maxPointLights:"",useLights?"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights:"",useLights?"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights:"",useShadows?"#define MAX_SHADOWS "+parameters.maxShadows:"",""].join("\n"),vertexPrefix=[definesPrefix,"uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;",parameters.positions?"attribute vec3 position;":"",parameters.normals?"attribute vec3 normal;":"",parameters.tangents?"attribute vec4 tangent;":"",parameters.uvs?"attribute vec2 uv;":"",parameters.colors?"attribute vec3 color;":"",emitter?"attribute vec3 data;":"",useBones?"attribute vec3 boneIndex;":"",useBones?"attribute vec3 boneWeight;":"",useBones?"uniform vec4 bonesRot["+parameters.bones+"];":"",useBones?"uniform vec3 bonesScl["+parameters.bones+"];":"",useBones?"uniform vec3 bonesPos["+parameters.bones+"];":""].join("\n"),fragmentPrefix=[OES_standard_derivatives?"#extension GL_OES_standard_derivatives : enable":"",definesPrefix,"uniform mat4 viewMatrix;","uniform vec3 cameraPosition;"].join("\n"),glVertexShader=vertexPrefix+"\n"+vertexShader,glFragmentShader=fragmentPrefix+"\n"+fragmentShader,main="void main(void) {\n",footer="\n}",vertexHeader=glVertexShader.match(HEADER)[1],vertexMain=glVertexShader.match(MAIN_FUNCTION)[5],fragmentHeader=glFragmentShader.match(HEADER)[1],fragmentMain=glFragmentShader.match(MAIN_FUNCTION)[5];return sprite&&(vertexHeader+=ShaderChunks.sprite_header,vertexMain+=ShaderChunks.sprite_vertex_after),emitter&&(vertexHeader+=ShaderChunks.particle_header_vertex+ShaderChunks.particle_header,fragmentHeader+=ShaderChunks.particle_header,vertexMain=parameters.emitter2d?ShaderChunks.particle_vertex_size_2d+vertexMain:ShaderChunks.particle_vertex_size+vertexMain,vertexMain=ShaderChunks.particle_vertex+vertexMain),OES_standard_derivatives&&(parameters.useNormal&&(fragmentHeader+=ShaderChunks.perturbNormal2Arb),parameters.useBump&&(fragmentHeader+=ShaderChunks.dHdxy_fwd+ShaderChunks.perturbNormalArb)),useLights?(useVertexLit?vertexHeader+=ShaderChunks.lights+ShaderChunks.VertexLight:(vertexHeader+=ShaderChunks.perPixelVaryingHeader,vertexMain=ShaderChunks.perPixelVaryingMain+vertexMain,fragmentHeader+=ShaderChunks.lights+ShaderChunks.perPixelVaryingHeader,fragmentHeader+=useSpecular?ShaderChunks.PixelLight:ShaderChunks.PixelLightNoSpec),emitter?(vertexMain=ShaderChunks.mvPosition_emitter+vertexMain,vertexMain=ShaderChunks.worldPosition_emitter+vertexMain):(vertexMain=(sprite?ShaderChunks.mvPosition_sprite:ShaderChunks.mvPosition)+vertexMain,vertexMain=(sprite?ShaderChunks.worldPosition_sprite:ShaderChunks.worldPosition)+vertexMain),parameters.normals&&(vertexMain=ShaderChunks.transformedNormal+vertexMain)):vertexMain=emitter?ShaderChunks.mvPosition_emitter+vertexMain:(sprite?ShaderChunks.mvPosition_sprite:ShaderChunks.mvPosition)+vertexMain,useBones&&(vertexHeader+=ShaderChunks.composeMat4,vertexHeader+=ShaderChunks.getBoneMatrix,parameters.normals&&(vertexMain=ShaderChunks.boneNormal+vertexMain),vertexMain=ShaderChunks.bone+vertexMain),glVertexShader=vertexHeader+main+vertexMain+footer,glFragmentShader=fragmentHeader+main+fragmentMain+footer,this.program=createProgram(_gl,glVertexShader,glFragmentShader),parseUniformsAttributesArrays(vertexShader,fragmentShader,this._customAttributes=[],this._customUniforms=[]),parseUniformsAttributes(this.program,glVertexShader,glFragmentShader,this.attributes={},this.uniforms={}),this},useDepth=!opts.disableDepth,_this=this,_gl=void 0,_canvas=void 0,_element=void 0,_context=!1,_extensions=void 0,_precision="highp",_maxAnisotropy=0,_maxTextures=0,_maxVertexTextures=0,_maxTextureSize=0,_maxCubeTextureSize=0,_maxRenderBufferSize=0,_maxUniforms=0,_maxVaryings=0,_maxAttributes=0,_viewportX=0,_viewportY=0,_viewportWidth=1,_viewportHeight=1,_currentWidth=1,_currentHeight=1,_textureIndex=0,_lastClearColor=new Color,_lastClearAlpha=1,_lastBlending=-1,_lastCullFace=-1,_cullFaceDisabled=!0,_lastDepthTest=-1,_lastDepthWrite=-1,_lastLineWidth=-1,_currentFramebuffer=null,_enabledAttributes=void 0,_lastProgram=void 0,_attributes=merge(opts.attributes||{},{alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}),this.init=function(canvas){return _canvas&&this.clear(),_canvas=canvas,_element=canvas.element,_canvas2d=document.createElement("canvas"),_ctx=_canvas2d.getContext("2d"),initGL(),_context=!0,setDefaultGLState(),addEvent(_element,"webglcontextlost",handleWebGLContextLost,this),addEvent(_element,"webglcontextrestored",handleWebGLContextRestored,this),this},this.clear=function(){return _canvas?(this.off(),removeEvent(element,"webglcontextlost",handleWebGLContextLost,this),removeEvent(element,"webglcontextrestored",handleWebGLContextRestored,this),_gl=void 0,_canvas=void 0,_element=void 0,_context=!1,_extensions=void 0,_precision="highp",_maxAnisotropy=0,_maxTextures=0,_maxVertexTextures=0,_maxTextureSize=0,_maxCubeTextureSize=0,_maxRenderBufferSize=0,_maxUniforms=0,_maxVaryings=0,_maxAttributes=0,_viewportX=0,_viewportY=0,_viewportWidth=1,_viewportHeight=1,_textureIndex=0,_lastClearColor.set(0,0,0),_lastClearAlpha=1,_lastBlending=-1,_lastCullFace=-1,_cullFaceDisabled=!0,_lastDepthTest=-1,_lastDepthWrite=-1,_lastLineWidth=-1,_currentFramebuffer=null,_enabledAttributes=void 0,_lastProgram=void 0,_shaders={},_spriteBuffers=void 0,_lastBuffers=void 0,_lastCamera=void 0,_lastResizeFn=void 0,_lastScene=void 0,_lastGUI=void 0,_textTextures={},_canvas2d=void 0,_ctx=void 0,_guiContentShader=void 0,_guiBuffers=void 0,this):this},defineProperty(this,"gl",{get:function(){return _gl}}),defineProperty(this,"canvas",{get:function(){return _canvas}}),defineProperty(this,"element",{get:function(){return _element}}),defineProperty(this,"precision",{get:function(){return _precision}}),defineProperty(this,"maxAnisotropy",{get:function(){return _maxAnisotropy}}),defineProperty(this,"maxTextures",{get:function(){return _maxTextures}}),defineProperty(this,"maxVertexTextures",{get:function(){return _maxVertexTextures}}),defineProperty(this,"maxTextureSize",{get:function(){return _maxTextureSize}}),defineProperty(this,"maxCubeTextureSize",{get:function(){return _maxCubeTextureSize}}),defineProperty(this,"maxRenderBufferSize",{get:function(){return _maxRenderBufferSize}}),defineProperty(this,"maxUniforms",{get:function(){return _maxUniforms}}),defineProperty(this,"maxVaryings",{get:function(){return _maxVaryings}}),defineProperty(this,"maxAttributes",{get:function(){return _maxAttributes}}),this.setViewport=setViewport,this.setDepthTest=setDepthTest,this.setDepthWrite=setDepthWrite,this.setLineWidth=setLineWidth,this.setCullFace=setCullFace,this.setBlending=setBlending,this.setScissor=setScissor,this.setClearColor=setClearColor,this.clearCanvas=clearCanvas,this.clearColor=clearColor,this.clearDepth=clearDepth,this.clearStencil=clearStencil,this.setProgram=setProgram,this.enableAttribute=enableAttribute,this.disableAttributes=disableAttributes,this.setRenderTarget=setRenderTarget,getExtension_prefixes=["WEBKIT","MOZ","O","MS","webkit","moz","o","ms"],getExtension_length=getExtension_prefixes.length,this.getExtension=getExtension,SHADER_SPLITER=/[\n;]+/,ATTRIBURE=/attribute\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,UNIFORM=/uniform\s+([a-z]+\s+)?([A-Za-z0-9]+)\s+([a-zA-Z_0-9]+)\s*(\[\s*(.+)\s*\])?/,DEFINE=/#define\s+([a-zA-Z_0-9]+)?\s+([0-9]+)?/,this.parseUniformsAttributesArrays=parseUniformsAttributesArrays,this.parseUniformsAttributes=parseUniformsAttributes,Attribute1i.prototype.set=function(value){var location=this.location;location>-1&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,value),enableAttribute(location),_gl.vertexAttribPointer(location,1,_gl.FLOAT,!1,0,0))},Attribute1f.prototype.set=function(value){var location=this.location;location>-1&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,value),enableAttribute(location),_gl.vertexAttribPointer(location,1,_gl.FLOAT,!1,0,0))},Attribute2f.prototype.set=function(value){var location=this.location;location>-1&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,value),enableAttribute(location),_gl.vertexAttribPointer(location,2,_gl.FLOAT,!1,0,0))},Attribute3f.prototype.set=function(value){var location=this.location;location>-1&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,value),enableAttribute(location),_gl.vertexAttribPointer(location,3,_gl.FLOAT,!1,0,0))},Attribute4f.prototype.set=function(value){var location=this.location;location>-1&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,value),enableAttribute(location),_gl.vertexAttribPointer(location,4,_gl.FLOAT,!1,0,0))},Uniform1f.prototype.set=function(value,force){(force||this.value!==value)&&(_gl.uniform1f(this.location,value),this.value=value)},Uniform1i.prototype.set=function(value,force){(force||this.value!==value)&&(_gl.uniform1i(this.location,value),this.value=value)},Uniform2f.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniform2f(this.location,value.x,value.y),this.value.copy(value))},Uniform3f.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniform3f(this.location,value.x,value.y,value.z),this.value.copy(value))},Uniform4f.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniform4f(this.location,value.x,value.y,value.z,value.w),this.value.copy(value))},UniformMatrix2fv.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniformMatrix2fv(this.location,!1,value.elements),this.value.copy(value))},UniformMatrix3fv.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniformMatrix3fv(this.location,!1,value.elements),this.value.copy(value))},UniformMatrix4fv.prototype.set=function(value,force){(force||this.value.notEquals(value))&&(_gl.uniformMatrix4fv(this.location,!1,value.elements),this.value.copy(value))},UniformTexture.prototype.set=function(value){setTexture(this.location,value)},UniformTextureCube.prototype.set=function(value){setTextureCube(this.location,value)}}var guiContent_vertex,guiContent_fragment,Blending=Enums.Blending,ShadowMapType=Enums.ShadowMapType,CullFace=Enums.CullFace,Side=Enums.Side,LightType=Enums.LightType,FilterMode=Enums.FilterMode,TextureFormat=Enums.TextureFormat,TextureWrap=Enums.TextureWrap,getWebGLContext=Dom.getWebGLContext,addEvent=Dom.addEvent,removeEvent=Dom.removeEvent,createProgram=Dom.createProgram,merge=util.merge,max=Math.max,floor=Math.floor,clamp=Mathf.clamp,isPowerOfTwo=Mathf.isPowerOfTwo,defineProperty=Object.defineProperty,EMPTY_ARRAY=[];return EventEmitter.extend(Renderer),guiContent_vertex=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 mvpMatrix;","uniform vec2 size;","uniform vec4 crop;","varying vec2 vUv;","void main() {","	vUv.x = uv.x * crop.z + crop.x;","	vUv.y = uv.y * crop.w + crop.y;","	gl_Position = mvpMatrix * vec4(position.xy * size, position.z, 1.0);","}"].join("\n"),guiContent_fragment=["uniform sampler2D texture;","uniform float alpha;","varying vec2 vUv;","void main() {","	vec4 finalColor = texture2D(texture, vUv);","	gl_FragColor = vec4(finalColor.xyz, finalColor.w * alpha);","}"].join("\n"),Renderer}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/input/handler",["odin/base/event_emitter","odin/base/dom","odin/base/object_pool","odin/math/vec2","odin/core/input/input"],function(EventEmitter,Dom,ObjectPool,Vec2,Input){function Handler(){EventEmitter.call(this),this.element=void 0}function handleDevicemotion(e){var acceleration,acc=e.accelerationIncludingGravity;acc&&(acc.x||acc.y||acc.z)&&(acceleration=this.acceleration,acceleration.x=acc.x,acceleration.y=acc.y,acceleration.z=acc.z,this.emit("acceleration"))}function handleTouches(e){e.preventDefault();var i,il,type=e.type,touches=this.touches,targetTouches=e.targetTouches,changedTouches=e.changedTouches;if("touchstart"===type){for(i=0,il=targetTouches.length;il>i;i++){this.emit("touchstart",touches.start(i,targetTouches[i]))}}else{if("touchend"===type){for(i=0,il=changedTouches.length;il>i;i++){this.emit("touchend",touches.end(i))}}else{if("touchcancel"===type){touches.cancel(),this.emit("touchcancel")}else{if("touchmove"===type&&this.touchesMoveNeedsUpdate){for(i=0,il=changedTouches.length;il>i;i++){this.emit("touchmove",touches.move(i,changedTouches[i]))}this.touchesMoveNeedsUpdate=!1}}}}}function handleMouse(e){e.preventDefault();var button,type=e.type;"mousedown"===type?(button=MOUSE_BUTTONS[e.button],this.buttons.on(button),updateMousePosition(this,e),this.emit("mousedown",button)):"mouseup"===type?(button=MOUSE_BUTTONS[e.button],this.buttons.off(button),updateMousePosition(this,e),this.emit("mouseup",button)):"mouseout"===type?(button=MOUSE_BUTTONS[e.button],this.buttons.off(button),updateMousePosition(this,e),this.emit("mouseout",button)):"mousewheel"===type||"DOMMouseScroll"===type?(mouseWheel=max(-1,min(1,e.wheelDelta||-e.detail)),this.mouseWheel=mouseWheel,this.emit("mousewheel",mouseWheel)):"mousemove"===type&&this.mouseMoveNeedsUpdate&&(updateMousePosition(this,e),this.mouseMoveNeedsUpdate=!1,this.emit("mousemove"))
}function updateMousePosition(input,e){var position=input.mousePosition,delta=input.mouseDelta,element=e.target||e.srcElement,offsetX=element.offsetLeft||0,offsetY=element.offsetTop||0,x=(e.pageX||e.clientX)-offsetX,y=(e.pageY||e.clientY)-offsetY;mouseLast.x=mouseFirst?position.x:x,mouseLast.y=mouseFirst?position.y:y,position.x=x,position.y=y,delta.x=position.x-mouseLast.x,delta.y=position.y-mouseLast.y,mouseFirst=!0}function handleKeys(e){e.preventDefault();var type=e.type,key=KEY_CODES[e.keyCode];"keydown"===type?(this.buttons.on(key),this.emit("keydown",key)):"keyup"===type&&(this.buttons.off(key),this.emit("keyup",key))}var mouseFirst,mouseLast,mouseWheel,MOUSE_BUTTONS,KEY_CODES,i,min=Math.min,max=Math.max,addEvent=Dom.addEvent,removeEvent=Dom.removeEvent;for(EventEmitter.extend(Handler),Handler.prototype.setElement=function(element){this.element&&this.removeElement(),this.element=element,addEvent(element,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",handleMouse,Input),addEvent(top,"keydown keyup",handleKeys,Input),addEvent(element,"touchstart touchmove touchend touchcancel",handleTouches,Input),addEvent(window,"devicemotion",handleDevicemotion,Input)},Handler.prototype.removeElement=function(){if(this.element){var element=this.element;removeEvent(element,"mousedown mouseup mousemove mouseout mousewheel DOMMouseScroll",handleMouse,Input),removeEvent(top,"keydown keyup",handleKeys,Input),removeEvent(element,"touchstart touchmove touchend touchcancel",handleTouches,Input),removeEvent(window,"devicemotion",handleDevicemotion,Input),this.element=void 0}},mouseFirst=!1,mouseLast=new Vec2,mouseWheel=0,MOUSE_BUTTONS={0:"mouse0",1:"mouse1",2:"mouse2"},KEY_CODES={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},i=48;90>=i;i++){KEY_CODES[i]=String.fromCharCode(i).toLowerCase()}return new Handler}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/game",["odin/base/class","odin/base/device","odin/base/time","odin/math/mathf","odin/core/game/config","odin/core/game/base_game","odin/core/game/log","odin/core/renderer/canvas","odin/core/renderer/renderer","odin/core/game_object","odin/core/components/component","odin/core/scene","odin/core/input/input","odin/core/input/handler"],function(Class,Device,Time,Mathf,Config,BaseGame,Log,Canvas,Renderer,GameObject,Component,Scene,Input,Handler){function Game(opts){opts||(opts={}),Config.fromJSON(opts),BaseGame.call(this,opts),this._handler=Handler,this.input=Input,this.gui=void 0,this.scene=void 0,this.camera=void 0,this.canvas=new Canvas(opts.canvas),this.renderer=new Renderer(opts.renderer)}return BaseGame.extend(Game),Game.prototype.init=function(){var canvas=this.canvas;return canvas.init(),this.renderer.init(canvas),Handler.setElement(canvas.element),this._loop.resume(),this.emit("init"),this},Game.prototype.start=function(){return this.init(),this.emit("start"),this},Game.prototype.setGUI=function(gui){return"string"==typeof gui?gui=this._guiNameHash[gui]:"number"==typeof gui&&(gui=this.guis[gui]),this._guiNameHash[gui.name]&&this._guiHash[gui._id]?(this.gui&&this.gui.destroy(),gui=Class.fromJSON(gui),this.gui=gui,gui.game=this,gui.init(),gui.emit("init"),gui.start(),gui.emit("start"),this.emit("setGUI",this.gui)):Log.error("Game.setGUI: GUI is not a member of Game"),this},Game.prototype.setScene=function(scene){return"string"==typeof scene?scene=this._sceneNameHash[scene]:"number"==typeof scene&&(scene=this.scenes[scene]),this._sceneNameHash[scene.name]&&this._sceneHash[scene._id]?(this.scene&&this.scene.destroy(),scene=Class.fromJSON(scene),this.scene=scene,scene.game=this,scene.init(),scene.emit("init"),scene.start(),scene.emit("start"),this.emit("setScene",this.scene)):Log.error("Game.setScene: Scene is not a member of Game"),this},Game.prototype.setCamera=function(gameObject){if(!(gameObject instanceof GameObject)){return Log.error("Game.setCamera: can't set argument to Game's Active Camera, it's not an instance of GameObject"),this}var index,scene=this.scene,lastCamera=this.camera;return scene?(index=scene.gameObjects.indexOf(gameObject),-1===index&&(Log.warn("Game.setCamera: GameObject is not a member of the active Scene, adding it..."),scene.addGameObject(gameObject)),this.camera=gameObject.camera||gameObject.camera2d,this.camera?(this.camera._active=!0,lastCamera&&(lastCamera._active=!1),this.emit("setCamera",this.camera)):Log.error("Game.setCamera: GameObject does't have a Camera or a Camera2D Component"),this):(Log.error("Game.setCamera: can't set camera without an active scene, use Game.setScene first"),this)},Game.prototype.loop=function(){var camera=this.camera,scene=this.scene,gui=this.gui,renderer=this.renderer;Time.update(),Input.update(),renderer&&camera&&(scene&&(scene.update(),scene.emit("update")),gui&&(gui.aspect=camera.aspect,gui.width=camera.width,gui.height=camera.height,gui.invWidth=camera.invWidth,gui.invHeight=camera.invHeight,gui.update(),gui.emit("update")),this.emit("update",Time.sinceStart),renderer.render(camera,scene,gui),this.emit("lateUpdate",Time.sinceStart))},Game}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/game/client_game",["odin/base/device","odin/base/socket.io","odin/base/time","odin/math/mathf","odin/core/game/config","odin/core/game/game","odin/core/game/log","odin/core/renderer/canvas","odin/core/game_object","odin/core/components/component","odin/core/scene","odin/core/input/input","odin/core/input/handler","odin/core/assets/assets","odin/core/assets/asset_loader"],function(Device,io,Time,Mathf,Config,Game,Log,GameObject,Component,Scene,Assets,AssetLoader){function ClientGame(opts){opts||(opts={}),Config.fromJSON(opts),Game.call(this,opts),this.io=void 0,this._sessionid=void 0,this._inputStamp=0,this._deltaState=Config.SCENE_SYNC_RATE+Config.FAKE_LAG,this._lag=Config.FAKE_LAG}var stamp=Time.stamp;return Game.extend(ClientGame),ClientGame.prototype.connect=function(handler){var lastState,canvasOnResize,self=this,socket=this.io=io.connect(Config.host+":"+Config.port);return socket.on("connect",function(){self._sessionid||(self._sessionid=this.socket.sessionid),self._sessionid!==this.socket.sessionid&&location.reload(),socket.emit("client_device",Device)}),socket.on("server_ready",function(game,assets){Assets.fromServerJSON(assets),AssetLoader.load(function(){self.fromServerJSON(game),socket.emit("client_ready"),self.emit("connect",socket),handler&&handler.call(self,socket)})}),socket.on("server_sync_input",function(timeStamp){self._inputStamp=timeStamp-2*Config.FAKE_LAG,socket.emit("client_sync_input",Input.toSYNC(),stamp())}),lastState=0,socket.on("server_sync_scene",function(jsonScene,serverTimeStamp){var timeStamp,lag,scene=self.scene;scene&&(timeStamp=stamp(),lag=timeStamp-serverTimeStamp+Config.FAKE_LAG,self._lag=lag,self._deltaState=timeStamp-(lastState||timeStamp-Config.SCENE_SYNC_RATE-lag),lastState=timeStamp-lag,self.emit("serverSyncScene",jsonScene),Config.SYNC_SERVER_SCENE&&scene.fromSYNC(jsonScene))}),socket.on("server_setScene",function(scene_id){var scene=self.findByJSONId(scene_id);self.setScene(scene)}),socket.on("server_setCamera",function(camera_id){if(!self.scene){return Log.error("Socket:server_setCamera: can't set camera without an active scene, use ServerGame.setScene first"),void 0}var camera=self.scene.findByJSONId(camera_id),canvas=self.canvas;return camera?(self.setCamera(camera),canvasOnResize&&canvas.off("resize",canvasOnResize),canvas.on("resize",canvasOnResize=function(){socket.emit("client_resize",this.pixelWidth,this.pixelHeight)}),socket.emit("client_resize",canvas.pixelWidth,canvas.pixelHeight),void 0):(Log.error("Socket:server_setCamera: can't find camera in active scene"),void 0)}),socket.on("server_addScene",function(scene){self.addScene((new Scene).fromServerJSON(scene))}),socket.on("server_addGameObject",function(scene_id,gameObject){var scene=self.findByJSONId(scene_id);scene&&scene.addGameObject((new GameObject).fromServerJSON(gameObject))}),socket.on("server_addComponent",function(scene_id,gameObject_id,component){var gameObject,scene=self.findByJSONId(scene_id);scene&&(gameObject=scene.findByJSONId(gameObject_id),gameObject&&gameObject.addComponent(new Component._types[component._type].fromServerJSON(component)))}),socket.on("server_removeScene",function(scene_id){self.removeScene(self.findByJSONId(scene_id))}),socket.on("server_removeGameObject",function(scene_id,gameObject_id){var scene=self.findByJSONId(scene_id);scene&&scene.removeGameObject(scene.findByJSONId(gameObject_id))}),socket.on("server_removeComponent",function(scene_id,gameObject_id,component_type){var gameObject,scene=self.findByJSONId(scene_id);scene&&(gameObject=scene.findByJSONId(gameObject_id),gameObject&&gameObject.removeComponent(gameObject.getComponent(component_type)))}),this},ClientGame.prototype.disconnect=function(){var socket=this.io;return socket.disconnect(),socket.removeAllListeners(),this._sessionid=void 0,this},ClientGame}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_style_state",["odin/math/color"],function(Color){function GUIStyleState(opts){opts||(opts={}),this.background=void 0!=opts.background?opts.background:new Color(1,1,1),this.text=void 0!=opts.text?opts.text:new Color}return GUIStyleState.prototype.clone=function(){return(new GUIStyleState).copy(this)},GUIStyleState.prototype.copy=function(other){return this.background.copy(other.background),this.text.copy(other.text),this},GUIStyleState.prototype.toJSON=function(json){return json||(json={}),json.background=this.background.toJSON(json.background),json.text=this.text.toJSON(json.text),json},GUIStyleState.prototype.fromJSON=function(json){return this.background.fromJSON(json.background),this.text.fromJSON(json.text),this},GUIStyleState}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/gui_style",["odin/base/class","odin/math/rect_offset","odin/math/vec2","odin/core/enums","odin/core/gui/gui_style_state"],function(Class,RectOffset,Vec2,Enums,GUIStyleState){function GUIStyle(opts){opts||(opts={}),this._id=++GUI_STYLE_ID,this._state="normal",this.name=opts.name||"GUIStyle_"+this._id,this.alpha=void 0!=opts.alpha?opts.alpha:1,this.z=void 0!=opts.z?opts.z:0,this.alignment=opts.alignment||TextAnchor.Left,this.clipping=opts.alignment||TextClipping.Clip,this.contentOffset=opts.contentOffset||new Vec2,this.fixedHeight=opts.fixedHeight||0,this.fixedWidth=opts.fixedWidth||0,this.normal=new GUIStyleState(opts.normal),this.active=new GUIStyleState(opts.active),this.focused=new GUIStyleState(opts.focused),this.hover=new GUIStyleState(opts.hover),this.font=opts.font||"Arial",this.bitmap=void 0!=opts.bitmap?opts.bitmap:!1,this.fontSize=opts.fontSize||16,this.fontStyle=opts.fontStyle||"normal",this.lineHeight=opts.lineHeight||24,this.lineSpacing=opts.lineSpacing||0,this.margin=opts.margin||new RectOffset,this.padding=opts.padding||new RectOffset,this.border=opts.border||new RectOffset,this.overflow=opts.overflow||new RectOffset,this.stretchHeight=void 0!=opts.stretchHeight?opts.stretchHeight:!0,this.stretchWidth=void 0!=opts.stretchWidth?opts.stretchWidth:!0,this.wordWrap=void 0!=opts.wordWrap?opts.wordWrap:!0}var GUI_STYLE_ID=0,TextAnchor=Enums.TextAnchor,TextClipping=Enums.TextClipping;return GUIStyle.prototype.clone=function(){return(new GUIStyle).copy(this)},GUIStyle.prototype.copy=function(other){return this.name=other.name,this.alpha=other.alpha,this.z=other.z,this.alignment=other.alignment,this.clipping=other.alignment,this.contentOffset.copy(other.contentOffset),this.fixedHeight=other.fixedHeight||0,this.fixedWidth=other.fixedWidth||0,this.normal.copy(other.normal),this.active.copy(other.active),this.focused.copy(other.focused),this.hover.copy(other.hover),this.font=other.font,this.fontSize=other.fontSize,this.fontStyle=other.fontStyle,this.lineHeight=other.lineHeight,this.margin.copy(other.margin),this.padding.copy(other.padding),this.border.copy(other.border),this.overflow.copy(other.overflow),this.stretchHeight=other.stretchHeight,this.stretchWidth=other.stretchWidth,this.wordWrap=other.wordWrap,this},GUIStyle.prototype.toJSON=function(json){return json||(json={}),json.name=this.name,json.alpha=this.alpha,json.z=this.z,json.alignment=this.alignment,json.clipping=this.alignment,json.contentOffset=this.contentOffset.toJSON(json.contentOffset),json.fixedHeight=this.fixedHeight||0,json.fixedWidth=this.fixedWidth||0,json.normal=this.normal.toJSON(json.normal),json.active=this.active.toJSON(json.active),json.focused=this.focused.toJSON(json.focused),json.hover=this.hover.toJSON(json.hover),json.font=this.font,json.fontSize=this.fontSize,json.fontStyle=this.fontStyle,json.lineHeight=this.lineHeight,json.margin=this.margin.toJSON(json.margin),json.padding=this.padding.toJSON(json.padding),json.border=this.border.toJSON(json.border),json.overflow=this.overflow.toJSON(json.overflow),json.stretchHeight=this.stretchHeight,json.stretchWidth=this.stretchWidth,json.wordWrap=this.wordWrap,json},GUIStyle.prototype.fromJSON=function(json){return this.name=json.name,this.alpha=json.alpha,this.z=json.z,this.alignment=json.alignment,this.clipping=json.alignment,this.contentOffset.fromJSON(json.contentOffset),this.fixedHeight=json.fixedHeight||0,this.fixedWidth=json.fixedWidth||0,this.normal.fromJSON(json.normal),this.active.fromJSON(json.active),this.focused.fromJSON(json.focused),this.hover.fromJSON(json.hover),this.font=json.font,this.fontSize=json.fontSize,this.fontStyle=json.fontStyle,this.lineHeight=json.lineHeight,this.margin.fromJSON(json.margin),this.padding.fromJSON(json.padding),this.border.fromJSON(json.border),this.overflow.fromJSON(json.overflow),this.stretchHeight=json.stretchHeight,this.stretchWidth=json.stretchWidth,this.wordWrap=json.wordWrap,this},GUIStyle}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/gui/components/gui_content",["odin/base/device","odin/math/vec2","odin/core/input/input","odin/core/gui/gui_style","odin/core/gui/components/gui_component"],function(Device,Vec2,Input,GUIStyle,GUIComponent){function GUIContent(opts){opts||(opts={}),GUIComponent.call(this,"GUIContent",opts),this.text=opts.text,this.texture=opts.texture,this.style=opts.style instanceof GUIStyle?opts.style:new GUIStyle(opts.style),this._down=!1,this._needsUpdate=!0}GUIComponent.extend(GUIContent),GUIContent.prototype.copy=function(other){return this.text=other.text,this.texture=other.texture,this.style.copy(other.style),this},GUIContent.prototype.clear=function(){return GUIComponent.prototype.clear.call(this),this};new Vec2;return GUIContent.prototype.update=function(){},GUIContent.prototype.setText=function(text){return this.text=text.toString(),this._needsUpdate=!0,this},GUIContent.prototype.sort=function(a,b){return b.style.z-a.style.z},GUIContent.prototype.toJSON=function(json){return json=GUIComponent.prototype.toJSON.call(this,json),json.text=this.text,json.texture=this.texture?this.texture.name:void 0,json.style=this.style.toJSON(json.style),json},GUIContent.prototype.fromJSON=function(json){return GUIComponent.prototype.fromJSON.call(this,json),this.text=json.text,this.texture=json.texture?Assets.get(json.texture):void 0,this.style.fromJSON(json.style),this},GUIContent}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/world/world_2d",["odin/base/time","odin/math/color","odin/core/world/world","odin/phys2d/phys2d"],function(Time,Color,World,Phys2D){function World2D(opts){opts||(opts={}),World.call(this,opts),this.space=new Phys2D.P2Space(opts.space)}return World.extend(World2D),World2D.prototype.init=function(){for(var space=this.space,scene=this.scene,RigidBodies=scene.components.RigidBody2D,i=RigidBodies.length;i--;){space.addBody(RigidBodies[i].body)}scene.on("addRigidBody2D",function(component){space.addBody(component.body)}),scene.on("removeRigidBody2D",function(component){space.removeBody(component.body)})},World2D.prototype.update=function(){this.space.step(Time.delta)},World2D.prototype.clear=function(){return World.prototype.clear.call(this),this},World2D.prototype.toSYNC=function(json){return json=World.prototype.toSYNC.call(this,json)},World2D.prototype.fromSYNC=function(json){return World.prototype.fromSYNC.call(this,json),this},World2D.prototype.toJSON=function(json){return json=World.prototype.toJSON.call(this,json),json.space=this.space.toJSON(json.space),json},World2D.prototype.fromJSON=function(json){return World.prototype.fromJSON.call(this,json),this.space.fromJSON(json.space),this},World2D}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/core/prefab",["odin/base/class","odin/base/object_pool","odin/core/game/log"],function(Class,ObjectPool){function Prefab(object){Class.call(this),this.object=object.toJSON(),this.objectPool=new ObjectPool(object.constructor)}function onRemove(object){this.objectPool.removeObject(object),object.off("remove",onRemove,this)}return Class.extend(Prefab),Prefab.prototype.create=function(){var object=this.objectPool.create();return object.fromJSON(this.object),object.on("remove",onRemove,this),object},Prefab.prototype.setObject=function(object){return this.object=object.toJSON(),this.objectPool=new ObjectPool(object.constructor),this},Prefab.prototype.empty=function(){return this.objectPool.empty(),this},Prefab.prototype.toJSON=function(json){return json=Class.prototype.toJSON.call(this,json),json.object=this.object,json},Prefab.prototype.fromJSON=function(json){return Class.prototype.fromJSON.call(this,json),this.object=json.object,this.objectPool=new ObjectPool(Class._classes[json.object._className]),this},Prefab}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/math/aabb3",["odin/math/mathf","odin/math/vec3"],function(Mathf,Vec3){function AABB3(min,max){this.min=min||new Vec3(1/0,1/0,1/0),this.max=max||new Vec3(-1/0,-1/0,-1/0)}return AABB3.prototype.clone=function(){return new AABB3(this.min.clone(),this.max.clone())},AABB3.prototype.copy=function(other){return this.min.copy(other.min),this.max.copy(other.max),this},AABB3.prototype.set=function(min,max){return this.min.copy(min),this.max.copy(max),this},AABB3.prototype.expandPoint=function(v){return this.min.min(v),this.max.max(v),this},AABB3.prototype.expandVec=function(v){return this.min.sub(v),this.max.add(v),this},AABB3.prototype.expandScalar=function(s){return this.min.ssub(s),this.max.sadd(s),this},AABB3.prototype.union=function(other){return this.min.min(other.min),this.max.max(other.max),this},AABB3.prototype.clear=function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this},AABB3.prototype.contains=function(point){var min=this.min,max=this.max,px=point.x,py=point.y,pz=point.z;return!(px<min.x||px>max.x||py<min.y||py>max.y||pz<min.z||pz>max.z)},AABB3.prototype.intersects=function(other){var aMin=this.min,aMax=this.max,bMin=other.min,bMax=other.max;return!(bMax.x<aMin.x||bMin.x>aMax.x||bMax.y<aMin.y||bMin.y>aMax.y||bMax.z<aMin.z||bMin.z>aMax.z)},AABB3.prototype.fromPoints=function(points){for(var v,x,y,z,i=points.length,minx=1/0,miny=1/0,minz=1/0,maxx=-1/0,maxy=-1/0,maxz=-1/0,min=this.min,max=this.max;i--;){v=points[i],x=v.x,y=v.y,z=v.z,minx=minx>x?x:minx,miny=miny>y?y:miny,minz=minz>z?z:minz,maxx=x>maxx?x:maxx,maxy=y>maxy?y:maxy,maxz=z>maxz?z:maxz}return min.x=minx,min.y=miny,min.z=minz,max.x=maxx,max.y=maxy,max.z=maxz,this},AABB3.prototype.fromCenterSize=function(center,size){var min=this.min,max=this.max,x=center.x,y=center.y,z=center.z,hx=.5*size.x,hy=.5*size.y,hz=.5*size.z;return min.x=x-hx,min.y=y-hy,min.z=z-hz,max.x=x+hx,max.y=y+hy,max.z=z+hz,this},AABB3.prototype.equals=function(other){return!(!this.min.equals(other.min)||!this.max.equals(other.max))},AABB3.prototype.notEquals=function(other){return this.min.notEquals(other.min)||this.max.notEquals(other.max)},AABB3.prototype.fromJSON=function(json){return this.min.fromJSON(json.min),this.max.fromJSON(json.max),this},AABB3.prototype.toJSON=function(json){return json||(json={}),json.min=this.min.toJSON(json.min),json.max=this.max.toJSON(json.max),json},AABB3.prototype.toString=function(){var min=this.min,max=this.max;return"AABB3( min: "+min+", max: "+max+" )"},AABB3}),"function"!=typeof define&&(define=require("amdefine")(module)),define("odin/odin",["require","odin/base/time","odin/phys2d/phys2d","odin/base/audio_ctx","odin/base/class","odin/base/device","odin/base/dom","odin/base/enum","odin/base/event_emitter","odin/base/object_pool","odin/base/request_animation_frame","odin/base/socket.io","odin/base/time","odin/base/util","odin/core/assets/shaders/shader","odin/core/assets/shaders/shader_lib","odin/core/assets/asset","odin/core/assets/asset_loader","odin/core/assets/assets","odin/core/assets/audio_clip","odin/core/assets/material","odin/core/assets/mesh","odin/core/assets/sprite_sheet","odin/core/assets/texture","odin/core/assets/texture_cube","odin/core/components/particle_system/particle_system","odin/core/components/audio_source","odin/core/components/camera","odin/core/components/camera_2d","odin/core/components/component","odin/core/components/gui_text","odin/core/components/gui_texture","odin/core/components/light","odin/core/components/mesh_animation","odin/core/components/mesh_filter","odin/core/components/orbit_control","odin/core/components/rigid_body_2d","odin/core/components/sprite","odin/core/components/sprite_animation","odin/core/components/transform","odin/core/components/transform_2d","odin/core/game/base_game","odin/core/game/client_game","odin/core/game/game","odin/core/game/config","odin/core/game/log","odin/core/gui/components/gui_component","odin/core/gui/components/gui_content","odin/core/gui/components/gui_transform","odin/core/gui/gui","odin/core/gui/gui_object","odin/core/gui/gui_style","odin/core/gui/gui_style_state","odin/core/input/handler","odin/core/input/input","odin/core/renderer/canvas","odin/core/renderer/render_target","odin/core/renderer/renderer","odin/core/renderer/shader_chunks","odin/core/world/world","odin/core/world/world_2d","odin/core/enums","odin/core/game_object","odin/core/prefab","odin/core/scene","odin/math/aabb2","odin/math/aabb3","odin/math/color","odin/math/mat2","odin/math/mat3","odin/math/mat32","odin/math/mat4","odin/math/mathf","odin/math/quat","odin/math/rect","odin/math/rect_offset","odin/math/vec2","odin/math/vec3","odin/math/vec4"],function(require){function Odin(){this.Phys2D=require("odin/phys2d/phys2d"),this.AudioCtx=require("odin/base/audio_ctx"),this.Class=require("odin/base/class"),this.Device=require("odin/base/device"),this.Dom=require("odin/base/dom"),this.Enum=require("odin/base/enum"),this.EventEmitter=require("odin/base/event_emitter"),this.ObjectPool=require("odin/base/object_pool"),this.requestAnimationFrame=require("odin/base/request_animation_frame"),this.io=require("odin/base/socket.io"),this.Time=require("odin/base/time"),this.util=require("odin/base/util"),this.Shader=require("odin/core/assets/shaders/shader"),this.ShaderLib=require("odin/core/assets/shaders/shader_lib"),this.Asset=require("odin/core/assets/asset"),this.AssetLoader=require("odin/core/assets/asset_loader"),this.Assets=require("odin/core/assets/assets"),this.AudioClip=require("odin/core/assets/audio_clip"),this.Material=require("odin/core/assets/material"),this.Mesh=require("odin/core/assets/mesh"),this.SpriteSheet=require("odin/core/assets/sprite_sheet"),this.Texture=require("odin/core/assets/texture"),this.TextureCube=require("odin/core/assets/texture_cube"),this.ParticleSystem=require("odin/core/components/particle_system/particle_system"),this.AudioSource=require("odin/core/components/audio_source"),this.Camera=require("odin/core/components/camera"),this.Camera2D=require("odin/core/components/camera_2d"),this.Component=require("odin/core/components/component"),this.GUIText=require("odin/core/components/gui_text"),this.GUITexture=require("odin/core/components/gui_texture"),this.Light=require("odin/core/components/light"),this.MeshAnimation=require("odin/core/components/mesh_animation"),this.MeshFilter=require("odin/core/components/mesh_filter"),this.OrbitControl=require("odin/core/components/orbit_control"),this.RigidBody2D=require("odin/core/components/rigid_body_2d"),this.Sprite=require("odin/core/components/sprite"),this.SpriteAnimation=require("odin/core/components/sprite_animation"),this.Transform=require("odin/core/components/transform"),this.Transform2D=require("odin/core/components/transform_2d"),this.BaseGame=require("odin/core/game/base_game"),this.ClientGame=require("odin/core/game/client_game"),this.Game=require("odin/core/game/game"),this.Config=require("odin/core/game/config"),this.Log=require("odin/core/game/log"),this.GUIComponent=require("odin/core/gui/components/gui_component"),this.GUIContent=require("odin/core/gui/components/gui_content"),this.GUITransform=require("odin/core/gui/components/gui_transform"),this.GUI=require("odin/core/gui/gui"),this.GUIObject=require("odin/core/gui/gui_object"),this.GUIStyle=require("odin/core/gui/gui_style"),this.GUIStyleState=require("odin/core/gui/gui_style_state"),this.Handler=require("odin/core/input/handler"),this.Input=require("odin/core/input/input"),this.Canvas=require("odin/core/renderer/canvas"),this.RenderTarget=require("odin/core/renderer/render_target"),this.Renderer=require("odin/core/renderer/renderer"),this.ShaderChunks=require("odin/core/renderer/shader_chunks"),this.World=require("odin/core/world/world"),this.World2D=require("odin/core/world/world_2d"),this.Enums=require("odin/core/enums"),this.GameObject=require("odin/core/game_object"),this.Prefab=require("odin/core/prefab"),this.Scene=require("odin/core/scene"),this.AABB2=require("odin/math/aabb2"),this.AABB3=require("odin/math/aabb3"),this.Color=require("odin/math/color"),this.Mat2=require("odin/math/mat2"),this.Mat3=require("odin/math/mat3"),this.Mat32=require("odin/math/mat32"),this.Mat4=require("odin/math/mat4"),this.Mathf=require("odin/math/mathf"),this.Quat=require("odin/math/quat"),this.Rect=require("odin/math/rect"),this.RectOffset=require("odin/math/rect_offset"),this.Vec2=require("odin/math/vec2"),this.Vec3=require("odin/math/vec3"),this.Vec4=require("odin/math/vec4"),this.Device.mobile&&(window.onerror=function(message,page,line){alert("line: "+line+", page: "+page+"\nmessage: "+message)})}var Time=require("odin/base/time"),now=Time.now,IS_SERVER=!("undefined"!=typeof window&&window.document),IS_CLIENT=!IS_SERVER,defineProperty=Object.defineProperty;return defineProperty(Odin.prototype,"isServer",{get:function(){return IS_SERVER}}),defineProperty(Odin.prototype,"isClient",{get:function(){return IS_CLIENT}}),Odin.prototype.globalize=function(){for(var key in this){window[key]=this[key]}window.Odin=this},Odin.prototype.benchmark=function(name,fn,times){times||(times=1e3);for(var start=0,time=0,i=times;i--;){start=now(),fn(),time+=now()-start}console.log(name+":\n	"+times/time+" (ops/sec)\n	"+time/times+"(avg/call)")},new Odin});
//# sourceMappingURL=odin.js.map